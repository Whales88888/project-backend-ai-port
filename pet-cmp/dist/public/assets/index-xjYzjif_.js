var Hy=n=>{throw TypeError(n)};var lh=(n,e,t)=>e.has(n)||Hy("Cannot "+t);var k=(n,e,t)=>(lh(n,e,"read from private field"),t?t.call(n):e.get(n)),ye=(n,e,t)=>e.has(n)?Hy("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),ie=(n,e,t,r)=>(lh(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),Pe=(n,e,t)=>(lh(n,e,"access private method"),t);var Kc=(n,e,t,r)=>({set _(s){ie(n,e,s,t)},get _(){return k(n,e,r)}});function BC(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function BE(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var VE={exports:{}},uf={},GE={exports:{}},je={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kc=Symbol.for("react.element"),VC=Symbol.for("react.portal"),GC=Symbol.for("react.fragment"),KC=Symbol.for("react.strict_mode"),HC=Symbol.for("react.profiler"),zC=Symbol.for("react.provider"),WC=Symbol.for("react.context"),YC=Symbol.for("react.forward_ref"),qC=Symbol.for("react.suspense"),QC=Symbol.for("react.memo"),XC=Symbol.for("react.lazy"),zy=Symbol.iterator;function ZC(n){return n===null||typeof n!="object"?null:(n=zy&&n[zy]||n["@@iterator"],typeof n=="function"?n:null)}var KE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},HE=Object.assign,zE={};function jo(n,e,t){this.props=n,this.context=e,this.refs=zE,this.updater=t||KE}jo.prototype.isReactComponent={};jo.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};jo.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function WE(){}WE.prototype=jo.prototype;function vg(n,e,t){this.props=n,this.context=e,this.refs=zE,this.updater=t||KE}var xg=vg.prototype=new WE;xg.constructor=vg;HE(xg,jo.prototype);xg.isPureReactComponent=!0;var Wy=Array.isArray,YE=Object.prototype.hasOwnProperty,Sg={current:null},qE={key:!0,ref:!0,__self:!0,__source:!0};function QE(n,e,t){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)YE.call(e,r)&&!qE.hasOwnProperty(r)&&(s[r]=e[r]);var o=arguments.length-2;if(o===1)s.children=t;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];s.children=l}if(n&&n.defaultProps)for(r in o=n.defaultProps,o)s[r]===void 0&&(s[r]=o[r]);return{$$typeof:kc,type:n,key:i,ref:a,props:s,_owner:Sg.current}}function JC(n,e){return{$$typeof:kc,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Eg(n){return typeof n=="object"&&n!==null&&n.$$typeof===kc}function eL(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Yy=/\/+/g;function ch(n,e){return typeof n=="object"&&n!==null&&n.key!=null?eL(""+n.key):e.toString(36)}function Pu(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case kc:case VC:a=!0}}if(a)return a=n,s=s(a),n=r===""?"."+ch(a,0):r,Wy(s)?(t="",n!=null&&(t=n.replace(Yy,"$&/")+"/"),Pu(s,e,t,"",function(c){return c})):s!=null&&(Eg(s)&&(s=JC(s,t+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(Yy,"$&/")+"/")+n)),e.push(s)),1;if(a=0,r=r===""?".":r+":",Wy(n))for(var o=0;o<n.length;o++){i=n[o];var l=r+ch(i,o);a+=Pu(i,e,t,l,s)}else if(l=ZC(n),typeof l=="function")for(n=l.call(n),o=0;!(i=n.next()).done;)i=i.value,l=r+ch(i,o++),a+=Pu(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Hc(n,e,t){if(n==null)return n;var r=[],s=0;return Pu(n,r,"","",function(i){return e.call(t,i,s++)}),r}function tL(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var hn={current:null},Nu={transition:null},nL={ReactCurrentDispatcher:hn,ReactCurrentBatchConfig:Nu,ReactCurrentOwner:Sg};function XE(){throw Error("act(...) is not supported in production builds of React.")}je.Children={map:Hc,forEach:function(n,e,t){Hc(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Hc(n,function(){e++}),e},toArray:function(n){return Hc(n,function(e){return e})||[]},only:function(n){if(!Eg(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};je.Component=jo;je.Fragment=GC;je.Profiler=HC;je.PureComponent=vg;je.StrictMode=KC;je.Suspense=qC;je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nL;je.act=XE;je.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=HE({},n.props),s=n.key,i=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=Sg.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)YE.call(e,l)&&!qE.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];r.children=o}return{$$typeof:kc,type:n.type,key:s,ref:i,props:r,_owner:a}};je.createContext=function(n){return n={$$typeof:WC,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:zC,_context:n},n.Consumer=n};je.createElement=QE;je.createFactory=function(n){var e=QE.bind(null,n);return e.type=n,e};je.createRef=function(){return{current:null}};je.forwardRef=function(n){return{$$typeof:YC,render:n}};je.isValidElement=Eg;je.lazy=function(n){return{$$typeof:XC,_payload:{_status:-1,_result:n},_init:tL}};je.memo=function(n,e){return{$$typeof:QC,type:n,compare:e===void 0?null:e}};je.startTransition=function(n){var e=Nu.transition;Nu.transition={};try{n()}finally{Nu.transition=e}};je.unstable_act=XE;je.useCallback=function(n,e){return hn.current.useCallback(n,e)};je.useContext=function(n){return hn.current.useContext(n)};je.useDebugValue=function(){};je.useDeferredValue=function(n){return hn.current.useDeferredValue(n)};je.useEffect=function(n,e){return hn.current.useEffect(n,e)};je.useId=function(){return hn.current.useId()};je.useImperativeHandle=function(n,e,t){return hn.current.useImperativeHandle(n,e,t)};je.useInsertionEffect=function(n,e){return hn.current.useInsertionEffect(n,e)};je.useLayoutEffect=function(n,e){return hn.current.useLayoutEffect(n,e)};je.useMemo=function(n,e){return hn.current.useMemo(n,e)};je.useReducer=function(n,e,t){return hn.current.useReducer(n,e,t)};je.useRef=function(n){return hn.current.useRef(n)};je.useState=function(n){return hn.current.useState(n)};je.useSyncExternalStore=function(n,e,t){return hn.current.useSyncExternalStore(n,e,t)};je.useTransition=function(){return hn.current.useTransition()};je.version="18.3.1";GE.exports=je;var E=GE.exports;const Ct=BE(E),ZE=BC({__proto__:null,default:Ct},[E]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rL=E,sL=Symbol.for("react.element"),iL=Symbol.for("react.fragment"),aL=Object.prototype.hasOwnProperty,oL=rL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,lL={key:!0,ref:!0,__self:!0,__source:!0};function JE(n,e,t){var r,s={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)aL.call(e,r)&&!lL.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:sL,type:n,key:i,ref:a,props:s,_owner:oL.current}}uf.Fragment=iL;uf.jsx=JE;uf.jsxs=JE;VE.exports=uf;var h=VE.exports,eT={exports:{}},Vn={},tT={exports:{}},nT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(D,N){var K=D.length;D.push(N);e:for(;0<K;){var V=K-1>>>1,W=D[V];if(0<s(W,N))D[V]=N,D[K]=W,K=V;else break e}}function t(D){return D.length===0?null:D[0]}function r(D){if(D.length===0)return null;var N=D[0],K=D.pop();if(K!==N){D[0]=K;e:for(var V=0,W=D.length,de=W>>>1;V<de;){var pe=2*(V+1)-1,ge=D[pe],me=pe+1,ee=D[me];if(0>s(ge,K))me<W&&0>s(ee,ge)?(D[V]=ee,D[me]=K,V=me):(D[V]=ge,D[pe]=K,V=pe);else if(me<W&&0>s(ee,K))D[V]=ee,D[me]=K,V=me;else break e}}return N}function s(D,N){var K=D.sortIndex-N.sortIndex;return K!==0?K:D.id-N.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,d=null,f=3,m=!1,p=!1,g=!1,v=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(D){for(var N=t(c);N!==null;){if(N.callback===null)r(c);else if(N.startTime<=D)r(c),N.sortIndex=N.expirationTime,e(l,N);else break;N=t(c)}}function b(D){if(g=!1,S(D),!p)if(t(l)!==null)p=!0,$(w);else{var N=t(c);N!==null&&Y(b,N.startTime-D)}}function w(D,N){p=!1,g&&(g=!1,x(I),I=-1),m=!0;var K=f;try{for(S(N),d=t(l);d!==null&&(!(d.expirationTime>N)||D&&!P());){var V=d.callback;if(typeof V=="function"){d.callback=null,f=d.priorityLevel;var W=V(d.expirationTime<=N);N=n.unstable_now(),typeof W=="function"?d.callback=W:d===t(l)&&r(l),S(N)}else r(l);d=t(l)}if(d!==null)var de=!0;else{var pe=t(c);pe!==null&&Y(b,pe.startTime-N),de=!1}return de}finally{d=null,f=K,m=!1}}var _=!1,A=null,I=-1,C=5,R=-1;function P(){return!(n.unstable_now()-R<C)}function O(){if(A!==null){var D=n.unstable_now();R=D;var N=!0;try{N=A(!0,D)}finally{N?U():(_=!1,A=null)}}else _=!1}var U;if(typeof y=="function")U=function(){y(O)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,G=j.port2;j.port1.onmessage=O,U=function(){G.postMessage(null)}}else U=function(){v(O,0)};function $(D){A=D,_||(_=!0,U())}function Y(D,N){I=v(function(){D(n.unstable_now())},N)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(D){D.callback=null},n.unstable_continueExecution=function(){p||m||(p=!0,$(w))},n.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<D?Math.floor(1e3/D):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(D){switch(f){case 1:case 2:case 3:var N=3;break;default:N=f}var K=f;f=N;try{return D()}finally{f=K}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(D,N){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var K=f;f=D;try{return N()}finally{f=K}},n.unstable_scheduleCallback=function(D,N,K){var V=n.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?V+K:V):K=V,D){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=K+W,D={id:u++,callback:N,priorityLevel:D,startTime:K,expirationTime:W,sortIndex:-1},K>V?(D.sortIndex=K,e(c,D),t(l)===null&&D===t(c)&&(g?(x(I),I=-1):g=!0,Y(b,K-V))):(D.sortIndex=W,e(l,D),p||m||(p=!0,$(w))),D},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(D){var N=f;return function(){var K=f;f=N;try{return D.apply(this,arguments)}finally{f=K}}}})(nT);tT.exports=nT;var cL=tT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uL=E,Bn=cL;function Q(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var rT=new Set,jl={};function pa(n,e){bo(n,e),bo(n+"Capture",e)}function bo(n,e){for(jl[n]=e,n=0;n<e.length;n++)rT.add(e[n])}var Ts=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wm=Object.prototype.hasOwnProperty,dL=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qy={},Qy={};function fL(n){return wm.call(Qy,n)?!0:wm.call(qy,n)?!1:dL.test(n)?Qy[n]=!0:(qy[n]=!0,!1)}function hL(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function mL(n,e,t,r){if(e===null||typeof e>"u"||hL(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function mn(n,e,t,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var Kt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Kt[n]=new mn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Kt[e]=new mn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Kt[n]=new mn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Kt[n]=new mn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Kt[n]=new mn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Kt[n]=new mn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Kt[n]=new mn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Kt[n]=new mn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Kt[n]=new mn(n,5,!1,n.toLowerCase(),null,!1,!1)});var Tg=/[\-:]([a-z])/g;function bg(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Tg,bg);Kt[e]=new mn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Tg,bg);Kt[e]=new mn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Tg,bg);Kt[e]=new mn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Kt[n]=new mn(n,1,!1,n.toLowerCase(),null,!1,!1)});Kt.xlinkHref=new mn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Kt[n]=new mn(n,1,!1,n.toLowerCase(),null,!0,!0)});function wg(n,e,t,r){var s=Kt.hasOwnProperty(e)?Kt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(mL(e,t,s,r)&&(t=null),r||s===null?fL(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Cs=uL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,zc=Symbol.for("react.element"),Na=Symbol.for("react.portal"),Oa=Symbol.for("react.fragment"),Ag=Symbol.for("react.strict_mode"),Am=Symbol.for("react.profiler"),sT=Symbol.for("react.provider"),iT=Symbol.for("react.context"),_g=Symbol.for("react.forward_ref"),_m=Symbol.for("react.suspense"),Im=Symbol.for("react.suspense_list"),Ig=Symbol.for("react.memo"),js=Symbol.for("react.lazy"),aT=Symbol.for("react.offscreen"),Xy=Symbol.iterator;function Jo(n){return n===null||typeof n!="object"?null:(n=Xy&&n[Xy]||n["@@iterator"],typeof n=="function"?n:null)}var gt=Object.assign,uh;function fl(n){if(uh===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);uh=e&&e[1]||""}return`
`+uh+n}var dh=!1;function fh(n,e){if(!n||dh)return"";dh=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,o=i.length-1;1<=a&&0<=o&&s[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||s[a]!==i[o]){var l=`
`+s[a].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=a&&0<=o);break}}}finally{dh=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?fl(n):""}function pL(n){switch(n.tag){case 5:return fl(n.type);case 16:return fl("Lazy");case 13:return fl("Suspense");case 19:return fl("SuspenseList");case 0:case 2:case 15:return n=fh(n.type,!1),n;case 11:return n=fh(n.type.render,!1),n;case 1:return n=fh(n.type,!0),n;default:return""}}function Rm(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Oa:return"Fragment";case Na:return"Portal";case Am:return"Profiler";case Ag:return"StrictMode";case _m:return"Suspense";case Im:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case iT:return(n.displayName||"Context")+".Consumer";case sT:return(n._context.displayName||"Context")+".Provider";case _g:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Ig:return e=n.displayName||null,e!==null?e:Rm(n.type)||"Memo";case js:e=n._payload,n=n._init;try{return Rm(n(e))}catch{}}return null}function gL(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Rm(e);case 8:return e===Ag?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function di(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function oT(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function yL(n){var e=oT(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Wc(n){n._valueTracker||(n._valueTracker=yL(n))}function lT(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=oT(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function ad(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Cm(n,e){var t=e.checked;return gt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Zy(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=di(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function cT(n,e){e=e.checked,e!=null&&wg(n,"checked",e,!1)}function Lm(n,e){cT(n,e);var t=di(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?km(n,e.type,t):e.hasOwnProperty("defaultValue")&&km(n,e.type,di(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Jy(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function km(n,e,t){(e!=="number"||ad(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var hl=Array.isArray;function Ya(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+di(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Dm(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Q(91));return gt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function ev(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Q(92));if(hl(t)){if(1<t.length)throw Error(Q(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:di(t)}}function uT(n,e){var t=di(e.value),r=di(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function tv(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function dT(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Pm(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?dT(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Yc,fT=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Yc=Yc||document.createElement("div"),Yc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Yc.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function $l(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Tl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},vL=["Webkit","ms","Moz","O"];Object.keys(Tl).forEach(function(n){vL.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Tl[e]=Tl[n]})});function hT(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Tl.hasOwnProperty(n)&&Tl[n]?(""+e).trim():e+"px"}function mT(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=hT(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var xL=gt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Nm(n,e){if(e){if(xL[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Q(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Q(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Q(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Q(62))}}function Om(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Mm=null;function Rg(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Fm=null,qa=null,Qa=null;function nv(n){if(n=Nc(n)){if(typeof Fm!="function")throw Error(Q(280));var e=n.stateNode;e&&(e=pf(e),Fm(n.stateNode,n.type,e))}}function pT(n){qa?Qa?Qa.push(n):Qa=[n]:qa=n}function gT(){if(qa){var n=qa,e=Qa;if(Qa=qa=null,nv(n),e)for(n=0;n<e.length;n++)nv(e[n])}}function yT(n,e){return n(e)}function vT(){}var hh=!1;function xT(n,e,t){if(hh)return n(e,t);hh=!0;try{return yT(n,e,t)}finally{hh=!1,(qa!==null||Qa!==null)&&(vT(),gT())}}function Ul(n,e){var t=n.stateNode;if(t===null)return null;var r=pf(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Q(231,e,typeof t));return t}var jm=!1;if(Ts)try{var el={};Object.defineProperty(el,"passive",{get:function(){jm=!0}}),window.addEventListener("test",el,el),window.removeEventListener("test",el,el)}catch{jm=!1}function SL(n,e,t,r,s,i,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var bl=!1,od=null,ld=!1,$m=null,EL={onError:function(n){bl=!0,od=n}};function TL(n,e,t,r,s,i,a,o,l){bl=!1,od=null,SL.apply(EL,arguments)}function bL(n,e,t,r,s,i,a,o,l){if(TL.apply(this,arguments),bl){if(bl){var c=od;bl=!1,od=null}else throw Error(Q(198));ld||(ld=!0,$m=c)}}function ga(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function ST(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function rv(n){if(ga(n)!==n)throw Error(Q(188))}function wL(n){var e=n.alternate;if(!e){if(e=ga(n),e===null)throw Error(Q(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return rv(s),n;if(i===r)return rv(s),e;i=i.sibling}throw Error(Q(188))}if(t.return!==r.return)t=s,r=i;else{for(var a=!1,o=s.child;o;){if(o===t){a=!0,t=s,r=i;break}if(o===r){a=!0,r=s,t=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===t){a=!0,t=i,r=s;break}if(o===r){a=!0,r=i,t=s;break}o=o.sibling}if(!a)throw Error(Q(189))}}if(t.alternate!==r)throw Error(Q(190))}if(t.tag!==3)throw Error(Q(188));return t.stateNode.current===t?n:e}function ET(n){return n=wL(n),n!==null?TT(n):null}function TT(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=TT(n);if(e!==null)return e;n=n.sibling}return null}var bT=Bn.unstable_scheduleCallback,sv=Bn.unstable_cancelCallback,AL=Bn.unstable_shouldYield,_L=Bn.unstable_requestPaint,Et=Bn.unstable_now,IL=Bn.unstable_getCurrentPriorityLevel,Cg=Bn.unstable_ImmediatePriority,wT=Bn.unstable_UserBlockingPriority,cd=Bn.unstable_NormalPriority,RL=Bn.unstable_LowPriority,AT=Bn.unstable_IdlePriority,df=null,zr=null;function CL(n){if(zr&&typeof zr.onCommitFiberRoot=="function")try{zr.onCommitFiberRoot(df,n,void 0,(n.current.flags&128)===128)}catch{}}var yr=Math.clz32?Math.clz32:DL,LL=Math.log,kL=Math.LN2;function DL(n){return n>>>=0,n===0?32:31-(LL(n)/kL|0)|0}var qc=64,Qc=4194304;function ml(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ud(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~s;o!==0?r=ml(o):(i&=a,i!==0&&(r=ml(i)))}else a=t&~s,a!==0?r=ml(a):i!==0&&(r=ml(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-yr(e),s=1<<t,r|=n[t],e&=~s;return r}function PL(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function NL(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var a=31-yr(i),o=1<<a,l=s[a];l===-1?(!(o&t)||o&r)&&(s[a]=PL(o,e)):l<=e&&(n.expiredLanes|=o),i&=~o}}function Um(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function _T(){var n=qc;return qc<<=1,!(qc&4194240)&&(qc=64),n}function mh(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Dc(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-yr(e),n[e]=t}function OL(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-yr(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function Lg(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-yr(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var qe=0;function IT(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var RT,kg,CT,LT,kT,Bm=!1,Xc=[],ri=null,si=null,ii=null,Bl=new Map,Vl=new Map,Vs=[],ML="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function iv(n,e){switch(n){case"focusin":case"focusout":ri=null;break;case"dragenter":case"dragleave":si=null;break;case"mouseover":case"mouseout":ii=null;break;case"pointerover":case"pointerout":Bl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vl.delete(e.pointerId)}}function tl(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Nc(e),e!==null&&kg(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function FL(n,e,t,r,s){switch(e){case"focusin":return ri=tl(ri,n,e,t,r,s),!0;case"dragenter":return si=tl(si,n,e,t,r,s),!0;case"mouseover":return ii=tl(ii,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return Bl.set(i,tl(Bl.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Vl.set(i,tl(Vl.get(i)||null,n,e,t,r,s)),!0}return!1}function DT(n){var e=ji(n.target);if(e!==null){var t=ga(e);if(t!==null){if(e=t.tag,e===13){if(e=ST(t),e!==null){n.blockedOn=e,kT(n.priority,function(){CT(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ou(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Vm(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Mm=r,t.target.dispatchEvent(r),Mm=null}else return e=Nc(t),e!==null&&kg(e),n.blockedOn=t,!1;e.shift()}return!0}function av(n,e,t){Ou(n)&&t.delete(e)}function jL(){Bm=!1,ri!==null&&Ou(ri)&&(ri=null),si!==null&&Ou(si)&&(si=null),ii!==null&&Ou(ii)&&(ii=null),Bl.forEach(av),Vl.forEach(av)}function nl(n,e){n.blockedOn===e&&(n.blockedOn=null,Bm||(Bm=!0,Bn.unstable_scheduleCallback(Bn.unstable_NormalPriority,jL)))}function Gl(n){function e(s){return nl(s,n)}if(0<Xc.length){nl(Xc[0],n);for(var t=1;t<Xc.length;t++){var r=Xc[t];r.blockedOn===n&&(r.blockedOn=null)}}for(ri!==null&&nl(ri,n),si!==null&&nl(si,n),ii!==null&&nl(ii,n),Bl.forEach(e),Vl.forEach(e),t=0;t<Vs.length;t++)r=Vs[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Vs.length&&(t=Vs[0],t.blockedOn===null);)DT(t),t.blockedOn===null&&Vs.shift()}var Xa=Cs.ReactCurrentBatchConfig,dd=!0;function $L(n,e,t,r){var s=qe,i=Xa.transition;Xa.transition=null;try{qe=1,Dg(n,e,t,r)}finally{qe=s,Xa.transition=i}}function UL(n,e,t,r){var s=qe,i=Xa.transition;Xa.transition=null;try{qe=4,Dg(n,e,t,r)}finally{qe=s,Xa.transition=i}}function Dg(n,e,t,r){if(dd){var s=Vm(n,e,t,r);if(s===null)wh(n,e,r,fd,t),iv(n,r);else if(FL(s,n,e,t,r))r.stopPropagation();else if(iv(n,r),e&4&&-1<ML.indexOf(n)){for(;s!==null;){var i=Nc(s);if(i!==null&&RT(i),i=Vm(n,e,t,r),i===null&&wh(n,e,r,fd,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else wh(n,e,r,null,t)}}var fd=null;function Vm(n,e,t,r){if(fd=null,n=Rg(r),n=ji(n),n!==null)if(e=ga(n),e===null)n=null;else if(t=e.tag,t===13){if(n=ST(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return fd=n,null}function PT(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(IL()){case Cg:return 1;case wT:return 4;case cd:case RL:return 16;case AT:return 536870912;default:return 16}default:return 16}}var ei=null,Pg=null,Mu=null;function NT(){if(Mu)return Mu;var n,e=Pg,t=e.length,r,s="value"in ei?ei.value:ei.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===s[i-r];r++);return Mu=s.slice(n,1<r?1-r:void 0)}function Fu(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Zc(){return!0}function ov(){return!1}function Gn(n){function e(t,r,s,i,a){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Zc:ov,this.isPropagationStopped=ov,this}return gt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Zc)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Zc)},persist:function(){},isPersistent:Zc}),e}var $o={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ng=Gn($o),Pc=gt({},$o,{view:0,detail:0}),BL=Gn(Pc),ph,gh,rl,ff=gt({},Pc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Og,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==rl&&(rl&&n.type==="mousemove"?(ph=n.screenX-rl.screenX,gh=n.screenY-rl.screenY):gh=ph=0,rl=n),ph)},movementY:function(n){return"movementY"in n?n.movementY:gh}}),lv=Gn(ff),VL=gt({},ff,{dataTransfer:0}),GL=Gn(VL),KL=gt({},Pc,{relatedTarget:0}),yh=Gn(KL),HL=gt({},$o,{animationName:0,elapsedTime:0,pseudoElement:0}),zL=Gn(HL),WL=gt({},$o,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),YL=Gn(WL),qL=gt({},$o,{data:0}),cv=Gn(qL),QL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},XL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ZL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function JL(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=ZL[n])?!!e[n]:!1}function Og(){return JL}var ek=gt({},Pc,{key:function(n){if(n.key){var e=QL[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Fu(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?XL[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Og,charCode:function(n){return n.type==="keypress"?Fu(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Fu(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),tk=Gn(ek),nk=gt({},ff,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uv=Gn(nk),rk=gt({},Pc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Og}),sk=Gn(rk),ik=gt({},$o,{propertyName:0,elapsedTime:0,pseudoElement:0}),ak=Gn(ik),ok=gt({},ff,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),lk=Gn(ok),ck=[9,13,27,32],Mg=Ts&&"CompositionEvent"in window,wl=null;Ts&&"documentMode"in document&&(wl=document.documentMode);var uk=Ts&&"TextEvent"in window&&!wl,OT=Ts&&(!Mg||wl&&8<wl&&11>=wl),dv=" ",fv=!1;function MT(n,e){switch(n){case"keyup":return ck.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function FT(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Ma=!1;function dk(n,e){switch(n){case"compositionend":return FT(e);case"keypress":return e.which!==32?null:(fv=!0,dv);case"textInput":return n=e.data,n===dv&&fv?null:n;default:return null}}function fk(n,e){if(Ma)return n==="compositionend"||!Mg&&MT(n,e)?(n=NT(),Mu=Pg=ei=null,Ma=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return OT&&e.locale!=="ko"?null:e.data;default:return null}}var hk={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hv(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!hk[n.type]:e==="textarea"}function jT(n,e,t,r){pT(r),e=hd(e,"onChange"),0<e.length&&(t=new Ng("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Al=null,Kl=null;function mk(n){qT(n,0)}function hf(n){var e=$a(n);if(lT(e))return n}function pk(n,e){if(n==="change")return e}var $T=!1;if(Ts){var vh;if(Ts){var xh="oninput"in document;if(!xh){var mv=document.createElement("div");mv.setAttribute("oninput","return;"),xh=typeof mv.oninput=="function"}vh=xh}else vh=!1;$T=vh&&(!document.documentMode||9<document.documentMode)}function pv(){Al&&(Al.detachEvent("onpropertychange",UT),Kl=Al=null)}function UT(n){if(n.propertyName==="value"&&hf(Kl)){var e=[];jT(e,Kl,n,Rg(n)),xT(mk,e)}}function gk(n,e,t){n==="focusin"?(pv(),Al=e,Kl=t,Al.attachEvent("onpropertychange",UT)):n==="focusout"&&pv()}function yk(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return hf(Kl)}function vk(n,e){if(n==="click")return hf(e)}function xk(n,e){if(n==="input"||n==="change")return hf(e)}function Sk(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Er=typeof Object.is=="function"?Object.is:Sk;function Hl(n,e){if(Er(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!wm.call(e,s)||!Er(n[s],e[s]))return!1}return!0}function gv(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function yv(n,e){var t=gv(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=gv(t)}}function BT(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?BT(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function VT(){for(var n=window,e=ad();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ad(n.document)}return e}function Fg(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function Ek(n){var e=VT(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&BT(t.ownerDocument.documentElement,t)){if(r!==null&&Fg(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=yv(t,i);var a=yv(t,r);s&&a&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Tk=Ts&&"documentMode"in document&&11>=document.documentMode,Fa=null,Gm=null,_l=null,Km=!1;function vv(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Km||Fa==null||Fa!==ad(r)||(r=Fa,"selectionStart"in r&&Fg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),_l&&Hl(_l,r)||(_l=r,r=hd(Gm,"onSelect"),0<r.length&&(e=new Ng("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Fa)))}function Jc(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var ja={animationend:Jc("Animation","AnimationEnd"),animationiteration:Jc("Animation","AnimationIteration"),animationstart:Jc("Animation","AnimationStart"),transitionend:Jc("Transition","TransitionEnd")},Sh={},GT={};Ts&&(GT=document.createElement("div").style,"AnimationEvent"in window||(delete ja.animationend.animation,delete ja.animationiteration.animation,delete ja.animationstart.animation),"TransitionEvent"in window||delete ja.transitionend.transition);function mf(n){if(Sh[n])return Sh[n];if(!ja[n])return n;var e=ja[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in GT)return Sh[n]=e[t];return n}var KT=mf("animationend"),HT=mf("animationiteration"),zT=mf("animationstart"),WT=mf("transitionend"),YT=new Map,xv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wi(n,e){YT.set(n,e),pa(e,[n])}for(var Eh=0;Eh<xv.length;Eh++){var Th=xv[Eh],bk=Th.toLowerCase(),wk=Th[0].toUpperCase()+Th.slice(1);wi(bk,"on"+wk)}wi(KT,"onAnimationEnd");wi(HT,"onAnimationIteration");wi(zT,"onAnimationStart");wi("dblclick","onDoubleClick");wi("focusin","onFocus");wi("focusout","onBlur");wi(WT,"onTransitionEnd");bo("onMouseEnter",["mouseout","mouseover"]);bo("onMouseLeave",["mouseout","mouseover"]);bo("onPointerEnter",["pointerout","pointerover"]);bo("onPointerLeave",["pointerout","pointerover"]);pa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));pa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));pa("onBeforeInput",["compositionend","keypress","textInput","paste"]);pa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));pa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));pa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ak=new Set("cancel close invalid load scroll toggle".split(" ").concat(pl));function Sv(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,bL(r,e,void 0,n),n.currentTarget=null}function qT(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==i&&s.isPropagationStopped())break e;Sv(s,o,c),i=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==i&&s.isPropagationStopped())break e;Sv(s,o,c),i=l}}}if(ld)throw n=$m,ld=!1,$m=null,n}function ot(n,e){var t=e[qm];t===void 0&&(t=e[qm]=new Set);var r=n+"__bubble";t.has(r)||(QT(e,n,2,!1),t.add(r))}function bh(n,e,t){var r=0;e&&(r|=4),QT(t,n,r,e)}var eu="_reactListening"+Math.random().toString(36).slice(2);function zl(n){if(!n[eu]){n[eu]=!0,rT.forEach(function(t){t!=="selectionchange"&&(Ak.has(t)||bh(t,!1,n),bh(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[eu]||(e[eu]=!0,bh("selectionchange",!1,e))}}function QT(n,e,t,r){switch(PT(e)){case 1:var s=$L;break;case 4:s=UL;break;default:s=Dg}t=s.bind(null,e,t,n),s=void 0,!jm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function wh(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;a=a.return}for(;o!==null;){if(a=ji(o),a===null)return;if(l=a.tag,l===5||l===6){r=i=a;continue e}o=o.parentNode}}r=r.return}xT(function(){var c=i,u=Rg(t),d=[];e:{var f=YT.get(n);if(f!==void 0){var m=Ng,p=n;switch(n){case"keypress":if(Fu(t)===0)break e;case"keydown":case"keyup":m=tk;break;case"focusin":p="focus",m=yh;break;case"focusout":p="blur",m=yh;break;case"beforeblur":case"afterblur":m=yh;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=lv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=GL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=sk;break;case KT:case HT:case zT:m=zL;break;case WT:m=ak;break;case"scroll":m=BL;break;case"wheel":m=lk;break;case"copy":case"cut":case"paste":m=YL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=uv}var g=(e&4)!==0,v=!g&&n==="scroll",x=g?f!==null?f+"Capture":null:f;g=[];for(var y=c,S;y!==null;){S=y;var b=S.stateNode;if(S.tag===5&&b!==null&&(S=b,x!==null&&(b=Ul(y,x),b!=null&&g.push(Wl(y,b,S)))),v)break;y=y.return}0<g.length&&(f=new m(f,p,null,t,u),d.push({event:f,listeners:g}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",f&&t!==Mm&&(p=t.relatedTarget||t.fromElement)&&(ji(p)||p[bs]))break e;if((m||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,m?(p=t.relatedTarget||t.toElement,m=c,p=p?ji(p):null,p!==null&&(v=ga(p),p!==v||p.tag!==5&&p.tag!==6)&&(p=null)):(m=null,p=c),m!==p)){if(g=lv,b="onMouseLeave",x="onMouseEnter",y="mouse",(n==="pointerout"||n==="pointerover")&&(g=uv,b="onPointerLeave",x="onPointerEnter",y="pointer"),v=m==null?f:$a(m),S=p==null?f:$a(p),f=new g(b,y+"leave",m,t,u),f.target=v,f.relatedTarget=S,b=null,ji(u)===c&&(g=new g(x,y+"enter",p,t,u),g.target=S,g.relatedTarget=v,b=g),v=b,m&&p)t:{for(g=m,x=p,y=0,S=g;S;S=Ta(S))y++;for(S=0,b=x;b;b=Ta(b))S++;for(;0<y-S;)g=Ta(g),y--;for(;0<S-y;)x=Ta(x),S--;for(;y--;){if(g===x||x!==null&&g===x.alternate)break t;g=Ta(g),x=Ta(x)}g=null}else g=null;m!==null&&Ev(d,f,m,g,!1),p!==null&&v!==null&&Ev(d,v,p,g,!0)}}e:{if(f=c?$a(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var w=pk;else if(hv(f))if($T)w=xk;else{w=yk;var _=gk}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(w=vk);if(w&&(w=w(n,c))){jT(d,w,t,u);break e}_&&_(n,f,c),n==="focusout"&&(_=f._wrapperState)&&_.controlled&&f.type==="number"&&km(f,"number",f.value)}switch(_=c?$a(c):window,n){case"focusin":(hv(_)||_.contentEditable==="true")&&(Fa=_,Gm=c,_l=null);break;case"focusout":_l=Gm=Fa=null;break;case"mousedown":Km=!0;break;case"contextmenu":case"mouseup":case"dragend":Km=!1,vv(d,t,u);break;case"selectionchange":if(Tk)break;case"keydown":case"keyup":vv(d,t,u)}var A;if(Mg)e:{switch(n){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else Ma?MT(n,t)&&(I="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(OT&&t.locale!=="ko"&&(Ma||I!=="onCompositionStart"?I==="onCompositionEnd"&&Ma&&(A=NT()):(ei=u,Pg="value"in ei?ei.value:ei.textContent,Ma=!0)),_=hd(c,I),0<_.length&&(I=new cv(I,n,null,t,u),d.push({event:I,listeners:_}),A?I.data=A:(A=FT(t),A!==null&&(I.data=A)))),(A=uk?dk(n,t):fk(n,t))&&(c=hd(c,"onBeforeInput"),0<c.length&&(u=new cv("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=A))}qT(d,e)})}function Wl(n,e,t){return{instance:n,listener:e,currentTarget:t}}function hd(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Ul(n,t),i!=null&&r.unshift(Wl(n,i,s)),i=Ul(n,e),i!=null&&r.push(Wl(n,i,s))),n=n.return}return r}function Ta(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Ev(n,e,t,r,s){for(var i=e._reactName,a=[];t!==null&&t!==r;){var o=t,l=o.alternate,c=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&c!==null&&(o=c,s?(l=Ul(t,i),l!=null&&a.unshift(Wl(t,l,o))):s||(l=Ul(t,i),l!=null&&a.push(Wl(t,l,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var _k=/\r\n?/g,Ik=/\u0000|\uFFFD/g;function Tv(n){return(typeof n=="string"?n:""+n).replace(_k,`
`).replace(Ik,"")}function tu(n,e,t){if(e=Tv(e),Tv(n)!==e&&t)throw Error(Q(425))}function md(){}var Hm=null,zm=null;function Wm(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ym=typeof setTimeout=="function"?setTimeout:void 0,Rk=typeof clearTimeout=="function"?clearTimeout:void 0,bv=typeof Promise=="function"?Promise:void 0,Ck=typeof queueMicrotask=="function"?queueMicrotask:typeof bv<"u"?function(n){return bv.resolve(null).then(n).catch(Lk)}:Ym;function Lk(n){setTimeout(function(){throw n})}function Ah(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Gl(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Gl(e)}function ai(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function wv(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Uo=Math.random().toString(36).slice(2),Br="__reactFiber$"+Uo,Yl="__reactProps$"+Uo,bs="__reactContainer$"+Uo,qm="__reactEvents$"+Uo,kk="__reactListeners$"+Uo,Dk="__reactHandles$"+Uo;function ji(n){var e=n[Br];if(e)return e;for(var t=n.parentNode;t;){if(e=t[bs]||t[Br]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=wv(n);n!==null;){if(t=n[Br])return t;n=wv(n)}return e}n=t,t=n.parentNode}return null}function Nc(n){return n=n[Br]||n[bs],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function $a(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Q(33))}function pf(n){return n[Yl]||null}var Qm=[],Ua=-1;function Ai(n){return{current:n}}function lt(n){0>Ua||(n.current=Qm[Ua],Qm[Ua]=null,Ua--)}function st(n,e){Ua++,Qm[Ua]=n.current,n.current=e}var fi={},Jt=Ai(fi),An=Ai(!1),ea=fi;function wo(n,e){var t=n.type.contextTypes;if(!t)return fi;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function _n(n){return n=n.childContextTypes,n!=null}function pd(){lt(An),lt(Jt)}function Av(n,e,t){if(Jt.current!==fi)throw Error(Q(168));st(Jt,e),st(An,t)}function XT(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Q(108,gL(n)||"Unknown",s));return gt({},t,r)}function gd(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||fi,ea=Jt.current,st(Jt,n),st(An,An.current),!0}function _v(n,e,t){var r=n.stateNode;if(!r)throw Error(Q(169));t?(n=XT(n,e,ea),r.__reactInternalMemoizedMergedChildContext=n,lt(An),lt(Jt),st(Jt,n)):lt(An),st(An,t)}var ms=null,gf=!1,_h=!1;function ZT(n){ms===null?ms=[n]:ms.push(n)}function Pk(n){gf=!0,ZT(n)}function _i(){if(!_h&&ms!==null){_h=!0;var n=0,e=qe;try{var t=ms;for(qe=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}ms=null,gf=!1}catch(s){throw ms!==null&&(ms=ms.slice(n+1)),bT(Cg,_i),s}finally{qe=e,_h=!1}}return null}var Ba=[],Va=0,yd=null,vd=0,Wn=[],Yn=0,ta=null,vs=1,xs="";function Oi(n,e){Ba[Va++]=vd,Ba[Va++]=yd,yd=n,vd=e}function JT(n,e,t){Wn[Yn++]=vs,Wn[Yn++]=xs,Wn[Yn++]=ta,ta=n;var r=vs;n=xs;var s=32-yr(r)-1;r&=~(1<<s),t+=1;var i=32-yr(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,vs=1<<32-yr(e)+s|t<<s|r,xs=i+n}else vs=1<<i|t<<s|r,xs=n}function jg(n){n.return!==null&&(Oi(n,1),JT(n,1,0))}function $g(n){for(;n===yd;)yd=Ba[--Va],Ba[Va]=null,vd=Ba[--Va],Ba[Va]=null;for(;n===ta;)ta=Wn[--Yn],Wn[Yn]=null,xs=Wn[--Yn],Wn[Yn]=null,vs=Wn[--Yn],Wn[Yn]=null}var Fn=null,Mn=null,ct=!1,fr=null;function eb(n,e){var t=Xn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Iv(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Fn=n,Mn=ai(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Fn=n,Mn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=ta!==null?{id:vs,overflow:xs}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Xn(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Fn=n,Mn=null,!0):!1;default:return!1}}function Xm(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Zm(n){if(ct){var e=Mn;if(e){var t=e;if(!Iv(n,e)){if(Xm(n))throw Error(Q(418));e=ai(t.nextSibling);var r=Fn;e&&Iv(n,e)?eb(r,t):(n.flags=n.flags&-4097|2,ct=!1,Fn=n)}}else{if(Xm(n))throw Error(Q(418));n.flags=n.flags&-4097|2,ct=!1,Fn=n}}}function Rv(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Fn=n}function nu(n){if(n!==Fn)return!1;if(!ct)return Rv(n),ct=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Wm(n.type,n.memoizedProps)),e&&(e=Mn)){if(Xm(n))throw tb(),Error(Q(418));for(;e;)eb(n,e),e=ai(e.nextSibling)}if(Rv(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Q(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Mn=ai(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Mn=null}}else Mn=Fn?ai(n.stateNode.nextSibling):null;return!0}function tb(){for(var n=Mn;n;)n=ai(n.nextSibling)}function Ao(){Mn=Fn=null,ct=!1}function Ug(n){fr===null?fr=[n]:fr.push(n)}var Nk=Cs.ReactCurrentBatchConfig;function sl(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Q(309));var r=t.stateNode}if(!r)throw Error(Q(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=s.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof n!="string")throw Error(Q(284));if(!t._owner)throw Error(Q(290,n))}return n}function ru(n,e){throw n=Object.prototype.toString.call(e),Error(Q(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Cv(n){var e=n._init;return e(n._payload)}function nb(n){function e(x,y){if(n){var S=x.deletions;S===null?(x.deletions=[y],x.flags|=16):S.push(y)}}function t(x,y){if(!n)return null;for(;y!==null;)e(x,y),y=y.sibling;return null}function r(x,y){for(x=new Map;y!==null;)y.key!==null?x.set(y.key,y):x.set(y.index,y),y=y.sibling;return x}function s(x,y){return x=ui(x,y),x.index=0,x.sibling=null,x}function i(x,y,S){return x.index=S,n?(S=x.alternate,S!==null?(S=S.index,S<y?(x.flags|=2,y):S):(x.flags|=2,y)):(x.flags|=1048576,y)}function a(x){return n&&x.alternate===null&&(x.flags|=2),x}function o(x,y,S,b){return y===null||y.tag!==6?(y=Ph(S,x.mode,b),y.return=x,y):(y=s(y,S),y.return=x,y)}function l(x,y,S,b){var w=S.type;return w===Oa?u(x,y,S.props.children,b,S.key):y!==null&&(y.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===js&&Cv(w)===y.type)?(b=s(y,S.props),b.ref=sl(x,y,S),b.return=x,b):(b=Ku(S.type,S.key,S.props,null,x.mode,b),b.ref=sl(x,y,S),b.return=x,b)}function c(x,y,S,b){return y===null||y.tag!==4||y.stateNode.containerInfo!==S.containerInfo||y.stateNode.implementation!==S.implementation?(y=Nh(S,x.mode,b),y.return=x,y):(y=s(y,S.children||[]),y.return=x,y)}function u(x,y,S,b,w){return y===null||y.tag!==7?(y=Qi(S,x.mode,b,w),y.return=x,y):(y=s(y,S),y.return=x,y)}function d(x,y,S){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Ph(""+y,x.mode,S),y.return=x,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case zc:return S=Ku(y.type,y.key,y.props,null,x.mode,S),S.ref=sl(x,null,y),S.return=x,S;case Na:return y=Nh(y,x.mode,S),y.return=x,y;case js:var b=y._init;return d(x,b(y._payload),S)}if(hl(y)||Jo(y))return y=Qi(y,x.mode,S,null),y.return=x,y;ru(x,y)}return null}function f(x,y,S,b){var w=y!==null?y.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return w!==null?null:o(x,y,""+S,b);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case zc:return S.key===w?l(x,y,S,b):null;case Na:return S.key===w?c(x,y,S,b):null;case js:return w=S._init,f(x,y,w(S._payload),b)}if(hl(S)||Jo(S))return w!==null?null:u(x,y,S,b,null);ru(x,S)}return null}function m(x,y,S,b,w){if(typeof b=="string"&&b!==""||typeof b=="number")return x=x.get(S)||null,o(y,x,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case zc:return x=x.get(b.key===null?S:b.key)||null,l(y,x,b,w);case Na:return x=x.get(b.key===null?S:b.key)||null,c(y,x,b,w);case js:var _=b._init;return m(x,y,S,_(b._payload),w)}if(hl(b)||Jo(b))return x=x.get(S)||null,u(y,x,b,w,null);ru(y,b)}return null}function p(x,y,S,b){for(var w=null,_=null,A=y,I=y=0,C=null;A!==null&&I<S.length;I++){A.index>I?(C=A,A=null):C=A.sibling;var R=f(x,A,S[I],b);if(R===null){A===null&&(A=C);break}n&&A&&R.alternate===null&&e(x,A),y=i(R,y,I),_===null?w=R:_.sibling=R,_=R,A=C}if(I===S.length)return t(x,A),ct&&Oi(x,I),w;if(A===null){for(;I<S.length;I++)A=d(x,S[I],b),A!==null&&(y=i(A,y,I),_===null?w=A:_.sibling=A,_=A);return ct&&Oi(x,I),w}for(A=r(x,A);I<S.length;I++)C=m(A,x,I,S[I],b),C!==null&&(n&&C.alternate!==null&&A.delete(C.key===null?I:C.key),y=i(C,y,I),_===null?w=C:_.sibling=C,_=C);return n&&A.forEach(function(P){return e(x,P)}),ct&&Oi(x,I),w}function g(x,y,S,b){var w=Jo(S);if(typeof w!="function")throw Error(Q(150));if(S=w.call(S),S==null)throw Error(Q(151));for(var _=w=null,A=y,I=y=0,C=null,R=S.next();A!==null&&!R.done;I++,R=S.next()){A.index>I?(C=A,A=null):C=A.sibling;var P=f(x,A,R.value,b);if(P===null){A===null&&(A=C);break}n&&A&&P.alternate===null&&e(x,A),y=i(P,y,I),_===null?w=P:_.sibling=P,_=P,A=C}if(R.done)return t(x,A),ct&&Oi(x,I),w;if(A===null){for(;!R.done;I++,R=S.next())R=d(x,R.value,b),R!==null&&(y=i(R,y,I),_===null?w=R:_.sibling=R,_=R);return ct&&Oi(x,I),w}for(A=r(x,A);!R.done;I++,R=S.next())R=m(A,x,I,R.value,b),R!==null&&(n&&R.alternate!==null&&A.delete(R.key===null?I:R.key),y=i(R,y,I),_===null?w=R:_.sibling=R,_=R);return n&&A.forEach(function(O){return e(x,O)}),ct&&Oi(x,I),w}function v(x,y,S,b){if(typeof S=="object"&&S!==null&&S.type===Oa&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case zc:e:{for(var w=S.key,_=y;_!==null;){if(_.key===w){if(w=S.type,w===Oa){if(_.tag===7){t(x,_.sibling),y=s(_,S.props.children),y.return=x,x=y;break e}}else if(_.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===js&&Cv(w)===_.type){t(x,_.sibling),y=s(_,S.props),y.ref=sl(x,_,S),y.return=x,x=y;break e}t(x,_);break}else e(x,_);_=_.sibling}S.type===Oa?(y=Qi(S.props.children,x.mode,b,S.key),y.return=x,x=y):(b=Ku(S.type,S.key,S.props,null,x.mode,b),b.ref=sl(x,y,S),b.return=x,x=b)}return a(x);case Na:e:{for(_=S.key;y!==null;){if(y.key===_)if(y.tag===4&&y.stateNode.containerInfo===S.containerInfo&&y.stateNode.implementation===S.implementation){t(x,y.sibling),y=s(y,S.children||[]),y.return=x,x=y;break e}else{t(x,y);break}else e(x,y);y=y.sibling}y=Nh(S,x.mode,b),y.return=x,x=y}return a(x);case js:return _=S._init,v(x,y,_(S._payload),b)}if(hl(S))return p(x,y,S,b);if(Jo(S))return g(x,y,S,b);ru(x,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,y!==null&&y.tag===6?(t(x,y.sibling),y=s(y,S),y.return=x,x=y):(t(x,y),y=Ph(S,x.mode,b),y.return=x,x=y),a(x)):t(x,y)}return v}var _o=nb(!0),rb=nb(!1),xd=Ai(null),Sd=null,Ga=null,Bg=null;function Vg(){Bg=Ga=Sd=null}function Gg(n){var e=xd.current;lt(xd),n._currentValue=e}function Jm(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Za(n,e){Sd=n,Bg=Ga=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(En=!0),n.firstContext=null)}function er(n){var e=n._currentValue;if(Bg!==n)if(n={context:n,memoizedValue:e,next:null},Ga===null){if(Sd===null)throw Error(Q(308));Ga=n,Sd.dependencies={lanes:0,firstContext:n}}else Ga=Ga.next=n;return e}var $i=null;function Kg(n){$i===null?$i=[n]:$i.push(n)}function sb(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,Kg(e)):(t.next=s.next,s.next=t),e.interleaved=t,ws(n,r)}function ws(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var $s=!1;function Hg(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ib(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Ss(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function oi(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Ge&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,ws(n,t)}return s=r.interleaved,s===null?(e.next=e,Kg(r)):(e.next=s.next,s.next=e),r.interleaved=e,ws(n,t)}function ju(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Lg(n,t)}}function Lv(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Ed(n,e,t,r){var s=n.updateQueue;$s=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?i=c:a.next=c,a=l;var u=n.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(i!==null){var d=s.baseState;a=0,u=c=l=null,o=i;do{var f=o.lane,m=o.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=n,g=o;switch(f=e,m=t,g.tag){case 1:if(p=g.payload,typeof p=="function"){d=p.call(m,d,f);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=g.payload,f=typeof p=="function"?p.call(m,d,f):p,f==null)break e;d=gt({},d,f);break e;case 2:$s=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,f=s.effects,f===null?s.effects=[o]:f.push(o))}else m={eventTime:m,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=m,l=d):u=u.next=m,a|=f;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;f=o,o=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(l=d),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ra|=a,n.lanes=a,n.memoizedState=d}}function kv(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(Q(191,s));s.call(r)}}}var Oc={},Wr=Ai(Oc),ql=Ai(Oc),Ql=Ai(Oc);function Ui(n){if(n===Oc)throw Error(Q(174));return n}function zg(n,e){switch(st(Ql,e),st(ql,n),st(Wr,Oc),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Pm(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Pm(e,n)}lt(Wr),st(Wr,e)}function Io(){lt(Wr),lt(ql),lt(Ql)}function ab(n){Ui(Ql.current);var e=Ui(Wr.current),t=Pm(e,n.type);e!==t&&(st(ql,n),st(Wr,t))}function Wg(n){ql.current===n&&(lt(Wr),lt(ql))}var ht=Ai(0);function Td(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ih=[];function Yg(){for(var n=0;n<Ih.length;n++)Ih[n]._workInProgressVersionPrimary=null;Ih.length=0}var $u=Cs.ReactCurrentDispatcher,Rh=Cs.ReactCurrentBatchConfig,na=0,pt=null,Lt=null,Mt=null,bd=!1,Il=!1,Xl=0,Ok=0;function Wt(){throw Error(Q(321))}function qg(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Er(n[t],e[t]))return!1;return!0}function Qg(n,e,t,r,s,i){if(na=i,pt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$u.current=n===null||n.memoizedState===null?$k:Uk,n=t(r,s),Il){i=0;do{if(Il=!1,Xl=0,25<=i)throw Error(Q(301));i+=1,Mt=Lt=null,e.updateQueue=null,$u.current=Bk,n=t(r,s)}while(Il)}if($u.current=wd,e=Lt!==null&&Lt.next!==null,na=0,Mt=Lt=pt=null,bd=!1,e)throw Error(Q(300));return n}function Xg(){var n=Xl!==0;return Xl=0,n}function Pr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mt===null?pt.memoizedState=Mt=n:Mt=Mt.next=n,Mt}function tr(){if(Lt===null){var n=pt.alternate;n=n!==null?n.memoizedState:null}else n=Lt.next;var e=Mt===null?pt.memoizedState:Mt.next;if(e!==null)Mt=e,Lt=n;else{if(n===null)throw Error(Q(310));Lt=n,n={memoizedState:Lt.memoizedState,baseState:Lt.baseState,baseQueue:Lt.baseQueue,queue:Lt.queue,next:null},Mt===null?pt.memoizedState=Mt=n:Mt=Mt.next=n}return Mt}function Zl(n,e){return typeof e=="function"?e(n):e}function Ch(n){var e=tr(),t=e.queue;if(t===null)throw Error(Q(311));t.lastRenderedReducer=n;var r=Lt,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var o=a=null,l=null,c=i;do{var u=c.lane;if((na&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=d,a=r):l=l.next=d,pt.lanes|=u,ra|=u}c=c.next}while(c!==null&&c!==i);l===null?a=r:l.next=o,Er(r,e.memoizedState)||(En=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,pt.lanes|=i,ra|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Lh(n){var e=tr(),t=e.queue;if(t===null)throw Error(Q(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var a=s=s.next;do i=n(i,a.action),a=a.next;while(a!==s);Er(i,e.memoizedState)||(En=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function ob(){}function lb(n,e){var t=pt,r=tr(),s=e(),i=!Er(r.memoizedState,s);if(i&&(r.memoizedState=s,En=!0),r=r.queue,Zg(db.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Mt!==null&&Mt.memoizedState.tag&1){if(t.flags|=2048,Jl(9,ub.bind(null,t,r,s,e),void 0,null),Ft===null)throw Error(Q(349));na&30||cb(t,e,s)}return s}function cb(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=pt.updateQueue,e===null?(e={lastEffect:null,stores:null},pt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function ub(n,e,t,r){e.value=t,e.getSnapshot=r,fb(e)&&hb(n)}function db(n,e,t){return t(function(){fb(e)&&hb(n)})}function fb(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Er(n,t)}catch{return!0}}function hb(n){var e=ws(n,1);e!==null&&vr(e,n,1,-1)}function Dv(n){var e=Pr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zl,lastRenderedState:n},e.queue=n,n=n.dispatch=jk.bind(null,pt,n),[e.memoizedState,n]}function Jl(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=pt.updateQueue,e===null?(e={lastEffect:null,stores:null},pt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function mb(){return tr().memoizedState}function Uu(n,e,t,r){var s=Pr();pt.flags|=n,s.memoizedState=Jl(1|e,t,void 0,r===void 0?null:r)}function yf(n,e,t,r){var s=tr();r=r===void 0?null:r;var i=void 0;if(Lt!==null){var a=Lt.memoizedState;if(i=a.destroy,r!==null&&qg(r,a.deps)){s.memoizedState=Jl(e,t,i,r);return}}pt.flags|=n,s.memoizedState=Jl(1|e,t,i,r)}function Pv(n,e){return Uu(8390656,8,n,e)}function Zg(n,e){return yf(2048,8,n,e)}function pb(n,e){return yf(4,2,n,e)}function gb(n,e){return yf(4,4,n,e)}function yb(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function vb(n,e,t){return t=t!=null?t.concat([n]):null,yf(4,4,yb.bind(null,e,n),t)}function Jg(){}function xb(n,e){var t=tr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&qg(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Sb(n,e){var t=tr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&qg(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Eb(n,e,t){return na&21?(Er(t,e)||(t=_T(),pt.lanes|=t,ra|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,En=!0),n.memoizedState=t)}function Mk(n,e){var t=qe;qe=t!==0&&4>t?t:4,n(!0);var r=Rh.transition;Rh.transition={};try{n(!1),e()}finally{qe=t,Rh.transition=r}}function Tb(){return tr().memoizedState}function Fk(n,e,t){var r=ci(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},bb(n))wb(e,t);else if(t=sb(n,e,t,r),t!==null){var s=dn();vr(t,n,r,s),Ab(t,e,r)}}function jk(n,e,t){var r=ci(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(bb(n))wb(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,t);if(s.hasEagerState=!0,s.eagerState=o,Er(o,a)){var l=e.interleaved;l===null?(s.next=s,Kg(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=sb(n,e,s,r),t!==null&&(s=dn(),vr(t,n,r,s),Ab(t,e,r))}}function bb(n){var e=n.alternate;return n===pt||e!==null&&e===pt}function wb(n,e){Il=bd=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Ab(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Lg(n,t)}}var wd={readContext:er,useCallback:Wt,useContext:Wt,useEffect:Wt,useImperativeHandle:Wt,useInsertionEffect:Wt,useLayoutEffect:Wt,useMemo:Wt,useReducer:Wt,useRef:Wt,useState:Wt,useDebugValue:Wt,useDeferredValue:Wt,useTransition:Wt,useMutableSource:Wt,useSyncExternalStore:Wt,useId:Wt,unstable_isNewReconciler:!1},$k={readContext:er,useCallback:function(n,e){return Pr().memoizedState=[n,e===void 0?null:e],n},useContext:er,useEffect:Pv,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Uu(4194308,4,yb.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Uu(4194308,4,n,e)},useInsertionEffect:function(n,e){return Uu(4,2,n,e)},useMemo:function(n,e){var t=Pr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Pr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=Fk.bind(null,pt,n),[r.memoizedState,n]},useRef:function(n){var e=Pr();return n={current:n},e.memoizedState=n},useState:Dv,useDebugValue:Jg,useDeferredValue:function(n){return Pr().memoizedState=n},useTransition:function(){var n=Dv(!1),e=n[0];return n=Mk.bind(null,n[1]),Pr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=pt,s=Pr();if(ct){if(t===void 0)throw Error(Q(407));t=t()}else{if(t=e(),Ft===null)throw Error(Q(349));na&30||cb(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,Pv(db.bind(null,r,i,n),[n]),r.flags|=2048,Jl(9,ub.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Pr(),e=Ft.identifierPrefix;if(ct){var t=xs,r=vs;t=(r&~(1<<32-yr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Xl++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=Ok++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},Uk={readContext:er,useCallback:xb,useContext:er,useEffect:Zg,useImperativeHandle:vb,useInsertionEffect:pb,useLayoutEffect:gb,useMemo:Sb,useReducer:Ch,useRef:mb,useState:function(){return Ch(Zl)},useDebugValue:Jg,useDeferredValue:function(n){var e=tr();return Eb(e,Lt.memoizedState,n)},useTransition:function(){var n=Ch(Zl)[0],e=tr().memoizedState;return[n,e]},useMutableSource:ob,useSyncExternalStore:lb,useId:Tb,unstable_isNewReconciler:!1},Bk={readContext:er,useCallback:xb,useContext:er,useEffect:Zg,useImperativeHandle:vb,useInsertionEffect:pb,useLayoutEffect:gb,useMemo:Sb,useReducer:Lh,useRef:mb,useState:function(){return Lh(Zl)},useDebugValue:Jg,useDeferredValue:function(n){var e=tr();return Lt===null?e.memoizedState=n:Eb(e,Lt.memoizedState,n)},useTransition:function(){var n=Lh(Zl)[0],e=tr().memoizedState;return[n,e]},useMutableSource:ob,useSyncExternalStore:lb,useId:Tb,unstable_isNewReconciler:!1};function cr(n,e){if(n&&n.defaultProps){e=gt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function ep(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:gt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var vf={isMounted:function(n){return(n=n._reactInternals)?ga(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=dn(),s=ci(n),i=Ss(r,s);i.payload=e,t!=null&&(i.callback=t),e=oi(n,i,s),e!==null&&(vr(e,n,s,r),ju(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=dn(),s=ci(n),i=Ss(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=oi(n,i,s),e!==null&&(vr(e,n,s,r),ju(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=dn(),r=ci(n),s=Ss(t,r);s.tag=2,e!=null&&(s.callback=e),e=oi(n,s,r),e!==null&&(vr(e,n,r,t),ju(e,n,r))}};function Nv(n,e,t,r,s,i,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!Hl(t,r)||!Hl(s,i):!0}function _b(n,e,t){var r=!1,s=fi,i=e.contextType;return typeof i=="object"&&i!==null?i=er(i):(s=_n(e)?ea:Jt.current,r=e.contextTypes,i=(r=r!=null)?wo(n,s):fi),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=vf,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function Ov(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&vf.enqueueReplaceState(e,e.state,null)}function tp(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Hg(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=er(i):(i=_n(e)?ea:Jt.current,s.context=wo(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(ep(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&vf.enqueueReplaceState(s,s.state,null),Ed(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Ro(n,e){try{var t="",r=e;do t+=pL(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function kh(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function np(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Vk=typeof WeakMap=="function"?WeakMap:Map;function Ib(n,e,t){t=Ss(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){_d||(_d=!0,fp=r),np(n,e)},t}function Rb(n,e,t){t=Ss(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){np(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){np(n,e),typeof r!="function"&&(li===null?li=new Set([this]):li.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function Mv(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new Vk;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=nD.bind(null,n,e,t),e.then(n,n))}function Fv(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function jv(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Ss(-1,1),e.tag=2,oi(t,e,1))),t.lanes|=1),n)}var Gk=Cs.ReactCurrentOwner,En=!1;function sn(n,e,t,r){e.child=n===null?rb(e,null,t,r):_o(e,n.child,t,r)}function $v(n,e,t,r,s){t=t.render;var i=e.ref;return Za(e,s),r=Qg(n,e,t,r,i,s),t=Xg(),n!==null&&!En?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,As(n,e,s)):(ct&&t&&jg(e),e.flags|=1,sn(n,e,r,s),e.child)}function Uv(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!o0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,Cb(n,e,i,r,s)):(n=Ku(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:Hl,t(a,r)&&n.ref===e.ref)return As(n,e,s)}return e.flags|=1,n=ui(i,r),n.ref=e.ref,n.return=e,e.child=n}function Cb(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(Hl(i,r)&&n.ref===e.ref)if(En=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(En=!0);else return e.lanes=n.lanes,As(n,e,s)}return rp(n,e,t,r,s)}function Lb(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},st(Ha,Pn),Pn|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,st(Ha,Pn),Pn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,st(Ha,Pn),Pn|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,st(Ha,Pn),Pn|=r;return sn(n,e,s,t),e.child}function kb(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function rp(n,e,t,r,s){var i=_n(t)?ea:Jt.current;return i=wo(e,i),Za(e,s),t=Qg(n,e,t,r,i,s),r=Xg(),n!==null&&!En?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,As(n,e,s)):(ct&&r&&jg(e),e.flags|=1,sn(n,e,t,s),e.child)}function Bv(n,e,t,r,s){if(_n(t)){var i=!0;gd(e)}else i=!1;if(Za(e,s),e.stateNode===null)Bu(n,e),_b(e,t,r),tp(e,t,r,s),r=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,c=t.contextType;typeof c=="object"&&c!==null?c=er(c):(c=_n(t)?ea:Jt.current,c=wo(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==c)&&Ov(e,a,r,c),$s=!1;var f=e.memoizedState;a.state=f,Ed(e,r,a,s),l=e.memoizedState,o!==r||f!==l||An.current||$s?(typeof u=="function"&&(ep(e,t,u,r),l=e.memoizedState),(o=$s||Nv(e,t,o,r,f,l,c))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,ib(n,e),o=e.memoizedProps,c=e.type===e.elementType?o:cr(e.type,o),a.props=c,d=e.pendingProps,f=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=er(l):(l=_n(t)?ea:Jt.current,l=wo(e,l));var m=t.getDerivedStateFromProps;(u=typeof m=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||f!==l)&&Ov(e,a,r,l),$s=!1,f=e.memoizedState,a.state=f,Ed(e,r,a,s);var p=e.memoizedState;o!==d||f!==p||An.current||$s?(typeof m=="function"&&(ep(e,t,m,r),p=e.memoizedState),(c=$s||Nv(e,t,c,r,f,p,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,p,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,p,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),a.props=r,a.state=p,a.context=l,r=c):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return sp(n,e,t,r,i,s)}function sp(n,e,t,r,s,i){kb(n,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&_v(e,t,!1),As(n,e,i);r=e.stateNode,Gk.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=_o(e,n.child,null,i),e.child=_o(e,null,o,i)):sn(n,e,o,i),e.memoizedState=r.state,s&&_v(e,t,!0),e.child}function Db(n){var e=n.stateNode;e.pendingContext?Av(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Av(n,e.context,!1),zg(n,e.containerInfo)}function Vv(n,e,t,r,s){return Ao(),Ug(s),e.flags|=256,sn(n,e,t,r),e.child}var ip={dehydrated:null,treeContext:null,retryLane:0};function ap(n){return{baseLanes:n,cachePool:null,transitions:null}}function Pb(n,e,t){var r=e.pendingProps,s=ht.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(s&2)!==0),o?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),st(ht,s&1),n===null)return Zm(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,n=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Ef(a,r,0,null),n=Qi(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=ap(t),e.memoizedState=ip,n):e0(e,a));if(s=n.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return Kk(n,e,a,r,o,s,t);if(i){i=r.fallback,a=e.mode,s=n.child,o=s.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=ui(s,l),r.subtreeFlags=s.subtreeFlags&14680064),o!==null?i=ui(o,i):(i=Qi(i,a,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=n.child.memoizedState,a=a===null?ap(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=n.childLanes&~t,e.memoizedState=ip,r}return i=n.child,n=i.sibling,r=ui(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function e0(n,e){return e=Ef({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function su(n,e,t,r){return r!==null&&Ug(r),_o(e,n.child,null,t),n=e0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function Kk(n,e,t,r,s,i,a){if(t)return e.flags&256?(e.flags&=-257,r=kh(Error(Q(422))),su(n,e,a,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Ef({mode:"visible",children:r.children},s,0,null),i=Qi(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&_o(e,n.child,null,a),e.child.memoizedState=ap(a),e.memoizedState=ip,i);if(!(e.mode&1))return su(n,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var o=r.dgst;return r=o,i=Error(Q(419)),r=kh(i,r,void 0),su(n,e,a,r)}if(o=(a&n.childLanes)!==0,En||o){if(r=Ft,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,ws(n,s),vr(r,n,s,-1))}return a0(),r=kh(Error(Q(421))),su(n,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=rD.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,Mn=ai(s.nextSibling),Fn=e,ct=!0,fr=null,n!==null&&(Wn[Yn++]=vs,Wn[Yn++]=xs,Wn[Yn++]=ta,vs=n.id,xs=n.overflow,ta=e),e=e0(e,r.children),e.flags|=4096,e)}function Gv(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Jm(n.return,e,t)}function Dh(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function Nb(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(sn(n,e,r.children,t),r=ht.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Gv(n,t,e);else if(n.tag===19)Gv(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(st(ht,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Td(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Dh(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Td(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}Dh(e,!0,t,null,i);break;case"together":Dh(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Bu(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function As(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ra|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Q(153));if(e.child!==null){for(n=e.child,t=ui(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=ui(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function Hk(n,e,t){switch(e.tag){case 3:Db(e),Ao();break;case 5:ab(e);break;case 1:_n(e.type)&&gd(e);break;case 4:zg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;st(xd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(st(ht,ht.current&1),e.flags|=128,null):t&e.child.childLanes?Pb(n,e,t):(st(ht,ht.current&1),n=As(n,e,t),n!==null?n.sibling:null);st(ht,ht.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return Nb(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),st(ht,ht.current),r)break;return null;case 22:case 23:return e.lanes=0,Lb(n,e,t)}return As(n,e,t)}var Ob,op,Mb,Fb;Ob=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};op=function(){};Mb=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,Ui(Wr.current);var i=null;switch(t){case"input":s=Cm(n,s),r=Cm(n,r),i=[];break;case"select":s=gt({},s,{value:void 0}),r=gt({},r,{value:void 0}),i=[];break;case"textarea":s=Dm(n,s),r=Dm(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=md)}Nm(t,r);var a;t=null;for(c in s)if(!r.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var o=s[c];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(jl.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in r){var l=r[c];if(o=s!=null?s[c]:void 0,r.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(i||(i=[]),i.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(jl.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ot("scroll",n),i||o===l||(i=[])):(i=i||[]).push(c,l))}t&&(i=i||[]).push("style",t);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};Fb=function(n,e,t,r){t!==r&&(e.flags|=4)};function il(n,e){if(!ct)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Yt(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function zk(n,e,t){var r=e.pendingProps;switch($g(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yt(e),null;case 1:return _n(e.type)&&pd(),Yt(e),null;case 3:return r=e.stateNode,Io(),lt(An),lt(Jt),Yg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(nu(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,fr!==null&&(pp(fr),fr=null))),op(n,e),Yt(e),null;case 5:Wg(e);var s=Ui(Ql.current);if(t=e.type,n!==null&&e.stateNode!=null)Mb(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Q(166));return Yt(e),null}if(n=Ui(Wr.current),nu(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Br]=e,r[Yl]=i,n=(e.mode&1)!==0,t){case"dialog":ot("cancel",r),ot("close",r);break;case"iframe":case"object":case"embed":ot("load",r);break;case"video":case"audio":for(s=0;s<pl.length;s++)ot(pl[s],r);break;case"source":ot("error",r);break;case"img":case"image":case"link":ot("error",r),ot("load",r);break;case"details":ot("toggle",r);break;case"input":Zy(r,i),ot("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},ot("invalid",r);break;case"textarea":ev(r,i),ot("invalid",r)}Nm(t,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?r.textContent!==o&&(i.suppressHydrationWarning!==!0&&tu(r.textContent,o,n),s=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&tu(r.textContent,o,n),s=["children",""+o]):jl.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&ot("scroll",r)}switch(t){case"input":Wc(r),Jy(r,i,!0);break;case"textarea":Wc(r),tv(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=md)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=dT(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[Br]=e,n[Yl]=r,Ob(n,e,!1,!1),e.stateNode=n;e:{switch(a=Om(t,r),t){case"dialog":ot("cancel",n),ot("close",n),s=r;break;case"iframe":case"object":case"embed":ot("load",n),s=r;break;case"video":case"audio":for(s=0;s<pl.length;s++)ot(pl[s],n);s=r;break;case"source":ot("error",n),s=r;break;case"img":case"image":case"link":ot("error",n),ot("load",n),s=r;break;case"details":ot("toggle",n),s=r;break;case"input":Zy(n,r),s=Cm(n,r),ot("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=gt({},r,{value:void 0}),ot("invalid",n);break;case"textarea":ev(n,r),s=Dm(n,r),ot("invalid",n);break;default:s=r}Nm(t,s),o=s;for(i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="style"?mT(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&fT(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&$l(n,l):typeof l=="number"&&$l(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(jl.hasOwnProperty(i)?l!=null&&i==="onScroll"&&ot("scroll",n):l!=null&&wg(n,i,l,a))}switch(t){case"input":Wc(n),Jy(n,r,!1);break;case"textarea":Wc(n),tv(n);break;case"option":r.value!=null&&n.setAttribute("value",""+di(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Ya(n,!!r.multiple,i,!1):r.defaultValue!=null&&Ya(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=md)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Yt(e),null;case 6:if(n&&e.stateNode!=null)Fb(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Q(166));if(t=Ui(Ql.current),Ui(Wr.current),nu(e)){if(r=e.stateNode,t=e.memoizedProps,r[Br]=e,(i=r.nodeValue!==t)&&(n=Fn,n!==null))switch(n.tag){case 3:tu(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&tu(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Br]=e,e.stateNode=r}return Yt(e),null;case 13:if(lt(ht),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(ct&&Mn!==null&&e.mode&1&&!(e.flags&128))tb(),Ao(),e.flags|=98560,i=!1;else if(i=nu(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(Q(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Q(317));i[Br]=e}else Ao(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Yt(e),i=!1}else fr!==null&&(pp(fr),fr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||ht.current&1?Pt===0&&(Pt=3):a0())),e.updateQueue!==null&&(e.flags|=4),Yt(e),null);case 4:return Io(),op(n,e),n===null&&zl(e.stateNode.containerInfo),Yt(e),null;case 10:return Gg(e.type._context),Yt(e),null;case 17:return _n(e.type)&&pd(),Yt(e),null;case 19:if(lt(ht),i=e.memoizedState,i===null)return Yt(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)il(i,!1);else{if(Pt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=Td(n),a!==null){for(e.flags|=128,il(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,n=a.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return st(ht,ht.current&1|2),e.child}n=n.sibling}i.tail!==null&&Et()>Co&&(e.flags|=128,r=!0,il(i,!1),e.lanes=4194304)}else{if(!r)if(n=Td(a),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),il(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!ct)return Yt(e),null}else 2*Et()-i.renderingStartTime>Co&&t!==1073741824&&(e.flags|=128,r=!0,il(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Et(),e.sibling=null,t=ht.current,st(ht,r?t&1|2:t&1),e):(Yt(e),null);case 22:case 23:return i0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Pn&1073741824&&(Yt(e),e.subtreeFlags&6&&(e.flags|=8192)):Yt(e),null;case 24:return null;case 25:return null}throw Error(Q(156,e.tag))}function Wk(n,e){switch($g(e),e.tag){case 1:return _n(e.type)&&pd(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Io(),lt(An),lt(Jt),Yg(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Wg(e),null;case 13:if(lt(ht),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Q(340));Ao()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return lt(ht),null;case 4:return Io(),null;case 10:return Gg(e.type._context),null;case 22:case 23:return i0(),null;case 24:return null;default:return null}}var iu=!1,Xt=!1,Yk=typeof WeakSet=="function"?WeakSet:Set,le=null;function Ka(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){St(n,e,r)}else t.current=null}function lp(n,e,t){try{t()}catch(r){St(n,e,r)}}var Kv=!1;function qk(n,e){if(Hm=dd,n=VT(),Fg(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,c=0,u=0,d=n,f=null;t:for(;;){for(var m;d!==t||s!==0&&d.nodeType!==3||(o=a+s),d!==i||r!==0&&d.nodeType!==3||(l=a+r),d.nodeType===3&&(a+=d.nodeValue.length),(m=d.firstChild)!==null;)f=d,d=m;for(;;){if(d===n)break t;if(f===t&&++c===s&&(o=a),f===i&&++u===r&&(l=a),(m=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=m}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(zm={focusedElem:n,selectionRange:t},dd=!1,le=e;le!==null;)if(e=le,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,le=n;else for(;le!==null;){e=le;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var g=p.memoizedProps,v=p.memoizedState,x=e.stateNode,y=x.getSnapshotBeforeUpdate(e.elementType===e.type?g:cr(e.type,g),v);x.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Q(163))}}catch(b){St(e,e.return,b)}if(n=e.sibling,n!==null){n.return=e.return,le=n;break}le=e.return}return p=Kv,Kv=!1,p}function Rl(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&lp(e,t,i)}s=s.next}while(s!==r)}}function xf(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function cp(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function jb(n){var e=n.alternate;e!==null&&(n.alternate=null,jb(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Br],delete e[Yl],delete e[qm],delete e[kk],delete e[Dk])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function $b(n){return n.tag===5||n.tag===3||n.tag===4}function Hv(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||$b(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function up(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=md));else if(r!==4&&(n=n.child,n!==null))for(up(n,e,t),n=n.sibling;n!==null;)up(n,e,t),n=n.sibling}function dp(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(dp(n,e,t),n=n.sibling;n!==null;)dp(n,e,t),n=n.sibling}var $t=null,dr=!1;function ks(n,e,t){for(t=t.child;t!==null;)Ub(n,e,t),t=t.sibling}function Ub(n,e,t){if(zr&&typeof zr.onCommitFiberUnmount=="function")try{zr.onCommitFiberUnmount(df,t)}catch{}switch(t.tag){case 5:Xt||Ka(t,e);case 6:var r=$t,s=dr;$t=null,ks(n,e,t),$t=r,dr=s,$t!==null&&(dr?(n=$t,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):$t.removeChild(t.stateNode));break;case 18:$t!==null&&(dr?(n=$t,t=t.stateNode,n.nodeType===8?Ah(n.parentNode,t):n.nodeType===1&&Ah(n,t),Gl(n)):Ah($t,t.stateNode));break;case 4:r=$t,s=dr,$t=t.stateNode.containerInfo,dr=!0,ks(n,e,t),$t=r,dr=s;break;case 0:case 11:case 14:case 15:if(!Xt&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&lp(t,e,a),s=s.next}while(s!==r)}ks(n,e,t);break;case 1:if(!Xt&&(Ka(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(o){St(t,e,o)}ks(n,e,t);break;case 21:ks(n,e,t);break;case 22:t.mode&1?(Xt=(r=Xt)||t.memoizedState!==null,ks(n,e,t),Xt=r):ks(n,e,t);break;default:ks(n,e,t)}}function zv(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new Yk),e.forEach(function(r){var s=sD.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function sr(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:$t=o.stateNode,dr=!1;break e;case 3:$t=o.stateNode.containerInfo,dr=!0;break e;case 4:$t=o.stateNode.containerInfo,dr=!0;break e}o=o.return}if($t===null)throw Error(Q(160));Ub(i,a,s),$t=null,dr=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){St(s,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Bb(e,n),e=e.sibling}function Bb(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(sr(e,n),Lr(n),r&4){try{Rl(3,n,n.return),xf(3,n)}catch(g){St(n,n.return,g)}try{Rl(5,n,n.return)}catch(g){St(n,n.return,g)}}break;case 1:sr(e,n),Lr(n),r&512&&t!==null&&Ka(t,t.return);break;case 5:if(sr(e,n),Lr(n),r&512&&t!==null&&Ka(t,t.return),n.flags&32){var s=n.stateNode;try{$l(s,"")}catch(g){St(n,n.return,g)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,a=t!==null?t.memoizedProps:i,o=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&cT(s,i),Om(o,a);var c=Om(o,i);for(a=0;a<l.length;a+=2){var u=l[a],d=l[a+1];u==="style"?mT(s,d):u==="dangerouslySetInnerHTML"?fT(s,d):u==="children"?$l(s,d):wg(s,u,d,c)}switch(o){case"input":Lm(s,i);break;case"textarea":uT(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var m=i.value;m!=null?Ya(s,!!i.multiple,m,!1):f!==!!i.multiple&&(i.defaultValue!=null?Ya(s,!!i.multiple,i.defaultValue,!0):Ya(s,!!i.multiple,i.multiple?[]:"",!1))}s[Yl]=i}catch(g){St(n,n.return,g)}}break;case 6:if(sr(e,n),Lr(n),r&4){if(n.stateNode===null)throw Error(Q(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(g){St(n,n.return,g)}}break;case 3:if(sr(e,n),Lr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Gl(e.containerInfo)}catch(g){St(n,n.return,g)}break;case 4:sr(e,n),Lr(n);break;case 13:sr(e,n),Lr(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(r0=Et())),r&4&&zv(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(Xt=(c=Xt)||u,sr(e,n),Xt=c):sr(e,n),Lr(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(le=n,u=n.child;u!==null;){for(d=le=u;le!==null;){switch(f=le,m=f.child,f.tag){case 0:case 11:case 14:case 15:Rl(4,f,f.return);break;case 1:Ka(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(g){St(r,t,g)}}break;case 5:Ka(f,f.return);break;case 22:if(f.memoizedState!==null){Yv(d);continue}}m!==null?(m.return=f,le=m):Yv(d)}u=u.sibling}e:for(u=null,d=n;;){if(d.tag===5){if(u===null){u=d;try{s=d.stateNode,c?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=d.stateNode,l=d.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=hT("display",a))}catch(g){St(n,n.return,g)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){St(n,n.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:sr(e,n),Lr(n),r&4&&zv(n);break;case 21:break;default:sr(e,n),Lr(n)}}function Lr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if($b(t)){var r=t;break e}t=t.return}throw Error(Q(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&($l(s,""),r.flags&=-33);var i=Hv(n);dp(n,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,o=Hv(n);up(n,o,a);break;default:throw Error(Q(161))}}catch(l){St(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function Qk(n,e,t){le=n,Vb(n)}function Vb(n,e,t){for(var r=(n.mode&1)!==0;le!==null;){var s=le,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||iu;if(!a){var o=s.alternate,l=o!==null&&o.memoizedState!==null||Xt;o=iu;var c=Xt;if(iu=a,(Xt=l)&&!c)for(le=s;le!==null;)a=le,l=a.child,a.tag===22&&a.memoizedState!==null?qv(s):l!==null?(l.return=a,le=l):qv(s);for(;i!==null;)le=i,Vb(i),i=i.sibling;le=s,iu=o,Xt=c}Wv(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,le=i):Wv(n)}}function Wv(n){for(;le!==null;){var e=le;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Xt||xf(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Xt)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:cr(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&kv(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}kv(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Gl(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Q(163))}Xt||e.flags&512&&cp(e)}catch(f){St(e,e.return,f)}}if(e===n){le=null;break}if(t=e.sibling,t!==null){t.return=e.return,le=t;break}le=e.return}}function Yv(n){for(;le!==null;){var e=le;if(e===n){le=null;break}var t=e.sibling;if(t!==null){t.return=e.return,le=t;break}le=e.return}}function qv(n){for(;le!==null;){var e=le;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{xf(4,e)}catch(l){St(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){St(e,s,l)}}var i=e.return;try{cp(e)}catch(l){St(e,i,l)}break;case 5:var a=e.return;try{cp(e)}catch(l){St(e,a,l)}}}catch(l){St(e,e.return,l)}if(e===n){le=null;break}var o=e.sibling;if(o!==null){o.return=e.return,le=o;break}le=e.return}}var Xk=Math.ceil,Ad=Cs.ReactCurrentDispatcher,t0=Cs.ReactCurrentOwner,Zn=Cs.ReactCurrentBatchConfig,Ge=0,Ft=null,At=null,Gt=0,Pn=0,Ha=Ai(0),Pt=0,ec=null,ra=0,Sf=0,n0=0,Cl=null,Sn=null,r0=0,Co=1/0,ds=null,_d=!1,fp=null,li=null,au=!1,ti=null,Id=0,Ll=0,hp=null,Vu=-1,Gu=0;function dn(){return Ge&6?Et():Vu!==-1?Vu:Vu=Et()}function ci(n){return n.mode&1?Ge&2&&Gt!==0?Gt&-Gt:Nk.transition!==null?(Gu===0&&(Gu=_T()),Gu):(n=qe,n!==0||(n=window.event,n=n===void 0?16:PT(n.type)),n):1}function vr(n,e,t,r){if(50<Ll)throw Ll=0,hp=null,Error(Q(185));Dc(n,t,r),(!(Ge&2)||n!==Ft)&&(n===Ft&&(!(Ge&2)&&(Sf|=t),Pt===4&&Gs(n,Gt)),In(n,r),t===1&&Ge===0&&!(e.mode&1)&&(Co=Et()+500,gf&&_i()))}function In(n,e){var t=n.callbackNode;NL(n,e);var r=ud(n,n===Ft?Gt:0);if(r===0)t!==null&&sv(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&sv(t),e===1)n.tag===0?Pk(Qv.bind(null,n)):ZT(Qv.bind(null,n)),Ck(function(){!(Ge&6)&&_i()}),t=null;else{switch(IT(r)){case 1:t=Cg;break;case 4:t=wT;break;case 16:t=cd;break;case 536870912:t=AT;break;default:t=cd}t=Qb(t,Gb.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function Gb(n,e){if(Vu=-1,Gu=0,Ge&6)throw Error(Q(327));var t=n.callbackNode;if(Ja()&&n.callbackNode!==t)return null;var r=ud(n,n===Ft?Gt:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Rd(n,r);else{e=r;var s=Ge;Ge|=2;var i=Hb();(Ft!==n||Gt!==e)&&(ds=null,Co=Et()+500,qi(n,e));do try{eD();break}catch(o){Kb(n,o)}while(!0);Vg(),Ad.current=i,Ge=s,At!==null?e=0:(Ft=null,Gt=0,e=Pt)}if(e!==0){if(e===2&&(s=Um(n),s!==0&&(r=s,e=mp(n,s))),e===1)throw t=ec,qi(n,0),Gs(n,r),In(n,Et()),t;if(e===6)Gs(n,r);else{if(s=n.current.alternate,!(r&30)&&!Zk(s)&&(e=Rd(n,r),e===2&&(i=Um(n),i!==0&&(r=i,e=mp(n,i))),e===1))throw t=ec,qi(n,0),Gs(n,r),In(n,Et()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(Q(345));case 2:Mi(n,Sn,ds);break;case 3:if(Gs(n,r),(r&130023424)===r&&(e=r0+500-Et(),10<e)){if(ud(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){dn(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=Ym(Mi.bind(null,n,Sn,ds),e);break}Mi(n,Sn,ds);break;case 4:if(Gs(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var a=31-yr(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=Et()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Xk(r/1960))-r,10<r){n.timeoutHandle=Ym(Mi.bind(null,n,Sn,ds),r);break}Mi(n,Sn,ds);break;case 5:Mi(n,Sn,ds);break;default:throw Error(Q(329))}}}return In(n,Et()),n.callbackNode===t?Gb.bind(null,n):null}function mp(n,e){var t=Cl;return n.current.memoizedState.isDehydrated&&(qi(n,e).flags|=256),n=Rd(n,e),n!==2&&(e=Sn,Sn=t,e!==null&&pp(e)),n}function pp(n){Sn===null?Sn=n:Sn.push.apply(Sn,n)}function Zk(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Er(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Gs(n,e){for(e&=~n0,e&=~Sf,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-yr(e),r=1<<t;n[t]=-1,e&=~r}}function Qv(n){if(Ge&6)throw Error(Q(327));Ja();var e=ud(n,0);if(!(e&1))return In(n,Et()),null;var t=Rd(n,e);if(n.tag!==0&&t===2){var r=Um(n);r!==0&&(e=r,t=mp(n,r))}if(t===1)throw t=ec,qi(n,0),Gs(n,e),In(n,Et()),t;if(t===6)throw Error(Q(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Mi(n,Sn,ds),In(n,Et()),null}function s0(n,e){var t=Ge;Ge|=1;try{return n(e)}finally{Ge=t,Ge===0&&(Co=Et()+500,gf&&_i())}}function sa(n){ti!==null&&ti.tag===0&&!(Ge&6)&&Ja();var e=Ge;Ge|=1;var t=Zn.transition,r=qe;try{if(Zn.transition=null,qe=1,n)return n()}finally{qe=r,Zn.transition=t,Ge=e,!(Ge&6)&&_i()}}function i0(){Pn=Ha.current,lt(Ha)}function qi(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,Rk(t)),At!==null)for(t=At.return;t!==null;){var r=t;switch($g(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&pd();break;case 3:Io(),lt(An),lt(Jt),Yg();break;case 5:Wg(r);break;case 4:Io();break;case 13:lt(ht);break;case 19:lt(ht);break;case 10:Gg(r.type._context);break;case 22:case 23:i0()}t=t.return}if(Ft=n,At=n=ui(n.current,null),Gt=Pn=e,Pt=0,ec=null,n0=Sf=ra=0,Sn=Cl=null,$i!==null){for(e=0;e<$i.length;e++)if(t=$i[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}t.pending=r}$i=null}return n}function Kb(n,e){do{var t=At;try{if(Vg(),$u.current=wd,bd){for(var r=pt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}bd=!1}if(na=0,Mt=Lt=pt=null,Il=!1,Xl=0,t0.current=null,t===null||t.return===null){Pt=1,ec=e,At=null;break}e:{var i=n,a=t.return,o=t,l=e;if(e=Gt,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=o,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=Fv(a);if(m!==null){m.flags&=-257,jv(m,a,o,i,e),m.mode&1&&Mv(i,c,e),e=m,l=c;var p=e.updateQueue;if(p===null){var g=new Set;g.add(l),e.updateQueue=g}else p.add(l);break e}else{if(!(e&1)){Mv(i,c,e),a0();break e}l=Error(Q(426))}}else if(ct&&o.mode&1){var v=Fv(a);if(v!==null){!(v.flags&65536)&&(v.flags|=256),jv(v,a,o,i,e),Ug(Ro(l,o));break e}}i=l=Ro(l,o),Pt!==4&&(Pt=2),Cl===null?Cl=[i]:Cl.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=Ib(i,l,e);Lv(i,x);break e;case 1:o=l;var y=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(li===null||!li.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var b=Rb(i,o,e);Lv(i,b);break e}}i=i.return}while(i!==null)}Wb(t)}catch(w){e=w,At===t&&t!==null&&(At=t=t.return);continue}break}while(!0)}function Hb(){var n=Ad.current;return Ad.current=wd,n===null?wd:n}function a0(){(Pt===0||Pt===3||Pt===2)&&(Pt=4),Ft===null||!(ra&268435455)&&!(Sf&268435455)||Gs(Ft,Gt)}function Rd(n,e){var t=Ge;Ge|=2;var r=Hb();(Ft!==n||Gt!==e)&&(ds=null,qi(n,e));do try{Jk();break}catch(s){Kb(n,s)}while(!0);if(Vg(),Ge=t,Ad.current=r,At!==null)throw Error(Q(261));return Ft=null,Gt=0,Pt}function Jk(){for(;At!==null;)zb(At)}function eD(){for(;At!==null&&!AL();)zb(At)}function zb(n){var e=qb(n.alternate,n,Pn);n.memoizedProps=n.pendingProps,e===null?Wb(n):At=e,t0.current=null}function Wb(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=Wk(t,e),t!==null){t.flags&=32767,At=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Pt=6,At=null;return}}else if(t=zk(t,e,Pn),t!==null){At=t;return}if(e=e.sibling,e!==null){At=e;return}At=e=n}while(e!==null);Pt===0&&(Pt=5)}function Mi(n,e,t){var r=qe,s=Zn.transition;try{Zn.transition=null,qe=1,tD(n,e,t,r)}finally{Zn.transition=s,qe=r}return null}function tD(n,e,t,r){do Ja();while(ti!==null);if(Ge&6)throw Error(Q(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Q(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(OL(n,i),n===Ft&&(At=Ft=null,Gt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||au||(au=!0,Qb(cd,function(){return Ja(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Zn.transition,Zn.transition=null;var a=qe;qe=1;var o=Ge;Ge|=4,t0.current=null,qk(n,t),Bb(t,n),Ek(zm),dd=!!Hm,zm=Hm=null,n.current=t,Qk(t),_L(),Ge=o,qe=a,Zn.transition=i}else n.current=t;if(au&&(au=!1,ti=n,Id=s),i=n.pendingLanes,i===0&&(li=null),CL(t.stateNode),In(n,Et()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(_d)throw _d=!1,n=fp,fp=null,n;return Id&1&&n.tag!==0&&Ja(),i=n.pendingLanes,i&1?n===hp?Ll++:(Ll=0,hp=n):Ll=0,_i(),null}function Ja(){if(ti!==null){var n=IT(Id),e=Zn.transition,t=qe;try{if(Zn.transition=null,qe=16>n?16:n,ti===null)var r=!1;else{if(n=ti,ti=null,Id=0,Ge&6)throw Error(Q(331));var s=Ge;for(Ge|=4,le=n.current;le!==null;){var i=le,a=i.child;if(le.flags&16){var o=i.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(le=c;le!==null;){var u=le;switch(u.tag){case 0:case 11:case 15:Rl(8,u,i)}var d=u.child;if(d!==null)d.return=u,le=d;else for(;le!==null;){u=le;var f=u.sibling,m=u.return;if(jb(u),u===c){le=null;break}if(f!==null){f.return=m,le=f;break}le=m}}}var p=i.alternate;if(p!==null){var g=p.child;if(g!==null){p.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(g!==null)}}le=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,le=a;else e:for(;le!==null;){if(i=le,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Rl(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,le=x;break e}le=i.return}}var y=n.current;for(le=y;le!==null;){a=le;var S=a.child;if(a.subtreeFlags&2064&&S!==null)S.return=a,le=S;else e:for(a=y;le!==null;){if(o=le,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:xf(9,o)}}catch(w){St(o,o.return,w)}if(o===a){le=null;break e}var b=o.sibling;if(b!==null){b.return=o.return,le=b;break e}le=o.return}}if(Ge=s,_i(),zr&&typeof zr.onPostCommitFiberRoot=="function")try{zr.onPostCommitFiberRoot(df,n)}catch{}r=!0}return r}finally{qe=t,Zn.transition=e}}return!1}function Xv(n,e,t){e=Ro(t,e),e=Ib(n,e,1),n=oi(n,e,1),e=dn(),n!==null&&(Dc(n,1,e),In(n,e))}function St(n,e,t){if(n.tag===3)Xv(n,n,t);else for(;e!==null;){if(e.tag===3){Xv(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(li===null||!li.has(r))){n=Ro(t,n),n=Rb(e,n,1),e=oi(e,n,1),n=dn(),e!==null&&(Dc(e,1,n),In(e,n));break}}e=e.return}}function nD(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=dn(),n.pingedLanes|=n.suspendedLanes&t,Ft===n&&(Gt&t)===t&&(Pt===4||Pt===3&&(Gt&130023424)===Gt&&500>Et()-r0?qi(n,0):n0|=t),In(n,e)}function Yb(n,e){e===0&&(n.mode&1?(e=Qc,Qc<<=1,!(Qc&130023424)&&(Qc=4194304)):e=1);var t=dn();n=ws(n,e),n!==null&&(Dc(n,e,t),In(n,t))}function rD(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),Yb(n,t)}function sD(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Q(314))}r!==null&&r.delete(e),Yb(n,t)}var qb;qb=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||An.current)En=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return En=!1,Hk(n,e,t);En=!!(n.flags&131072)}else En=!1,ct&&e.flags&1048576&&JT(e,vd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Bu(n,e),n=e.pendingProps;var s=wo(e,Jt.current);Za(e,t),s=Qg(null,e,r,n,s,t);var i=Xg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,_n(r)?(i=!0,gd(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Hg(e),s.updater=vf,e.stateNode=s,s._reactInternals=e,tp(e,r,n,t),e=sp(null,e,r,!0,i,t)):(e.tag=0,ct&&i&&jg(e),sn(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Bu(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=aD(r),n=cr(r,n),s){case 0:e=rp(null,e,r,n,t);break e;case 1:e=Bv(null,e,r,n,t);break e;case 11:e=$v(null,e,r,n,t);break e;case 14:e=Uv(null,e,r,cr(r.type,n),t);break e}throw Error(Q(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cr(r,s),rp(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cr(r,s),Bv(n,e,r,s,t);case 3:e:{if(Db(e),n===null)throw Error(Q(387));r=e.pendingProps,i=e.memoizedState,s=i.element,ib(n,e),Ed(e,r,null,t);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ro(Error(Q(423)),e),e=Vv(n,e,r,t,s);break e}else if(r!==s){s=Ro(Error(Q(424)),e),e=Vv(n,e,r,t,s);break e}else for(Mn=ai(e.stateNode.containerInfo.firstChild),Fn=e,ct=!0,fr=null,t=rb(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ao(),r===s){e=As(n,e,t);break e}sn(n,e,r,t)}e=e.child}return e;case 5:return ab(e),n===null&&Zm(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,a=s.children,Wm(r,s)?a=null:i!==null&&Wm(r,i)&&(e.flags|=32),kb(n,e),sn(n,e,a,t),e.child;case 6:return n===null&&Zm(e),null;case 13:return Pb(n,e,t);case 4:return zg(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=_o(e,null,r,t):sn(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cr(r,s),$v(n,e,r,s,t);case 7:return sn(n,e,e.pendingProps,t),e.child;case 8:return sn(n,e,e.pendingProps.children,t),e.child;case 12:return sn(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,st(xd,r._currentValue),r._currentValue=a,i!==null)if(Er(i.value,a)){if(i.children===s.children&&!An.current){e=As(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=Ss(-1,t&-t),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),Jm(i.return,t,e),o.lanes|=t;break}l=l.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(Q(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),Jm(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}sn(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Za(e,t),s=er(s),r=r(s),e.flags|=1,sn(n,e,r,t),e.child;case 14:return r=e.type,s=cr(r,e.pendingProps),s=cr(r.type,s),Uv(n,e,r,s,t);case 15:return Cb(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cr(r,s),Bu(n,e),e.tag=1,_n(r)?(n=!0,gd(e)):n=!1,Za(e,t),_b(e,r,s),tp(e,r,s,t),sp(null,e,r,!0,n,t);case 19:return Nb(n,e,t);case 22:return Lb(n,e,t)}throw Error(Q(156,e.tag))};function Qb(n,e){return bT(n,e)}function iD(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xn(n,e,t,r){return new iD(n,e,t,r)}function o0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function aD(n){if(typeof n=="function")return o0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===_g)return 11;if(n===Ig)return 14}return 2}function ui(n,e){var t=n.alternate;return t===null?(t=Xn(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Ku(n,e,t,r,s,i){var a=2;if(r=n,typeof n=="function")o0(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case Oa:return Qi(t.children,s,i,e);case Ag:a=8,s|=8;break;case Am:return n=Xn(12,t,e,s|2),n.elementType=Am,n.lanes=i,n;case _m:return n=Xn(13,t,e,s),n.elementType=_m,n.lanes=i,n;case Im:return n=Xn(19,t,e,s),n.elementType=Im,n.lanes=i,n;case aT:return Ef(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case sT:a=10;break e;case iT:a=9;break e;case _g:a=11;break e;case Ig:a=14;break e;case js:a=16,r=null;break e}throw Error(Q(130,n==null?n:typeof n,""))}return e=Xn(a,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function Qi(n,e,t,r){return n=Xn(7,n,r,e),n.lanes=t,n}function Ef(n,e,t,r){return n=Xn(22,n,r,e),n.elementType=aT,n.lanes=t,n.stateNode={isHidden:!1},n}function Ph(n,e,t){return n=Xn(6,n,null,e),n.lanes=t,n}function Nh(n,e,t){return e=Xn(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function oD(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mh(0),this.expirationTimes=mh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mh(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function l0(n,e,t,r,s,i,a,o,l){return n=new oD(n,e,t,o,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Xn(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Hg(i),n}function lD(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Na,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function Xb(n){if(!n)return fi;n=n._reactInternals;e:{if(ga(n)!==n||n.tag!==1)throw Error(Q(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(_n(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Q(171))}if(n.tag===1){var t=n.type;if(_n(t))return XT(n,t,e)}return e}function Zb(n,e,t,r,s,i,a,o,l){return n=l0(t,r,!0,n,s,i,a,o,l),n.context=Xb(null),t=n.current,r=dn(),s=ci(t),i=Ss(r,s),i.callback=e??null,oi(t,i,s),n.current.lanes=s,Dc(n,s,r),In(n,r),n}function Tf(n,e,t,r){var s=e.current,i=dn(),a=ci(s);return t=Xb(t),e.context===null?e.context=t:e.pendingContext=t,e=Ss(i,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=oi(s,e,a),n!==null&&(vr(n,s,a,i),ju(n,s,a)),a}function Cd(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Zv(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function c0(n,e){Zv(n,e),(n=n.alternate)&&Zv(n,e)}function cD(){return null}var Jb=typeof reportError=="function"?reportError:function(n){console.error(n)};function u0(n){this._internalRoot=n}bf.prototype.render=u0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Q(409));Tf(n,e,null,null)};bf.prototype.unmount=u0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;sa(function(){Tf(null,n,null,null)}),e[bs]=null}};function bf(n){this._internalRoot=n}bf.prototype.unstable_scheduleHydration=function(n){if(n){var e=LT();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Vs.length&&e!==0&&e<Vs[t].priority;t++);Vs.splice(t,0,n),t===0&&DT(n)}};function d0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function wf(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Jv(){}function uD(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var c=Cd(a);i.call(c)}}var a=Zb(e,r,n,0,null,!1,!1,"",Jv);return n._reactRootContainer=a,n[bs]=a.current,zl(n.nodeType===8?n.parentNode:n),sa(),a}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var o=r;r=function(){var c=Cd(l);o.call(c)}}var l=l0(n,0,!1,null,null,!1,!1,"",Jv);return n._reactRootContainer=l,n[bs]=l.current,zl(n.nodeType===8?n.parentNode:n),sa(function(){Tf(e,l,t,r)}),l}function Af(n,e,t,r,s){var i=t._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var o=s;s=function(){var l=Cd(a);o.call(l)}}Tf(e,a,n,s)}else a=uD(t,e,n,s,r);return Cd(a)}RT=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=ml(e.pendingLanes);t!==0&&(Lg(e,t|1),In(e,Et()),!(Ge&6)&&(Co=Et()+500,_i()))}break;case 13:sa(function(){var r=ws(n,1);if(r!==null){var s=dn();vr(r,n,1,s)}}),c0(n,1)}};kg=function(n){if(n.tag===13){var e=ws(n,134217728);if(e!==null){var t=dn();vr(e,n,134217728,t)}c0(n,134217728)}};CT=function(n){if(n.tag===13){var e=ci(n),t=ws(n,e);if(t!==null){var r=dn();vr(t,n,e,r)}c0(n,e)}};LT=function(){return qe};kT=function(n,e){var t=qe;try{return qe=n,e()}finally{qe=t}};Fm=function(n,e,t){switch(e){case"input":if(Lm(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=pf(r);if(!s)throw Error(Q(90));lT(r),Lm(r,s)}}}break;case"textarea":uT(n,t);break;case"select":e=t.value,e!=null&&Ya(n,!!t.multiple,e,!1)}};yT=s0;vT=sa;var dD={usingClientEntryPoint:!1,Events:[Nc,$a,pf,pT,gT,s0]},al={findFiberByHostInstance:ji,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},fD={bundleType:al.bundleType,version:al.version,rendererPackageName:al.rendererPackageName,rendererConfig:al.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Cs.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=ET(n),n===null?null:n.stateNode},findFiberByHostInstance:al.findFiberByHostInstance||cD,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ou=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ou.isDisabled&&ou.supportsFiber)try{df=ou.inject(fD),zr=ou}catch{}}Vn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dD;Vn.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d0(e))throw Error(Q(200));return lD(n,e,null,t)};Vn.createRoot=function(n,e){if(!d0(n))throw Error(Q(299));var t=!1,r="",s=Jb;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=l0(n,1,!1,null,null,t,!1,r,s),n[bs]=e.current,zl(n.nodeType===8?n.parentNode:n),new u0(e)};Vn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Q(188)):(n=Object.keys(n).join(","),Error(Q(268,n)));return n=ET(e),n=n===null?null:n.stateNode,n};Vn.flushSync=function(n){return sa(n)};Vn.hydrate=function(n,e,t){if(!wf(e))throw Error(Q(200));return Af(null,n,e,!0,t)};Vn.hydrateRoot=function(n,e,t){if(!d0(n))throw Error(Q(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",a=Jb;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=Zb(e,null,n,1,t??null,s,!1,i,a),n[bs]=e.current,zl(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new bf(e)};Vn.render=function(n,e,t){if(!wf(e))throw Error(Q(200));return Af(null,n,e,!1,t)};Vn.unmountComponentAtNode=function(n){if(!wf(n))throw Error(Q(40));return n._reactRootContainer?(sa(function(){Af(null,null,n,!1,function(){n._reactRootContainer=null,n[bs]=null})}),!0):!1};Vn.unstable_batchedUpdates=s0;Vn.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!wf(t))throw Error(Q(200));if(n==null||n._reactInternals===void 0)throw Error(Q(38));return Af(n,e,t,!1,r)};Vn.version="18.3.1-next-f1338f8080-20240426";function ew(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ew)}catch(n){console.error(n)}}ew(),eT.exports=Vn;var ya=eT.exports;const hD=BE(ya);var tw,ex=ya;tw=ex.createRoot,ex.hydrateRoot;function mD(n,e){if(n instanceof RegExp)return{keys:!1,pattern:n};var t,r,s,i,a=[],o="",l=n.split("/");for(l[0]||l.shift();s=l.shift();)t=s[0],t==="*"?(a.push(t),o+=s[1]==="?"?"(?:/(.*))?":"/(.*)"):t===":"?(r=s.indexOf("?",1),i=s.indexOf(".",1),a.push(s.substring(1,~r?r:~i?i:s.length)),o+=~r&&!~i?"(?:/([^/]+?))?":"/([^/]+?)",~i&&(o+=(~r?"?":"")+"\\"+s.substring(i))):o+="/"+s;return{keys:a,pattern:new RegExp("^"+o+(e?"(?=$|/)":"/?$"),"i")}}var nw={exports:{}},rw={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lo=E;function pD(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var gD=typeof Object.is=="function"?Object.is:pD,yD=Lo.useState,vD=Lo.useEffect,xD=Lo.useLayoutEffect,SD=Lo.useDebugValue;function ED(n,e){var t=e(),r=yD({inst:{value:t,getSnapshot:e}}),s=r[0].inst,i=r[1];return xD(function(){s.value=t,s.getSnapshot=e,Oh(s)&&i({inst:s})},[n,t,e]),vD(function(){return Oh(s)&&i({inst:s}),n(function(){Oh(s)&&i({inst:s})})},[n]),SD(t),t}function Oh(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!gD(n,t)}catch{return!0}}function TD(n,e){return e()}var bD=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?TD:ED;rw.useSyncExternalStore=Lo.useSyncExternalStore!==void 0?Lo.useSyncExternalStore:bD;nw.exports=rw;var wD=nw.exports;const AD=ZE.useInsertionEffect,_D=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ID=_D?E.useLayoutEffect:E.useEffect,RD=AD||ID,sw=n=>{const e=E.useRef([n,(...t)=>e[0](...t)]).current;return RD(()=>{e[0]=n}),e[1]},CD="popstate",f0="pushState",h0="replaceState",LD="hashchange",tx=[CD,f0,h0,LD],kD=n=>{for(const e of tx)addEventListener(e,n);return()=>{for(const e of tx)removeEventListener(e,n)}},iw=(n,e)=>wD.useSyncExternalStore(kD,n,e),DD=()=>location.search,PD=({ssrSearch:n=""}={})=>iw(DD,()=>n),nx=()=>location.pathname,ND=({ssrPath:n}={})=>iw(nx,n?()=>n:nx),OD=(n,{replace:e=!1,state:t=null}={})=>history[e?h0:f0](t,"",n),MD=(n={})=>[ND(n),OD],rx=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[rx]>"u"){for(const n of[f0,h0]){const e=history[n];history[n]=function(){const t=e.apply(this,arguments),r=new Event(n);return r.arguments=arguments,dispatchEvent(r),t}}Object.defineProperty(window,rx,{value:!0})}const FD=(n,e)=>e.toLowerCase().indexOf(n.toLowerCase())?"~"+e:e.slice(n.length)||"/",aw=(n="")=>n==="/"?"":n,jD=(n,e)=>n[0]==="~"?n.slice(1):aw(e)+n,$D=(n="",e)=>FD(sx(aw(n)),sx(e)),sx=n=>{try{return decodeURI(n)}catch{return n}},ow={hook:MD,searchHook:PD,parser:mD,base:"",ssrPath:void 0,ssrSearch:void 0,hrefs:n=>n},lw=E.createContext(ow),Bo=()=>E.useContext(lw),cw={},uw=E.createContext(cw),UD=()=>E.useContext(uw),_f=n=>{const[e,t]=n.hook(n);return[$D(n.base,e),sw((r,s)=>t(jD(r,n.base),s))]},dw=()=>_f(Bo()),m0=(n,e,t,r)=>{const{pattern:s,keys:i}=e instanceof RegExp?{keys:!1,pattern:e}:n(e||"*",r),a=s.exec(t)||[],[o,...l]=a;return o!==void 0?[!0,(()=>{const c=i!==!1?Object.fromEntries(i.map((d,f)=>[d,l[f]])):a.groups;let u={...l};return c&&Object.assign(u,c),u})(),...r?[o]:[]]:[!1,null]},BD=n=>m0(Bo().parser,n,dw()[0]),VD=({children:n,...e})=>{var u,d;const t=Bo(),r=e.hook?ow:t;let s=r;const[i,a]=((u=e.ssrPath)==null?void 0:u.split("?"))??[];a&&(e.ssrSearch=a,e.ssrPath=i),e.hrefs=e.hrefs??((d=e.hook)==null?void 0:d.hrefs);let o=E.useRef({}),l=o.current,c=l;for(let f in r){const m=f==="base"?r[f]+(e[f]||""):e[f]||r[f];l===c&&m!==c[f]&&(o.current=c={...c}),c[f]=m,m!==r[f]&&(s=c)}return E.createElement(lw.Provider,{value:s,children:n})},ix=({children:n,component:e},t)=>e?E.createElement(e,{params:t}):typeof n=="function"?n(t):n,GD=n=>{let e=E.useRef(cw),t=e.current;for(const r in n)n[r]!==t[r]&&(t=n);return Object.keys(n).length===0&&(t=n),e.current=t},ir=({path:n,nest:e,match:t,...r})=>{const s=Bo(),[i]=_f(s),[a,o,l]=t??m0(s.parser,n,i,e),c=GD({...UD(),...o});if(!a)return null;const u=l?E.createElement(VD,{base:l},ix(r,c)):ix(r,c);return E.createElement(uw.Provider,{value:c,children:u})},p0=E.forwardRef((n,e)=>{const t=Bo(),[r,s]=_f(t),{to:i="",href:a=i,onClick:o,asChild:l,children:c,className:u,replace:d,state:f,...m}=n,p=sw(v=>{v.ctrlKey||v.metaKey||v.altKey||v.shiftKey||v.button!==0||(o==null||o(v),v.defaultPrevented||(v.preventDefault(),s(a,n)))}),g=t.hrefs(a[0]==="~"?a.slice(1):t.base+a,t);return l&&E.isValidElement(c)?E.cloneElement(c,{onClick:p,href:g}):E.createElement("a",{...m,onClick:p,href:g,className:u!=null&&u.call?u(r===a):u,children:c,ref:e})}),fw=n=>Array.isArray(n)?n.flatMap(e=>fw(e&&e.type===E.Fragment?e.props.children:e)):[n],KD=({children:n,location:e})=>{const t=Bo(),[r]=_f(t);for(const s of fw(n)){let i=0;if(E.isValidElement(s)&&(i=m0(t.parser,s.props.path,e||r,s.props.nest))[0])return E.cloneElement(s,{match:i})}return null};var Vo=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ia=typeof window>"u"||"Deno"in globalThis;function zn(){}function HD(n,e){return typeof n=="function"?n(e):n}function gp(n){return typeof n=="number"&&n>=0&&n!==1/0}function hw(n,e){return Math.max(n+(e||0)-Date.now(),0)}function eo(n,e){return typeof n=="function"?n(e):n}function hr(n,e){return typeof n=="function"?n(e):n}function ax(n,e){const{type:t="all",exact:r,fetchStatus:s,predicate:i,queryKey:a,stale:o}=n;if(a){if(r){if(e.queryHash!==g0(a,e.options))return!1}else if(!tc(e.queryKey,a))return!1}if(t!=="all"){const l=e.isActive();if(t==="active"&&!l||t==="inactive"&&l)return!1}return!(typeof o=="boolean"&&e.isStale()!==o||s&&s!==e.state.fetchStatus||i&&!i(e))}function ox(n,e){const{exact:t,status:r,predicate:s,mutationKey:i}=n;if(i){if(!e.options.mutationKey)return!1;if(t){if(aa(e.options.mutationKey)!==aa(i))return!1}else if(!tc(e.options.mutationKey,i))return!1}return!(r&&e.state.status!==r||s&&!s(e))}function g0(n,e){return((e==null?void 0:e.queryKeyHashFn)||aa)(n)}function aa(n){return JSON.stringify(n,(e,t)=>yp(t)?Object.keys(t).sort().reduce((r,s)=>(r[s]=t[s],r),{}):t)}function tc(n,e){return n===e?!0:typeof n!=typeof e?!1:n&&e&&typeof n=="object"&&typeof e=="object"?!Object.keys(e).some(t=>!tc(n[t],e[t])):!1}function mw(n,e){if(n===e)return n;const t=lx(n)&&lx(e);if(t||yp(n)&&yp(e)){const r=t?n:Object.keys(n),s=r.length,i=t?e:Object.keys(e),a=i.length,o=t?[]:{};let l=0;for(let c=0;c<a;c++){const u=t?c:i[c];(!t&&r.includes(u)||t)&&n[u]===void 0&&e[u]===void 0?(o[u]=void 0,l++):(o[u]=mw(n[u],e[u]),o[u]===n[u]&&n[u]!==void 0&&l++)}return s===a&&l===s?n:o}return e}function Ld(n,e){if(!e||Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(n[t]!==e[t])return!1;return!0}function lx(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function yp(n){if(!cx(n))return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!cx(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function cx(n){return Object.prototype.toString.call(n)==="[object Object]"}function zD(n){return new Promise(e=>{setTimeout(e,n)})}function vp(n,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(n,e):t.structuralSharing!==!1?mw(n,e):e}function WD(n,e,t=0){const r=[...n,e];return t&&r.length>t?r.slice(1):r}function YD(n,e,t=0){const r=[e,...n];return t&&r.length>t?r.slice(0,-1):r}var y0=Symbol();function pw(n,e){return!n.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!n.queryFn||n.queryFn===y0?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}var Vi,Hs,co,kE,qD=(kE=class extends Vo{constructor(){super();ye(this,Vi);ye(this,Hs);ye(this,co);ie(this,co,e=>{if(!ia&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){k(this,Hs)||this.setEventListener(k(this,co))}onUnsubscribe(){var e;this.hasListeners()||((e=k(this,Hs))==null||e.call(this),ie(this,Hs,void 0))}setEventListener(e){var t;ie(this,co,e),(t=k(this,Hs))==null||t.call(this),ie(this,Hs,e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(e){k(this,Vi)!==e&&(ie(this,Vi,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof k(this,Vi)=="boolean"?k(this,Vi):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Vi=new WeakMap,Hs=new WeakMap,co=new WeakMap,kE),v0=new qD,uo,zs,fo,DE,QD=(DE=class extends Vo{constructor(){super();ye(this,uo,!0);ye(this,zs);ye(this,fo);ie(this,fo,e=>{if(!ia&&window.addEventListener){const t=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",r)}}})}onSubscribe(){k(this,zs)||this.setEventListener(k(this,fo))}onUnsubscribe(){var e;this.hasListeners()||((e=k(this,zs))==null||e.call(this),ie(this,zs,void 0))}setEventListener(e){var t;ie(this,fo,e),(t=k(this,zs))==null||t.call(this),ie(this,zs,e(this.setOnline.bind(this)))}setOnline(e){k(this,uo)!==e&&(ie(this,uo,e),this.listeners.forEach(r=>{r(e)}))}isOnline(){return k(this,uo)}},uo=new WeakMap,zs=new WeakMap,fo=new WeakMap,DE),kd=new QD;function xp(){let n,e;const t=new Promise((s,i)=>{n=s,e=i});t.status="pending",t.catch(()=>{});function r(s){Object.assign(t,s),delete t.resolve,delete t.reject}return t.resolve=s=>{r({status:"fulfilled",value:s}),n(s)},t.reject=s=>{r({status:"rejected",reason:s}),e(s)},t}function XD(n){return Math.min(1e3*2**n,3e4)}function gw(n){return(n??"online")==="online"?kd.isOnline():!0}var yw=class extends Error{constructor(n){super("CancelledError"),this.revert=n==null?void 0:n.revert,this.silent=n==null?void 0:n.silent}};function Mh(n){return n instanceof yw}function vw(n){let e=!1,t=0,r=!1,s;const i=xp(),a=g=>{var v;r||(f(new yw(g)),(v=n.abort)==null||v.call(n))},o=()=>{e=!0},l=()=>{e=!1},c=()=>v0.isFocused()&&(n.networkMode==="always"||kd.isOnline())&&n.canRun(),u=()=>gw(n.networkMode)&&n.canRun(),d=g=>{var v;r||(r=!0,(v=n.onSuccess)==null||v.call(n,g),s==null||s(),i.resolve(g))},f=g=>{var v;r||(r=!0,(v=n.onError)==null||v.call(n,g),s==null||s(),i.reject(g))},m=()=>new Promise(g=>{var v;s=x=>{(r||c())&&g(x)},(v=n.onPause)==null||v.call(n)}).then(()=>{var g;s=void 0,r||(g=n.onContinue)==null||g.call(n)}),p=()=>{if(r)return;let g;const v=t===0?n.initialPromise:void 0;try{g=v??n.fn()}catch(x){g=Promise.reject(x)}Promise.resolve(g).then(d).catch(x=>{var _;if(r)return;const y=n.retry??(ia?0:3),S=n.retryDelay??XD,b=typeof S=="function"?S(t,x):S,w=y===!0||typeof y=="number"&&t<y||typeof y=="function"&&y(t,x);if(e||!w){f(x);return}t++,(_=n.onFail)==null||_.call(n,t,x),zD(b).then(()=>c()?void 0:m()).then(()=>{e?f(x):p()})})};return{promise:i,cancel:a,continue:()=>(s==null||s(),i),cancelRetry:o,continueRetry:l,canStart:u,start:()=>(u()?p():m().then(p),i)}}function ZD(){let n=[],e=0,t=o=>{o()},r=o=>{o()},s=o=>setTimeout(o,0);const i=o=>{e?n.push(o):s(()=>{t(o)})},a=()=>{const o=n;n=[],o.length&&s(()=>{r(()=>{o.forEach(l=>{t(l)})})})};return{batch:o=>{let l;e++;try{l=o()}finally{e--,e||a()}return l},batchCalls:o=>(...l)=>{i(()=>{o(...l)})},schedule:i,setNotifyFunction:o=>{t=o},setBatchNotifyFunction:o=>{r=o},setScheduler:o=>{s=o}}}var Dt=ZD(),Gi,PE,xw=(PE=class{constructor(){ye(this,Gi)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),gp(this.gcTime)&&ie(this,Gi,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(ia?1/0:5*60*1e3))}clearGcTimeout(){k(this,Gi)&&(clearTimeout(k(this,Gi)),ie(this,Gi,void 0))}},Gi=new WeakMap,PE),ho,mo,Hn,Qt,Ic,Ki,ur,cs,NE,JD=(NE=class extends xw{constructor(e){super();ye(this,ur);ye(this,ho);ye(this,mo);ye(this,Hn);ye(this,Qt);ye(this,Ic);ye(this,Ki);ie(this,Ki,!1),ie(this,Ic,e.defaultOptions),this.setOptions(e.options),this.observers=[],ie(this,Hn,e.cache),this.queryKey=e.queryKey,this.queryHash=e.queryHash,ie(this,ho,eP(this.options)),this.state=e.state??k(this,ho),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=k(this,Qt))==null?void 0:e.promise}setOptions(e){this.options={...k(this,Ic),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&k(this,Hn).remove(this)}setData(e,t){const r=vp(this.state.data,e,this.options);return Pe(this,ur,cs).call(this,{data:r,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),r}setState(e,t){Pe(this,ur,cs).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var r,s;const t=(r=k(this,Qt))==null?void 0:r.promise;return(s=k(this,Qt))==null||s.cancel(e),t?t.then(zn).catch(zn):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(k(this,ho))}isActive(){return this.observers.some(e=>hr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===y0||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(e=0){return this.state.isInvalidated||this.state.data===void 0||!hw(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(r=>r.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=k(this,Qt))==null||t.continue()}onOnline(){var t;const e=this.observers.find(r=>r.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=k(this,Qt))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),k(this,Hn).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(k(this,Qt)&&(k(this,Ki)?k(this,Qt).cancel({revert:!0}):k(this,Qt).cancelRetry()),this.scheduleGc()),k(this,Hn).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Pe(this,ur,cs).call(this,{type:"invalidate"})}fetch(e,t){var l,c,u;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(k(this,Qt))return k(this,Qt).continueRetry(),k(this,Qt).promise}if(e&&this.setOptions(e),!this.options.queryFn){const d=this.observers.find(f=>f.options.queryFn);d&&this.setOptions(d.options)}const r=new AbortController,s=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(ie(this,Ki,!0),r.signal)})},i=()=>{const d=pw(this.options,t),f={queryKey:this.queryKey,meta:this.meta};return s(f),ie(this,Ki,!1),this.options.persister?this.options.persister(d,f,this):d(f)},a={fetchOptions:t,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:i};s(a),(l=this.options.behavior)==null||l.onFetch(a,this),ie(this,mo,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((c=a.fetchOptions)==null?void 0:c.meta))&&Pe(this,ur,cs).call(this,{type:"fetch",meta:(u=a.fetchOptions)==null?void 0:u.meta});const o=d=>{var f,m,p,g;Mh(d)&&d.silent||Pe(this,ur,cs).call(this,{type:"error",error:d}),Mh(d)||((m=(f=k(this,Hn).config).onError)==null||m.call(f,d,this),(g=(p=k(this,Hn).config).onSettled)==null||g.call(p,this.state.data,d,this)),this.scheduleGc()};return ie(this,Qt,vw({initialPromise:t==null?void 0:t.initialPromise,fn:a.fetchFn,abort:r.abort.bind(r),onSuccess:d=>{var f,m,p,g;if(d===void 0){o(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(d)}catch(v){o(v);return}(m=(f=k(this,Hn).config).onSuccess)==null||m.call(f,d,this),(g=(p=k(this,Hn).config).onSettled)==null||g.call(p,d,this.state.error,this),this.scheduleGc()},onError:o,onFail:(d,f)=>{Pe(this,ur,cs).call(this,{type:"failed",failureCount:d,error:f})},onPause:()=>{Pe(this,ur,cs).call(this,{type:"pause"})},onContinue:()=>{Pe(this,ur,cs).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0})),k(this,Qt).start()}},ho=new WeakMap,mo=new WeakMap,Hn=new WeakMap,Qt=new WeakMap,Ic=new WeakMap,Ki=new WeakMap,ur=new WeakSet,cs=function(e){const t=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...Sw(r.data,this.options),fetchMeta:e.meta??null};case"success":return{...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=e.error;return Mh(s)&&s.revert&&k(this,mo)?{...k(this,mo),fetchStatus:"idle"}:{...r,error:s,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=t(this.state),Dt.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),k(this,Hn).notify({query:this,type:"updated",action:e})})},NE);function Sw(n,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:gw(e.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function eP(n){const e=typeof n.initialData=="function"?n.initialData():n.initialData,t=e!==void 0,r=t?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var Mr,OE,tP=(OE=class extends Vo{constructor(e={}){super();ye(this,Mr);this.config=e,ie(this,Mr,new Map)}build(e,t,r){const s=t.queryKey,i=t.queryHash??g0(s,t);let a=this.get(i);return a||(a=new JD({cache:this,queryKey:s,queryHash:i,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(s)}),this.add(a)),a}add(e){k(this,Mr).has(e.queryHash)||(k(this,Mr).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=k(this,Mr).get(e.queryHash);t&&(e.destroy(),t===e&&k(this,Mr).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Dt.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return k(this,Mr).get(e)}getAll(){return[...k(this,Mr).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(r=>ax(t,r))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(r=>ax(e,r)):t}notify(e){Dt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Dt.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Dt.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Mr=new WeakMap,OE),Fr,tn,Hi,jr,Ms,ME,nP=(ME=class extends xw{constructor(e){super();ye(this,jr);ye(this,Fr);ye(this,tn);ye(this,Hi);this.mutationId=e.mutationId,ie(this,tn,e.mutationCache),ie(this,Fr,[]),this.state=e.state||Ew(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){k(this,Fr).includes(e)||(k(this,Fr).push(e),this.clearGcTimeout(),k(this,tn).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){ie(this,Fr,k(this,Fr).filter(t=>t!==e)),this.scheduleGc(),k(this,tn).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){k(this,Fr).length||(this.state.status==="pending"?this.scheduleGc():k(this,tn).remove(this))}continue(){var e;return((e=k(this,Hi))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var s,i,a,o,l,c,u,d,f,m,p,g,v,x,y,S,b,w,_,A;ie(this,Hi,vw({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(I,C)=>{Pe(this,jr,Ms).call(this,{type:"failed",failureCount:I,error:C})},onPause:()=>{Pe(this,jr,Ms).call(this,{type:"pause"})},onContinue:()=>{Pe(this,jr,Ms).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>k(this,tn).canRun(this)}));const t=this.state.status==="pending",r=!k(this,Hi).canStart();try{if(!t){Pe(this,jr,Ms).call(this,{type:"pending",variables:e,isPaused:r}),await((i=(s=k(this,tn).config).onMutate)==null?void 0:i.call(s,e,this));const C=await((o=(a=this.options).onMutate)==null?void 0:o.call(a,e));C!==this.state.context&&Pe(this,jr,Ms).call(this,{type:"pending",context:C,variables:e,isPaused:r})}const I=await k(this,Hi).start();return await((c=(l=k(this,tn).config).onSuccess)==null?void 0:c.call(l,I,e,this.state.context,this)),await((d=(u=this.options).onSuccess)==null?void 0:d.call(u,I,e,this.state.context)),await((m=(f=k(this,tn).config).onSettled)==null?void 0:m.call(f,I,null,this.state.variables,this.state.context,this)),await((g=(p=this.options).onSettled)==null?void 0:g.call(p,I,null,e,this.state.context)),Pe(this,jr,Ms).call(this,{type:"success",data:I}),I}catch(I){try{throw await((x=(v=k(this,tn).config).onError)==null?void 0:x.call(v,I,e,this.state.context,this)),await((S=(y=this.options).onError)==null?void 0:S.call(y,I,e,this.state.context)),await((w=(b=k(this,tn).config).onSettled)==null?void 0:w.call(b,void 0,I,this.state.variables,this.state.context,this)),await((A=(_=this.options).onSettled)==null?void 0:A.call(_,void 0,I,e,this.state.context)),I}finally{Pe(this,jr,Ms).call(this,{type:"error",error:I})}}finally{k(this,tn).runNext(this)}}},Fr=new WeakMap,tn=new WeakMap,Hi=new WeakMap,jr=new WeakSet,Ms=function(e){const t=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),Dt.batch(()=>{k(this,Fr).forEach(r=>{r.onMutationUpdate(e)}),k(this,tn).notify({mutation:this,type:"updated",action:e})})},ME);function Ew(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var kn,Rc,FE,rP=(FE=class extends Vo{constructor(e={}){super();ye(this,kn);ye(this,Rc);this.config=e,ie(this,kn,new Map),ie(this,Rc,Date.now())}build(e,t,r){const s=new nP({mutationCache:this,mutationId:++Kc(this,Rc)._,options:e.defaultMutationOptions(t),state:r});return this.add(s),s}add(e){const t=lu(e),r=k(this,kn).get(t)??[];r.push(e),k(this,kn).set(t,r),this.notify({type:"added",mutation:e})}remove(e){var r;const t=lu(e);if(k(this,kn).has(t)){const s=(r=k(this,kn).get(t))==null?void 0:r.filter(i=>i!==e);s&&(s.length===0?k(this,kn).delete(t):k(this,kn).set(t,s))}this.notify({type:"removed",mutation:e})}canRun(e){var r;const t=(r=k(this,kn).get(lu(e)))==null?void 0:r.find(s=>s.state.status==="pending");return!t||t===e}runNext(e){var r;const t=(r=k(this,kn).get(lu(e)))==null?void 0:r.find(s=>s!==e&&s.state.isPaused);return(t==null?void 0:t.continue())??Promise.resolve()}clear(){Dt.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}getAll(){return[...k(this,kn).values()].flat()}find(e){const t={exact:!0,...e};return this.getAll().find(r=>ox(t,r))}findAll(e={}){return this.getAll().filter(t=>ox(e,t))}notify(e){Dt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return Dt.batch(()=>Promise.all(e.map(t=>t.continue().catch(zn))))}},kn=new WeakMap,Rc=new WeakMap,FE);function lu(n){var e;return((e=n.options.scope)==null?void 0:e.id)??String(n.mutationId)}function ux(n){return{onFetch:(e,t)=>{var u,d,f,m,p;const r=e.options,s=(f=(d=(u=e.fetchOptions)==null?void 0:u.meta)==null?void 0:d.fetchMore)==null?void 0:f.direction,i=((m=e.state.data)==null?void 0:m.pages)||[],a=((p=e.state.data)==null?void 0:p.pageParams)||[];let o={pages:[],pageParams:[]},l=0;const c=async()=>{let g=!1;const v=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(e.signal.aborted?g=!0:e.signal.addEventListener("abort",()=>{g=!0}),e.signal)})},x=pw(e.options,e.fetchOptions),y=async(S,b,w)=>{if(g)return Promise.reject();if(b==null&&S.pages.length)return Promise.resolve(S);const _={queryKey:e.queryKey,pageParam:b,direction:w?"backward":"forward",meta:e.options.meta};v(_);const A=await x(_),{maxPages:I}=e.options,C=w?YD:WD;return{pages:C(S.pages,A,I),pageParams:C(S.pageParams,b,I)}};if(s&&i.length){const S=s==="backward",b=S?sP:dx,w={pages:i,pageParams:a},_=b(r,w);o=await y(w,_,S)}else{const S=n??i.length;do{const b=l===0?a[0]??r.initialPageParam:dx(r,o);if(l>0&&b==null)break;o=await y(o,b),l++}while(l<S)}return o};e.options.persister?e.fetchFn=()=>{var g,v;return(v=(g=e.options).persister)==null?void 0:v.call(g,c,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=c}}}function dx(n,{pages:e,pageParams:t}){const r=e.length-1;return e.length>0?n.getNextPageParam(e[r],e,t[r],t):void 0}function sP(n,{pages:e,pageParams:t}){var r;return e.length>0?(r=n.getPreviousPageParam)==null?void 0:r.call(n,e[0],e,t[0],t):void 0}var xt,Ws,Ys,po,go,qs,yo,vo,jE,iP=(jE=class{constructor(n={}){ye(this,xt);ye(this,Ws);ye(this,Ys);ye(this,po);ye(this,go);ye(this,qs);ye(this,yo);ye(this,vo);ie(this,xt,n.queryCache||new tP),ie(this,Ws,n.mutationCache||new rP),ie(this,Ys,n.defaultOptions||{}),ie(this,po,new Map),ie(this,go,new Map),ie(this,qs,0)}mount(){Kc(this,qs)._++,k(this,qs)===1&&(ie(this,yo,v0.subscribe(async n=>{n&&(await this.resumePausedMutations(),k(this,xt).onFocus())})),ie(this,vo,kd.subscribe(async n=>{n&&(await this.resumePausedMutations(),k(this,xt).onOnline())})))}unmount(){var n,e;Kc(this,qs)._--,k(this,qs)===0&&((n=k(this,yo))==null||n.call(this),ie(this,yo,void 0),(e=k(this,vo))==null||e.call(this),ie(this,vo,void 0))}isFetching(n){return k(this,xt).findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return k(this,Ws).findAll({...n,status:"pending"}).length}getQueryData(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=k(this,xt).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(n){const e=this.getQueryData(n.queryKey);if(e===void 0)return this.fetchQuery(n);{const t=this.defaultQueryOptions(n),r=k(this,xt).build(this,t);return n.revalidateIfStale&&r.isStaleByTime(eo(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(e)}}getQueriesData(n){return k(this,xt).findAll(n).map(({queryKey:e,state:t})=>{const r=t.data;return[e,r]})}setQueryData(n,e,t){const r=this.defaultQueryOptions({queryKey:n}),s=k(this,xt).get(r.queryHash),i=s==null?void 0:s.state.data,a=HD(e,i);if(a!==void 0)return k(this,xt).build(this,r).setData(a,{...t,manual:!0})}setQueriesData(n,e,t){return Dt.batch(()=>k(this,xt).findAll(n).map(({queryKey:r})=>[r,this.setQueryData(r,e,t)]))}getQueryState(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=k(this,xt).get(e.queryHash))==null?void 0:t.state}removeQueries(n){const e=k(this,xt);Dt.batch(()=>{e.findAll(n).forEach(t=>{e.remove(t)})})}resetQueries(n,e){const t=k(this,xt),r={type:"active",...n};return Dt.batch(()=>(t.findAll(n).forEach(s=>{s.reset()}),this.refetchQueries(r,e)))}cancelQueries(n={},e={}){const t={revert:!0,...e},r=Dt.batch(()=>k(this,xt).findAll(n).map(s=>s.cancel(t)));return Promise.all(r).then(zn).catch(zn)}invalidateQueries(n={},e={}){return Dt.batch(()=>{if(k(this,xt).findAll(n).forEach(r=>{r.invalidate()}),n.refetchType==="none")return Promise.resolve();const t={...n,type:n.refetchType??n.type??"active"};return this.refetchQueries(t,e)})}refetchQueries(n={},e){const t={...e,cancelRefetch:(e==null?void 0:e.cancelRefetch)??!0},r=Dt.batch(()=>k(this,xt).findAll(n).filter(s=>!s.isDisabled()).map(s=>{let i=s.fetch(void 0,t);return t.throwOnError||(i=i.catch(zn)),s.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(r).then(zn)}fetchQuery(n){const e=this.defaultQueryOptions(n);e.retry===void 0&&(e.retry=!1);const t=k(this,xt).build(this,e);return t.isStaleByTime(eo(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(zn).catch(zn)}fetchInfiniteQuery(n){return n.behavior=ux(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(zn).catch(zn)}ensureInfiniteQueryData(n){return n.behavior=ux(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return kd.isOnline()?k(this,Ws).resumePausedMutations():Promise.resolve()}getQueryCache(){return k(this,xt)}getMutationCache(){return k(this,Ws)}getDefaultOptions(){return k(this,Ys)}setDefaultOptions(n){ie(this,Ys,n)}setQueryDefaults(n,e){k(this,po).set(aa(n),{queryKey:n,defaultOptions:e})}getQueryDefaults(n){const e=[...k(this,po).values()];let t={};return e.forEach(r=>{tc(n,r.queryKey)&&(t={...t,...r.defaultOptions})}),t}setMutationDefaults(n,e){k(this,go).set(aa(n),{mutationKey:n,defaultOptions:e})}getMutationDefaults(n){const e=[...k(this,go).values()];let t={};return e.forEach(r=>{tc(n,r.mutationKey)&&(t={...t,...r.defaultOptions})}),t}defaultQueryOptions(n){if(n._defaulted)return n;const e={...k(this,Ys).queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return e.queryHash||(e.queryHash=g0(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.enabled!==!0&&e.queryFn===y0&&(e.enabled=!1),e}defaultMutationOptions(n){return n!=null&&n._defaulted?n:{...k(this,Ys).mutations,...(n==null?void 0:n.mutationKey)&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){k(this,xt).clear(),k(this,Ws).clear()}},xt=new WeakMap,Ws=new WeakMap,Ys=new WeakMap,po=new WeakMap,go=new WeakMap,qs=new WeakMap,yo=new WeakMap,vo=new WeakMap,jE),vn,Ue,Cc,nn,zi,xo,Qs,$r,Lc,So,Eo,Wi,Yi,Xs,To,ze,gl,Sp,Ep,Tp,bp,wp,Ap,_p,Tw,$E,aP=($E=class extends Vo{constructor(e,t){super();ye(this,ze);ye(this,vn);ye(this,Ue);ye(this,Cc);ye(this,nn);ye(this,zi);ye(this,xo);ye(this,Qs);ye(this,$r);ye(this,Lc);ye(this,So);ye(this,Eo);ye(this,Wi);ye(this,Yi);ye(this,Xs);ye(this,To,new Set);this.options=t,ie(this,vn,e),ie(this,$r,null),ie(this,Qs,xp()),this.options.experimental_prefetchInRender||k(this,Qs).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(k(this,Ue).addObserver(this),fx(k(this,Ue),this.options)?Pe(this,ze,gl).call(this):this.updateResult(),Pe(this,ze,bp).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Ip(k(this,Ue),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Ip(k(this,Ue),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Pe(this,ze,wp).call(this),Pe(this,ze,Ap).call(this),k(this,Ue).removeObserver(this)}setOptions(e,t){const r=this.options,s=k(this,Ue);if(this.options=k(this,vn).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof hr(this.options.enabled,k(this,Ue))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Pe(this,ze,_p).call(this),k(this,Ue).setOptions(this.options),r._defaulted&&!Ld(this.options,r)&&k(this,vn).getQueryCache().notify({type:"observerOptionsUpdated",query:k(this,Ue),observer:this});const i=this.hasListeners();i&&hx(k(this,Ue),s,this.options,r)&&Pe(this,ze,gl).call(this),this.updateResult(t),i&&(k(this,Ue)!==s||hr(this.options.enabled,k(this,Ue))!==hr(r.enabled,k(this,Ue))||eo(this.options.staleTime,k(this,Ue))!==eo(r.staleTime,k(this,Ue)))&&Pe(this,ze,Sp).call(this);const a=Pe(this,ze,Ep).call(this);i&&(k(this,Ue)!==s||hr(this.options.enabled,k(this,Ue))!==hr(r.enabled,k(this,Ue))||a!==k(this,Xs))&&Pe(this,ze,Tp).call(this,a)}getOptimisticResult(e){const t=k(this,vn).getQueryCache().build(k(this,vn),e),r=this.createResult(t,e);return lP(this,r)&&(ie(this,nn,r),ie(this,xo,this.options),ie(this,zi,k(this,Ue).state)),r}getCurrentResult(){return k(this,nn)}trackResult(e,t){const r={};return Object.keys(e).forEach(s=>{Object.defineProperty(r,s,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(s),t==null||t(s),e[s])})}),r}trackProp(e){k(this,To).add(e)}getCurrentQuery(){return k(this,Ue)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=k(this,vn).defaultQueryOptions(e),r=k(this,vn).getQueryCache().build(k(this,vn),t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return Pe(this,ze,gl).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),k(this,nn)))}createResult(e,t){var I;const r=k(this,Ue),s=this.options,i=k(this,nn),a=k(this,zi),o=k(this,xo),c=e!==r?e.state:k(this,Cc),{state:u}=e;let d={...u},f=!1,m;if(t._optimisticResults){const C=this.hasListeners(),R=!C&&fx(e,t),P=C&&hx(e,r,t,s);(R||P)&&(d={...d,...Sw(u.data,e.options)}),t._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:p,errorUpdatedAt:g,status:v}=d;if(t.select&&d.data!==void 0)if(i&&d.data===(a==null?void 0:a.data)&&t.select===k(this,Lc))m=k(this,So);else try{ie(this,Lc,t.select),m=t.select(d.data),m=vp(i==null?void 0:i.data,m,t),ie(this,So,m),ie(this,$r,null)}catch(C){ie(this,$r,C)}else m=d.data;if(t.placeholderData!==void 0&&m===void 0&&v==="pending"){let C;if(i!=null&&i.isPlaceholderData&&t.placeholderData===(o==null?void 0:o.placeholderData))C=i.data;else if(C=typeof t.placeholderData=="function"?t.placeholderData((I=k(this,Eo))==null?void 0:I.state.data,k(this,Eo)):t.placeholderData,t.select&&C!==void 0)try{C=t.select(C),ie(this,$r,null)}catch(R){ie(this,$r,R)}C!==void 0&&(v="success",m=vp(i==null?void 0:i.data,C,t),f=!0)}k(this,$r)&&(p=k(this,$r),m=k(this,So),g=Date.now(),v="error");const x=d.fetchStatus==="fetching",y=v==="pending",S=v==="error",b=y&&x,w=m!==void 0,A={status:v,fetchStatus:d.fetchStatus,isPending:y,isSuccess:v==="success",isError:S,isInitialLoading:b,isLoading:b,data:m,dataUpdatedAt:d.dataUpdatedAt,error:p,errorUpdatedAt:g,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>c.dataUpdateCount||d.errorUpdateCount>c.errorUpdateCount,isFetching:x,isRefetching:x&&!y,isLoadingError:S&&!w,isPaused:d.fetchStatus==="paused",isPlaceholderData:f,isRefetchError:S&&w,isStale:x0(e,t),refetch:this.refetch,promise:k(this,Qs)};if(this.options.experimental_prefetchInRender){const C=O=>{A.status==="error"?O.reject(A.error):A.data!==void 0&&O.resolve(A.data)},R=()=>{const O=ie(this,Qs,A.promise=xp());C(O)},P=k(this,Qs);switch(P.status){case"pending":e.queryHash===r.queryHash&&C(P);break;case"fulfilled":(A.status==="error"||A.data!==P.value)&&R();break;case"rejected":(A.status!=="error"||A.error!==P.reason)&&R();break}}return A}updateResult(e){const t=k(this,nn),r=this.createResult(k(this,Ue),this.options);if(ie(this,zi,k(this,Ue).state),ie(this,xo,this.options),k(this,zi).data!==void 0&&ie(this,Eo,k(this,Ue)),Ld(r,t))return;ie(this,nn,r);const s={},i=()=>{if(!t)return!0;const{notifyOnChangeProps:a}=this.options,o=typeof a=="function"?a():a;if(o==="all"||!o&&!k(this,To).size)return!0;const l=new Set(o??k(this,To));return this.options.throwOnError&&l.add("error"),Object.keys(k(this,nn)).some(c=>{const u=c;return k(this,nn)[u]!==t[u]&&l.has(u)})};(e==null?void 0:e.listeners)!==!1&&i()&&(s.listeners=!0),Pe(this,ze,Tw).call(this,{...s,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Pe(this,ze,bp).call(this)}},vn=new WeakMap,Ue=new WeakMap,Cc=new WeakMap,nn=new WeakMap,zi=new WeakMap,xo=new WeakMap,Qs=new WeakMap,$r=new WeakMap,Lc=new WeakMap,So=new WeakMap,Eo=new WeakMap,Wi=new WeakMap,Yi=new WeakMap,Xs=new WeakMap,To=new WeakMap,ze=new WeakSet,gl=function(e){Pe(this,ze,_p).call(this);let t=k(this,Ue).fetch(this.options,e);return e!=null&&e.throwOnError||(t=t.catch(zn)),t},Sp=function(){Pe(this,ze,wp).call(this);const e=eo(this.options.staleTime,k(this,Ue));if(ia||k(this,nn).isStale||!gp(e))return;const r=hw(k(this,nn).dataUpdatedAt,e)+1;ie(this,Wi,setTimeout(()=>{k(this,nn).isStale||this.updateResult()},r))},Ep=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(k(this,Ue)):this.options.refetchInterval)??!1},Tp=function(e){Pe(this,ze,Ap).call(this),ie(this,Xs,e),!(ia||hr(this.options.enabled,k(this,Ue))===!1||!gp(k(this,Xs))||k(this,Xs)===0)&&ie(this,Yi,setInterval(()=>{(this.options.refetchIntervalInBackground||v0.isFocused())&&Pe(this,ze,gl).call(this)},k(this,Xs)))},bp=function(){Pe(this,ze,Sp).call(this),Pe(this,ze,Tp).call(this,Pe(this,ze,Ep).call(this))},wp=function(){k(this,Wi)&&(clearTimeout(k(this,Wi)),ie(this,Wi,void 0))},Ap=function(){k(this,Yi)&&(clearInterval(k(this,Yi)),ie(this,Yi,void 0))},_p=function(){const e=k(this,vn).getQueryCache().build(k(this,vn),this.options);if(e===k(this,Ue))return;const t=k(this,Ue);ie(this,Ue,e),ie(this,Cc,e.state),this.hasListeners()&&(t==null||t.removeObserver(this),e.addObserver(this))},Tw=function(e){Dt.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(k(this,nn))}),k(this,vn).getQueryCache().notify({query:k(this,Ue),type:"observerResultsUpdated"})})},$E);function oP(n,e){return hr(e.enabled,n)!==!1&&n.state.data===void 0&&!(n.state.status==="error"&&e.retryOnMount===!1)}function fx(n,e){return oP(n,e)||n.state.data!==void 0&&Ip(n,e,e.refetchOnMount)}function Ip(n,e,t){if(hr(e.enabled,n)!==!1){const r=typeof t=="function"?t(n):t;return r==="always"||r!==!1&&x0(n,e)}return!1}function hx(n,e,t,r){return(n!==e||hr(r.enabled,n)===!1)&&(!t.suspense||n.state.status!=="error")&&x0(n,t)}function x0(n,e){return hr(e.enabled,n)!==!1&&n.isStaleByTime(eo(e.staleTime,n))}function lP(n,e){return!Ld(n.getCurrentResult(),e)}var Zs,Js,xn,gs,Es,Hu,Rp,UE,cP=(UE=class extends Vo{constructor(t,r){super();ye(this,Es);ye(this,Zs);ye(this,Js);ye(this,xn);ye(this,gs);ie(this,Zs,t),this.setOptions(r),this.bindMethods(),Pe(this,Es,Hu).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const r=this.options;this.options=k(this,Zs).defaultMutationOptions(t),Ld(this.options,r)||k(this,Zs).getMutationCache().notify({type:"observerOptionsUpdated",mutation:k(this,xn),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&aa(r.mutationKey)!==aa(this.options.mutationKey)?this.reset():((s=k(this,xn))==null?void 0:s.state.status)==="pending"&&k(this,xn).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=k(this,xn))==null||t.removeObserver(this)}onMutationUpdate(t){Pe(this,Es,Hu).call(this),Pe(this,Es,Rp).call(this,t)}getCurrentResult(){return k(this,Js)}reset(){var t;(t=k(this,xn))==null||t.removeObserver(this),ie(this,xn,void 0),Pe(this,Es,Hu).call(this),Pe(this,Es,Rp).call(this)}mutate(t,r){var s;return ie(this,gs,r),(s=k(this,xn))==null||s.removeObserver(this),ie(this,xn,k(this,Zs).getMutationCache().build(k(this,Zs),this.options)),k(this,xn).addObserver(this),k(this,xn).execute(t)}},Zs=new WeakMap,Js=new WeakMap,xn=new WeakMap,gs=new WeakMap,Es=new WeakSet,Hu=function(){var r;const t=((r=k(this,xn))==null?void 0:r.state)??Ew();ie(this,Js,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},Rp=function(t){Dt.batch(()=>{var r,s,i,a,o,l,c,u;if(k(this,gs)&&this.hasListeners()){const d=k(this,Js).variables,f=k(this,Js).context;(t==null?void 0:t.type)==="success"?((s=(r=k(this,gs)).onSuccess)==null||s.call(r,t.data,d,f),(a=(i=k(this,gs)).onSettled)==null||a.call(i,t.data,null,d,f)):(t==null?void 0:t.type)==="error"&&((l=(o=k(this,gs)).onError)==null||l.call(o,t.error,d,f),(u=(c=k(this,gs)).onSettled)==null||u.call(c,void 0,t.error,d,f))}this.listeners.forEach(d=>{d(k(this,Js))})})},UE),bw=E.createContext(void 0),_r=n=>{const e=E.useContext(bw);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},uP=({client:n,children:e})=>(E.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),h.jsx(bw.Provider,{value:n,children:e})),ww=E.createContext(!1),dP=()=>E.useContext(ww);ww.Provider;function fP(){let n=!1;return{clearReset:()=>{n=!1},reset:()=>{n=!0},isReset:()=>n}}var hP=E.createContext(fP()),mP=()=>E.useContext(hP);function Aw(n,e){return typeof n=="function"?n(...e):!!n}function Cp(){}var pP=(n,e)=>{(n.suspense||n.throwOnError||n.experimental_prefetchInRender)&&(e.isReset()||(n.retryOnMount=!1))},gP=n=>{E.useEffect(()=>{n.clearReset()},[n])},yP=({result:n,errorResetBoundary:e,throwOnError:t,query:r})=>n.isError&&!e.isReset()&&!n.isFetching&&r&&Aw(t,[n.error,r]),vP=n=>{n.suspense&&(n.staleTime===void 0&&(n.staleTime=1e3),typeof n.gcTime=="number"&&(n.gcTime=Math.max(n.gcTime,1e3)))},xP=(n,e)=>n.isLoading&&n.isFetching&&!e,SP=(n,e)=>(n==null?void 0:n.suspense)&&e.isPending,mx=(n,e,t)=>e.fetchOptimistic(n).catch(()=>{t.clearReset()});function EP(n,e,t){var u,d,f,m,p;const r=_r(),s=dP(),i=mP(),a=r.defaultQueryOptions(n);(d=(u=r.getDefaultOptions().queries)==null?void 0:u._experimental_beforeQuery)==null||d.call(u,a),a._optimisticResults=s?"isRestoring":"optimistic",vP(a),pP(a,i),gP(i);const o=!r.getQueryCache().get(a.queryHash),[l]=E.useState(()=>new e(r,a)),c=l.getOptimisticResult(a);if(E.useSyncExternalStore(E.useCallback(g=>{const v=s?Cp:l.subscribe(Dt.batchCalls(g));return l.updateResult(),v},[l,s]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),E.useEffect(()=>{l.setOptions(a,{listeners:!1})},[a,l]),SP(a,c))throw mx(a,l,i);if(yP({result:c,errorResetBoundary:i,throwOnError:a.throwOnError,query:r.getQueryCache().get(a.queryHash)}))throw c.error;if((m=(f=r.getDefaultOptions().queries)==null?void 0:f._experimental_afterQuery)==null||m.call(f,a,c),a.experimental_prefetchInRender&&!ia&&xP(c,s)){const g=o?mx(a,l,i):(p=r.getQueryCache().get(a.queryHash))==null?void 0:p.promise;g==null||g.catch(Cp).finally(()=>{l.updateResult()})}return a.notifyOnChangeProps?c:l.trackResult(c)}function Je(n,e){return EP(n,aP)}function Tr(n,e){const t=_r(),[r]=E.useState(()=>new cP(t,n));E.useEffect(()=>{r.setOptions(n)},[r,n]);const s=E.useSyncExternalStore(E.useCallback(a=>r.subscribe(Dt.batchCalls(a)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),i=E.useCallback((a,o)=>{r.mutate(a,o).catch(Cp)},[r]);if(s.error&&Aw(r.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:i,mutateAsync:s.mutate}}async function _w(n){if(!n.ok){let e=n.statusText;try{const t=await n.text();if(t)try{const r=JSON.parse(t);r!=null&&r.error?e=r.error:e=t}catch{e=t}}catch{}throw new Error(`${n.status}: ${e}`)}}async function Qr(n,e,t){const r=await fetch(e,{method:n,headers:t?{"Content-Type":"application/json"}:{},body:t?JSON.stringify(t):void 0,credentials:"include"});return await _w(r),r}const TP=({on401:n})=>async({queryKey:e})=>{const t=await fetch(e.join("/"),{credentials:"include"});return n==="returnNull"&&t.status===401?null:(await _w(t),await t.json())},bP=new iP({defaultOptions:{queries:{queryFn:TP({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1},mutations:{retry:!1}}}),wP=1,AP=1e6;let Fh=0;function _P(){return Fh=(Fh+1)%Number.MAX_SAFE_INTEGER,Fh.toString()}const jh=new Map,px=n=>{if(jh.has(n))return;const e=setTimeout(()=>{jh.delete(n),kl({type:"REMOVE_TOAST",toastId:n})},AP);jh.set(n,e)},IP=(n,e)=>{switch(e.type){case"ADD_TOAST":return{...n,toasts:[e.toast,...n.toasts].slice(0,wP)};case"UPDATE_TOAST":return{...n,toasts:n.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=e;return t?px(t):n.toasts.forEach(r=>{px(r.id)}),{...n,toasts:n.toasts.map(r=>r.id===t||t===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return e.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(t=>t.id!==e.toastId)}}},zu=[];let Wu={toasts:[]};function kl(n){Wu=IP(Wu,n),zu.forEach(e=>{e(Wu)})}function RP({...n}){const e=_P(),t=s=>kl({type:"UPDATE_TOAST",toast:{...s,id:e}}),r=()=>kl({type:"DISMISS_TOAST",toastId:e});return kl({type:"ADD_TOAST",toast:{...n,id:e,open:!0,onOpenChange:s=>{s||r()}}}),{id:e,dismiss:r,update:t}}function ns(){const[n,e]=E.useState(Wu);return E.useEffect(()=>(zu.push(e),()=>{const t=zu.indexOf(e);t>-1&&zu.splice(t,1)}),[n]),{...n,toast:RP,dismiss:t=>kl({type:"DISMISS_TOAST",toastId:t})}}function ne(n,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(n==null||n(s),t===!1||!s.defaultPrevented)return e==null?void 0:e(s)}}function gx(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function If(...n){return e=>{let t=!1;const r=n.map(s=>{const i=gx(s,e);return!t&&typeof i=="function"&&(t=!0),i});if(t)return()=>{for(let s=0;s<r.length;s++){const i=r[s];typeof i=="function"?i():gx(n[s],null)}}}}function He(...n){return E.useCallback(If(...n),n)}function CP(n,e){const t=E.createContext(e),r=i=>{const{children:a,...o}=i,l=E.useMemo(()=>o,Object.values(o));return h.jsx(t.Provider,{value:l,children:a})};r.displayName=n+"Provider";function s(i){const a=E.useContext(t);if(a)return a;if(e!==void 0)return e;throw new Error(`\`${i}\` must be used within \`${n}\``)}return[r,s]}function Ir(n,e=[]){let t=[];function r(i,a){const o=E.createContext(a),l=t.length;t=[...t,a];const c=d=>{var x;const{scope:f,children:m,...p}=d,g=((x=f==null?void 0:f[n])==null?void 0:x[l])||o,v=E.useMemo(()=>p,Object.values(p));return h.jsx(g.Provider,{value:v,children:m})};c.displayName=i+"Provider";function u(d,f){var g;const m=((g=f==null?void 0:f[n])==null?void 0:g[l])||o,p=E.useContext(m);if(p)return p;if(a!==void 0)return a;throw new Error(`\`${d}\` must be used within \`${i}\``)}return[c,u]}const s=()=>{const i=t.map(a=>E.createContext(a));return function(o){const l=(o==null?void 0:o[n])||i;return E.useMemo(()=>({[`__scope${n}`]:{...o,[n]:l}}),[o,l])}};return s.scopeName=n,[r,LP(s,...e)]}function LP(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(i){const a=r.reduce((o,{useScope:l,scopeName:c})=>{const d=l(i)[`__scope${c}`];return{...o,...d}},{});return E.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return t.scopeName=e.scopeName,t}function oa(n){const e=kP(n),t=E.forwardRef((r,s)=>{const{children:i,...a}=r,o=E.Children.toArray(i),l=o.find(PP);if(l){const c=l.props.children,u=o.map(d=>d===l?E.Children.count(c)>1?E.Children.only(null):E.isValidElement(c)?c.props.children:null:d);return h.jsx(e,{...a,ref:s,children:E.isValidElement(c)?E.cloneElement(c,void 0,u):null})}return h.jsx(e,{...a,ref:s,children:i})});return t.displayName=`${n}.Slot`,t}var S0=oa("Slot");function kP(n){const e=E.forwardRef((t,r)=>{const{children:s,...i}=t;if(E.isValidElement(s)){const a=OP(s),o=NP(i,s.props);return s.type!==E.Fragment&&(o.ref=r?If(r,a):a),E.cloneElement(s,o)}return E.Children.count(s)>1?E.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var Iw=Symbol("radix.slottable");function DP(n){const e=({children:t})=>h.jsx(h.Fragment,{children:t});return e.displayName=`${n}.Slottable`,e.__radixId=Iw,e}function PP(n){return E.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===Iw}function NP(n,e){const t={...e};for(const r in e){const s=n[r],i=e[r];/^on[A-Z]/.test(r)?s&&i?t[r]=(...o)=>{i(...o),s(...o)}:s&&(t[r]=s):r==="style"?t[r]={...s,...i}:r==="className"&&(t[r]=[s,i].filter(Boolean).join(" "))}return{...n,...t}}function OP(n){var r,s;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(s=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}function Rf(n){const e=n+"CollectionProvider",[t,r]=Ir(e),[s,i]=t(e,{collectionRef:{current:null},itemMap:new Map}),a=g=>{const{scope:v,children:x}=g,y=Ct.useRef(null),S=Ct.useRef(new Map).current;return h.jsx(s,{scope:v,itemMap:S,collectionRef:y,children:x})};a.displayName=e;const o=n+"CollectionSlot",l=oa(o),c=Ct.forwardRef((g,v)=>{const{scope:x,children:y}=g,S=i(o,x),b=He(v,S.collectionRef);return h.jsx(l,{ref:b,children:y})});c.displayName=o;const u=n+"CollectionItemSlot",d="data-radix-collection-item",f=oa(u),m=Ct.forwardRef((g,v)=>{const{scope:x,children:y,...S}=g,b=Ct.useRef(null),w=He(v,b),_=i(u,x);return Ct.useEffect(()=>(_.itemMap.set(b,{ref:b,...S}),()=>void _.itemMap.delete(b))),h.jsx(f,{[d]:"",ref:w,children:y})});m.displayName=u;function p(g){const v=i(n+"CollectionConsumer",g);return Ct.useCallback(()=>{const y=v.collectionRef.current;if(!y)return[];const S=Array.from(y.querySelectorAll(`[${d}]`));return Array.from(v.itemMap.values()).sort((_,A)=>S.indexOf(_.ref.current)-S.indexOf(A.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:a,Slot:c,ItemSlot:m},p,r]}var MP=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],xe=MP.reduce((n,e)=>{const t=oa(`Primitive.${e}`),r=E.forwardRef((s,i)=>{const{asChild:a,...o}=s,l=a?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(l,{...o,ref:i})});return r.displayName=`Primitive.${e}`,{...n,[e]:r}},{});function E0(n,e){n&&ya.flushSync(()=>n.dispatchEvent(e))}function Ht(n){const e=E.useRef(n);return E.useEffect(()=>{e.current=n}),E.useMemo(()=>(...t)=>{var r;return(r=e.current)==null?void 0:r.call(e,...t)},[])}function FP(n,e=globalThis==null?void 0:globalThis.document){const t=Ht(n);E.useEffect(()=>{const r=s=>{s.key==="Escape"&&t(s)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var jP="DismissableLayer",Lp="dismissableLayer.update",$P="dismissableLayer.pointerDownOutside",UP="dismissableLayer.focusOutside",yx,Rw=E.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Go=E.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:s,onFocusOutside:i,onInteractOutside:a,onDismiss:o,...l}=n,c=E.useContext(Rw),[u,d]=E.useState(null),f=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,m]=E.useState({}),p=He(e,A=>d(A)),g=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),x=g.indexOf(v),y=u?g.indexOf(u):-1,S=c.layersWithOutsidePointerEventsDisabled.size>0,b=y>=x,w=VP(A=>{const I=A.target,C=[...c.branches].some(R=>R.contains(I));!b||C||(s==null||s(A),a==null||a(A),A.defaultPrevented||o==null||o())},f),_=GP(A=>{const I=A.target;[...c.branches].some(R=>R.contains(I))||(i==null||i(A),a==null||a(A),A.defaultPrevented||o==null||o())},f);return FP(A=>{y===c.layers.size-1&&(r==null||r(A),!A.defaultPrevented&&o&&(A.preventDefault(),o()))},f),E.useEffect(()=>{if(u)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(yx=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),vx(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=yx)}},[u,f,t,c]),E.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),vx())},[u,c]),E.useEffect(()=>{const A=()=>m({});return document.addEventListener(Lp,A),()=>document.removeEventListener(Lp,A)},[]),h.jsx(xe.div,{...l,ref:p,style:{pointerEvents:S?b?"auto":"none":void 0,...n.style},onFocusCapture:ne(n.onFocusCapture,_.onFocusCapture),onBlurCapture:ne(n.onBlurCapture,_.onBlurCapture),onPointerDownCapture:ne(n.onPointerDownCapture,w.onPointerDownCapture)})});Go.displayName=jP;var BP="DismissableLayerBranch",Cw=E.forwardRef((n,e)=>{const t=E.useContext(Rw),r=E.useRef(null),s=He(e,r);return E.useEffect(()=>{const i=r.current;if(i)return t.branches.add(i),()=>{t.branches.delete(i)}},[t.branches]),h.jsx(xe.div,{...n,ref:s})});Cw.displayName=BP;function VP(n,e=globalThis==null?void 0:globalThis.document){const t=Ht(n),r=E.useRef(!1),s=E.useRef(()=>{});return E.useEffect(()=>{const i=o=>{if(o.target&&!r.current){let l=function(){Lw($P,t,c,{discrete:!0})};const c={originalEvent:o};o.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=l,e.addEventListener("click",s.current,{once:!0})):l()}else e.removeEventListener("click",s.current);r.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",i),e.removeEventListener("click",s.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function GP(n,e=globalThis==null?void 0:globalThis.document){const t=Ht(n),r=E.useRef(!1);return E.useEffect(()=>{const s=i=>{i.target&&!r.current&&Lw(UP,t,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function vx(){const n=new CustomEvent(Lp);document.dispatchEvent(n)}function Lw(n,e,t,{discrete:r}){const s=t.originalEvent.target,i=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&s.addEventListener(n,e,{once:!0}),r?E0(s,i):s.dispatchEvent(i)}var KP=Go,HP=Cw,Nt=globalThis!=null&&globalThis.document?E.useLayoutEffect:()=>{},zP="Portal",Mc=E.forwardRef((n,e)=>{var o;const{container:t,...r}=n,[s,i]=E.useState(!1);Nt(()=>i(!0),[]);const a=t||s&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return a?hD.createPortal(h.jsx(xe.div,{...r,ref:e}),a):null});Mc.displayName=zP;function WP(n,e){return E.useReducer((t,r)=>e[t][r]??t,n)}var Rr=n=>{const{present:e,children:t}=n,r=YP(e),s=typeof t=="function"?t({present:r.isPresent}):E.Children.only(t),i=He(r.ref,qP(s));return typeof t=="function"||r.isPresent?E.cloneElement(s,{ref:i}):null};Rr.displayName="Presence";function YP(n){const[e,t]=E.useState(),r=E.useRef({}),s=E.useRef(n),i=E.useRef("none"),a=n?"mounted":"unmounted",[o,l]=WP(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return E.useEffect(()=>{const c=cu(r.current);i.current=o==="mounted"?c:"none"},[o]),Nt(()=>{const c=r.current,u=s.current;if(u!==n){const f=i.current,m=cu(c);n?l("MOUNT"):m==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&f!==m?"ANIMATION_OUT":"UNMOUNT"),s.current=n}},[n,l]),Nt(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=m=>{const g=cu(r.current).includes(m.animationName);if(m.target===e&&g&&(l("ANIMATION_END"),!s.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},f=m=>{m.target===e&&(i.current=cu(r.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:E.useCallback(c=>{c&&(r.current=getComputedStyle(c)),t(c)},[])}}function cu(n){return(n==null?void 0:n.animationName)||"none"}function qP(n){var r,s;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(s=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}function hi({prop:n,defaultProp:e,onChange:t=()=>{}}){const[r,s]=QP({defaultProp:e,onChange:t}),i=n!==void 0,a=i?n:r,o=Ht(t),l=E.useCallback(c=>{if(i){const d=typeof c=="function"?c(n):c;d!==n&&o(d)}else s(c)},[i,n,s,o]);return[a,l]}function QP({defaultProp:n,onChange:e}){const t=E.useState(n),[r]=t,s=E.useRef(r),i=Ht(e);return E.useEffect(()=>{s.current!==r&&(i(r),s.current=r)},[r,s,i]),t}var XP="VisuallyHidden",Fc=E.forwardRef((n,e)=>h.jsx(xe.span,{...n,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}));Fc.displayName=XP;var ZP=Fc,T0="ToastProvider",[b0,JP,eN]=Rf("Toast"),[kw,cK]=Ir("Toast",[eN]),[tN,Cf]=kw(T0),Dw=n=>{const{__scopeToast:e,label:t="Notification",duration:r=5e3,swipeDirection:s="right",swipeThreshold:i=50,children:a}=n,[o,l]=E.useState(null),[c,u]=E.useState(0),d=E.useRef(!1),f=E.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${T0}\`. Expected non-empty \`string\`.`),h.jsx(b0.Provider,{scope:e,children:h.jsx(tN,{scope:e,label:t,duration:r,swipeDirection:s,swipeThreshold:i,toastCount:c,viewport:o,onViewportChange:l,onToastAdd:E.useCallback(()=>u(m=>m+1),[]),onToastRemove:E.useCallback(()=>u(m=>m-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:f,children:a})})};Dw.displayName=T0;var Pw="ToastViewport",nN=["F8"],kp="toast.viewportPause",Dp="toast.viewportResume",Nw=E.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:r=nN,label:s="Notifications ({hotkey})",...i}=n,a=Cf(Pw,t),o=JP(t),l=E.useRef(null),c=E.useRef(null),u=E.useRef(null),d=E.useRef(null),f=He(e,d,a.onViewportChange),m=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),p=a.toastCount>0;E.useEffect(()=>{const v=x=>{var S;r.length!==0&&r.every(b=>x[b]||x.code===b)&&((S=d.current)==null||S.focus())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[r]),E.useEffect(()=>{const v=l.current,x=d.current;if(p&&v&&x){const y=()=>{if(!a.isClosePausedRef.current){const _=new CustomEvent(kp);x.dispatchEvent(_),a.isClosePausedRef.current=!0}},S=()=>{if(a.isClosePausedRef.current){const _=new CustomEvent(Dp);x.dispatchEvent(_),a.isClosePausedRef.current=!1}},b=_=>{!v.contains(_.relatedTarget)&&S()},w=()=>{v.contains(document.activeElement)||S()};return v.addEventListener("focusin",y),v.addEventListener("focusout",b),v.addEventListener("pointermove",y),v.addEventListener("pointerleave",w),window.addEventListener("blur",y),window.addEventListener("focus",S),()=>{v.removeEventListener("focusin",y),v.removeEventListener("focusout",b),v.removeEventListener("pointermove",y),v.removeEventListener("pointerleave",w),window.removeEventListener("blur",y),window.removeEventListener("focus",S)}}},[p,a.isClosePausedRef]);const g=E.useCallback(({tabbingDirection:v})=>{const y=o().map(S=>{const b=S.ref.current,w=[b,...pN(b)];return v==="forwards"?w:w.reverse()});return(v==="forwards"?y.reverse():y).flat()},[o]);return E.useEffect(()=>{const v=d.current;if(v){const x=y=>{var w,_,A;const S=y.altKey||y.ctrlKey||y.metaKey;if(y.key==="Tab"&&!S){const I=document.activeElement,C=y.shiftKey;if(y.target===v&&C){(w=c.current)==null||w.focus();return}const O=g({tabbingDirection:C?"backwards":"forwards"}),U=O.findIndex(j=>j===I);$h(O.slice(U+1))?y.preventDefault():C?(_=c.current)==null||_.focus():(A=u.current)==null||A.focus()}};return v.addEventListener("keydown",x),()=>v.removeEventListener("keydown",x)}},[o,g]),h.jsxs(HP,{ref:l,role:"region","aria-label":s.replace("{hotkey}",m),tabIndex:-1,style:{pointerEvents:p?void 0:"none"},children:[p&&h.jsx(Pp,{ref:c,onFocusFromOutsideViewport:()=>{const v=g({tabbingDirection:"forwards"});$h(v)}}),h.jsx(b0.Slot,{scope:t,children:h.jsx(xe.ol,{tabIndex:-1,...i,ref:f})}),p&&h.jsx(Pp,{ref:u,onFocusFromOutsideViewport:()=>{const v=g({tabbingDirection:"backwards"});$h(v)}})]})});Nw.displayName=Pw;var Ow="ToastFocusProxy",Pp=E.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:r,...s}=n,i=Cf(Ow,t);return h.jsx(Fc,{"aria-hidden":!0,tabIndex:0,...s,ref:e,style:{position:"fixed"},onFocus:a=>{var c;const o=a.relatedTarget;!((c=i.viewport)!=null&&c.contains(o))&&r()}})});Pp.displayName=Ow;var Lf="Toast",rN="toast.swipeStart",sN="toast.swipeMove",iN="toast.swipeCancel",aN="toast.swipeEnd",Mw=E.forwardRef((n,e)=>{const{forceMount:t,open:r,defaultOpen:s,onOpenChange:i,...a}=n,[o=!0,l]=hi({prop:r,defaultProp:s,onChange:i});return h.jsx(Rr,{present:t||o,children:h.jsx(cN,{open:o,...a,ref:e,onClose:()=>l(!1),onPause:Ht(n.onPause),onResume:Ht(n.onResume),onSwipeStart:ne(n.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:ne(n.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:ne(n.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:ne(n.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})})});Mw.displayName=Lf;var[oN,lN]=kw(Lf,{onClose(){}}),cN=E.forwardRef((n,e)=>{const{__scopeToast:t,type:r="foreground",duration:s,open:i,onClose:a,onEscapeKeyDown:o,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:f,onSwipeEnd:m,...p}=n,g=Cf(Lf,t),[v,x]=E.useState(null),y=He(e,j=>x(j)),S=E.useRef(null),b=E.useRef(null),w=s||g.duration,_=E.useRef(0),A=E.useRef(w),I=E.useRef(0),{onToastAdd:C,onToastRemove:R}=g,P=Ht(()=>{var G;(v==null?void 0:v.contains(document.activeElement))&&((G=g.viewport)==null||G.focus()),a()}),O=E.useCallback(j=>{!j||j===1/0||(window.clearTimeout(I.current),_.current=new Date().getTime(),I.current=window.setTimeout(P,j))},[P]);E.useEffect(()=>{const j=g.viewport;if(j){const G=()=>{O(A.current),c==null||c()},$=()=>{const Y=new Date().getTime()-_.current;A.current=A.current-Y,window.clearTimeout(I.current),l==null||l()};return j.addEventListener(kp,$),j.addEventListener(Dp,G),()=>{j.removeEventListener(kp,$),j.removeEventListener(Dp,G)}}},[g.viewport,w,l,c,O]),E.useEffect(()=>{i&&!g.isClosePausedRef.current&&O(w)},[i,w,g.isClosePausedRef,O]),E.useEffect(()=>(C(),()=>R()),[C,R]);const U=E.useMemo(()=>v?Gw(v):null,[v]);return g.viewport?h.jsxs(h.Fragment,{children:[U&&h.jsx(uN,{__scopeToast:t,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0,children:U}),h.jsx(oN,{scope:t,onClose:P,children:ya.createPortal(h.jsx(b0.ItemSlot,{scope:t,children:h.jsx(KP,{asChild:!0,onEscapeKeyDown:ne(o,()=>{g.isFocusedToastEscapeKeyDownRef.current||P(),g.isFocusedToastEscapeKeyDownRef.current=!1}),children:h.jsx(xe.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":g.swipeDirection,...p,ref:y,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:ne(n.onKeyDown,j=>{j.key==="Escape"&&(o==null||o(j.nativeEvent),j.nativeEvent.defaultPrevented||(g.isFocusedToastEscapeKeyDownRef.current=!0,P()))}),onPointerDown:ne(n.onPointerDown,j=>{j.button===0&&(S.current={x:j.clientX,y:j.clientY})}),onPointerMove:ne(n.onPointerMove,j=>{if(!S.current)return;const G=j.clientX-S.current.x,$=j.clientY-S.current.y,Y=!!b.current,D=["left","right"].includes(g.swipeDirection),N=["left","up"].includes(g.swipeDirection)?Math.min:Math.max,K=D?N(0,G):0,V=D?0:N(0,$),W=j.pointerType==="touch"?10:2,de={x:K,y:V},pe={originalEvent:j,delta:de};Y?(b.current=de,uu(sN,d,pe,{discrete:!1})):xx(de,g.swipeDirection,W)?(b.current=de,uu(rN,u,pe,{discrete:!1}),j.target.setPointerCapture(j.pointerId)):(Math.abs(G)>W||Math.abs($)>W)&&(S.current=null)}),onPointerUp:ne(n.onPointerUp,j=>{const G=b.current,$=j.target;if($.hasPointerCapture(j.pointerId)&&$.releasePointerCapture(j.pointerId),b.current=null,S.current=null,G){const Y=j.currentTarget,D={originalEvent:j,delta:G};xx(G,g.swipeDirection,g.swipeThreshold)?uu(aN,m,D,{discrete:!0}):uu(iN,f,D,{discrete:!0}),Y.addEventListener("click",N=>N.preventDefault(),{once:!0})}})})})}),g.viewport)})]}):null}),uN=n=>{const{__scopeToast:e,children:t,...r}=n,s=Cf(Lf,e),[i,a]=E.useState(!1),[o,l]=E.useState(!1);return hN(()=>a(!0)),E.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),o?null:h.jsx(Mc,{asChild:!0,children:h.jsx(Fc,{...r,children:i&&h.jsxs(h.Fragment,{children:[s.label," ",t]})})})},dN="ToastTitle",Fw=E.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return h.jsx(xe.div,{...r,ref:e})});Fw.displayName=dN;var fN="ToastDescription",jw=E.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return h.jsx(xe.div,{...r,ref:e})});jw.displayName=fN;var $w="ToastAction",Uw=E.forwardRef((n,e)=>{const{altText:t,...r}=n;return t.trim()?h.jsx(Vw,{altText:t,asChild:!0,children:h.jsx(w0,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${$w}\`. Expected non-empty \`string\`.`),null)});Uw.displayName=$w;var Bw="ToastClose",w0=E.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n,s=lN(Bw,t);return h.jsx(Vw,{asChild:!0,children:h.jsx(xe.button,{type:"button",...r,ref:e,onClick:ne(n.onClick,s.onClose)})})});w0.displayName=Bw;var Vw=E.forwardRef((n,e)=>{const{__scopeToast:t,altText:r,...s}=n;return h.jsx(xe.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...s,ref:e})});function Gw(n){const e=[];return Array.from(n.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),mN(r)){const s=r.ariaHidden||r.hidden||r.style.display==="none",i=r.dataset.radixToastAnnounceExclude==="";if(!s)if(i){const a=r.dataset.radixToastAnnounceAlt;a&&e.push(a)}else e.push(...Gw(r))}}),e}function uu(n,e,t,{discrete:r}){const s=t.originalEvent.currentTarget,i=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&s.addEventListener(n,e,{once:!0}),r?E0(s,i):s.dispatchEvent(i)}var xx=(n,e,t=0)=>{const r=Math.abs(n.x),s=Math.abs(n.y),i=r>s;return e==="left"||e==="right"?i&&r>t:!i&&s>t};function hN(n=()=>{}){const e=Ht(n);Nt(()=>{let t=0,r=0;return t=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(r)}},[e])}function mN(n){return n.nodeType===n.ELEMENT_NODE}function pN(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const s=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||s?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function $h(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var gN=Dw,Kw=Nw,Hw=Mw,zw=Fw,Ww=jw,Yw=Uw,qw=w0;function Qw(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=Qw(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function Xw(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=Qw(n))&&(r&&(r+=" "),r+=e);return r}const Sx=n=>typeof n=="boolean"?`${n}`:n===0?"0":n,Ex=Xw,va=(n,e)=>t=>{var r;if((e==null?void 0:e.variants)==null)return Ex(n,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:s,defaultVariants:i}=e,a=Object.keys(s).map(c=>{const u=t==null?void 0:t[c],d=i==null?void 0:i[c];if(u===null)return null;const f=Sx(u)||Sx(d);return s[c][f]}),o=t&&Object.entries(t).reduce((c,u)=>{let[d,f]=u;return f===void 0||(c[d]=f),c},{}),l=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((c,u)=>{let{class:d,className:f,...m}=u;return Object.entries(m).every(p=>{let[g,v]=p;return Array.isArray(v)?v.includes({...i,...o}[g]):{...i,...o}[g]===v})?[...c,d,f]:c},[]);return Ex(n,a,l,t==null?void 0:t.class,t==null?void 0:t.className)};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yN=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Zw=(...n)=>n.filter((e,t,r)=>!!e&&r.indexOf(e)===t).join(" ");/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var vN={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xN=E.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:s="",children:i,iconNode:a,...o},l)=>E.createElement("svg",{ref:l,...vN,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:Zw("lucide",s),...o},[...a.map(([c,u])=>E.createElement(c,u)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=(n,e)=>{const t=E.forwardRef(({className:r,...s},i)=>E.createElement(xN,{ref:i,iconNode:e,className:Zw(`lucide-${yN(n)}`,r),...s}));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kf=Ke("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jw=Ke("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eA=Ke("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tA=Ke("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SN=Ke("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nA=Ke("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EN=Ke("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rA=Ke("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TN=Ke("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sA=Ke("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bN=Ke("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wN=Ke("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AN=Ke("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _N=Ke("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Df=Ke("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IN=Ke("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RN=Ke("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CN=Ke("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LN=Ke("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A0=Ke("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kN=Ke("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DN=Ke("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mi=Ke("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dl=Ke("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _0=Ke("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PN=Ke("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NN=Ke("Stethoscope",[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ON=Ke("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MN=Ke("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tx=Ke("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bx=Ke("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iA=Ke("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=Ke("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),R0="-",FN=n=>{const e=$N(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=n;return{getClassGroupId:a=>{const o=a.split(R0);return o[0]===""&&o.length!==1&&o.shift(),aA(o,e)||jN(a)},getConflictingClassGroupIds:(a,o)=>{const l=t[a]||[];return o&&r[a]?[...l,...r[a]]:l}}},aA=(n,e)=>{var a;if(n.length===0)return e.classGroupId;const t=n[0],r=e.nextPart.get(t),s=r?aA(n.slice(1),r):void 0;if(s)return s;if(e.validators.length===0)return;const i=n.join(R0);return(a=e.validators.find(({validator:o})=>o(i)))==null?void 0:a.classGroupId},wx=/^\[(.+)\]$/,jN=n=>{if(wx.test(n)){const e=wx.exec(n)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},$N=n=>{const{theme:e,prefix:t}=n,r={nextPart:new Map,validators:[]};return BN(Object.entries(n.classGroups),t).forEach(([i,a])=>{Np(a,r,i,e)}),r},Np=(n,e,t,r)=>{n.forEach(s=>{if(typeof s=="string"){const i=s===""?e:Ax(e,s);i.classGroupId=t;return}if(typeof s=="function"){if(UN(s)){Np(s(r),e,t,r);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([i,a])=>{Np(a,Ax(e,i),t,r)})})},Ax=(n,e)=>{let t=n;return e.split(R0).forEach(r=>{t.nextPart.has(r)||t.nextPart.set(r,{nextPart:new Map,validators:[]}),t=t.nextPart.get(r)}),t},UN=n=>n.isThemeGetter,BN=(n,e)=>e?n.map(([t,r])=>{const s=r.map(i=>typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([a,o])=>[e+a,o])):i);return[t,s]}):n,VN=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,r=new Map;const s=(i,a)=>{t.set(i,a),e++,e>n&&(e=0,r=t,t=new Map)};return{get(i){let a=t.get(i);if(a!==void 0)return a;if((a=r.get(i))!==void 0)return s(i,a),a},set(i,a){t.has(i)?t.set(i,a):s(i,a)}}},oA="!",GN=n=>{const{separator:e,experimentalParseClassName:t}=n,r=e.length===1,s=e[0],i=e.length,a=o=>{const l=[];let c=0,u=0,d;for(let v=0;v<o.length;v++){let x=o[v];if(c===0){if(x===s&&(r||o.slice(v,v+i)===e)){l.push(o.slice(u,v)),u=v+i;continue}if(x==="/"){d=v;continue}}x==="["?c++:x==="]"&&c--}const f=l.length===0?o:o.substring(u),m=f.startsWith(oA),p=m?f.substring(1):f,g=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:m,baseClassName:p,maybePostfixModifierPosition:g}};return t?o=>t({className:o,parseClassName:a}):a},KN=n=>{if(n.length<=1)return n;const e=[];let t=[];return n.forEach(r=>{r[0]==="["?(e.push(...t.sort(),r),t=[]):t.push(r)}),e.push(...t.sort()),e},HN=n=>({cache:VN(n.cacheSize),parseClassName:GN(n),...FN(n)}),zN=/\s+/,WN=(n,e)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:s}=e,i=[],a=n.trim().split(zN);let o="";for(let l=a.length-1;l>=0;l-=1){const c=a[l],{modifiers:u,hasImportantModifier:d,baseClassName:f,maybePostfixModifierPosition:m}=t(c);let p=!!m,g=r(p?f.substring(0,m):f);if(!g){if(!p){o=c+(o.length>0?" "+o:o);continue}if(g=r(f),!g){o=c+(o.length>0?" "+o:o);continue}p=!1}const v=KN(u).join(":"),x=d?v+oA:v,y=x+g;if(i.includes(y))continue;i.push(y);const S=s(g,p);for(let b=0;b<S.length;++b){const w=S[b];i.push(x+w)}o=c+(o.length>0?" "+o:o)}return o};function YN(){let n=0,e,t,r="";for(;n<arguments.length;)(e=arguments[n++])&&(t=lA(e))&&(r&&(r+=" "),r+=t);return r}const lA=n=>{if(typeof n=="string")return n;let e,t="";for(let r=0;r<n.length;r++)n[r]&&(e=lA(n[r]))&&(t&&(t+=" "),t+=e);return t};function qN(n,...e){let t,r,s,i=a;function a(l){const c=e.reduce((u,d)=>d(u),n());return t=HN(c),r=t.cache.get,s=t.cache.set,i=o,o(l)}function o(l){const c=r(l);if(c)return c;const u=WN(l,t);return s(l,u),u}return function(){return i(YN.apply(null,arguments))}}const at=n=>{const e=t=>t[n]||[];return e.isThemeGetter=!0,e},cA=/^\[(?:([a-z-]+):)?(.+)\]$/i,QN=/^\d+\/\d+$/,XN=new Set(["px","full","screen"]),ZN=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,JN=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,eO=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,tO=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,nO=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,is=n=>to(n)||XN.has(n)||QN.test(n),Ds=n=>Ko(n,"length",uO),to=n=>!!n&&!Number.isNaN(Number(n)),Uh=n=>Ko(n,"number",to),ol=n=>!!n&&Number.isInteger(Number(n)),rO=n=>n.endsWith("%")&&to(n.slice(0,-1)),Le=n=>cA.test(n),Ps=n=>ZN.test(n),sO=new Set(["length","size","percentage"]),iO=n=>Ko(n,sO,uA),aO=n=>Ko(n,"position",uA),oO=new Set(["image","url"]),lO=n=>Ko(n,oO,fO),cO=n=>Ko(n,"",dO),ll=()=>!0,Ko=(n,e,t)=>{const r=cA.exec(n);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):t(r[2]):!1},uO=n=>JN.test(n)&&!eO.test(n),uA=()=>!1,dO=n=>tO.test(n),fO=n=>nO.test(n),hO=()=>{const n=at("colors"),e=at("spacing"),t=at("blur"),r=at("brightness"),s=at("borderColor"),i=at("borderRadius"),a=at("borderSpacing"),o=at("borderWidth"),l=at("contrast"),c=at("grayscale"),u=at("hueRotate"),d=at("invert"),f=at("gap"),m=at("gradientColorStops"),p=at("gradientColorStopPositions"),g=at("inset"),v=at("margin"),x=at("opacity"),y=at("padding"),S=at("saturate"),b=at("scale"),w=at("sepia"),_=at("skew"),A=at("space"),I=at("translate"),C=()=>["auto","contain","none"],R=()=>["auto","hidden","clip","visible","scroll"],P=()=>["auto",Le,e],O=()=>[Le,e],U=()=>["",is,Ds],j=()=>["auto",to,Le],G=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],$=()=>["solid","dashed","dotted","double","none"],Y=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],D=()=>["start","end","center","between","around","evenly","stretch"],N=()=>["","0",Le],K=()=>["auto","avoid","all","avoid-page","page","left","right","column"],V=()=>[to,Le];return{cacheSize:500,separator:":",theme:{colors:[ll],spacing:[is,Ds],blur:["none","",Ps,Le],brightness:V(),borderColor:[n],borderRadius:["none","","full",Ps,Le],borderSpacing:O(),borderWidth:U(),contrast:V(),grayscale:N(),hueRotate:V(),invert:N(),gap:O(),gradientColorStops:[n],gradientColorStopPositions:[rO,Ds],inset:P(),margin:P(),opacity:V(),padding:O(),saturate:V(),scale:V(),sepia:N(),skew:V(),space:O(),translate:O()},classGroups:{aspect:[{aspect:["auto","square","video",Le]}],container:["container"],columns:[{columns:[Ps]}],"break-after":[{"break-after":K()}],"break-before":[{"break-before":K()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...G(),Le]}],overflow:[{overflow:R()}],"overflow-x":[{"overflow-x":R()}],"overflow-y":[{"overflow-y":R()}],overscroll:[{overscroll:C()}],"overscroll-x":[{"overscroll-x":C()}],"overscroll-y":[{"overscroll-y":C()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",ol,Le]}],basis:[{basis:P()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Le]}],grow:[{grow:N()}],shrink:[{shrink:N()}],order:[{order:["first","last","none",ol,Le]}],"grid-cols":[{"grid-cols":[ll]}],"col-start-end":[{col:["auto",{span:["full",ol,Le]},Le]}],"col-start":[{"col-start":j()}],"col-end":[{"col-end":j()}],"grid-rows":[{"grid-rows":[ll]}],"row-start-end":[{row:["auto",{span:[ol,Le]},Le]}],"row-start":[{"row-start":j()}],"row-end":[{"row-end":j()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Le]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Le]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...D()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...D(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...D(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[y]}],px:[{px:[y]}],py:[{py:[y]}],ps:[{ps:[y]}],pe:[{pe:[y]}],pt:[{pt:[y]}],pr:[{pr:[y]}],pb:[{pb:[y]}],pl:[{pl:[y]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[A]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[A]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Le,e]}],"min-w":[{"min-w":[Le,e,"min","max","fit"]}],"max-w":[{"max-w":[Le,e,"none","full","min","max","fit","prose",{screen:[Ps]},Ps]}],h:[{h:[Le,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Le,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Le,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Le,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Ps,Ds]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Uh]}],"font-family":[{font:[ll]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Le]}],"line-clamp":[{"line-clamp":["none",to,Uh]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",is,Le]}],"list-image":[{"list-image":["none",Le]}],"list-style-type":[{list:["none","disc","decimal",Le]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[n]}],"placeholder-opacity":[{"placeholder-opacity":[x]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[n]}],"text-opacity":[{"text-opacity":[x]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...$(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",is,Ds]}],"underline-offset":[{"underline-offset":["auto",is,Le]}],"text-decoration-color":[{decoration:[n]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:O()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Le]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Le]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[x]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...G(),aO]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",iO]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},lO]}],"bg-color":[{bg:[n]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[x]}],"border-style":[{border:[...$(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[x]}],"divide-style":[{divide:$()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...$()]}],"outline-offset":[{"outline-offset":[is,Le]}],"outline-w":[{outline:[is,Ds]}],"outline-color":[{outline:[n]}],"ring-w":[{ring:U()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[n]}],"ring-opacity":[{"ring-opacity":[x]}],"ring-offset-w":[{"ring-offset":[is,Ds]}],"ring-offset-color":[{"ring-offset":[n]}],shadow:[{shadow:["","inner","none",Ps,cO]}],"shadow-color":[{shadow:[ll]}],opacity:[{opacity:[x]}],"mix-blend":[{"mix-blend":[...Y(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Y()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Ps,Le]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[S]}],sepia:[{sepia:[w]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[x]}],"backdrop-saturate":[{"backdrop-saturate":[S]}],"backdrop-sepia":[{"backdrop-sepia":[w]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Le]}],duration:[{duration:V()}],ease:[{ease:["linear","in","out","in-out",Le]}],delay:[{delay:V()}],animate:[{animate:["none","spin","ping","pulse","bounce",Le]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[b]}],"scale-x":[{"scale-x":[b]}],"scale-y":[{"scale-y":[b]}],rotate:[{rotate:[ol,Le]}],"translate-x":[{"translate-x":[I]}],"translate-y":[{"translate-y":[I]}],"skew-x":[{"skew-x":[_]}],"skew-y":[{"skew-y":[_]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Le]}],accent:[{accent:["auto",n]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Le]}],"caret-color":[{caret:[n]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":O()}],"scroll-mx":[{"scroll-mx":O()}],"scroll-my":[{"scroll-my":O()}],"scroll-ms":[{"scroll-ms":O()}],"scroll-me":[{"scroll-me":O()}],"scroll-mt":[{"scroll-mt":O()}],"scroll-mr":[{"scroll-mr":O()}],"scroll-mb":[{"scroll-mb":O()}],"scroll-ml":[{"scroll-ml":O()}],"scroll-p":[{"scroll-p":O()}],"scroll-px":[{"scroll-px":O()}],"scroll-py":[{"scroll-py":O()}],"scroll-ps":[{"scroll-ps":O()}],"scroll-pe":[{"scroll-pe":O()}],"scroll-pt":[{"scroll-pt":O()}],"scroll-pr":[{"scroll-pr":O()}],"scroll-pb":[{"scroll-pb":O()}],"scroll-pl":[{"scroll-pl":O()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Le]}],fill:[{fill:[n,"none"]}],"stroke-w":[{stroke:[is,Ds,Uh]}],stroke:[{stroke:[n,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},mO=qN(hO);function J(...n){return mO(Xw(n))}const pO=gN,dA=E.forwardRef(({className:n,...e},t)=>h.jsx(Kw,{ref:t,className:J("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",n),...e}));dA.displayName=Kw.displayName;const gO=va("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),fA=E.forwardRef(({className:n,variant:e,...t},r)=>h.jsx(Hw,{ref:r,className:J(gO({variant:e}),n),...t}));fA.displayName=Hw.displayName;const yO=E.forwardRef(({className:n,...e},t)=>h.jsx(Yw,{ref:t,className:J("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",n),...e}));yO.displayName=Yw.displayName;const hA=E.forwardRef(({className:n,...e},t)=>h.jsx(qw,{ref:t,className:J("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",n),"toast-close":"",...e,children:h.jsx(I0,{className:"h-4 w-4"})}));hA.displayName=qw.displayName;const mA=E.forwardRef(({className:n,...e},t)=>h.jsx(zw,{ref:t,className:J("text-sm font-semibold",n),...e}));mA.displayName=zw.displayName;const pA=E.forwardRef(({className:n,...e},t)=>h.jsx(Ww,{ref:t,className:J("text-sm opacity-90",n),...e}));pA.displayName=Ww.displayName;function vO(){const{toasts:n}=ns();return h.jsxs(pO,{children:[n.map(function({id:e,title:t,description:r,action:s,...i}){return h.jsxs(fA,{...i,children:[h.jsxs("div",{className:"grid gap-1",children:[t&&h.jsx(mA,{children:t}),r&&h.jsx(pA,{children:r})]}),s,h.jsx(hA,{})]},e)}),h.jsx(dA,{})]})}var xO=ZE[" useId ".trim().toString()]||(()=>{}),SO=0;function xr(n){const[e,t]=E.useState(xO());return Nt(()=>{t(r=>r??String(SO++))},[n]),e?`radix-${e}`:""}const EO=["top","right","bottom","left"],pi=Math.min,Nn=Math.max,Dd=Math.round,du=Math.floor,Yr=n=>({x:n,y:n}),TO={left:"right",right:"left",bottom:"top",top:"bottom"},bO={start:"end",end:"start"};function Op(n,e,t){return Nn(n,pi(e,t))}function _s(n,e){return typeof n=="function"?n(e):n}function Is(n){return n.split("-")[0]}function Ho(n){return n.split("-")[1]}function C0(n){return n==="x"?"y":"x"}function L0(n){return n==="y"?"height":"width"}function gi(n){return["top","bottom"].includes(Is(n))?"y":"x"}function k0(n){return C0(gi(n))}function wO(n,e,t){t===void 0&&(t=!1);const r=Ho(n),s=k0(n),i=L0(s);let a=s==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(a=Pd(a)),[a,Pd(a)]}function AO(n){const e=Pd(n);return[Mp(n),e,Mp(e)]}function Mp(n){return n.replace(/start|end/g,e=>bO[e])}function _O(n,e,t){const r=["left","right"],s=["right","left"],i=["top","bottom"],a=["bottom","top"];switch(n){case"top":case"bottom":return t?e?s:r:e?r:s;case"left":case"right":return e?i:a;default:return[]}}function IO(n,e,t,r){const s=Ho(n);let i=_O(Is(n),t==="start",r);return s&&(i=i.map(a=>a+"-"+s),e&&(i=i.concat(i.map(Mp)))),i}function Pd(n){return n.replace(/left|right|bottom|top/g,e=>TO[e])}function RO(n){return{top:0,right:0,bottom:0,left:0,...n}}function gA(n){return typeof n!="number"?RO(n):{top:n,right:n,bottom:n,left:n}}function Nd(n){const{x:e,y:t,width:r,height:s}=n;return{width:r,height:s,top:t,left:e,right:e+r,bottom:t+s,x:e,y:t}}function _x(n,e,t){let{reference:r,floating:s}=n;const i=gi(e),a=k0(e),o=L0(a),l=Is(e),c=i==="y",u=r.x+r.width/2-s.width/2,d=r.y+r.height/2-s.height/2,f=r[o]/2-s[o]/2;let m;switch(l){case"top":m={x:u,y:r.y-s.height};break;case"bottom":m={x:u,y:r.y+r.height};break;case"right":m={x:r.x+r.width,y:d};break;case"left":m={x:r.x-s.width,y:d};break;default:m={x:r.x,y:r.y}}switch(Ho(e)){case"start":m[a]-=f*(t&&c?-1:1);break;case"end":m[a]+=f*(t&&c?-1:1);break}return m}const CO=async(n,e,t)=>{const{placement:r="bottom",strategy:s="absolute",middleware:i=[],platform:a}=t,o=i.filter(Boolean),l=await(a.isRTL==null?void 0:a.isRTL(e));let c=await a.getElementRects({reference:n,floating:e,strategy:s}),{x:u,y:d}=_x(c,r,l),f=r,m={},p=0;for(let g=0;g<o.length;g++){const{name:v,fn:x}=o[g],{x:y,y:S,data:b,reset:w}=await x({x:u,y:d,initialPlacement:r,placement:f,strategy:s,middlewareData:m,rects:c,platform:a,elements:{reference:n,floating:e}});u=y??u,d=S??d,m={...m,[v]:{...m[v],...b}},w&&p<=50&&(p++,typeof w=="object"&&(w.placement&&(f=w.placement),w.rects&&(c=w.rects===!0?await a.getElementRects({reference:n,floating:e,strategy:s}):w.rects),{x:u,y:d}=_x(c,f,l)),g=-1)}return{x:u,y:d,placement:f,strategy:s,middlewareData:m}};async function nc(n,e){var t;e===void 0&&(e={});const{x:r,y:s,platform:i,rects:a,elements:o,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:m=0}=_s(e,n),p=gA(m),v=o[f?d==="floating"?"reference":"floating":d],x=Nd(await i.getClippingRect({element:(t=await(i.isElement==null?void 0:i.isElement(v)))==null||t?v:v.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(o.floating)),boundary:c,rootBoundary:u,strategy:l})),y=d==="floating"?{x:r,y:s,width:a.floating.width,height:a.floating.height}:a.reference,S=await(i.getOffsetParent==null?void 0:i.getOffsetParent(o.floating)),b=await(i.isElement==null?void 0:i.isElement(S))?await(i.getScale==null?void 0:i.getScale(S))||{x:1,y:1}:{x:1,y:1},w=Nd(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:y,offsetParent:S,strategy:l}):y);return{top:(x.top-w.top+p.top)/b.y,bottom:(w.bottom-x.bottom+p.bottom)/b.y,left:(x.left-w.left+p.left)/b.x,right:(w.right-x.right+p.right)/b.x}}const LO=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:s,rects:i,platform:a,elements:o,middlewareData:l}=e,{element:c,padding:u=0}=_s(n,e)||{};if(c==null)return{};const d=gA(u),f={x:t,y:r},m=k0(s),p=L0(m),g=await a.getDimensions(c),v=m==="y",x=v?"top":"left",y=v?"bottom":"right",S=v?"clientHeight":"clientWidth",b=i.reference[p]+i.reference[m]-f[m]-i.floating[p],w=f[m]-i.reference[m],_=await(a.getOffsetParent==null?void 0:a.getOffsetParent(c));let A=_?_[S]:0;(!A||!await(a.isElement==null?void 0:a.isElement(_)))&&(A=o.floating[S]||i.floating[p]);const I=b/2-w/2,C=A/2-g[p]/2-1,R=pi(d[x],C),P=pi(d[y],C),O=R,U=A-g[p]-P,j=A/2-g[p]/2+I,G=Op(O,j,U),$=!l.arrow&&Ho(s)!=null&&j!==G&&i.reference[p]/2-(j<O?R:P)-g[p]/2<0,Y=$?j<O?j-O:j-U:0;return{[m]:f[m]+Y,data:{[m]:G,centerOffset:j-G-Y,...$&&{alignmentOffset:Y}},reset:$}}}),kO=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:s,middlewareData:i,rects:a,initialPlacement:o,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:g=!0,...v}=_s(n,e);if((t=i.arrow)!=null&&t.alignmentOffset)return{};const x=Is(s),y=gi(o),S=Is(o)===o,b=await(l.isRTL==null?void 0:l.isRTL(c.floating)),w=f||(S||!g?[Pd(o)]:AO(o)),_=p!=="none";!f&&_&&w.push(...IO(o,g,p,b));const A=[o,...w],I=await nc(e,v),C=[];let R=((r=i.flip)==null?void 0:r.overflows)||[];if(u&&C.push(I[x]),d){const j=wO(s,a,b);C.push(I[j[0]],I[j[1]])}if(R=[...R,{placement:s,overflows:C}],!C.every(j=>j<=0)){var P,O;const j=(((P=i.flip)==null?void 0:P.index)||0)+1,G=A[j];if(G)return{data:{index:j,overflows:R},reset:{placement:G}};let $=(O=R.filter(Y=>Y.overflows[0]<=0).sort((Y,D)=>Y.overflows[1]-D.overflows[1])[0])==null?void 0:O.placement;if(!$)switch(m){case"bestFit":{var U;const Y=(U=R.filter(D=>{if(_){const N=gi(D.placement);return N===y||N==="y"}return!0}).map(D=>[D.placement,D.overflows.filter(N=>N>0).reduce((N,K)=>N+K,0)]).sort((D,N)=>D[1]-N[1])[0])==null?void 0:U[0];Y&&($=Y);break}case"initialPlacement":$=o;break}if(s!==$)return{reset:{placement:$}}}return{}}}};function Ix(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function Rx(n){return EO.some(e=>n[e]>=0)}const DO=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...s}=_s(n,e);switch(r){case"referenceHidden":{const i=await nc(e,{...s,elementContext:"reference"}),a=Ix(i,t.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:Rx(a)}}}case"escaped":{const i=await nc(e,{...s,altBoundary:!0}),a=Ix(i,t.floating);return{data:{escapedOffsets:a,escaped:Rx(a)}}}default:return{}}}}};async function PO(n,e){const{placement:t,platform:r,elements:s}=n,i=await(r.isRTL==null?void 0:r.isRTL(s.floating)),a=Is(t),o=Ho(t),l=gi(t)==="y",c=["left","top"].includes(a)?-1:1,u=i&&l?-1:1,d=_s(e,n);let{mainAxis:f,crossAxis:m,alignmentAxis:p}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return o&&typeof p=="number"&&(m=o==="end"?p*-1:p),l?{x:m*u,y:f*c}:{x:f*c,y:m*u}}const NO=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:s,y:i,placement:a,middlewareData:o}=e,l=await PO(e,n);return a===((t=o.offset)==null?void 0:t.placement)&&(r=o.arrow)!=null&&r.alignmentOffset?{}:{x:s+l.x,y:i+l.y,data:{...l,placement:a}}}}},OO=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:s}=e,{mainAxis:i=!0,crossAxis:a=!1,limiter:o={fn:v=>{let{x,y}=v;return{x,y}}},...l}=_s(n,e),c={x:t,y:r},u=await nc(e,l),d=gi(Is(s)),f=C0(d);let m=c[f],p=c[d];if(i){const v=f==="y"?"top":"left",x=f==="y"?"bottom":"right",y=m+u[v],S=m-u[x];m=Op(y,m,S)}if(a){const v=d==="y"?"top":"left",x=d==="y"?"bottom":"right",y=p+u[v],S=p-u[x];p=Op(y,p,S)}const g=o.fn({...e,[f]:m,[d]:p});return{...g,data:{x:g.x-t,y:g.y-r,enabled:{[f]:i,[d]:a}}}}}},MO=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:s,rects:i,middlewareData:a}=e,{offset:o=0,mainAxis:l=!0,crossAxis:c=!0}=_s(n,e),u={x:t,y:r},d=gi(s),f=C0(d);let m=u[f],p=u[d];const g=_s(o,e),v=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){const S=f==="y"?"height":"width",b=i.reference[f]-i.floating[S]+v.mainAxis,w=i.reference[f]+i.reference[S]-v.mainAxis;m<b?m=b:m>w&&(m=w)}if(c){var x,y;const S=f==="y"?"width":"height",b=["top","left"].includes(Is(s)),w=i.reference[d]-i.floating[S]+(b&&((x=a.offset)==null?void 0:x[d])||0)+(b?0:v.crossAxis),_=i.reference[d]+i.reference[S]+(b?0:((y=a.offset)==null?void 0:y[d])||0)-(b?v.crossAxis:0);p<w?p=w:p>_&&(p=_)}return{[f]:m,[d]:p}}}},FO=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,r;const{placement:s,rects:i,platform:a,elements:o}=e,{apply:l=()=>{},...c}=_s(n,e),u=await nc(e,c),d=Is(s),f=Ho(s),m=gi(s)==="y",{width:p,height:g}=i.floating;let v,x;d==="top"||d==="bottom"?(v=d,x=f===(await(a.isRTL==null?void 0:a.isRTL(o.floating))?"start":"end")?"left":"right"):(x=d,v=f==="end"?"top":"bottom");const y=g-u.top-u.bottom,S=p-u.left-u.right,b=pi(g-u[v],y),w=pi(p-u[x],S),_=!e.middlewareData.shift;let A=b,I=w;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(I=S),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(A=y),_&&!f){const R=Nn(u.left,0),P=Nn(u.right,0),O=Nn(u.top,0),U=Nn(u.bottom,0);m?I=p-2*(R!==0||P!==0?R+P:Nn(u.left,u.right)):A=g-2*(O!==0||U!==0?O+U:Nn(u.top,u.bottom))}await l({...e,availableWidth:I,availableHeight:A});const C=await a.getDimensions(o.floating);return p!==C.width||g!==C.height?{reset:{rects:!0}}:{}}}};function Pf(){return typeof window<"u"}function zo(n){return yA(n)?(n.nodeName||"").toLowerCase():"#document"}function jn(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function rs(n){var e;return(e=(yA(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function yA(n){return Pf()?n instanceof Node||n instanceof jn(n).Node:!1}function br(n){return Pf()?n instanceof Element||n instanceof jn(n).Element:!1}function Xr(n){return Pf()?n instanceof HTMLElement||n instanceof jn(n).HTMLElement:!1}function Cx(n){return!Pf()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof jn(n).ShadowRoot}function jc(n){const{overflow:e,overflowX:t,overflowY:r,display:s}=wr(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(s)}function jO(n){return["table","td","th"].includes(zo(n))}function Nf(n){return[":popover-open",":modal"].some(e=>{try{return n.matches(e)}catch{return!1}})}function D0(n){const e=P0(),t=br(n)?wr(n):n;return["transform","translate","scale","rotate","perspective"].some(r=>t[r]?t[r]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function $O(n){let e=yi(n);for(;Xr(e)&&!ko(e);){if(D0(e))return e;if(Nf(e))return null;e=yi(e)}return null}function P0(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ko(n){return["html","body","#document"].includes(zo(n))}function wr(n){return jn(n).getComputedStyle(n)}function Of(n){return br(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function yi(n){if(zo(n)==="html")return n;const e=n.assignedSlot||n.parentNode||Cx(n)&&n.host||rs(n);return Cx(e)?e.host:e}function vA(n){const e=yi(n);return ko(e)?n.ownerDocument?n.ownerDocument.body:n.body:Xr(e)&&jc(e)?e:vA(e)}function rc(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=vA(n),i=s===((r=n.ownerDocument)==null?void 0:r.body),a=jn(s);if(i){const o=Fp(a);return e.concat(a,a.visualViewport||[],jc(s)?s:[],o&&t?rc(o):[])}return e.concat(s,rc(s,[],t))}function Fp(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function xA(n){const e=wr(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const s=Xr(n),i=s?n.offsetWidth:t,a=s?n.offsetHeight:r,o=Dd(t)!==i||Dd(r)!==a;return o&&(t=i,r=a),{width:t,height:r,$:o}}function N0(n){return br(n)?n:n.contextElement}function no(n){const e=N0(n);if(!Xr(e))return Yr(1);const t=e.getBoundingClientRect(),{width:r,height:s,$:i}=xA(e);let a=(i?Dd(t.width):t.width)/r,o=(i?Dd(t.height):t.height)/s;return(!a||!Number.isFinite(a))&&(a=1),(!o||!Number.isFinite(o))&&(o=1),{x:a,y:o}}const UO=Yr(0);function SA(n){const e=jn(n);return!P0()||!e.visualViewport?UO:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function BO(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==jn(n)?!1:e}function la(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=n.getBoundingClientRect(),i=N0(n);let a=Yr(1);e&&(r?br(r)&&(a=no(r)):a=no(n));const o=BO(i,t,r)?SA(i):Yr(0);let l=(s.left+o.x)/a.x,c=(s.top+o.y)/a.y,u=s.width/a.x,d=s.height/a.y;if(i){const f=jn(i),m=r&&br(r)?jn(r):r;let p=f,g=Fp(p);for(;g&&r&&m!==p;){const v=no(g),x=g.getBoundingClientRect(),y=wr(g),S=x.left+(g.clientLeft+parseFloat(y.paddingLeft))*v.x,b=x.top+(g.clientTop+parseFloat(y.paddingTop))*v.y;l*=v.x,c*=v.y,u*=v.x,d*=v.y,l+=S,c+=b,p=jn(g),g=Fp(p)}}return Nd({width:u,height:d,x:l,y:c})}function O0(n,e){const t=Of(n).scrollLeft;return e?e.left+t:la(rs(n)).left+t}function EA(n,e,t){t===void 0&&(t=!1);const r=n.getBoundingClientRect(),s=r.left+e.scrollLeft-(t?0:O0(n,r)),i=r.top+e.scrollTop;return{x:s,y:i}}function VO(n){let{elements:e,rect:t,offsetParent:r,strategy:s}=n;const i=s==="fixed",a=rs(r),o=e?Nf(e.floating):!1;if(r===a||o&&i)return t;let l={scrollLeft:0,scrollTop:0},c=Yr(1);const u=Yr(0),d=Xr(r);if((d||!d&&!i)&&((zo(r)!=="body"||jc(a))&&(l=Of(r)),Xr(r))){const m=la(r);c=no(r),u.x=m.x+r.clientLeft,u.y=m.y+r.clientTop}const f=a&&!d&&!i?EA(a,l,!0):Yr(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:t.y*c.y-l.scrollTop*c.y+u.y+f.y}}function GO(n){return Array.from(n.getClientRects())}function KO(n){const e=rs(n),t=Of(n),r=n.ownerDocument.body,s=Nn(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),i=Nn(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let a=-t.scrollLeft+O0(n);const o=-t.scrollTop;return wr(r).direction==="rtl"&&(a+=Nn(e.clientWidth,r.clientWidth)-s),{width:s,height:i,x:a,y:o}}function HO(n,e){const t=jn(n),r=rs(n),s=t.visualViewport;let i=r.clientWidth,a=r.clientHeight,o=0,l=0;if(s){i=s.width,a=s.height;const c=P0();(!c||c&&e==="fixed")&&(o=s.offsetLeft,l=s.offsetTop)}return{width:i,height:a,x:o,y:l}}function zO(n,e){const t=la(n,!0,e==="fixed"),r=t.top+n.clientTop,s=t.left+n.clientLeft,i=Xr(n)?no(n):Yr(1),a=n.clientWidth*i.x,o=n.clientHeight*i.y,l=s*i.x,c=r*i.y;return{width:a,height:o,x:l,y:c}}function Lx(n,e,t){let r;if(e==="viewport")r=HO(n,t);else if(e==="document")r=KO(rs(n));else if(br(e))r=zO(e,t);else{const s=SA(n);r={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return Nd(r)}function TA(n,e){const t=yi(n);return t===e||!br(t)||ko(t)?!1:wr(t).position==="fixed"||TA(t,e)}function WO(n,e){const t=e.get(n);if(t)return t;let r=rc(n,[],!1).filter(o=>br(o)&&zo(o)!=="body"),s=null;const i=wr(n).position==="fixed";let a=i?yi(n):n;for(;br(a)&&!ko(a);){const o=wr(a),l=D0(a);!l&&o.position==="fixed"&&(s=null),(i?!l&&!s:!l&&o.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||jc(a)&&!l&&TA(n,a))?r=r.filter(u=>u!==a):s=o,a=yi(a)}return e.set(n,r),r}function YO(n){let{element:e,boundary:t,rootBoundary:r,strategy:s}=n;const a=[...t==="clippingAncestors"?Nf(e)?[]:WO(e,this._c):[].concat(t),r],o=a[0],l=a.reduce((c,u)=>{const d=Lx(e,u,s);return c.top=Nn(d.top,c.top),c.right=pi(d.right,c.right),c.bottom=pi(d.bottom,c.bottom),c.left=Nn(d.left,c.left),c},Lx(e,o,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function qO(n){const{width:e,height:t}=xA(n);return{width:e,height:t}}function QO(n,e,t){const r=Xr(e),s=rs(e),i=t==="fixed",a=la(n,!0,i,e);let o={scrollLeft:0,scrollTop:0};const l=Yr(0);if(r||!r&&!i)if((zo(e)!=="body"||jc(s))&&(o=Of(e)),r){const f=la(e,!0,i,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else s&&(l.x=O0(s));const c=s&&!r&&!i?EA(s,o):Yr(0),u=a.left+o.scrollLeft-l.x-c.x,d=a.top+o.scrollTop-l.y-c.y;return{x:u,y:d,width:a.width,height:a.height}}function Bh(n){return wr(n).position==="static"}function kx(n,e){if(!Xr(n)||wr(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return rs(n)===t&&(t=t.ownerDocument.body),t}function bA(n,e){const t=jn(n);if(Nf(n))return t;if(!Xr(n)){let s=yi(n);for(;s&&!ko(s);){if(br(s)&&!Bh(s))return s;s=yi(s)}return t}let r=kx(n,e);for(;r&&jO(r)&&Bh(r);)r=kx(r,e);return r&&ko(r)&&Bh(r)&&!D0(r)?t:r||$O(n)||t}const XO=async function(n){const e=this.getOffsetParent||bA,t=this.getDimensions,r=await t(n.floating);return{reference:QO(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function ZO(n){return wr(n).direction==="rtl"}const JO={convertOffsetParentRelativeRectToViewportRelativeRect:VO,getDocumentElement:rs,getClippingRect:YO,getOffsetParent:bA,getElementRects:XO,getClientRects:GO,getDimensions:qO,getScale:no,isElement:br,isRTL:ZO};function wA(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function eM(n,e){let t=null,r;const s=rs(n);function i(){var o;clearTimeout(r),(o=t)==null||o.disconnect(),t=null}function a(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),i();const c=n.getBoundingClientRect(),{left:u,top:d,width:f,height:m}=c;if(o||e(),!f||!m)return;const p=du(d),g=du(s.clientWidth-(u+f)),v=du(s.clientHeight-(d+m)),x=du(u),S={rootMargin:-p+"px "+-g+"px "+-v+"px "+-x+"px",threshold:Nn(0,pi(1,l))||1};let b=!0;function w(_){const A=_[0].intersectionRatio;if(A!==l){if(!b)return a();A?a(!1,A):r=setTimeout(()=>{a(!1,1e-7)},1e3)}A===1&&!wA(c,n.getBoundingClientRect())&&a(),b=!1}try{t=new IntersectionObserver(w,{...S,root:s.ownerDocument})}catch{t=new IntersectionObserver(w,S)}t.observe(n)}return a(!0),i}function tM(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:s=!0,ancestorResize:i=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=N0(n),u=s||i?[...c?rc(c):[],...rc(e)]:[];u.forEach(x=>{s&&x.addEventListener("scroll",t,{passive:!0}),i&&x.addEventListener("resize",t)});const d=c&&o?eM(c,t):null;let f=-1,m=null;a&&(m=new ResizeObserver(x=>{let[y]=x;y&&y.target===c&&m&&(m.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var S;(S=m)==null||S.observe(e)})),t()}),c&&!l&&m.observe(c),m.observe(e));let p,g=l?la(n):null;l&&v();function v(){const x=la(n);g&&!wA(g,x)&&t(),g=x,p=requestAnimationFrame(v)}return t(),()=>{var x;u.forEach(y=>{s&&y.removeEventListener("scroll",t),i&&y.removeEventListener("resize",t)}),d==null||d(),(x=m)==null||x.disconnect(),m=null,l&&cancelAnimationFrame(p)}}const nM=NO,rM=OO,sM=kO,iM=FO,aM=DO,Dx=LO,oM=MO,lM=(n,e,t)=>{const r=new Map,s={platform:JO,...t},i={...s.platform,_c:r};return CO(n,e,{...s,platform:i})};var Yu=typeof document<"u"?E.useLayoutEffect:E.useEffect;function Od(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,s;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!Od(n[r],e[r]))return!1;return!0}if(s=Object.keys(n),t=s.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,s[r]))return!1;for(r=t;r--!==0;){const i=s[r];if(!(i==="_owner"&&n.$$typeof)&&!Od(n[i],e[i]))return!1}return!0}return n!==n&&e!==e}function AA(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function Px(n,e){const t=AA(n);return Math.round(e*t)/t}function Vh(n){const e=E.useRef(n);return Yu(()=>{e.current=n}),e}function cM(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:s,elements:{reference:i,floating:a}={},transform:o=!0,whileElementsMounted:l,open:c}=n,[u,d]=E.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[f,m]=E.useState(r);Od(f,r)||m(r);const[p,g]=E.useState(null),[v,x]=E.useState(null),y=E.useCallback(D=>{D!==_.current&&(_.current=D,g(D))},[]),S=E.useCallback(D=>{D!==A.current&&(A.current=D,x(D))},[]),b=i||p,w=a||v,_=E.useRef(null),A=E.useRef(null),I=E.useRef(u),C=l!=null,R=Vh(l),P=Vh(s),O=Vh(c),U=E.useCallback(()=>{if(!_.current||!A.current)return;const D={placement:e,strategy:t,middleware:f};P.current&&(D.platform=P.current),lM(_.current,A.current,D).then(N=>{const K={...N,isPositioned:O.current!==!1};j.current&&!Od(I.current,K)&&(I.current=K,ya.flushSync(()=>{d(K)}))})},[f,e,t,P,O]);Yu(()=>{c===!1&&I.current.isPositioned&&(I.current.isPositioned=!1,d(D=>({...D,isPositioned:!1})))},[c]);const j=E.useRef(!1);Yu(()=>(j.current=!0,()=>{j.current=!1}),[]),Yu(()=>{if(b&&(_.current=b),w&&(A.current=w),b&&w){if(R.current)return R.current(b,w,U);U()}},[b,w,U,R,C]);const G=E.useMemo(()=>({reference:_,floating:A,setReference:y,setFloating:S}),[y,S]),$=E.useMemo(()=>({reference:b,floating:w}),[b,w]),Y=E.useMemo(()=>{const D={position:t,left:0,top:0};if(!$.floating)return D;const N=Px($.floating,u.x),K=Px($.floating,u.y);return o?{...D,transform:"translate("+N+"px, "+K+"px)",...AA($.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:N,top:K}},[t,o,$.floating,u.x,u.y]);return E.useMemo(()=>({...u,update:U,refs:G,elements:$,floatingStyles:Y}),[u,U,G,$,Y])}const uM=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:s}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?Dx({element:r.current,padding:s}).fn(t):{}:r?Dx({element:r,padding:s}).fn(t):{}}}},dM=(n,e)=>({...nM(n),options:[n,e]}),fM=(n,e)=>({...rM(n),options:[n,e]}),hM=(n,e)=>({...oM(n),options:[n,e]}),mM=(n,e)=>({...sM(n),options:[n,e]}),pM=(n,e)=>({...iM(n),options:[n,e]}),gM=(n,e)=>({...aM(n),options:[n,e]}),yM=(n,e)=>({...uM(n),options:[n,e]});var vM="Arrow",_A=E.forwardRef((n,e)=>{const{children:t,width:r=10,height:s=5,...i}=n;return h.jsx(xe.svg,{...i,ref:e,width:r,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});_A.displayName=vM;var xM=_A;function SM(n){const[e,t]=E.useState(void 0);return Nt(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const i=s[0];let a,o;if("borderBoxSize"in i){const l=i.borderBoxSize,c=Array.isArray(l)?l[0]:l;a=c.inlineSize,o=c.blockSize}else a=n.offsetWidth,o=n.offsetHeight;t({width:a,height:o})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}var M0="Popper",[IA,Wo]=Ir(M0),[EM,RA]=IA(M0),CA=n=>{const{__scopePopper:e,children:t}=n,[r,s]=E.useState(null);return h.jsx(EM,{scope:e,anchor:r,onAnchorChange:s,children:t})};CA.displayName=M0;var LA="PopperAnchor",kA=E.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...s}=n,i=RA(LA,t),a=E.useRef(null),o=He(e,a);return E.useEffect(()=>{i.onAnchorChange((r==null?void 0:r.current)||a.current)}),r?null:h.jsx(xe.div,{...s,ref:o})});kA.displayName=LA;var F0="PopperContent",[TM,bM]=IA(F0),DA=E.forwardRef((n,e)=>{var ee,Se,Ae,_e,De,Ve;const{__scopePopper:t,side:r="bottom",sideOffset:s=0,align:i="center",alignOffset:a=0,arrowPadding:o=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:m="optimized",onPlaced:p,...g}=n,v=RA(F0,t),[x,y]=E.useState(null),S=He(e,_t=>y(_t)),[b,w]=E.useState(null),_=SM(b),A=(_==null?void 0:_.width)??0,I=(_==null?void 0:_.height)??0,C=r+(i!=="center"?"-"+i:""),R=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},P=Array.isArray(c)?c:[c],O=P.length>0,U={padding:R,boundary:P.filter(AM),altBoundary:O},{refs:j,floatingStyles:G,placement:$,isPositioned:Y,middlewareData:D}=cM({strategy:"fixed",placement:C,whileElementsMounted:(..._t)=>tM(..._t,{animationFrame:m==="always"}),elements:{reference:v.anchor},middleware:[dM({mainAxis:s+I,alignmentAxis:a}),l&&fM({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?hM():void 0,...U}),l&&mM({...U}),pM({...U,apply:({elements:_t,rects:jt,availableWidth:Ls,availableHeight:Ce})=>{const{width:it,height:zt}=jt.reference,gn=_t.floating.style;gn.setProperty("--radix-popper-available-width",`${Ls}px`),gn.setProperty("--radix-popper-available-height",`${Ce}px`),gn.setProperty("--radix-popper-anchor-width",`${it}px`),gn.setProperty("--radix-popper-anchor-height",`${zt}px`)}}),b&&yM({element:b,padding:o}),_M({arrowWidth:A,arrowHeight:I}),f&&gM({strategy:"referenceHidden",...U})]}),[N,K]=OA($),V=Ht(p);Nt(()=>{Y&&(V==null||V())},[Y,V]);const W=(ee=D.arrow)==null?void 0:ee.x,de=(Se=D.arrow)==null?void 0:Se.y,pe=((Ae=D.arrow)==null?void 0:Ae.centerOffset)!==0,[ge,me]=E.useState();return Nt(()=>{x&&me(window.getComputedStyle(x).zIndex)},[x]),h.jsx("div",{ref:j.setFloating,"data-radix-popper-content-wrapper":"",style:{...G,transform:Y?G.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ge,"--radix-popper-transform-origin":[(_e=D.transformOrigin)==null?void 0:_e.x,(De=D.transformOrigin)==null?void 0:De.y].join(" "),...((Ve=D.hide)==null?void 0:Ve.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:h.jsx(TM,{scope:t,placedSide:N,onArrowChange:w,arrowX:W,arrowY:de,shouldHideArrow:pe,children:h.jsx(xe.div,{"data-side":N,"data-align":K,...g,ref:S,style:{...g.style,animation:Y?void 0:"none"}})})})});DA.displayName=F0;var PA="PopperArrow",wM={top:"bottom",right:"left",bottom:"top",left:"right"},NA=E.forwardRef(function(e,t){const{__scopePopper:r,...s}=e,i=bM(PA,r),a=wM[i.placedSide];return h.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[a]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:h.jsx(xM,{...s,ref:t,style:{...s.style,display:"block"}})})});NA.displayName=PA;function AM(n){return n!==null}var _M=n=>({name:"transformOrigin",options:n,fn(e){var v,x,y;const{placement:t,rects:r,middlewareData:s}=e,a=((v=s.arrow)==null?void 0:v.centerOffset)!==0,o=a?0:n.arrowWidth,l=a?0:n.arrowHeight,[c,u]=OA(t),d={start:"0%",center:"50%",end:"100%"}[u],f=(((x=s.arrow)==null?void 0:x.x)??0)+o/2,m=(((y=s.arrow)==null?void 0:y.y)??0)+l/2;let p="",g="";return c==="bottom"?(p=a?d:`${f}px`,g=`${-l}px`):c==="top"?(p=a?d:`${f}px`,g=`${r.floating.height+l}px`):c==="right"?(p=`${-l}px`,g=a?d:`${m}px`):c==="left"&&(p=`${r.floating.width+l}px`,g=a?d:`${m}px`),{data:{x:p,y:g}}}});function OA(n){const[e,t="center"]=n.split("-");return[e,t]}var j0=CA,$0=kA,U0=DA,B0=NA,[Mf,uK]=Ir("Tooltip",[Wo]),Ff=Wo(),MA="TooltipProvider",IM=700,jp="tooltip.open",[RM,V0]=Mf(MA),FA=n=>{const{__scopeTooltip:e,delayDuration:t=IM,skipDelayDuration:r=300,disableHoverableContent:s=!1,children:i}=n,a=E.useRef(!0),o=E.useRef(!1),l=E.useRef(0);return E.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),h.jsx(RM,{scope:e,isOpenDelayedRef:a,delayDuration:t,onOpen:E.useCallback(()=>{window.clearTimeout(l.current),a.current=!1},[]),onClose:E.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>a.current=!0,r)},[r]),isPointerInTransitRef:o,onPointerInTransitChange:E.useCallback(c=>{o.current=c},[]),disableHoverableContent:s,children:i})};FA.displayName=MA;var jf="Tooltip",[CM,$f]=Mf(jf),jA=n=>{const{__scopeTooltip:e,children:t,open:r,defaultOpen:s=!1,onOpenChange:i,disableHoverableContent:a,delayDuration:o}=n,l=V0(jf,n.__scopeTooltip),c=Ff(e),[u,d]=E.useState(null),f=xr(),m=E.useRef(0),p=a??l.disableHoverableContent,g=o??l.delayDuration,v=E.useRef(!1),[x=!1,y]=hi({prop:r,defaultProp:s,onChange:A=>{A?(l.onOpen(),document.dispatchEvent(new CustomEvent(jp))):l.onClose(),i==null||i(A)}}),S=E.useMemo(()=>x?v.current?"delayed-open":"instant-open":"closed",[x]),b=E.useCallback(()=>{window.clearTimeout(m.current),m.current=0,v.current=!1,y(!0)},[y]),w=E.useCallback(()=>{window.clearTimeout(m.current),m.current=0,y(!1)},[y]),_=E.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>{v.current=!0,y(!0),m.current=0},g)},[g,y]);return E.useEffect(()=>()=>{m.current&&(window.clearTimeout(m.current),m.current=0)},[]),h.jsx(j0,{...c,children:h.jsx(CM,{scope:e,contentId:f,open:x,stateAttribute:S,trigger:u,onTriggerChange:d,onTriggerEnter:E.useCallback(()=>{l.isOpenDelayedRef.current?_():b()},[l.isOpenDelayedRef,_,b]),onTriggerLeave:E.useCallback(()=>{p?w():(window.clearTimeout(m.current),m.current=0)},[w,p]),onOpen:b,onClose:w,disableHoverableContent:p,children:t})})};jA.displayName=jf;var $p="TooltipTrigger",$A=E.forwardRef((n,e)=>{const{__scopeTooltip:t,...r}=n,s=$f($p,t),i=V0($p,t),a=Ff(t),o=E.useRef(null),l=He(e,o,s.onTriggerChange),c=E.useRef(!1),u=E.useRef(!1),d=E.useCallback(()=>c.current=!1,[]);return E.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),h.jsx($0,{asChild:!0,...a,children:h.jsx(xe.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...r,ref:l,onPointerMove:ne(n.onPointerMove,f=>{f.pointerType!=="touch"&&!u.current&&!i.isPointerInTransitRef.current&&(s.onTriggerEnter(),u.current=!0)}),onPointerLeave:ne(n.onPointerLeave,()=>{s.onTriggerLeave(),u.current=!1}),onPointerDown:ne(n.onPointerDown,()=>{s.open&&s.onClose(),c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:ne(n.onFocus,()=>{c.current||s.onOpen()}),onBlur:ne(n.onBlur,s.onClose),onClick:ne(n.onClick,s.onClose)})})});$A.displayName=$p;var LM="TooltipPortal",[dK,kM]=Mf(LM,{forceMount:void 0}),Do="TooltipContent",UA=E.forwardRef((n,e)=>{const t=kM(Do,n.__scopeTooltip),{forceMount:r=t.forceMount,side:s="top",...i}=n,a=$f(Do,n.__scopeTooltip);return h.jsx(Rr,{present:r||a.open,children:a.disableHoverableContent?h.jsx(BA,{side:s,...i,ref:e}):h.jsx(DM,{side:s,...i,ref:e})})}),DM=E.forwardRef((n,e)=>{const t=$f(Do,n.__scopeTooltip),r=V0(Do,n.__scopeTooltip),s=E.useRef(null),i=He(e,s),[a,o]=E.useState(null),{trigger:l,onClose:c}=t,u=s.current,{onPointerInTransitChange:d}=r,f=E.useCallback(()=>{o(null),d(!1)},[d]),m=E.useCallback((p,g)=>{const v=p.currentTarget,x={x:p.clientX,y:p.clientY},y=FM(x,v.getBoundingClientRect()),S=jM(x,y),b=$M(g.getBoundingClientRect()),w=BM([...S,...b]);o(w),d(!0)},[d]);return E.useEffect(()=>()=>f(),[f]),E.useEffect(()=>{if(l&&u){const p=v=>m(v,u),g=v=>m(v,l);return l.addEventListener("pointerleave",p),u.addEventListener("pointerleave",g),()=>{l.removeEventListener("pointerleave",p),u.removeEventListener("pointerleave",g)}}},[l,u,m,f]),E.useEffect(()=>{if(a){const p=g=>{const v=g.target,x={x:g.clientX,y:g.clientY},y=(l==null?void 0:l.contains(v))||(u==null?void 0:u.contains(v)),S=!UM(x,a);y?f():S&&(f(),c())};return document.addEventListener("pointermove",p),()=>document.removeEventListener("pointermove",p)}},[l,u,a,c,f]),h.jsx(BA,{...n,ref:i})}),[PM,NM]=Mf(jf,{isInside:!1}),OM=DP("TooltipContent"),BA=E.forwardRef((n,e)=>{const{__scopeTooltip:t,children:r,"aria-label":s,onEscapeKeyDown:i,onPointerDownOutside:a,...o}=n,l=$f(Do,t),c=Ff(t),{onClose:u}=l;return E.useEffect(()=>(document.addEventListener(jp,u),()=>document.removeEventListener(jp,u)),[u]),E.useEffect(()=>{if(l.trigger){const d=f=>{const m=f.target;m!=null&&m.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),h.jsx(Go,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:a,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:h.jsxs(U0,{"data-state":l.stateAttribute,...c,...o,ref:e,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[h.jsx(OM,{children:r}),h.jsx(PM,{scope:t,isInside:!0,children:h.jsx(ZP,{id:l.contentId,role:"tooltip",children:s||r})})]})})});UA.displayName=Do;var VA="TooltipArrow",MM=E.forwardRef((n,e)=>{const{__scopeTooltip:t,...r}=n,s=Ff(t);return NM(VA,t).isInside?null:h.jsx(B0,{...s,...r,ref:e})});MM.displayName=VA;function FM(n,e){const t=Math.abs(e.top-n.y),r=Math.abs(e.bottom-n.y),s=Math.abs(e.right-n.x),i=Math.abs(e.left-n.x);switch(Math.min(t,r,s,i)){case i:return"left";case s:return"right";case t:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function jM(n,e,t=5){const r=[];switch(e){case"top":r.push({x:n.x-t,y:n.y+t},{x:n.x+t,y:n.y+t});break;case"bottom":r.push({x:n.x-t,y:n.y-t},{x:n.x+t,y:n.y-t});break;case"left":r.push({x:n.x+t,y:n.y-t},{x:n.x+t,y:n.y+t});break;case"right":r.push({x:n.x-t,y:n.y-t},{x:n.x-t,y:n.y+t});break}return r}function $M(n){const{top:e,right:t,bottom:r,left:s}=n;return[{x:s,y:e},{x:t,y:e},{x:t,y:r},{x:s,y:r}]}function UM(n,e){const{x:t,y:r}=n;let s=!1;for(let i=0,a=e.length-1;i<e.length;a=i++){const o=e[i].x,l=e[i].y,c=e[a].x,u=e[a].y;l>r!=u>r&&t<(c-o)*(r-l)/(u-l)+o&&(s=!s)}return s}function BM(n){const e=n.slice();return e.sort((t,r)=>t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0),VM(e)}function VM(n){if(n.length<=1)return n.slice();const e=[];for(let r=0;r<n.length;r++){const s=n[r];for(;e.length>=2;){const i=e[e.length-1],a=e[e.length-2];if((i.x-a.x)*(s.y-a.y)>=(i.y-a.y)*(s.x-a.x))e.pop();else break}e.push(s)}e.pop();const t=[];for(let r=n.length-1;r>=0;r--){const s=n[r];for(;t.length>=2;){const i=t[t.length-1],a=t[t.length-2];if((i.x-a.x)*(s.y-a.y)>=(i.y-a.y)*(s.x-a.x))t.pop();else break}t.push(s)}return t.pop(),e.length===1&&t.length===1&&e[0].x===t[0].x&&e[0].y===t[0].y?e:e.concat(t)}var GM=FA,KM=jA,HM=$A,GA=UA;const KA=GM,zM=KM,WM=HM,HA=E.forwardRef(({className:n,sideOffset:e=4,...t},r)=>h.jsx(GA,{ref:r,sideOffset:e,className:J("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",n),...t}));HA.displayName=GA.displayName;const Gh=768;function YM(){const[n,e]=E.useState(void 0);return E.useEffect(()=>{const t=window.matchMedia(`(max-width: ${Gh-1}px)`),r=()=>{e(window.innerWidth<Gh)};return t.addEventListener("change",r),e(window.innerWidth<Gh),()=>t.removeEventListener("change",r)},[]),!!n}const qM=va("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover-elevate active-elevate-2",{variants:{variant:{default:"bg-primary text-primary-foreground border border-primary-border",destructive:"bg-destructive text-destructive-foreground border border-destructive-border",outline:" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none ",secondary:"border bg-secondary text-secondary-foreground border border-secondary-border ",ghost:"border border-transparent"},size:{default:"min-h-9 px-4 py-2",sm:"min-h-8 rounded-md px-3 text-xs",lg:"min-h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),be=E.forwardRef(({className:n,variant:e,size:t,asChild:r=!1,...s},i)=>{const a=r?S0:"button";return h.jsx(a,{className:J(qM({variant:e,size:t,className:n})),ref:i,...s})});be.displayName="Button";const Xe=E.forwardRef(({className:n,type:e,...t},r)=>h.jsx("input",{type:e,className:J("flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:r,...t}));Xe.displayName="Input";var QM="Separator",Nx="horizontal",XM=["horizontal","vertical"],zA=E.forwardRef((n,e)=>{const{decorative:t,orientation:r=Nx,...s}=n,i=ZM(r)?r:Nx,o=t?{role:"none"}:{"aria-orientation":i==="vertical"?i:void 0,role:"separator"};return h.jsx(xe.div,{"data-orientation":i,...o,...s,ref:e})});zA.displayName=QM;function ZM(n){return XM.includes(n)}var WA=zA;const JM=E.forwardRef(({className:n,orientation:e="horizontal",decorative:t=!0,...r},s)=>h.jsx(WA,{ref:s,decorative:t,orientation:e,className:J("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",n),...r}));JM.displayName=WA.displayName;var Kh="focusScope.autoFocusOnMount",Hh="focusScope.autoFocusOnUnmount",Ox={bubbles:!1,cancelable:!0},eF="FocusScope",Uf=E.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:s,onUnmountAutoFocus:i,...a}=n,[o,l]=E.useState(null),c=Ht(s),u=Ht(i),d=E.useRef(null),f=He(e,g=>l(g)),m=E.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;E.useEffect(()=>{if(r){let g=function(S){if(m.paused||!o)return;const b=S.target;o.contains(b)?d.current=b:Fs(d.current,{select:!0})},v=function(S){if(m.paused||!o)return;const b=S.relatedTarget;b!==null&&(o.contains(b)||Fs(d.current,{select:!0}))},x=function(S){if(document.activeElement===document.body)for(const w of S)w.removedNodes.length>0&&Fs(o)};document.addEventListener("focusin",g),document.addEventListener("focusout",v);const y=new MutationObserver(x);return o&&y.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",v),y.disconnect()}}},[r,o,m.paused]),E.useEffect(()=>{if(o){Fx.add(m);const g=document.activeElement;if(!o.contains(g)){const x=new CustomEvent(Kh,Ox);o.addEventListener(Kh,c),o.dispatchEvent(x),x.defaultPrevented||(tF(aF(YA(o)),{select:!0}),document.activeElement===g&&Fs(o))}return()=>{o.removeEventListener(Kh,c),setTimeout(()=>{const x=new CustomEvent(Hh,Ox);o.addEventListener(Hh,u),o.dispatchEvent(x),x.defaultPrevented||Fs(g??document.body,{select:!0}),o.removeEventListener(Hh,u),Fx.remove(m)},0)}}},[o,c,u,m]);const p=E.useCallback(g=>{if(!t&&!r||m.paused)return;const v=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,x=document.activeElement;if(v&&x){const y=g.currentTarget,[S,b]=nF(y);S&&b?!g.shiftKey&&x===b?(g.preventDefault(),t&&Fs(S,{select:!0})):g.shiftKey&&x===S&&(g.preventDefault(),t&&Fs(b,{select:!0})):x===y&&g.preventDefault()}},[t,r,m.paused]);return h.jsx(xe.div,{tabIndex:-1,...a,ref:f,onKeyDown:p})});Uf.displayName=eF;function tF(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(Fs(r,{select:e}),document.activeElement!==t)return}function nF(n){const e=YA(n),t=Mx(e,n),r=Mx(e.reverse(),n);return[t,r]}function YA(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const s=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||s?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function Mx(n,e){for(const t of n)if(!rF(t,{upTo:e}))return t}function rF(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function sF(n){return n instanceof HTMLInputElement&&"select"in n}function Fs(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&sF(n)&&e&&n.select()}}var Fx=iF();function iF(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=jx(n,e),n.unshift(e)},remove(e){var t;n=jx(n,e),(t=n[0])==null||t.resume()}}}function jx(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function aF(n){return n.filter(e=>e.tagName!=="A")}var zh=0;function G0(){E.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??$x()),document.body.insertAdjacentElement("beforeend",n[1]??$x()),zh++,()=>{zh===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),zh--}},[])}function $x(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var Vr=function(){return Vr=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Vr.apply(this,arguments)};function qA(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function oF(n,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var qu="right-scroll-bar-position",Qu="width-before-scroll-bar",lF="with-scroll-bars-hidden",cF="--removed-body-scroll-bar-size";function Wh(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function uF(n,e){var t=E.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var s=t.value;s!==r&&(t.value=r,t.callback(r,s))}}}})[0];return t.callback=e,t.facade}var dF=typeof window<"u"?E.useLayoutEffect:E.useEffect,Ux=new WeakMap;function fF(n,e){var t=uF(null,function(r){return n.forEach(function(s){return Wh(s,r)})});return dF(function(){var r=Ux.get(t);if(r){var s=new Set(r),i=new Set(n),a=t.current;s.forEach(function(o){i.has(o)||Wh(o,null)}),i.forEach(function(o){s.has(o)||Wh(o,a)})}Ux.set(t,n)},[n]),t}function hF(n){return n}function mF(n,e){e===void 0&&(e=hF);var t=[],r=!1,s={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(i){var a=e(i,r);return t.push(a),function(){t=t.filter(function(o){return o!==a})}},assignSyncMedium:function(i){for(r=!0;t.length;){var a=t;t=[],a.forEach(i)}t={push:function(o){return i(o)},filter:function(){return t}}},assignMedium:function(i){r=!0;var a=[];if(t.length){var o=t;t=[],o.forEach(i),a=t}var l=function(){var u=a;a=[],u.forEach(i)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(u){a.push(u),c()},filter:function(u){return a=a.filter(u),t}}}};return s}function pF(n){n===void 0&&(n={});var e=mF(null);return e.options=Vr({async:!0,ssr:!1},n),e}var QA=function(n){var e=n.sideCar,t=qA(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return E.createElement(r,Vr({},t))};QA.isSideCarExport=!0;function gF(n,e){return n.useMedium(e),QA}var XA=pF(),Yh=function(){},Bf=E.forwardRef(function(n,e){var t=E.useRef(null),r=E.useState({onScrollCapture:Yh,onWheelCapture:Yh,onTouchMoveCapture:Yh}),s=r[0],i=r[1],a=n.forwardProps,o=n.children,l=n.className,c=n.removeScrollBar,u=n.enabled,d=n.shards,f=n.sideCar,m=n.noIsolation,p=n.inert,g=n.allowPinchZoom,v=n.as,x=v===void 0?"div":v,y=n.gapMode,S=qA(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),b=f,w=fF([t,e]),_=Vr(Vr({},S),s);return E.createElement(E.Fragment,null,u&&E.createElement(b,{sideCar:XA,removeScrollBar:c,shards:d,noIsolation:m,inert:p,setCallbacks:i,allowPinchZoom:!!g,lockRef:t,gapMode:y}),a?E.cloneElement(E.Children.only(o),Vr(Vr({},_),{ref:w})):E.createElement(x,Vr({},_,{className:l,ref:w}),o))});Bf.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Bf.classNames={fullWidth:Qu,zeroRight:qu};var yF=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function vF(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=yF();return e&&n.setAttribute("nonce",e),n}function xF(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function SF(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var EF=function(){var n=0,e=null;return{add:function(t){n==0&&(e=vF())&&(xF(e,t),SF(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},TF=function(){var n=EF();return function(e,t){E.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},ZA=function(){var n=TF(),e=function(t){var r=t.styles,s=t.dynamic;return n(r,s),null};return e},bF={left:0,top:0,right:0,gap:0},qh=function(n){return parseInt(n||"",10)||0},wF=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],s=e[n==="padding"?"paddingRight":"marginRight"];return[qh(t),qh(r),qh(s)]},AF=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return bF;var e=wF(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},_F=ZA(),ro="data-scroll-locked",IF=function(n,e,t,r){var s=n.left,i=n.top,a=n.right,o=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(lF,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(o,"px ").concat(r,`;
  }
  body[`).concat(ro,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(o,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(qu,` {
    right: `).concat(o,"px ").concat(r,`;
  }
  
  .`).concat(Qu,` {
    margin-right: `).concat(o,"px ").concat(r,`;
  }
  
  .`).concat(qu," .").concat(qu,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Qu," .").concat(Qu,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(ro,`] {
    `).concat(cF,": ").concat(o,`px;
  }
`)},Bx=function(){var n=parseInt(document.body.getAttribute(ro)||"0",10);return isFinite(n)?n:0},RF=function(){E.useEffect(function(){return document.body.setAttribute(ro,(Bx()+1).toString()),function(){var n=Bx()-1;n<=0?document.body.removeAttribute(ro):document.body.setAttribute(ro,n.toString())}},[])},CF=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,s=r===void 0?"margin":r;RF();var i=E.useMemo(function(){return AF(s)},[s]);return E.createElement(_F,{styles:IF(i,!e,s,t?"":"!important")})},Up=!1;if(typeof window<"u")try{var fu=Object.defineProperty({},"passive",{get:function(){return Up=!0,!0}});window.addEventListener("test",fu,fu),window.removeEventListener("test",fu,fu)}catch{Up=!1}var ba=Up?{passive:!1}:!1,LF=function(n){return n.tagName==="TEXTAREA"},JA=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!LF(n)&&t[e]==="visible")},kF=function(n){return JA(n,"overflowY")},DF=function(n){return JA(n,"overflowX")},Vx=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var s=e_(n,r);if(s){var i=t_(n,r),a=i[1],o=i[2];if(a>o)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},PF=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},NF=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},e_=function(n,e){return n==="v"?kF(e):DF(e)},t_=function(n,e){return n==="v"?PF(e):NF(e)},OF=function(n,e){return n==="h"&&e==="rtl"?-1:1},MF=function(n,e,t,r,s){var i=OF(n,window.getComputedStyle(e).direction),a=i*r,o=t.target,l=e.contains(o),c=!1,u=a>0,d=0,f=0;do{var m=t_(n,o),p=m[0],g=m[1],v=m[2],x=g-v-i*p;(p||x)&&e_(n,o)&&(d+=x,f+=p),o instanceof ShadowRoot?o=o.host:o=o.parentNode}while(!l&&o!==document.body||l&&(e.contains(o)||e===o));return(u&&(Math.abs(d)<1||!s)||!u&&(Math.abs(f)<1||!s))&&(c=!0),c},hu=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},Gx=function(n){return[n.deltaX,n.deltaY]},Kx=function(n){return n&&"current"in n?n.current:n},FF=function(n,e){return n[0]===e[0]&&n[1]===e[1]},jF=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},$F=0,wa=[];function UF(n){var e=E.useRef([]),t=E.useRef([0,0]),r=E.useRef(),s=E.useState($F++)[0],i=E.useState(ZA)[0],a=E.useRef(n);E.useEffect(function(){a.current=n},[n]),E.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(s));var g=oF([n.lockRef.current],(n.shards||[]).map(Kx),!0).filter(Boolean);return g.forEach(function(v){return v.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),g.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(s))})}}},[n.inert,n.lockRef.current,n.shards]);var o=E.useCallback(function(g,v){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!a.current.allowPinchZoom;var x=hu(g),y=t.current,S="deltaX"in g?g.deltaX:y[0]-x[0],b="deltaY"in g?g.deltaY:y[1]-x[1],w,_=g.target,A=Math.abs(S)>Math.abs(b)?"h":"v";if("touches"in g&&A==="h"&&_.type==="range")return!1;var I=Vx(A,_);if(!I)return!0;if(I?w=A:(w=A==="v"?"h":"v",I=Vx(A,_)),!I)return!1;if(!r.current&&"changedTouches"in g&&(S||b)&&(r.current=w),!w)return!0;var C=r.current||w;return MF(C,v,g,C==="h"?S:b,!0)},[]),l=E.useCallback(function(g){var v=g;if(!(!wa.length||wa[wa.length-1]!==i)){var x="deltaY"in v?Gx(v):hu(v),y=e.current.filter(function(w){return w.name===v.type&&(w.target===v.target||v.target===w.shadowParent)&&FF(w.delta,x)})[0];if(y&&y.should){v.cancelable&&v.preventDefault();return}if(!y){var S=(a.current.shards||[]).map(Kx).filter(Boolean).filter(function(w){return w.contains(v.target)}),b=S.length>0?o(v,S[0]):!a.current.noIsolation;b&&v.cancelable&&v.preventDefault()}}},[]),c=E.useCallback(function(g,v,x,y){var S={name:g,delta:v,target:x,should:y,shadowParent:BF(x)};e.current.push(S),setTimeout(function(){e.current=e.current.filter(function(b){return b!==S})},1)},[]),u=E.useCallback(function(g){t.current=hu(g),r.current=void 0},[]),d=E.useCallback(function(g){c(g.type,Gx(g),g.target,o(g,n.lockRef.current))},[]),f=E.useCallback(function(g){c(g.type,hu(g),g.target,o(g,n.lockRef.current))},[]);E.useEffect(function(){return wa.push(i),n.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",l,ba),document.addEventListener("touchmove",l,ba),document.addEventListener("touchstart",u,ba),function(){wa=wa.filter(function(g){return g!==i}),document.removeEventListener("wheel",l,ba),document.removeEventListener("touchmove",l,ba),document.removeEventListener("touchstart",u,ba)}},[]);var m=n.removeScrollBar,p=n.inert;return E.createElement(E.Fragment,null,p?E.createElement(i,{styles:jF(s)}):null,m?E.createElement(CF,{gapMode:n.gapMode}):null)}function BF(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const VF=gF(XA,UF);var Vf=E.forwardRef(function(n,e){return E.createElement(Bf,Vr({},n,{ref:e,sideCar:VF}))});Vf.classNames=Bf.classNames;var GF=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Aa=new WeakMap,mu=new WeakMap,pu={},Qh=0,n_=function(n){return n&&(n.host||n_(n.parentNode))},KF=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=n_(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},HF=function(n,e,t,r){var s=KF(e,Array.isArray(n)?n:[n]);pu[t]||(pu[t]=new WeakMap);var i=pu[t],a=[],o=new Set,l=new Set(s),c=function(d){!d||o.has(d)||(o.add(d),c(d.parentNode))};s.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(f){if(o.has(f))u(f);else try{var m=f.getAttribute(r),p=m!==null&&m!=="false",g=(Aa.get(f)||0)+1,v=(i.get(f)||0)+1;Aa.set(f,g),i.set(f,v),a.push(f),g===1&&p&&mu.set(f,!0),v===1&&f.setAttribute(t,"true"),p||f.setAttribute(r,"true")}catch(x){console.error("aria-hidden: cannot operate on ",f,x)}})};return u(e),o.clear(),Qh++,function(){a.forEach(function(d){var f=Aa.get(d)-1,m=i.get(d)-1;Aa.set(d,f),i.set(d,m),f||(mu.has(d)||d.removeAttribute(r),mu.delete(d)),m||d.removeAttribute(t)}),Qh--,Qh||(Aa=new WeakMap,Aa=new WeakMap,mu=new WeakMap,pu={})}},K0=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),s=GF(n);return s?(r.push.apply(r,Array.from(s.querySelectorAll("[aria-live]"))),HF(r,s,t,"aria-hidden")):function(){return null}},H0="Dialog",[r_,fK]=Ir(H0),[zF,Cr]=r_(H0),s_=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:s,onOpenChange:i,modal:a=!0}=n,o=E.useRef(null),l=E.useRef(null),[c=!1,u]=hi({prop:r,defaultProp:s,onChange:i});return h.jsx(zF,{scope:e,triggerRef:o,contentRef:l,contentId:xr(),titleId:xr(),descriptionId:xr(),open:c,onOpenChange:u,onOpenToggle:E.useCallback(()=>u(d=>!d),[u]),modal:a,children:t})};s_.displayName=H0;var i_="DialogTrigger",WF=E.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=Cr(i_,t),i=He(e,s.triggerRef);return h.jsx(xe.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":Y0(s.open),...r,ref:i,onClick:ne(n.onClick,s.onOpenToggle)})});WF.displayName=i_;var z0="DialogPortal",[YF,a_]=r_(z0,{forceMount:void 0}),o_=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:s}=n,i=Cr(z0,e);return h.jsx(YF,{scope:e,forceMount:t,children:E.Children.map(r,a=>h.jsx(Rr,{present:t||i.open,children:h.jsx(Mc,{asChild:!0,container:s,children:a})}))})};o_.displayName=z0;var Md="DialogOverlay",l_=E.forwardRef((n,e)=>{const t=a_(Md,n.__scopeDialog),{forceMount:r=t.forceMount,...s}=n,i=Cr(Md,n.__scopeDialog);return i.modal?h.jsx(Rr,{present:r||i.open,children:h.jsx(QF,{...s,ref:e})}):null});l_.displayName=Md;var qF=oa("DialogOverlay.RemoveScroll"),QF=E.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=Cr(Md,t);return h.jsx(Vf,{as:qF,allowPinchZoom:!0,shards:[s.contentRef],children:h.jsx(xe.div,{"data-state":Y0(s.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),ca="DialogContent",c_=E.forwardRef((n,e)=>{const t=a_(ca,n.__scopeDialog),{forceMount:r=t.forceMount,...s}=n,i=Cr(ca,n.__scopeDialog);return h.jsx(Rr,{present:r||i.open,children:i.modal?h.jsx(XF,{...s,ref:e}):h.jsx(ZF,{...s,ref:e})})});c_.displayName=ca;var XF=E.forwardRef((n,e)=>{const t=Cr(ca,n.__scopeDialog),r=E.useRef(null),s=He(e,t.contentRef,r);return E.useEffect(()=>{const i=r.current;if(i)return K0(i)},[]),h.jsx(u_,{...n,ref:s,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ne(n.onCloseAutoFocus,i=>{var a;i.preventDefault(),(a=t.triggerRef.current)==null||a.focus()}),onPointerDownOutside:ne(n.onPointerDownOutside,i=>{const a=i.detail.originalEvent,o=a.button===0&&a.ctrlKey===!0;(a.button===2||o)&&i.preventDefault()}),onFocusOutside:ne(n.onFocusOutside,i=>i.preventDefault())})}),ZF=E.forwardRef((n,e)=>{const t=Cr(ca,n.__scopeDialog),r=E.useRef(!1),s=E.useRef(!1);return h.jsx(u_,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var a,o;(a=n.onCloseAutoFocus)==null||a.call(n,i),i.defaultPrevented||(r.current||(o=t.triggerRef.current)==null||o.focus(),i.preventDefault()),r.current=!1,s.current=!1},onInteractOutside:i=>{var l,c;(l=n.onInteractOutside)==null||l.call(n,i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const a=i.target;((c=t.triggerRef.current)==null?void 0:c.contains(a))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&s.current&&i.preventDefault()}})}),u_=E.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:s,onCloseAutoFocus:i,...a}=n,o=Cr(ca,t),l=E.useRef(null),c=He(e,l);return G0(),h.jsxs(h.Fragment,{children:[h.jsx(Uf,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:s,onUnmountAutoFocus:i,children:h.jsx(Go,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":Y0(o.open),...a,ref:c,onDismiss:()=>o.onOpenChange(!1)})}),h.jsxs(h.Fragment,{children:[h.jsx(JF,{titleId:o.titleId}),h.jsx(t2,{contentRef:l,descriptionId:o.descriptionId})]})]})}),W0="DialogTitle",d_=E.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=Cr(W0,t);return h.jsx(xe.h2,{id:s.titleId,...r,ref:e})});d_.displayName=W0;var f_="DialogDescription",h_=E.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=Cr(f_,t);return h.jsx(xe.p,{id:s.descriptionId,...r,ref:e})});h_.displayName=f_;var m_="DialogClose",p_=E.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=Cr(m_,t);return h.jsx(xe.button,{type:"button",...r,ref:e,onClick:ne(n.onClick,()=>s.onOpenChange(!1))})});p_.displayName=m_;function Y0(n){return n?"open":"closed"}var g_="DialogTitleWarning",[hK,y_]=CP(g_,{contentName:ca,titleName:W0,docsSlug:"dialog"}),JF=({titleId:n})=>{const e=y_(g_),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return E.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},e2="DialogDescriptionWarning",t2=({contentRef:n,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${y_(e2).contentName}}.`;return E.useEffect(()=>{var i;const s=(i=n.current)==null?void 0:i.getAttribute("aria-describedby");e&&s&&(document.getElementById(e)||console.warn(r))},[r,n,e]),null},v_=s_,x_=o_,Gf=l_,Kf=c_,Hf=d_,zf=h_,S_=p_;const n2=v_,r2=x_,E_=E.forwardRef(({className:n,...e},t)=>h.jsx(Gf,{className:J("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...e,ref:t}));E_.displayName=Gf.displayName;const s2=va("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),T_=E.forwardRef(({side:n="right",className:e,children:t,...r},s)=>h.jsxs(r2,{children:[h.jsx(E_,{}),h.jsxs(Kf,{ref:s,className:J(s2({side:n}),e),...r,children:[t,h.jsxs(S_,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[h.jsx(I0,{className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));T_.displayName=Kf.displayName;const b_=({className:n,...e})=>h.jsx("div",{className:J("flex flex-col space-y-2 text-center sm:text-left",n),...e});b_.displayName="SheetHeader";const w_=E.forwardRef(({className:n,...e},t)=>h.jsx(Hf,{ref:t,className:J("text-lg font-semibold text-foreground",n),...e}));w_.displayName=Hf.displayName;const A_=E.forwardRef(({className:n,...e},t)=>h.jsx(zf,{ref:t,className:J("text-sm text-muted-foreground",n),...e}));A_.displayName=zf.displayName;const i2="sidebar_state",a2=60*60*24*7,o2="16rem",l2="18rem",c2="3rem",u2="b",__=E.createContext(null);function q0(){const n=E.useContext(__);if(!n)throw new Error("useSidebar must be used within a SidebarProvider.");return n}function d2({defaultOpen:n=!0,open:e,onOpenChange:t,className:r,style:s,children:i,...a}){const o=YM(),[l,c]=E.useState(!1),[u,d]=E.useState(n),f=e??u,m=E.useCallback(x=>{const y=typeof x=="function"?x(f):x;t?t(y):d(y),document.cookie=`${i2}=${y}; path=/; max-age=${a2}`},[t,f]),p=E.useCallback(()=>o?c(x=>!x):m(x=>!x),[o,m,c]);E.useEffect(()=>{const x=y=>{y.key===u2&&(y.metaKey||y.ctrlKey)&&(y.preventDefault(),p())};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[p]);const g=f?"expanded":"collapsed",v=E.useMemo(()=>({state:g,open:f,setOpen:m,isMobile:o,openMobile:l,setOpenMobile:c,toggleSidebar:p}),[g,f,m,o,l,c,p]);return h.jsx(__.Provider,{value:v,children:h.jsx(KA,{delayDuration:0,children:h.jsx("div",{"data-slot":"sidebar-wrapper",style:{"--sidebar-width":o2,"--sidebar-width-icon":c2,...s},className:J("group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",r),...a,children:i})})})}function f2({side:n="left",variant:e="sidebar",collapsible:t="offcanvas",className:r,children:s,...i}){const{isMobile:a,state:o,openMobile:l,setOpenMobile:c}=q0();return t==="none"?h.jsx("div",{"data-slot":"sidebar",className:J("bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col",r),...i,children:s}):a?h.jsx(n2,{open:l,onOpenChange:c,...i,children:h.jsxs(T_,{"data-sidebar":"sidebar","data-slot":"sidebar","data-mobile":"true",className:"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden",style:{"--sidebar-width":l2},side:n,children:[h.jsxs(b_,{className:"sr-only",children:[h.jsx(w_,{children:"Sidebar"}),h.jsx(A_,{children:"Displays the mobile sidebar."})]}),h.jsx("div",{className:"flex h-full w-full flex-col",children:s})]})}):h.jsxs("div",{className:"group peer text-sidebar-foreground hidden md:block","data-state":o,"data-collapsible":o==="collapsed"?t:"","data-variant":e,"data-side":n,"data-slot":"sidebar",children:[h.jsx("div",{"data-slot":"sidebar-gap",className:J("relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",e==="floating"||e==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]":"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]")}),h.jsx("div",{"data-slot":"sidebar-container",className:J("fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex",n==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",e==="floating"||e==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]":"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l",r),...i,children:h.jsx("div",{"data-sidebar":"sidebar","data-slot":"sidebar-inner",className:"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm",children:s})})]})}function h2({className:n,onClick:e,...t}){const{toggleSidebar:r}=q0();return h.jsxs(be,{"data-sidebar":"trigger","data-slot":"sidebar-trigger",variant:"ghost",size:"icon",className:J("h-7 w-7",n),onClick:s=>{e==null||e(s),r()},...t,children:[h.jsx(kN,{}),h.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})}function m2({className:n,...e}){return h.jsx("div",{"data-slot":"sidebar-header","data-sidebar":"header",className:J("flex flex-col gap-2 p-2",n),...e})}function p2({className:n,...e}){return h.jsx("div",{"data-slot":"sidebar-footer","data-sidebar":"footer",className:J("flex flex-col gap-2 p-2",n),...e})}function g2({className:n,...e}){return h.jsx("div",{"data-slot":"sidebar-content","data-sidebar":"content",className:J("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",n),...e})}function y2({className:n,...e}){return h.jsx("div",{"data-slot":"sidebar-group","data-sidebar":"group",className:J("relative flex w-full min-w-0 flex-col p-2",n),...e})}function v2({className:n,asChild:e=!1,...t}){const r=e?S0:"div";return h.jsx(r,{"data-slot":"sidebar-group-label","data-sidebar":"group-label",className:J("text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",n),...t})}function x2({className:n,...e}){return h.jsx("div",{"data-slot":"sidebar-group-content","data-sidebar":"group-content",className:J("w-full text-sm",n),...e})}function S2({className:n,...e}){return h.jsx("ul",{"data-slot":"sidebar-menu","data-sidebar":"menu",className:J("flex w-full min-w-0 flex-col gap-1",n),...e})}function E2({className:n,...e}){return h.jsx("li",{"data-slot":"sidebar-menu-item","data-sidebar":"menu-item",className:J("group/menu-item relative",n),...e})}const T2=va("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:p-0!"}},defaultVariants:{variant:"default",size:"default"}});function b2({asChild:n=!1,isActive:e=!1,variant:t="default",size:r="default",tooltip:s,className:i,...a}){const o=n?S0:"button",{isMobile:l,state:c}=q0(),u=h.jsx(o,{"data-slot":"sidebar-menu-button","data-sidebar":"menu-button","data-size":r,"data-active":e,className:J(T2({variant:t,size:r}),i),...a});return s?(typeof s=="string"&&(s={children:s}),h.jsxs(zM,{children:[h.jsx(WM,{asChild:!0,children:u}),h.jsx(HA,{side:"right",align:"center",hidden:c!=="collapsed"||l,...s})]})):u}var Q0="Avatar",[w2,mK]=Ir(Q0),[A2,I_]=w2(Q0),R_=E.forwardRef((n,e)=>{const{__scopeAvatar:t,...r}=n,[s,i]=E.useState("idle");return h.jsx(A2,{scope:t,imageLoadingStatus:s,onImageLoadingStatusChange:i,children:h.jsx(xe.span,{...r,ref:e})})});R_.displayName=Q0;var C_="AvatarImage",L_=E.forwardRef((n,e)=>{const{__scopeAvatar:t,src:r,onLoadingStatusChange:s=()=>{},...i}=n,a=I_(C_,t),o=_2(r,i),l=Ht(c=>{s(c),a.onImageLoadingStatusChange(c)});return Nt(()=>{o!=="idle"&&l(o)},[o,l]),o==="loaded"?h.jsx(xe.img,{...i,ref:e,src:r}):null});L_.displayName=C_;var k_="AvatarFallback",D_=E.forwardRef((n,e)=>{const{__scopeAvatar:t,delayMs:r,...s}=n,i=I_(k_,t),[a,o]=E.useState(r===void 0);return E.useEffect(()=>{if(r!==void 0){const l=window.setTimeout(()=>o(!0),r);return()=>window.clearTimeout(l)}},[r]),a&&i.imageLoadingStatus!=="loaded"?h.jsx(xe.span,{...s,ref:e}):null});D_.displayName=k_;function Hx(n,e){return n?e?(n.src!==e&&(n.src=e),n.complete&&n.naturalWidth>0?"loaded":"loading"):"error":"idle"}function _2(n,{referrerPolicy:e,crossOrigin:t}){const r=R2(),s=E.useRef(null),i=r?(s.current||(s.current=new window.Image),s.current):null,[a,o]=E.useState(()=>Hx(i,n));return Nt(()=>{o(Hx(i,n))},[i,n]),Nt(()=>{const l=d=>()=>{o(d)};if(!i)return;const c=l("loaded"),u=l("error");return i.addEventListener("load",c),i.addEventListener("error",u),e&&(i.referrerPolicy=e),typeof t=="string"&&(i.crossOrigin=t),()=>{i.removeEventListener("load",c),i.removeEventListener("error",u)}},[i,t,e]),a}function I2(){return()=>{}}function R2(){return E.useSyncExternalStore(I2,()=>!0,()=>!1)}var P_=R_,N_=L_,O_=D_;const Yo=E.forwardRef(({className:n,...e},t)=>h.jsx(P_,{ref:t,className:J(`
      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10
      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,n),...e}));Yo.displayName=P_.displayName;const X0=E.forwardRef(({className:n,...e},t)=>h.jsx(N_,{ref:t,className:J("aspect-square h-full w-full",n),...e}));X0.displayName=N_.displayName;const qo=E.forwardRef(({className:n,...e},t)=>h.jsx(O_,{ref:t,className:J("flex h-full w-full items-center justify-center rounded-full bg-muted",n),...e}));qo.displayName=O_.displayName;const C2=va("whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 hover-elevate ",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow-xs",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground shadow-xs",outline:" border [border-color:var(--badge-outline)] shadow-xs"}},defaultVariants:{variant:"default"}});function Rn({className:n,variant:e,...t}){return h.jsx("div",{className:J(C2({variant:e}),n),...t})}const L2=[{title:"Tng quan",url:"/",icon:IN},{title:"Khch hng",url:"/customers",icon:iA},{title:"Lch khm",url:"/appointments",icon:kf,badge:5},{title:"H s khm",url:"/medical-records",icon:Df},{title:"Kho thuc",url:"/inventory",icon:A0,badge:8},{title:"Ha n",url:"/invoices",icon:Dl},{title:"Camera",url:"/cameras",icon:Jw}];function k2(){const[n]=dw();return h.jsxs(f2,{children:[h.jsx(m2,{className:"border-b p-4",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-primary text-primary-foreground",children:h.jsx(NN,{className:"h-6 w-6"})}),h.jsxs("div",{children:[h.jsx("h2",{className:"font-serif text-lg font-bold",children:""}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Qun l phng khm"})]})]})}),h.jsx(g2,{children:h.jsxs(y2,{children:[h.jsx(v2,{children:"Menu chnh"}),h.jsx(x2,{children:h.jsx(S2,{children:L2.map(e=>h.jsx(E2,{children:h.jsx(b2,{asChild:!0,isActive:n===e.url,"data-testid":`link-${e.title.toLowerCase().replace(/\s+/g,"-")}`,children:h.jsxs(p0,{href:e.url,children:[h.jsx(e.icon,{className:"h-4 w-4"}),h.jsx("span",{children:e.title}),e.badge&&h.jsx(Rn,{variant:"secondary",className:"ml-auto h-5 w-5 flex items-center justify-center p-0 text-xs",children:e.badge})]})})},e.title))})})]})}),h.jsx(p2,{className:"border-t p-4",children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsxs(Yo,{className:"h-9 w-9",children:[h.jsx(X0,{src:""}),h.jsx(qo,{className:"bg-primary text-primary-foreground",children:"BS"})]}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("p",{className:"text-sm font-medium truncate","data-testid":"text-username",children:"Dr.5ae bo"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Bc s th y"})]})]})})]})}function D2(){const[n,e]=E.useState("light");E.useEffect(()=>{const s=localStorage.getItem("theme")||"light";e(s),document.documentElement.classList.toggle("dark",s==="dark")},[]);const t=()=>{const r=n==="light"?"dark":"light";e(r),localStorage.setItem("theme",r),document.documentElement.classList.toggle("dark",r==="dark")};return h.jsxs(be,{variant:"ghost",size:"icon",onClick:t,"data-testid":"button-theme-toggle",className:"h-9 w-9",children:[n==="light"?h.jsx(LN,{className:"h-4 w-4"}):h.jsx(ON,{className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"Chuyn i ch  mu"})]})}const M_=E.createContext(void 0),zx="petclinic_cart_v1";function P2({children:n}){const[e,t]=E.useState(()=>{try{const c=localStorage.getItem(zx);return c?JSON.parse(c):[]}catch{return[]}});E.useEffect(()=>{localStorage.setItem(zx,JSON.stringify(e))},[e]);const r=(c,u=1)=>{t(d=>d.find(m=>m.id===c.id)?d.map(m=>m.id===c.id?{...m,quantity:m.quantity+u}:m):[...d,{...c,quantity:u}])},s=c=>t(u=>u.filter(d=>d.id!==c)),i=(c,u)=>{t(d=>d.map(f=>f.id===c?{...f,quantity:Math.max(1,u)}:f))},a=()=>t([]),o=E.useMemo(()=>e.reduce((c,u)=>c+u.price*u.quantity,0),[e]),l={items:e,addItem:r,removeItem:s,updateQuantity:i,clear:a,total:o};return h.jsx(M_.Provider,{value:l,children:n})}function Z0(){const n=E.useContext(M_);if(!n)throw new Error("useCart must be used within CartProvider");return n}const tt=E.forwardRef(({className:n,...e},t)=>h.jsx("div",{ref:t,className:J("shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm",n),...e}));tt.displayName="Card";const Vt=E.forwardRef(({className:n,...e},t)=>h.jsx("div",{ref:t,className:J("flex flex-col space-y-1.5 p-6",n),...e}));Vt.displayName="CardHeader";const Zt=E.forwardRef(({className:n,...e},t)=>h.jsx("div",{ref:t,className:J("text-2xl font-semibold leading-none tracking-tight",n),...e}));Zt.displayName="CardTitle";const N2=E.forwardRef(({className:n,...e},t)=>h.jsx("div",{ref:t,className:J("text-sm text-muted-foreground",n),...e}));N2.displayName="CardDescription";const nt=E.forwardRef(({className:n,...e},t)=>h.jsx("div",{ref:t,className:J("p-6 pt-0",n),...e}));nt.displayName="CardContent";const O2=E.forwardRef(({className:n,...e},t)=>h.jsx("div",{ref:t,className:J("flex items-center p-6 pt-0",n),...e}));O2.displayName="CardFooter";function gu({title:n,value:e,icon:t,trend:r,iconColor:s="text-primary"}){return h.jsxs(tt,{"data-testid":`card-stats-${n.toLowerCase().replace(/\s+/g,"-")}`,children:[h.jsxs(Vt,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[h.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:n}),h.jsx(t,{className:J("h-5 w-5",s)})]}),h.jsxs(nt,{children:[h.jsx("div",{className:"text-3xl font-bold","data-testid":"text-stat-value",children:e}),r&&h.jsxs("p",{className:J("text-xs mt-1",r.isPositive?"text-green-600 dark:text-green-500":"text-red-600 dark:text-red-500"),children:[r.isPositive?"+":"",r.value,"% so vi thng trc"]})]})]})}const M2={confirmed:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",pending:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400",urgent:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",cancelled:"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400",completed:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},F2={confirmed:" xc nhn",pending:"Ch xc nhn",urgent:"Khn cp",cancelled:" hy",completed:"Hon thnh"};function j2(){const{data:n}=Je({queryKey:["/api/dashboard/stats"]}),e=new Date,{data:t=[]}=Je({queryKey:["/api/appointments",{date:e.toISOString()}]}),{data:r=[]}=Je({queryKey:["/api/customers"]}),{data:s=[]}=Je({queryKey:["/api/pets"]}),{data:i=[]}=Je({queryKey:["/api/inventory/low-stock"]}),{data:a=[]}=Je({queryKey:["/api/medical-records"]}),{data:o=[]}=Je({queryKey:["/api/invoices"]}),l=d=>{const f=r.find(m=>m.id===d);return(f==null?void 0:f.name)||"Unknown"},c=d=>{const f=s.find(m=>m.id===d);return(f==null?void 0:f.name)||"Unknown"},u=t.slice(0,4);return h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"font-serif text-3xl font-bold","data-testid":"text-page-title",children:"Dashboard"}),h.jsx("p",{className:"text-muted-foreground mt-1",children:"Tng quan hot ng phng khm"})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[h.jsx(gu,{title:"Tng khch hng",value:(n==null?void 0:n.totalCustomers)||r.length||0,icon:iA,trend:{value:12,isPositive:!0}}),h.jsx(gu,{title:"Lch hn hm nay",value:(n==null?void 0:n.todayAppointments)||t.length||0,icon:kf,iconColor:"text-chart-2"}),h.jsx(gu,{title:"Doanh thu thng",value:`${((n==null?void 0:n.monthlyRevenue)||0).toLocaleString()}`,icon:bN,trend:{value:8,isPositive:!0},iconColor:"text-chart-3"}),h.jsx(gu,{title:"Thuc sp ht",value:(n==null?void 0:n.lowStockCount)||i.length||0,icon:A0,iconColor:"text-destructive"})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[h.jsxs(tt,{children:[h.jsx(Vt,{children:h.jsxs(Zt,{className:"flex items-center gap-2",children:[h.jsx(sA,{className:"h-5 w-5 text-primary"}),"Lch hn hm nay"]})}),h.jsx(nt,{children:u.length===0?h.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Cha c lch hn"}):h.jsx("div",{className:"space-y-4",children:u.map(d=>{const m=new Date(d.appointmentDate).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"});return h.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg hover-elevate","data-testid":`appointment-${d.id}`,children:[h.jsx(Yo,{className:"h-12 w-12",children:h.jsx(qo,{children:c(d.petId)[0]})}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("p",{className:"font-medium truncate","data-testid":"text-pet-name",children:c(d.petId)}),h.jsx("p",{className:"text-sm text-muted-foreground truncate",children:l(d.customerId)})]}),h.jsxs("div",{className:"text-right",children:[h.jsx("p",{className:"text-sm font-medium font-mono",children:m}),h.jsx(Rn,{variant:"secondary",className:M2[d.status],children:F2[d.status]})]})]},d.id)})})})]}),h.jsxs(tt,{children:[h.jsx(Vt,{children:h.jsxs(Zt,{className:"flex items-center gap-2",children:[h.jsx(MN,{className:"h-5 w-5 text-chart-3"}),"Hot ng gn y"]})}),h.jsx(nt,{children:h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx("div",{className:"h-2 w-2 mt-2 rounded-full bg-green-500"}),h.jsxs("div",{className:"flex-1",children:[h.jsx("p",{className:"text-sm font-medium",children:"H thng khi ng thnh cng"}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Va xong"})]})]}),i.length>0&&h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx("div",{className:"h-2 w-2 mt-2 rounded-full bg-amber-500"}),h.jsxs("div",{className:"flex-1",children:[h.jsxs("p",{className:"text-sm font-medium",children:["Cnh bo: ",i.length," thuc sp ht"]}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"H thng"})]})]}),t.length>0&&h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx("div",{className:"h-2 w-2 mt-2 rounded-full bg-blue-500"}),h.jsxs("div",{className:"flex-1",children:[h.jsxs("p",{className:"text-sm font-medium",children:[t.length," lch hn hm nay"]}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"H thng"})]})]}),o.length>0&&h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx("div",{className:"h-2 w-2 mt-2 rounded-full bg-purple-500"}),h.jsxs("div",{className:"flex-1",children:[h.jsxs("p",{className:"text-sm font-medium",children:[o.length," ha n thng ny"]}),h.jsx("p",{className:"text-xs text-muted-foreground",children:"Ti chnh"})]})]})]})})]})]}),h.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[h.jsxs(tt,{children:[h.jsx(Vt,{children:h.jsxs(Zt,{className:"flex items-center gap-2",children:[h.jsx(Df,{className:"h-5 w-5 text-primary"}),"H s khm gn y"]})}),h.jsx(nt,{children:a.length===0?h.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Cha c h s"}):h.jsx("div",{className:"space-y-3",children:a.slice(0,5).map(d=>h.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover-elevate",children:[h.jsxs("div",{className:"min-w-0",children:[h.jsx("p",{className:"text-sm font-medium truncate",children:d.diagnosis||"Khm"}),h.jsx("p",{className:"text-xs text-muted-foreground truncate",children:new Date(d.visitDate).toLocaleString("vi-VN")})]}),h.jsx(Rn,{variant:"secondary",children:c(d.petId)})]},d.id))})})]}),h.jsxs(tt,{children:[h.jsx(Vt,{children:h.jsxs(Zt,{className:"flex items-center gap-2",children:[h.jsx(Dl,{className:"h-5 w-5 text-chart-3"}),"Ha n gn y"]})}),h.jsx(nt,{children:o.length===0?h.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Cha c ha n"}):h.jsx("div",{className:"space-y-3",children:o.slice(0,5).map(d=>h.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover-elevate",children:[h.jsxs("div",{className:"min-w-0",children:[h.jsx("p",{className:"text-sm font-medium truncate",children:d.invoiceNumber}),h.jsx("p",{className:"text-xs text-muted-foreground truncate",children:new Date(d.issuedAt).toLocaleDateString("vi-VN")})]}),h.jsxs("div",{className:"text-right",children:[h.jsxs("p",{className:"text-sm font-mono font-medium",children:["",parseFloat(d.totalAmount).toLocaleString()]}),h.jsx(Rn,{variant:"secondary",className:"text-xs",children:d.status==="paid"?" thanh ton":"Ch thanh ton"})]})]},d.id))})})]})]})]})}function $2(){return h.jsx(j2,{})}const J0=E.forwardRef(({className:n,...e},t)=>h.jsx("div",{className:"relative w-full overflow-auto",children:h.jsx("table",{ref:t,className:J("w-full caption-bottom text-sm",n),...e})}));J0.displayName="Table";const ey=E.forwardRef(({className:n,...e},t)=>h.jsx("thead",{ref:t,className:J("[&_tr]:border-b",n),...e}));ey.displayName="TableHeader";const ty=E.forwardRef(({className:n,...e},t)=>h.jsx("tbody",{ref:t,className:J("[&_tr:last-child]:border-0",n),...e}));ty.displayName="TableBody";const U2=E.forwardRef(({className:n,...e},t)=>h.jsx("tfoot",{ref:t,className:J("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",n),...e}));U2.displayName="TableFooter";const sc=E.forwardRef(({className:n,...e},t)=>h.jsx("tr",{ref:t,className:J("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",n),...e}));sc.displayName="TableRow";const qn=E.forwardRef(({className:n,...e},t)=>h.jsx("th",{ref:t,className:J("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",n),...e}));qn.displayName="TableHead";const Qn=E.forwardRef(({className:n,...e},t)=>h.jsx("td",{ref:t,className:J("p-4 align-middle [&:has([role=checkbox])]:pr-0",n),...e}));Qn.displayName="TableCell";const B2=E.forwardRef(({className:n,...e},t)=>h.jsx("caption",{ref:t,className:J("mt-4 text-sm text-muted-foreground",n),...e}));B2.displayName="TableCaption";var V2=E.createContext(void 0);function Wf(n){const e=E.useContext(V2);return n||e||"ltr"}var Xh="rovingFocusGroup.onEntryFocus",G2={bubbles:!1,cancelable:!0},Yf="RovingFocusGroup",[Bp,F_,K2]=Rf(Yf),[H2,qf]=Ir(Yf,[K2]),[z2,W2]=H2(Yf),j_=E.forwardRef((n,e)=>h.jsx(Bp.Provider,{scope:n.__scopeRovingFocusGroup,children:h.jsx(Bp.Slot,{scope:n.__scopeRovingFocusGroup,children:h.jsx(Y2,{...n,ref:e})})}));j_.displayName=Yf;var Y2=E.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:s=!1,dir:i,currentTabStopId:a,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:u=!1,...d}=n,f=E.useRef(null),m=He(e,f),p=Wf(i),[g=null,v]=hi({prop:a,defaultProp:o,onChange:l}),[x,y]=E.useState(!1),S=Ht(c),b=F_(t),w=E.useRef(!1),[_,A]=E.useState(0);return E.useEffect(()=>{const I=f.current;if(I)return I.addEventListener(Xh,S),()=>I.removeEventListener(Xh,S)},[S]),h.jsx(z2,{scope:t,orientation:r,dir:p,loop:s,currentTabStopId:g,onItemFocus:E.useCallback(I=>v(I),[v]),onItemShiftTab:E.useCallback(()=>y(!0),[]),onFocusableItemAdd:E.useCallback(()=>A(I=>I+1),[]),onFocusableItemRemove:E.useCallback(()=>A(I=>I-1),[]),children:h.jsx(xe.div,{tabIndex:x||_===0?-1:0,"data-orientation":r,...d,ref:m,style:{outline:"none",...n.style},onMouseDown:ne(n.onMouseDown,()=>{w.current=!0}),onFocus:ne(n.onFocus,I=>{const C=!w.current;if(I.target===I.currentTarget&&C&&!x){const R=new CustomEvent(Xh,G2);if(I.currentTarget.dispatchEvent(R),!R.defaultPrevented){const P=b().filter($=>$.focusable),O=P.find($=>$.active),U=P.find($=>$.id===g),G=[O,U,...P].filter(Boolean).map($=>$.ref.current);B_(G,u)}}w.current=!1}),onBlur:ne(n.onBlur,()=>y(!1))})})}),$_="RovingFocusGroupItem",U_=E.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:s=!1,tabStopId:i,...a}=n,o=xr(),l=i||o,c=W2($_,t),u=c.currentTabStopId===l,d=F_(t),{onFocusableItemAdd:f,onFocusableItemRemove:m}=c;return E.useEffect(()=>{if(r)return f(),()=>m()},[r,f,m]),h.jsx(Bp.ItemSlot,{scope:t,id:l,focusable:r,active:s,children:h.jsx(xe.span,{tabIndex:u?0:-1,"data-orientation":c.orientation,...a,ref:e,onMouseDown:ne(n.onMouseDown,p=>{r?c.onItemFocus(l):p.preventDefault()}),onFocus:ne(n.onFocus,()=>c.onItemFocus(l)),onKeyDown:ne(n.onKeyDown,p=>{if(p.key==="Tab"&&p.shiftKey){c.onItemShiftTab();return}if(p.target!==p.currentTarget)return;const g=X2(p,c.orientation,c.dir);if(g!==void 0){if(p.metaKey||p.ctrlKey||p.altKey||p.shiftKey)return;p.preventDefault();let x=d().filter(y=>y.focusable).map(y=>y.ref.current);if(g==="last")x.reverse();else if(g==="prev"||g==="next"){g==="prev"&&x.reverse();const y=x.indexOf(p.currentTarget);x=c.loop?Z2(x,y+1):x.slice(y+1)}setTimeout(()=>B_(x))}})})})});U_.displayName=$_;var q2={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Q2(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function X2(n,e,t){const r=Q2(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return q2[r]}function B_(n,e=!1){const t=document.activeElement;for(const r of n)if(r===t||(r.focus({preventScroll:e}),document.activeElement!==t))return}function Z2(n,e){return n.map((t,r)=>n[(e+r)%n.length])}var V_=j_,G_=U_,Vp=["Enter"," "],J2=["ArrowDown","PageUp","Home"],K_=["ArrowUp","PageDown","End"],ej=[...J2,...K_],tj={ltr:[...Vp,"ArrowRight"],rtl:[...Vp,"ArrowLeft"]},nj={ltr:["ArrowLeft"],rtl:["ArrowRight"]},$c="Menu",[ic,rj,sj]=Rf($c),[xa,H_]=Ir($c,[sj,Wo,qf]),Qf=Wo(),z_=qf(),[ij,Sa]=xa($c),[aj,Uc]=xa($c),W_=n=>{const{__scopeMenu:e,open:t=!1,children:r,dir:s,onOpenChange:i,modal:a=!0}=n,o=Qf(e),[l,c]=E.useState(null),u=E.useRef(!1),d=Ht(i),f=Wf(s);return E.useEffect(()=>{const m=()=>{u.current=!0,document.addEventListener("pointerdown",p,{capture:!0,once:!0}),document.addEventListener("pointermove",p,{capture:!0,once:!0})},p=()=>u.current=!1;return document.addEventListener("keydown",m,{capture:!0}),()=>{document.removeEventListener("keydown",m,{capture:!0}),document.removeEventListener("pointerdown",p,{capture:!0}),document.removeEventListener("pointermove",p,{capture:!0})}},[]),h.jsx(j0,{...o,children:h.jsx(ij,{scope:e,open:t,onOpenChange:d,content:l,onContentChange:c,children:h.jsx(aj,{scope:e,onClose:E.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:f,modal:a,children:r})})})};W_.displayName=$c;var oj="MenuAnchor",ny=E.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,s=Qf(t);return h.jsx($0,{...s,...r,ref:e})});ny.displayName=oj;var ry="MenuPortal",[lj,Y_]=xa(ry,{forceMount:void 0}),q_=n=>{const{__scopeMenu:e,forceMount:t,children:r,container:s}=n,i=Sa(ry,e);return h.jsx(lj,{scope:e,forceMount:t,children:h.jsx(Rr,{present:t||i.open,children:h.jsx(Mc,{asChild:!0,container:s,children:r})})})};q_.displayName=ry;var Jn="MenuContent",[cj,sy]=xa(Jn),Q_=E.forwardRef((n,e)=>{const t=Y_(Jn,n.__scopeMenu),{forceMount:r=t.forceMount,...s}=n,i=Sa(Jn,n.__scopeMenu),a=Uc(Jn,n.__scopeMenu);return h.jsx(ic.Provider,{scope:n.__scopeMenu,children:h.jsx(Rr,{present:r||i.open,children:h.jsx(ic.Slot,{scope:n.__scopeMenu,children:a.modal?h.jsx(uj,{...s,ref:e}):h.jsx(dj,{...s,ref:e})})})})}),uj=E.forwardRef((n,e)=>{const t=Sa(Jn,n.__scopeMenu),r=E.useRef(null),s=He(e,r);return E.useEffect(()=>{const i=r.current;if(i)return K0(i)},[]),h.jsx(iy,{...n,ref:s,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:ne(n.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),dj=E.forwardRef((n,e)=>{const t=Sa(Jn,n.__scopeMenu);return h.jsx(iy,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),fj=oa("MenuContent.ScrollLock"),iy=E.forwardRef((n,e)=>{const{__scopeMenu:t,loop:r=!1,trapFocus:s,onOpenAutoFocus:i,onCloseAutoFocus:a,disableOutsidePointerEvents:o,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:f,onDismiss:m,disableOutsideScroll:p,...g}=n,v=Sa(Jn,t),x=Uc(Jn,t),y=Qf(t),S=z_(t),b=rj(t),[w,_]=E.useState(null),A=E.useRef(null),I=He(e,A,v.onContentChange),C=E.useRef(0),R=E.useRef(""),P=E.useRef(0),O=E.useRef(null),U=E.useRef("right"),j=E.useRef(0),G=p?Vf:E.Fragment,$=p?{as:fj,allowPinchZoom:!0}:void 0,Y=N=>{var ee,Se;const K=R.current+N,V=b().filter(Ae=>!Ae.disabled),W=document.activeElement,de=(ee=V.find(Ae=>Ae.ref.current===W))==null?void 0:ee.textValue,pe=V.map(Ae=>Ae.textValue),ge=wj(pe,K,de),me=(Se=V.find(Ae=>Ae.textValue===ge))==null?void 0:Se.ref.current;(function Ae(_e){R.current=_e,window.clearTimeout(C.current),_e!==""&&(C.current=window.setTimeout(()=>Ae(""),1e3))})(K),me&&setTimeout(()=>me.focus())};E.useEffect(()=>()=>window.clearTimeout(C.current),[]),G0();const D=E.useCallback(N=>{var V,W;return U.current===((V=O.current)==null?void 0:V.side)&&_j(N,(W=O.current)==null?void 0:W.area)},[]);return h.jsx(cj,{scope:t,searchRef:R,onItemEnter:E.useCallback(N=>{D(N)&&N.preventDefault()},[D]),onItemLeave:E.useCallback(N=>{var K;D(N)||((K=A.current)==null||K.focus(),_(null))},[D]),onTriggerLeave:E.useCallback(N=>{D(N)&&N.preventDefault()},[D]),pointerGraceTimerRef:P,onPointerGraceIntentChange:E.useCallback(N=>{O.current=N},[]),children:h.jsx(G,{...$,children:h.jsx(Uf,{asChild:!0,trapped:s,onMountAutoFocus:ne(i,N=>{var K;N.preventDefault(),(K=A.current)==null||K.focus({preventScroll:!0})}),onUnmountAutoFocus:a,children:h.jsx(Go,{asChild:!0,disableOutsidePointerEvents:o,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:f,onDismiss:m,children:h.jsx(V_,{asChild:!0,...S,dir:x.dir,orientation:"vertical",loop:r,currentTabStopId:w,onCurrentTabStopIdChange:_,onEntryFocus:ne(l,N=>{x.isUsingKeyboardRef.current||N.preventDefault()}),preventScrollOnEntryFocus:!0,children:h.jsx(U0,{role:"menu","aria-orientation":"vertical","data-state":fI(v.open),"data-radix-menu-content":"",dir:x.dir,...y,...g,ref:I,style:{outline:"none",...g.style},onKeyDown:ne(g.onKeyDown,N=>{const V=N.target.closest("[data-radix-menu-content]")===N.currentTarget,W=N.ctrlKey||N.altKey||N.metaKey,de=N.key.length===1;V&&(N.key==="Tab"&&N.preventDefault(),!W&&de&&Y(N.key));const pe=A.current;if(N.target!==pe||!ej.includes(N.key))return;N.preventDefault();const me=b().filter(ee=>!ee.disabled).map(ee=>ee.ref.current);K_.includes(N.key)&&me.reverse(),Tj(me)}),onBlur:ne(n.onBlur,N=>{N.currentTarget.contains(N.target)||(window.clearTimeout(C.current),R.current="")}),onPointerMove:ne(n.onPointerMove,ac(N=>{const K=N.target,V=j.current!==N.clientX;if(N.currentTarget.contains(K)&&V){const W=N.clientX>j.current?"right":"left";U.current=W,j.current=N.clientX}}))})})})})})})});Q_.displayName=Jn;var hj="MenuGroup",ay=E.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return h.jsx(xe.div,{role:"group",...r,ref:e})});ay.displayName=hj;var mj="MenuLabel",X_=E.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return h.jsx(xe.div,{...r,ref:e})});X_.displayName=mj;var Fd="MenuItem",Wx="menu.itemSelect",Xf=E.forwardRef((n,e)=>{const{disabled:t=!1,onSelect:r,...s}=n,i=E.useRef(null),a=Uc(Fd,n.__scopeMenu),o=sy(Fd,n.__scopeMenu),l=He(e,i),c=E.useRef(!1),u=()=>{const d=i.current;if(!t&&d){const f=new CustomEvent(Wx,{bubbles:!0,cancelable:!0});d.addEventListener(Wx,m=>r==null?void 0:r(m),{once:!0}),E0(d,f),f.defaultPrevented?c.current=!1:a.onClose()}};return h.jsx(Z_,{...s,ref:l,disabled:t,onClick:ne(n.onClick,u),onPointerDown:d=>{var f;(f=n.onPointerDown)==null||f.call(n,d),c.current=!0},onPointerUp:ne(n.onPointerUp,d=>{var f;c.current||(f=d.currentTarget)==null||f.click()}),onKeyDown:ne(n.onKeyDown,d=>{const f=o.searchRef.current!=="";t||f&&d.key===" "||Vp.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})})});Xf.displayName=Fd;var Z_=E.forwardRef((n,e)=>{const{__scopeMenu:t,disabled:r=!1,textValue:s,...i}=n,a=sy(Fd,t),o=z_(t),l=E.useRef(null),c=He(e,l),[u,d]=E.useState(!1),[f,m]=E.useState("");return E.useEffect(()=>{const p=l.current;p&&m((p.textContent??"").trim())},[i.children]),h.jsx(ic.ItemSlot,{scope:t,disabled:r,textValue:s??f,children:h.jsx(G_,{asChild:!0,...o,focusable:!r,children:h.jsx(xe.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...i,ref:c,onPointerMove:ne(n.onPointerMove,ac(p=>{r?a.onItemLeave(p):(a.onItemEnter(p),p.defaultPrevented||p.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:ne(n.onPointerLeave,ac(p=>a.onItemLeave(p))),onFocus:ne(n.onFocus,()=>d(!0)),onBlur:ne(n.onBlur,()=>d(!1))})})})}),pj="MenuCheckboxItem",J_=E.forwardRef((n,e)=>{const{checked:t=!1,onCheckedChange:r,...s}=n;return h.jsx(sI,{scope:n.__scopeMenu,checked:t,children:h.jsx(Xf,{role:"menuitemcheckbox","aria-checked":jd(t)?"mixed":t,...s,ref:e,"data-state":ly(t),onSelect:ne(s.onSelect,()=>r==null?void 0:r(jd(t)?!0:!t),{checkForDefaultPrevented:!1})})})});J_.displayName=pj;var eI="MenuRadioGroup",[gj,yj]=xa(eI,{value:void 0,onValueChange:()=>{}}),tI=E.forwardRef((n,e)=>{const{value:t,onValueChange:r,...s}=n,i=Ht(r);return h.jsx(gj,{scope:n.__scopeMenu,value:t,onValueChange:i,children:h.jsx(ay,{...s,ref:e})})});tI.displayName=eI;var nI="MenuRadioItem",rI=E.forwardRef((n,e)=>{const{value:t,...r}=n,s=yj(nI,n.__scopeMenu),i=t===s.value;return h.jsx(sI,{scope:n.__scopeMenu,checked:i,children:h.jsx(Xf,{role:"menuitemradio","aria-checked":i,...r,ref:e,"data-state":ly(i),onSelect:ne(r.onSelect,()=>{var a;return(a=s.onValueChange)==null?void 0:a.call(s,t)},{checkForDefaultPrevented:!1})})})});rI.displayName=nI;var oy="MenuItemIndicator",[sI,vj]=xa(oy,{checked:!1}),iI=E.forwardRef((n,e)=>{const{__scopeMenu:t,forceMount:r,...s}=n,i=vj(oy,t);return h.jsx(Rr,{present:r||jd(i.checked)||i.checked===!0,children:h.jsx(xe.span,{...s,ref:e,"data-state":ly(i.checked)})})});iI.displayName=oy;var xj="MenuSeparator",aI=E.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return h.jsx(xe.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});aI.displayName=xj;var Sj="MenuArrow",oI=E.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,s=Qf(t);return h.jsx(B0,{...s,...r,ref:e})});oI.displayName=Sj;var Ej="MenuSub",[pK,lI]=xa(Ej),yl="MenuSubTrigger",cI=E.forwardRef((n,e)=>{const t=Sa(yl,n.__scopeMenu),r=Uc(yl,n.__scopeMenu),s=lI(yl,n.__scopeMenu),i=sy(yl,n.__scopeMenu),a=E.useRef(null),{pointerGraceTimerRef:o,onPointerGraceIntentChange:l}=i,c={__scopeMenu:n.__scopeMenu},u=E.useCallback(()=>{a.current&&window.clearTimeout(a.current),a.current=null},[]);return E.useEffect(()=>u,[u]),E.useEffect(()=>{const d=o.current;return()=>{window.clearTimeout(d),l(null)}},[o,l]),h.jsx(ny,{asChild:!0,...c,children:h.jsx(Z_,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":s.contentId,"data-state":fI(t.open),...n,ref:If(e,s.onTriggerChange),onClick:d=>{var f;(f=n.onClick)==null||f.call(n,d),!(n.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:ne(n.onPointerMove,ac(d=>{i.onItemEnter(d),!d.defaultPrevented&&!n.disabled&&!t.open&&!a.current&&(i.onPointerGraceIntentChange(null),a.current=window.setTimeout(()=>{t.onOpenChange(!0),u()},100))})),onPointerLeave:ne(n.onPointerLeave,ac(d=>{var m,p;u();const f=(m=t.content)==null?void 0:m.getBoundingClientRect();if(f){const g=(p=t.content)==null?void 0:p.dataset.side,v=g==="right",x=v?-5:5,y=f[v?"left":"right"],S=f[v?"right":"left"];i.onPointerGraceIntentChange({area:[{x:d.clientX+x,y:d.clientY},{x:y,y:f.top},{x:S,y:f.top},{x:S,y:f.bottom},{x:y,y:f.bottom}],side:g}),window.clearTimeout(o.current),o.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(d),d.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:ne(n.onKeyDown,d=>{var m;const f=i.searchRef.current!=="";n.disabled||f&&d.key===" "||tj[r.dir].includes(d.key)&&(t.onOpenChange(!0),(m=t.content)==null||m.focus(),d.preventDefault())})})})});cI.displayName=yl;var uI="MenuSubContent",dI=E.forwardRef((n,e)=>{const t=Y_(Jn,n.__scopeMenu),{forceMount:r=t.forceMount,...s}=n,i=Sa(Jn,n.__scopeMenu),a=Uc(Jn,n.__scopeMenu),o=lI(uI,n.__scopeMenu),l=E.useRef(null),c=He(e,l);return h.jsx(ic.Provider,{scope:n.__scopeMenu,children:h.jsx(Rr,{present:r||i.open,children:h.jsx(ic.Slot,{scope:n.__scopeMenu,children:h.jsx(iy,{id:o.contentId,"aria-labelledby":o.triggerId,...s,ref:c,align:"start",side:a.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var d;a.isUsingKeyboardRef.current&&((d=l.current)==null||d.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:ne(n.onFocusOutside,u=>{u.target!==o.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:ne(n.onEscapeKeyDown,u=>{a.onClose(),u.preventDefault()}),onKeyDown:ne(n.onKeyDown,u=>{var m;const d=u.currentTarget.contains(u.target),f=nj[a.dir].includes(u.key);d&&f&&(i.onOpenChange(!1),(m=o.trigger)==null||m.focus(),u.preventDefault())})})})})})});dI.displayName=uI;function fI(n){return n?"open":"closed"}function jd(n){return n==="indeterminate"}function ly(n){return jd(n)?"indeterminate":n?"checked":"unchecked"}function Tj(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function bj(n,e){return n.map((t,r)=>n[(e+r)%n.length])}function wj(n,e,t){const s=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,i=t?n.indexOf(t):-1;let a=bj(n,Math.max(i,0));s.length===1&&(a=a.filter(c=>c!==t));const l=a.find(c=>c.toLowerCase().startsWith(s.toLowerCase()));return l!==t?l:void 0}function Aj(n,e){const{x:t,y:r}=n;let s=!1;for(let i=0,a=e.length-1;i<e.length;a=i++){const o=e[i].x,l=e[i].y,c=e[a].x,u=e[a].y;l>r!=u>r&&t<(c-o)*(r-l)/(u-l)+o&&(s=!s)}return s}function _j(n,e){if(!e)return!1;const t={x:n.clientX,y:n.clientY};return Aj(t,e)}function ac(n){return e=>e.pointerType==="mouse"?n(e):void 0}var Ij=W_,Rj=ny,Cj=q_,Lj=Q_,kj=ay,Dj=X_,Pj=Xf,Nj=J_,Oj=tI,Mj=rI,Fj=iI,jj=aI,$j=oI,Uj=cI,Bj=dI,cy="DropdownMenu",[Vj,gK]=Ir(cy,[H_]),pn=H_(),[Gj,hI]=Vj(cy),mI=n=>{const{__scopeDropdownMenu:e,children:t,dir:r,open:s,defaultOpen:i,onOpenChange:a,modal:o=!0}=n,l=pn(e),c=E.useRef(null),[u=!1,d]=hi({prop:s,defaultProp:i,onChange:a});return h.jsx(Gj,{scope:e,triggerId:xr(),triggerRef:c,contentId:xr(),open:u,onOpenChange:d,onOpenToggle:E.useCallback(()=>d(f=>!f),[d]),modal:o,children:h.jsx(Ij,{...l,open:u,onOpenChange:d,dir:r,modal:o,children:t})})};mI.displayName=cy;var pI="DropdownMenuTrigger",gI=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,disabled:r=!1,...s}=n,i=hI(pI,t),a=pn(t);return h.jsx(Rj,{asChild:!0,...a,children:h.jsx(xe.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...s,ref:If(e,i.triggerRef),onPointerDown:ne(n.onPointerDown,o=>{!r&&o.button===0&&o.ctrlKey===!1&&(i.onOpenToggle(),i.open||o.preventDefault())}),onKeyDown:ne(n.onKeyDown,o=>{r||(["Enter"," "].includes(o.key)&&i.onOpenToggle(),o.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(o.key)&&o.preventDefault())})})})});gI.displayName=pI;var Kj="DropdownMenuPortal",yI=n=>{const{__scopeDropdownMenu:e,...t}=n,r=pn(e);return h.jsx(Cj,{...r,...t})};yI.displayName=Kj;var vI="DropdownMenuContent",xI=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,s=hI(vI,t),i=pn(t),a=E.useRef(!1);return h.jsx(Lj,{id:s.contentId,"aria-labelledby":s.triggerId,...i,...r,ref:e,onCloseAutoFocus:ne(n.onCloseAutoFocus,o=>{var l;a.current||(l=s.triggerRef.current)==null||l.focus(),a.current=!1,o.preventDefault()}),onInteractOutside:ne(n.onInteractOutside,o=>{const l=o.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,u=l.button===2||c;(!s.modal||u)&&(a.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});xI.displayName=vI;var Hj="DropdownMenuGroup",zj=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,s=pn(t);return h.jsx(kj,{...s,...r,ref:e})});zj.displayName=Hj;var Wj="DropdownMenuLabel",SI=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,s=pn(t);return h.jsx(Dj,{...s,...r,ref:e})});SI.displayName=Wj;var Yj="DropdownMenuItem",EI=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,s=pn(t);return h.jsx(Pj,{...s,...r,ref:e})});EI.displayName=Yj;var qj="DropdownMenuCheckboxItem",TI=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,s=pn(t);return h.jsx(Nj,{...s,...r,ref:e})});TI.displayName=qj;var Qj="DropdownMenuRadioGroup",Xj=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,s=pn(t);return h.jsx(Oj,{...s,...r,ref:e})});Xj.displayName=Qj;var Zj="DropdownMenuRadioItem",bI=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,s=pn(t);return h.jsx(Mj,{...s,...r,ref:e})});bI.displayName=Zj;var Jj="DropdownMenuItemIndicator",wI=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,s=pn(t);return h.jsx(Fj,{...s,...r,ref:e})});wI.displayName=Jj;var e$="DropdownMenuSeparator",AI=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,s=pn(t);return h.jsx(jj,{...s,...r,ref:e})});AI.displayName=e$;var t$="DropdownMenuArrow",n$=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,s=pn(t);return h.jsx($j,{...s,...r,ref:e})});n$.displayName=t$;var r$="DropdownMenuSubTrigger",_I=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,s=pn(t);return h.jsx(Uj,{...s,...r,ref:e})});_I.displayName=r$;var s$="DropdownMenuSubContent",II=E.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,s=pn(t);return h.jsx(Bj,{...s,...r,ref:e,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});II.displayName=s$;var i$=mI,a$=gI,o$=yI,RI=xI,CI=SI,LI=EI,kI=TI,DI=bI,PI=wI,NI=AI,OI=_I,MI=II;const l$=i$,c$=a$,u$=E.forwardRef(({className:n,inset:e,children:t,...r},s)=>h.jsxs(OI,{ref:s,className:J("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",n),...r,children:[t,h.jsx(nA,{className:"ml-auto"})]}));u$.displayName=OI.displayName;const d$=E.forwardRef(({className:n,...e},t)=>h.jsx(MI,{ref:t,className:J("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",n),...e}));d$.displayName=MI.displayName;const FI=E.forwardRef(({className:n,sideOffset:e=4,...t},r)=>h.jsx(o$,{children:h.jsx(RI,{ref:r,sideOffset:e,className:J("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",n),...t})}));FI.displayName=RI.displayName;const ka=E.forwardRef(({className:n,inset:e,...t},r)=>h.jsx(LI,{ref:r,className:J("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",n),...t}));ka.displayName=LI.displayName;const f$=E.forwardRef(({className:n,children:e,checked:t,...r},s)=>h.jsxs(kI,{ref:s,className:J("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:t,...r,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(PI,{children:h.jsx(eA,{className:"h-4 w-4"})})}),e]}));f$.displayName=kI.displayName;const h$=E.forwardRef(({className:n,children:e,...t},r)=>h.jsxs(DI,{ref:r,className:J("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...t,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(PI,{children:h.jsx(TN,{className:"h-2 w-2 fill-current"})})}),e]}));h$.displayName=DI.displayName;const m$=E.forwardRef(({className:n,inset:e,...t},r)=>h.jsx(CI,{ref:r,className:J("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",n),...t}));m$.displayName=CI.displayName;const p$=E.forwardRef(({className:n,...e},t)=>h.jsx(NI,{ref:t,className:J("-mx-1 my-1 h-px bg-muted",n),...e}));p$.displayName=NI.displayName;var Bc=n=>n.type==="checkbox",Bi=n=>n instanceof Date,an=n=>n==null;const jI=n=>typeof n=="object";var Tt=n=>!an(n)&&!Array.isArray(n)&&jI(n)&&!Bi(n),g$=n=>Tt(n)&&n.target?Bc(n.target)?n.target.checked:n.target.value:n,y$=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,v$=(n,e)=>n.has(y$(e)),x$=n=>{const e=n.constructor&&n.constructor.prototype;return Tt(e)&&e.hasOwnProperty("isPrototypeOf")},uy=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function qt(n){let e;const t=Array.isArray(n),r=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(n instanceof Set)e=new Set(n);else if(!(uy&&(n instanceof Blob||r))&&(t||Tt(n)))if(e=t?[]:{},!t&&!x$(n))e=n;else for(const s in n)n.hasOwnProperty(s)&&(e[s]=qt(n[s]));else return n;return e}var Zf=n=>Array.isArray(n)?n.filter(Boolean):[],bt=n=>n===void 0,ue=(n,e,t)=>{if(!e||!Tt(n))return t;const r=Zf(e.split(/[,[\].]+?/)).reduce((s,i)=>an(s)?s:s[i],n);return bt(r)||r===n?bt(n[e])?t:n[e]:r},Or=n=>typeof n=="boolean",dy=n=>/^\w*$/.test(n),$I=n=>Zf(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Qe=(n,e,t)=>{let r=-1;const s=dy(e)?[e]:$I(e),i=s.length,a=i-1;for(;++r<i;){const o=s[r];let l=t;if(r!==a){const c=n[o];l=Tt(c)||Array.isArray(c)?c:isNaN(+s[r+1])?{}:[]}if(o==="__proto__"||o==="constructor"||o==="prototype")return;n[o]=l,n=n[o]}};const Yx={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},mr={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},as={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};Ct.createContext(null);var S$=(n,e,t,r=!0)=>{const s={defaultValues:e._defaultValues};for(const i in n)Object.defineProperty(s,i,{get:()=>{const a=i;return e._proxyFormState[a]!==mr.all&&(e._proxyFormState[a]=!r||mr.all),n[a]}});return s},Gr=n=>typeof n=="string",E$=(n,e,t,r,s)=>Gr(n)?(r&&e.watch.add(n),ue(t,n,s)):Array.isArray(n)?n.map(i=>(r&&e.watch.add(i),ue(t,i))):(r&&(e.watchAll=!0),t),UI=(n,e,t,r,s)=>e?{...t[n],types:{...t[n]&&t[n].types?t[n].types:{},[r]:s||!0}}:{},Pl=n=>Array.isArray(n)?n:[n],qx=()=>{let n=[];return{get observers(){return n},next:s=>{for(const i of n)i.next&&i.next(s)},subscribe:s=>(n.push(s),{unsubscribe:()=>{n=n.filter(i=>i!==s)}}),unsubscribe:()=>{n=[]}}},Gp=n=>an(n)||!jI(n);function Ks(n,e){if(Gp(n)||Gp(e))return n===e;if(Bi(n)&&Bi(e))return n.getTime()===e.getTime();const t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(const s of t){const i=n[s];if(!r.includes(s))return!1;if(s!=="ref"){const a=e[s];if(Bi(i)&&Bi(a)||Tt(i)&&Tt(a)||Array.isArray(i)&&Array.isArray(a)?!Ks(i,a):i!==a)return!1}}return!0}var rn=n=>Tt(n)&&!Object.keys(n).length,fy=n=>n.type==="file",pr=n=>typeof n=="function",$d=n=>{if(!uy)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},BI=n=>n.type==="select-multiple",hy=n=>n.type==="radio",T$=n=>hy(n)||Bc(n),Zh=n=>$d(n)&&n.isConnected;function b$(n,e){const t=e.slice(0,-1).length;let r=0;for(;r<t;)n=bt(n)?r++:n[e[r++]];return n}function w$(n){for(const e in n)if(n.hasOwnProperty(e)&&!bt(n[e]))return!1;return!0}function It(n,e){const t=Array.isArray(e)?e:dy(e)?[e]:$I(e),r=t.length===1?n:b$(n,t),s=t.length-1,i=t[s];return r&&delete r[i],s!==0&&(Tt(r)&&rn(r)||Array.isArray(r)&&w$(r))&&It(n,t.slice(0,-1)),n}var VI=n=>{for(const e in n)if(pr(n[e]))return!0;return!1};function Ud(n,e={}){const t=Array.isArray(n);if(Tt(n)||t)for(const r in n)Array.isArray(n[r])||Tt(n[r])&&!VI(n[r])?(e[r]=Array.isArray(n[r])?[]:{},Ud(n[r],e[r])):an(n[r])||(e[r]=!0);return e}function GI(n,e,t){const r=Array.isArray(n);if(Tt(n)||r)for(const s in n)Array.isArray(n[s])||Tt(n[s])&&!VI(n[s])?bt(e)||Gp(t[s])?t[s]=Array.isArray(n[s])?Ud(n[s],[]):{...Ud(n[s])}:GI(n[s],an(e)?{}:e[s],t[s]):t[s]=!Ks(n[s],e[s]);return t}var cl=(n,e)=>GI(n,e,Ud(e));const Qx={value:!1,isValid:!1},Xx={value:!0,isValid:!0};var KI=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!bt(n[0].attributes.value)?bt(n[0].value)||n[0].value===""?Xx:{value:n[0].value,isValid:!0}:Xx:Qx}return Qx},HI=(n,{valueAsNumber:e,valueAsDate:t,setValueAs:r})=>bt(n)?n:e?n===""?NaN:n&&+n:t&&Gr(n)?new Date(n):r?r(n):n;const Zx={isValid:!1,value:null};var zI=n=>Array.isArray(n)?n.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,Zx):Zx;function Jx(n){const e=n.ref;return fy(e)?e.files:hy(e)?zI(n.refs).value:BI(e)?[...e.selectedOptions].map(({value:t})=>t):Bc(e)?KI(n.refs).value:HI(bt(e.value)?n.ref.value:e.value,n)}var A$=(n,e,t,r)=>{const s={};for(const i of n){const a=ue(e,i);a&&Qe(s,i,a._f)}return{criteriaMode:t,names:[...n],fields:s,shouldUseNativeValidation:r}},Bd=n=>n instanceof RegExp,ul=n=>bt(n)?n:Bd(n)?n.source:Tt(n)?Bd(n.value)?n.value.source:n.value:n,eS=n=>({isOnSubmit:!n||n===mr.onSubmit,isOnBlur:n===mr.onBlur,isOnChange:n===mr.onChange,isOnAll:n===mr.all,isOnTouch:n===mr.onTouched});const tS="AsyncFunction";var _$=n=>!!n&&!!n.validate&&!!(pr(n.validate)&&n.validate.constructor.name===tS||Tt(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===tS)),I$=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate),nS=(n,e,t)=>!t&&(e.watchAll||e.watch.has(n)||[...e.watch].some(r=>n.startsWith(r)&&/^\.\w+/.test(n.slice(r.length))));const Nl=(n,e,t,r)=>{for(const s of t||Object.keys(n)){const i=ue(n,s);if(i){const{_f:a,...o}=i;if(a){if(a.refs&&a.refs[0]&&e(a.refs[0],s)&&!r)return!0;if(a.ref&&e(a.ref,a.name)&&!r)return!0;if(Nl(o,e))break}else if(Tt(o)&&Nl(o,e))break}}};function rS(n,e,t){const r=ue(n,t);if(r||dy(t))return{error:r,name:t};const s=t.split(".");for(;s.length;){const i=s.join("."),a=ue(e,i),o=ue(n,i);if(a&&!Array.isArray(a)&&t!==i)return{name:t};if(o&&o.type)return{name:i,error:o};s.pop()}return{name:t}}var R$=(n,e,t,r)=>{t(n);const{name:s,...i}=n;return rn(i)||Object.keys(i).length>=Object.keys(e).length||Object.keys(i).find(a=>e[a]===(!r||mr.all))},C$=(n,e,t)=>!n||!e||n===e||Pl(n).some(r=>r&&(t?r===e:r.startsWith(e)||e.startsWith(r))),L$=(n,e,t,r,s)=>s.isOnAll?!1:!t&&s.isOnTouch?!(e||n):(t?r.isOnBlur:s.isOnBlur)?!n:(t?r.isOnChange:s.isOnChange)?n:!0,k$=(n,e)=>!Zf(ue(n,e)).length&&It(n,e),D$=(n,e,t)=>{const r=Pl(ue(n,t));return Qe(r,"root",e[t]),Qe(n,t,r),n},Xu=n=>Gr(n);function sS(n,e,t="validate"){if(Xu(n)||Array.isArray(n)&&n.every(Xu)||Or(n)&&!n)return{type:t,message:Xu(n)?n:"",ref:e}}var _a=n=>Tt(n)&&!Bd(n)?n:{value:n,message:""},iS=async(n,e,t,r,s,i)=>{const{ref:a,refs:o,required:l,maxLength:c,minLength:u,min:d,max:f,pattern:m,validate:p,name:g,valueAsNumber:v,mount:x}=n._f,y=ue(t,g);if(!x||e.has(g))return{};const S=o?o[0]:a,b=O=>{s&&S.reportValidity&&(S.setCustomValidity(Or(O)?"":O||""),S.reportValidity())},w={},_=hy(a),A=Bc(a),I=_||A,C=(v||fy(a))&&bt(a.value)&&bt(y)||$d(a)&&a.value===""||y===""||Array.isArray(y)&&!y.length,R=UI.bind(null,g,r,w),P=(O,U,j,G=as.maxLength,$=as.minLength)=>{const Y=O?U:j;w[g]={type:O?G:$,message:Y,ref:a,...R(O?G:$,Y)}};if(i?!Array.isArray(y)||!y.length:l&&(!I&&(C||an(y))||Or(y)&&!y||A&&!KI(o).isValid||_&&!zI(o).isValid)){const{value:O,message:U}=Xu(l)?{value:!!l,message:l}:_a(l);if(O&&(w[g]={type:as.required,message:U,ref:S,...R(as.required,U)},!r))return b(U),w}if(!C&&(!an(d)||!an(f))){let O,U;const j=_a(f),G=_a(d);if(!an(y)&&!isNaN(y)){const $=a.valueAsNumber||y&&+y;an(j.value)||(O=$>j.value),an(G.value)||(U=$<G.value)}else{const $=a.valueAsDate||new Date(y),Y=K=>new Date(new Date().toDateString()+" "+K),D=a.type=="time",N=a.type=="week";Gr(j.value)&&y&&(O=D?Y(y)>Y(j.value):N?y>j.value:$>new Date(j.value)),Gr(G.value)&&y&&(U=D?Y(y)<Y(G.value):N?y<G.value:$<new Date(G.value))}if((O||U)&&(P(!!O,j.message,G.message,as.max,as.min),!r))return b(w[g].message),w}if((c||u)&&!C&&(Gr(y)||i&&Array.isArray(y))){const O=_a(c),U=_a(u),j=!an(O.value)&&y.length>+O.value,G=!an(U.value)&&y.length<+U.value;if((j||G)&&(P(j,O.message,U.message),!r))return b(w[g].message),w}if(m&&!C&&Gr(y)){const{value:O,message:U}=_a(m);if(Bd(O)&&!y.match(O)&&(w[g]={type:as.pattern,message:U,ref:a,...R(as.pattern,U)},!r))return b(U),w}if(p){if(pr(p)){const O=await p(y,t),U=sS(O,S);if(U&&(w[g]={...U,...R(as.validate,U.message)},!r))return b(U.message),w}else if(Tt(p)){let O={};for(const U in p){if(!rn(O)&&!r)break;const j=sS(await p[U](y,t),S,U);j&&(O={...j,...R(U,j.message)},b(j.message),r&&(w[g]=O))}if(!rn(O)&&(w[g]={ref:S,...O},!r))return w}}return b(!0),w};const P$={mode:mr.onSubmit,reValidateMode:mr.onChange,shouldFocusError:!0};function N$(n={}){let e={...P$,...n},t={submitCount:0,isDirty:!1,isLoading:pr(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1};const r={};let s=Tt(e.defaultValues)||Tt(e.values)?qt(e.values||e.defaultValues)||{}:{},i=e.shouldUnregister?{}:qt(s),a={action:!1,mount:!1,watch:!1},o={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},l,c=0;const u={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let d={...u};const f={array:qx(),state:qx()},m=eS(e.mode),p=eS(e.reValidateMode),g=e.criteriaMode===mr.all,v=L=>B=>{clearTimeout(c),c=setTimeout(L,B)},x=async L=>{if(!e.disabled&&(u.isValid||d.isValid||L)){const B=e.resolver?rn((await C()).errors):await P(r,!0);B!==t.isValid&&f.state.next({isValid:B})}},y=(L,B)=>{!e.disabled&&(u.isValidating||u.validatingFields||d.isValidating||d.validatingFields)&&((L||Array.from(o.mount)).forEach(H=>{H&&(B?Qe(t.validatingFields,H,B):It(t.validatingFields,H))}),f.state.next({validatingFields:t.validatingFields,isValidating:!rn(t.validatingFields)}))},S=(L,B=[],H,se,Z=!0,X=!0)=>{if(se&&H&&!e.disabled){if(a.action=!0,X&&Array.isArray(ue(r,L))){const ce=H(ue(r,L),se.argA,se.argB);Z&&Qe(r,L,ce)}if(X&&Array.isArray(ue(t.errors,L))){const ce=H(ue(t.errors,L),se.argA,se.argB);Z&&Qe(t.errors,L,ce),k$(t.errors,L)}if((u.touchedFields||d.touchedFields)&&X&&Array.isArray(ue(t.touchedFields,L))){const ce=H(ue(t.touchedFields,L),se.argA,se.argB);Z&&Qe(t.touchedFields,L,ce)}(u.dirtyFields||d.dirtyFields)&&(t.dirtyFields=cl(s,i)),f.state.next({name:L,isDirty:U(L,B),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else Qe(i,L,B)},b=(L,B)=>{Qe(t.errors,L,B),f.state.next({errors:t.errors})},w=L=>{t.errors=L,f.state.next({errors:t.errors,isValid:!1})},_=(L,B,H,se)=>{const Z=ue(r,L);if(Z){const X=ue(i,L,bt(H)?ue(s,L):H);bt(X)||se&&se.defaultChecked||B?Qe(i,L,B?X:Jx(Z._f)):$(L,X),a.mount&&x()}},A=(L,B,H,se,Z)=>{let X=!1,ce=!1;const $e={name:L};if(!e.disabled){if(!H||se){(u.isDirty||d.isDirty)&&(ce=t.isDirty,t.isDirty=$e.isDirty=U(),X=ce!==$e.isDirty);const ut=Ks(ue(s,L),B);ce=!!ue(t.dirtyFields,L),ut?It(t.dirtyFields,L):Qe(t.dirtyFields,L,!0),$e.dirtyFields=t.dirtyFields,X=X||(u.dirtyFields||d.dirtyFields)&&ce!==!ut}if(H){const ut=ue(t.touchedFields,L);ut||(Qe(t.touchedFields,L,H),$e.touchedFields=t.touchedFields,X=X||(u.touchedFields||d.touchedFields)&&ut!==H)}X&&Z&&f.state.next($e)}return X?$e:{}},I=(L,B,H,se)=>{const Z=ue(t.errors,L),X=(u.isValid||d.isValid)&&Or(B)&&t.isValid!==B;if(e.delayError&&H?(l=v(()=>b(L,H)),l(e.delayError)):(clearTimeout(c),l=null,H?Qe(t.errors,L,H):It(t.errors,L)),(H?!Ks(Z,H):Z)||!rn(se)||X){const ce={...se,...X&&Or(B)?{isValid:B}:{},errors:t.errors,name:L};t={...t,...ce},f.state.next(ce)}},C=async L=>{y(L,!0);const B=await e.resolver(i,e.context,A$(L||o.mount,r,e.criteriaMode,e.shouldUseNativeValidation));return y(L),B},R=async L=>{const{errors:B}=await C(L);if(L)for(const H of L){const se=ue(B,H);se?Qe(t.errors,H,se):It(t.errors,H)}else t.errors=B;return B},P=async(L,B,H={valid:!0})=>{for(const se in L){const Z=L[se];if(Z){const{_f:X,...ce}=Z;if(X){const $e=o.array.has(X.name),ut=Z._f&&_$(Z._f);ut&&u.validatingFields&&y([se],!0);const yt=await iS(Z,o.disabled,i,g,e.shouldUseNativeValidation&&!B,$e);if(ut&&u.validatingFields&&y([se]),yt[X.name]&&(H.valid=!1,B))break;!B&&(ue(yt,X.name)?$e?D$(t.errors,yt,X.name):Qe(t.errors,X.name,yt[X.name]):It(t.errors,X.name))}!rn(ce)&&await P(ce,B,H)}}return H.valid},O=()=>{for(const L of o.unMount){const B=ue(r,L);B&&(B._f.refs?B._f.refs.every(H=>!Zh(H)):!Zh(B._f.ref))&&Ae(L)}o.unMount=new Set},U=(L,B)=>!e.disabled&&(L&&B&&Qe(i,L,B),!Ks(W(),s)),j=(L,B,H)=>E$(L,o,{...a.mount?i:bt(B)?s:Gr(L)?{[L]:B}:B},H,B),G=L=>Zf(ue(a.mount?i:s,L,e.shouldUnregister?ue(s,L,[]):[])),$=(L,B,H={})=>{const se=ue(r,L);let Z=B;if(se){const X=se._f;X&&(!X.disabled&&Qe(i,L,HI(B,X)),Z=$d(X.ref)&&an(B)?"":B,BI(X.ref)?[...X.ref.options].forEach(ce=>ce.selected=Z.includes(ce.value)):X.refs?Bc(X.ref)?X.refs.length>1?X.refs.forEach(ce=>(!ce.defaultChecked||!ce.disabled)&&(ce.checked=Array.isArray(Z)?!!Z.find($e=>$e===ce.value):Z===ce.value)):X.refs[0]&&(X.refs[0].checked=!!Z):X.refs.forEach(ce=>ce.checked=ce.value===Z):fy(X.ref)?X.ref.value="":(X.ref.value=Z,X.ref.type||f.state.next({name:L,values:qt(i)})))}(H.shouldDirty||H.shouldTouch)&&A(L,Z,H.shouldTouch,H.shouldDirty,!0),H.shouldValidate&&V(L)},Y=(L,B,H)=>{for(const se in B){const Z=B[se],X=`${L}.${se}`,ce=ue(r,X);(o.array.has(L)||Tt(Z)||ce&&!ce._f)&&!Bi(Z)?Y(X,Z,H):$(X,Z,H)}},D=(L,B,H={})=>{const se=ue(r,L),Z=o.array.has(L),X=qt(B);Qe(i,L,X),Z?(f.array.next({name:L,values:qt(i)}),(u.isDirty||u.dirtyFields||d.isDirty||d.dirtyFields)&&H.shouldDirty&&f.state.next({name:L,dirtyFields:cl(s,i),isDirty:U(L,X)})):se&&!se._f&&!an(X)?Y(L,X,H):$(L,X,H),nS(L,o)&&f.state.next({...t}),f.state.next({name:a.mount?L:void 0,values:qt(i)})},N=async L=>{a.mount=!0;const B=L.target;let H=B.name,se=!0;const Z=ue(r,H),X=ce=>{se=Number.isNaN(ce)||Bi(ce)&&isNaN(ce.getTime())||Ks(ce,ue(i,H,ce))};if(Z){let ce,$e;const ut=B.type?Jx(Z._f):g$(L),yt=L.type===Yx.BLUR||L.type===Yx.FOCUS_OUT,jC=!I$(Z._f)&&!e.resolver&&!ue(t.errors,H)&&!Z._f.deps||L$(yt,ue(t.touchedFields,H),t.isSubmitted,p,m),ah=nS(H,o,yt);Qe(i,H,ut),yt?(Z._f.onBlur&&Z._f.onBlur(L),l&&l(0)):Z._f.onChange&&Z._f.onChange(L);const oh=A(H,ut,yt),$C=!rn(oh)||ah;if(!yt&&f.state.next({name:H,type:L.type,values:qt(i)}),jC)return(u.isValid||d.isValid)&&(e.mode==="onBlur"?yt&&x():yt||x()),$C&&f.state.next({name:H,...ah?{}:oh});if(!yt&&ah&&f.state.next({...t}),e.resolver){const{errors:Gy}=await C([H]);if(X(ut),se){const UC=rS(t.errors,r,H),Ky=rS(Gy,r,UC.name||H);ce=Ky.error,H=Ky.name,$e=rn(Gy)}}else y([H],!0),ce=(await iS(Z,o.disabled,i,g,e.shouldUseNativeValidation))[H],y([H]),X(ut),se&&(ce?$e=!1:(u.isValid||d.isValid)&&($e=await P(r,!0)));se&&(Z._f.deps&&V(Z._f.deps),I(H,$e,ce,oh))}},K=(L,B)=>{if(ue(t.errors,B)&&L.focus)return L.focus(),1},V=async(L,B={})=>{let H,se;const Z=Pl(L);if(e.resolver){const X=await R(bt(L)?L:Z);H=rn(X),se=L?!Z.some(ce=>ue(X,ce)):H}else L?(se=(await Promise.all(Z.map(async X=>{const ce=ue(r,X);return await P(ce&&ce._f?{[X]:ce}:ce)}))).every(Boolean),!(!se&&!t.isValid)&&x()):se=H=await P(r);return f.state.next({...!Gr(L)||(u.isValid||d.isValid)&&H!==t.isValid?{}:{name:L},...e.resolver||!L?{isValid:H}:{},errors:t.errors}),B.shouldFocus&&!se&&Nl(r,K,L?Z:o.mount),se},W=L=>{const B={...a.mount?i:s};return bt(L)?B:Gr(L)?ue(B,L):L.map(H=>ue(B,H))},de=(L,B)=>({invalid:!!ue((B||t).errors,L),isDirty:!!ue((B||t).dirtyFields,L),error:ue((B||t).errors,L),isValidating:!!ue(t.validatingFields,L),isTouched:!!ue((B||t).touchedFields,L)}),pe=L=>{L&&Pl(L).forEach(B=>It(t.errors,B)),f.state.next({errors:L?t.errors:{}})},ge=(L,B,H)=>{const se=(ue(r,L,{_f:{}})._f||{}).ref,Z=ue(t.errors,L)||{},{ref:X,message:ce,type:$e,...ut}=Z;Qe(t.errors,L,{...ut,...B,ref:se}),f.state.next({name:L,errors:t.errors,isValid:!1}),H&&H.shouldFocus&&se&&se.focus&&se.focus()},me=(L,B)=>pr(L)?f.state.subscribe({next:H=>L(j(void 0,B),H)}):j(L,B,!0),ee=L=>f.state.subscribe({next:B=>{C$(L.name,B.name,L.exact)&&R$(B,L.formState||u,gn,L.reRenderRoot)&&L.callback({values:{...i},...t,...B})}}).unsubscribe,Se=L=>(a.mount=!0,d={...d,...L.formState},ee({...L,formState:d})),Ae=(L,B={})=>{for(const H of L?Pl(L):o.mount)o.mount.delete(H),o.array.delete(H),B.keepValue||(It(r,H),It(i,H)),!B.keepError&&It(t.errors,H),!B.keepDirty&&It(t.dirtyFields,H),!B.keepTouched&&It(t.touchedFields,H),!B.keepIsValidating&&It(t.validatingFields,H),!e.shouldUnregister&&!B.keepDefaultValue&&It(s,H);f.state.next({values:qt(i)}),f.state.next({...t,...B.keepDirty?{isDirty:U()}:{}}),!B.keepIsValid&&x()},_e=({disabled:L,name:B})=>{(Or(L)&&a.mount||L||o.disabled.has(B))&&(L?o.disabled.add(B):o.disabled.delete(B))},De=(L,B={})=>{let H=ue(r,L);const se=Or(B.disabled)||Or(e.disabled);return Qe(r,L,{...H||{},_f:{...H&&H._f?H._f:{ref:{name:L}},name:L,mount:!0,...B}}),o.mount.add(L),H?_e({disabled:Or(B.disabled)?B.disabled:e.disabled,name:L}):_(L,!0,B.value),{...se?{disabled:B.disabled||e.disabled}:{},...e.progressive?{required:!!B.required,min:ul(B.min),max:ul(B.max),minLength:ul(B.minLength),maxLength:ul(B.maxLength),pattern:ul(B.pattern)}:{},name:L,onChange:N,onBlur:N,ref:Z=>{if(Z){De(L,B),H=ue(r,L);const X=bt(Z.value)&&Z.querySelectorAll&&Z.querySelectorAll("input,select,textarea")[0]||Z,ce=T$(X),$e=H._f.refs||[];if(ce?$e.find(ut=>ut===X):X===H._f.ref)return;Qe(r,L,{_f:{...H._f,...ce?{refs:[...$e.filter(Zh),X,...Array.isArray(ue(s,L))?[{}]:[]],ref:{type:X.type,name:L}}:{ref:X}}}),_(L,!1,void 0,X)}else H=ue(r,L,{}),H._f&&(H._f.mount=!1),(e.shouldUnregister||B.shouldUnregister)&&!(v$(o.array,L)&&a.action)&&o.unMount.add(L)}}},Ve=()=>e.shouldFocusError&&Nl(r,K,o.mount),_t=L=>{Or(L)&&(f.state.next({disabled:L}),Nl(r,(B,H)=>{const se=ue(r,H);se&&(B.disabled=se._f.disabled||L,Array.isArray(se._f.refs)&&se._f.refs.forEach(Z=>{Z.disabled=se._f.disabled||L}))},0,!1))},jt=(L,B)=>async H=>{let se;H&&(H.preventDefault&&H.preventDefault(),H.persist&&H.persist());let Z=qt(i);if(f.state.next({isSubmitting:!0}),e.resolver){const{errors:X,values:ce}=await C();t.errors=X,Z=ce}else await P(r);if(o.disabled.size)for(const X of o.disabled)Qe(Z,X,void 0);if(It(t.errors,"root"),rn(t.errors)){f.state.next({errors:{}});try{await L(Z,H)}catch(X){se=X}}else B&&await B({...t.errors},H),Ve(),setTimeout(Ve);if(f.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:rn(t.errors)&&!se,submitCount:t.submitCount+1,errors:t.errors}),se)throw se},Ls=(L,B={})=>{ue(r,L)&&(bt(B.defaultValue)?D(L,qt(ue(s,L))):(D(L,B.defaultValue),Qe(s,L,qt(B.defaultValue))),B.keepTouched||It(t.touchedFields,L),B.keepDirty||(It(t.dirtyFields,L),t.isDirty=B.defaultValue?U(L,qt(ue(s,L))):U()),B.keepError||(It(t.errors,L),u.isValid&&x()),f.state.next({...t}))},Ce=(L,B={})=>{const H=L?qt(L):s,se=qt(H),Z=rn(L),X=Z?s:se;if(B.keepDefaultValues||(s=H),!B.keepValues){if(B.keepDirtyValues){const ce=new Set([...o.mount,...Object.keys(cl(s,i))]);for(const $e of Array.from(ce))ue(t.dirtyFields,$e)?Qe(X,$e,ue(i,$e)):D($e,ue(X,$e))}else{if(uy&&bt(L))for(const ce of o.mount){const $e=ue(r,ce);if($e&&$e._f){const ut=Array.isArray($e._f.refs)?$e._f.refs[0]:$e._f.ref;if($d(ut)){const yt=ut.closest("form");if(yt){yt.reset();break}}}}for(const ce of o.mount)D(ce,ue(X,ce))}i=qt(X),f.array.next({values:{...X}}),f.state.next({values:{...X}})}o={mount:B.keepDirtyValues?o.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},a.mount=!u.isValid||!!B.keepIsValid||!!B.keepDirtyValues,a.watch=!!e.shouldUnregister,f.state.next({submitCount:B.keepSubmitCount?t.submitCount:0,isDirty:Z?!1:B.keepDirty?t.isDirty:!!(B.keepDefaultValues&&!Ks(L,s)),isSubmitted:B.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:Z?{}:B.keepDirtyValues?B.keepDefaultValues&&i?cl(s,i):t.dirtyFields:B.keepDefaultValues&&L?cl(s,L):B.keepDirty?t.dirtyFields:{},touchedFields:B.keepTouched?t.touchedFields:{},errors:B.keepErrors?t.errors:{},isSubmitSuccessful:B.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1})},it=(L,B)=>Ce(pr(L)?L(i):L,B),zt=(L,B={})=>{const H=ue(r,L),se=H&&H._f;if(se){const Z=se.refs?se.refs[0]:se.ref;Z.focus&&(Z.focus(),B.shouldSelect&&pr(Z.select)&&Z.select())}},gn=L=>{t={...t,...L}},ss={control:{register:De,unregister:Ae,getFieldState:de,handleSubmit:jt,setError:ge,_subscribe:ee,_runSchema:C,_getWatch:j,_getDirty:U,_setValid:x,_setFieldArray:S,_setDisabledField:_e,_setErrors:w,_getFieldArray:G,_reset:Ce,_resetDefaultValues:()=>pr(e.defaultValues)&&e.defaultValues().then(L=>{it(L,e.resetOptions),f.state.next({isLoading:!1})}),_removeUnmounted:O,_disableForm:_t,_subjects:f,_proxyFormState:u,get _fields(){return r},get _formValues(){return i},get _state(){return a},set _state(L){a=L},get _defaultValues(){return s},get _names(){return o},set _names(L){o=L},get _formState(){return t},get _options(){return e},set _options(L){e={...e,...L}}},subscribe:Se,trigger:V,register:De,handleSubmit:jt,watch:me,setValue:D,getValues:W,reset:it,resetField:Ls,clearErrors:pe,unregister:Ae,setError:ge,setFocus:zt,getFieldState:de};return{...ss,formControl:ss}}function Qo(n={}){const e=Ct.useRef(void 0),t=Ct.useRef(void 0),[r,s]=Ct.useState({isDirty:!1,isValidating:!1,isLoading:pr(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:pr(n.defaultValues)?void 0:n.defaultValues});e.current||(e.current={...n.formControl?n.formControl:N$(n),formState:r},n.formControl&&n.defaultValues&&!pr(n.defaultValues)&&n.formControl.reset(n.defaultValues,n.resetOptions));const i=e.current.control;return i._options=n,Ct.useLayoutEffect(()=>i._subscribe({formState:i._proxyFormState,callback:()=>s({...i._formState}),reRenderRoot:!0}),[i]),Ct.useEffect(()=>i._disableForm(n.disabled),[i,n.disabled]),Ct.useEffect(()=>{if(i._proxyFormState.isDirty){const a=i._getDirty();a!==r.isDirty&&i._subjects.state.next({isDirty:a})}},[i,r.isDirty]),Ct.useEffect(()=>{n.values&&!Ks(n.values,t.current)?(i._reset(n.values,i._options.resetOptions),t.current=n.values,s(a=>({...a}))):i._resetDefaultValues()},[n.values,i]),Ct.useEffect(()=>{n.errors&&!rn(n.errors)&&i._setErrors(n.errors)},[n.errors,i]),Ct.useEffect(()=>{i._state.mount||(i._setValid(),i._state.mount=!0),i._state.watch&&(i._state.watch=!1,i._subjects.state.next({...i._formState})),i._removeUnmounted()}),Ct.useEffect(()=>{n.shouldUnregister&&i._subjects.state.next({values:i._getWatch()})},[n.shouldUnregister,i]),e.current.formState=S$(r,i),e.current}const aS=(n,e,t)=>{if(n&&"reportValidity"in n){const r=ue(t,e);n.setCustomValidity(r&&r.message||""),n.reportValidity()}},WI=(n,e)=>{for(const t in e.fields){const r=e.fields[t];r&&r.ref&&"reportValidity"in r.ref?aS(r.ref,t,n):r.refs&&r.refs.forEach(s=>aS(s,t,n))}},O$=(n,e)=>{e.shouldUseNativeValidation&&WI(n,e);const t={};for(const r in n){const s=ue(e.fields,r),i=Object.assign(n[r]||{},{ref:s&&s.ref});if(M$(e.names||Object.keys(n),r)){const a=Object.assign({},ue(t,r));Qe(a,"root",i),Qe(t,r,a)}else Qe(t,r,i)}return t},M$=(n,e)=>n.some(t=>t.startsWith(e+"."));var F$=function(n,e){for(var t={};n.length;){var r=n[0],s=r.code,i=r.message,a=r.path.join(".");if(!t[a])if("unionErrors"in r){var o=r.unionErrors[0].errors[0];t[a]={message:o.message,type:o.code}}else t[a]={message:i,type:s};if("unionErrors"in r&&r.unionErrors.forEach(function(u){return u.errors.forEach(function(d){return n.push(d)})}),e){var l=t[a].types,c=l&&l[r.code];t[a]=UI(a,e,t,s,c?[].concat(c,r.message):r.message)}n.shift()}return t},Xo=function(n,e,t){return t===void 0&&(t={}),function(r,s,i){try{return Promise.resolve(function(a,o){try{var l=Promise.resolve(n[t.mode==="sync"?"parse":"parseAsync"](r,e)).then(function(c){return i.shouldUseNativeValidation&&WI({},i),{errors:{},values:t.raw?r:c}})}catch(c){return o(c)}return l&&l.then?l.then(void 0,o):l}(0,function(a){if(function(o){return Array.isArray(o==null?void 0:o.errors)}(a))return{values:{},errors:O$(F$(a.errors,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw a}))}catch(a){return Promise.reject(a)}}},Be;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return n.objectValues(a)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},n.find=(s,i)=>{for(const a of s)if(i(a))return a},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(Be||(Be={}));var Kp;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(Kp||(Kp={}));const ae=Be.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ps=n=>{switch(typeof n){case"undefined":return ae.undefined;case"string":return ae.string;case"number":return isNaN(n)?ae.nan:ae.number;case"boolean":return ae.boolean;case"function":return ae.function;case"bigint":return ae.bigint;case"symbol":return ae.symbol;case"object":return Array.isArray(n)?ae.array:n===null?ae.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?ae.promise:typeof Map<"u"&&n instanceof Map?ae.map:typeof Set<"u"&&n instanceof Set?ae.set:typeof Date<"u"&&n instanceof Date?ae.date:ae.object;default:return ae.unknown}},q=Be.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),j$=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class $n extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,l=0;for(;l<a.path.length;){const c=a.path[l];l===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],l++}}};return s(this),r}static assert(e){if(!(e instanceof $n))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Be.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}$n.create=n=>new $n(n);const Po=(n,e)=>{let t;switch(n.code){case q.invalid_type:n.received===ae.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case q.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,Be.jsonStringifyReplacer)}`;break;case q.unrecognized_keys:t=`Unrecognized key(s) in object: ${Be.joinValues(n.keys,", ")}`;break;case q.invalid_union:t="Invalid input";break;case q.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Be.joinValues(n.options)}`;break;case q.invalid_enum_value:t=`Invalid enum value. Expected ${Be.joinValues(n.options)}, received '${n.received}'`;break;case q.invalid_arguments:t="Invalid function arguments";break;case q.invalid_return_type:t="Invalid function return type";break;case q.invalid_date:t="Invalid date";break;case q.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:Be.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case q.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case q.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case q.custom:t="Invalid input";break;case q.invalid_intersection_types:t="Intersection results could not be merged";break;case q.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case q.not_finite:t="Number must be finite";break;default:t=e.defaultError,Be.assertNever(n)}return{message:t}};let YI=Po;function $$(n){YI=n}function Vd(){return YI}const Gd=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="";const l=r.filter(c=>!!c).slice().reverse();for(const c of l)o=c(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}},U$=[];function te(n,e){const t=Vd(),r=Gd({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===Po?void 0:Po].filter(s=>!!s)});n.common.issues.push(r)}class en{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return Ee;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t){const i=await s.key,a=await s.value;r.push({key:i,value:a})}return en.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return Ee;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(r[i.value]=a.value)}return{status:e.value,value:r}}}const Ee=Object.freeze({status:"aborted"}),za=n=>({status:"dirty",value:n}),fn=n=>({status:"valid",value:n}),Hp=n=>n.status==="aborted",zp=n=>n.status==="dirty",ua=n=>n.status==="valid",oc=n=>typeof Promise<"u"&&n instanceof Promise;function Kd(n,e,t,r){if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function qI(n,e,t,r,s){if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}var he;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(he||(he={}));var vl,xl;class Zr{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const oS=(n,e)=>{if(ua(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new $n(n.common.issues);return this._error=t,this._error}}};function Re(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{var l,c;const{message:u}=n;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:(l=u??r)!==null&&l!==void 0?l:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(c=u??t)!==null&&c!==void 0?c:o.defaultError}},description:s}}class Oe{get description(){return this._def.description}_getType(e){return ps(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ps(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new en,ctx:{common:e.parent.common,data:e.data,parsedType:ps(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(oc(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ps(e)},i=this._parseSync({data:e,path:s.path,parent:s});return oS(s,i)}"~validate"(e){var t,r;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ps(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:s});return ua(i)?{value:i.value}:{issues:s.common.issues}}catch(i){!((r=(t=i==null?void 0:i.message)===null||t===void 0?void 0:t.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(i=>ua(i)?{value:i.value}:{issues:s.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ps(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(oc(s)?s:Promise.resolve(s));return oS(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:q.custom,...r(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(l=>l?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new Ar({schema:this,typeName:ve.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return qr.create(this,this._def)}nullable(){return Ei.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Sr.create(this)}promise(){return Oo.create(this,this._def)}or(e){return dc.create([this,e],this._def)}and(e){return fc.create(this,e,this._def)}transform(e){return new Ar({...Re(this._def),schema:this,typeName:ve.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new yc({...Re(this._def),innerType:this,defaultValue:t,typeName:ve.ZodDefault})}brand(){return new my({typeName:ve.ZodBranded,type:this,...Re(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new vc({...Re(this._def),innerType:this,catchValue:t,typeName:ve.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Vc.create(this,e)}readonly(){return xc.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const B$=/^c[^\s-]{8,}$/i,V$=/^[0-9a-z]+$/,G$=/^[0-9A-HJKMNP-TV-Z]{26}$/i,K$=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,H$=/^[a-z0-9_-]{21}$/i,z$=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,W$=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Y$=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,q$="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Jh;const Q$=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,X$=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Z$=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,J$=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,eU=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,tU=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,QI="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",nU=new RegExp(`^${QI}$`);function XI(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function rU(n){return new RegExp(`^${XI(n)}$`)}function ZI(n){let e=`${QI}T${XI(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function sU(n,e){return!!((e==="v4"||!e)&&Q$.test(n)||(e==="v6"||!e)&&Z$.test(n))}function iU(n,e){if(!z$.test(n))return!1;try{const[t]=n.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function aU(n,e){return!!((e==="v4"||!e)&&X$.test(n)||(e==="v6"||!e)&&J$.test(n))}class gr extends Oe{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ae.string){const i=this._getOrReturnCtx(e);return te(i,{code:q.invalid_type,expected:ae.string,received:i.parsedType}),Ee}const r=new en;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),te(s,{code:q.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),te(s,{code:q.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?te(s,{code:q.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&te(s,{code:q.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")Y$.test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"email",code:q.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")Jh||(Jh=new RegExp(q$,"u")),Jh.test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"emoji",code:q.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")K$.test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"uuid",code:q.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")H$.test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"nanoid",code:q.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")B$.test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"cuid",code:q.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")V$.test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"cuid2",code:q.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")G$.test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"ulid",code:q.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),te(s,{validation:"url",code:q.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"regex",code:q.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),te(s,{code:q.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),te(s,{code:q.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),te(s,{code:q.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?ZI(i).test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{code:q.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?nU.test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{code:q.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?rU(i).test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{code:q.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?W$.test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"duration",code:q.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?sU(e.data,i.version)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"ip",code:q.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?iU(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"jwt",code:q.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?aU(e.data,i.version)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"cidr",code:q.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?eU.test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"base64",code:q.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?tU.test(e.data)||(s=this._getOrReturnCtx(e,s),te(s,{validation:"base64url",code:q.invalid_string,message:i.message}),r.dirty()):Be.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:q.invalid_string,...he.errToObj(r)})}_addCheck(e){return new gr({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...he.errToObj(e)})}url(e){return this._addCheck({kind:"url",...he.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...he.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...he.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...he.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...he.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...he.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...he.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...he.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...he.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...he.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...he.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...he.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...he.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...he.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...he.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...he.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...he.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...he.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...he.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...he.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...he.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...he.errToObj(t)})}nonempty(e){return this.min(1,he.errToObj(e))}trim(){return new gr({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new gr({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new gr({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}gr.create=n=>{var e;return new gr({checks:[],typeName:ve.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Re(n)})};function oU(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=parseInt(n.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}class vi extends Oe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ae.number){const i=this._getOrReturnCtx(e);return te(i,{code:q.invalid_type,expected:ae.number,received:i.parsedType}),Ee}let r;const s=new en;for(const i of this._def.checks)i.kind==="int"?Be.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),te(r,{code:q.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),te(r,{code:q.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),te(r,{code:q.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?oU(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),te(r,{code:q.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),te(r,{code:q.not_finite,message:i.message}),s.dirty()):Be.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,he.toString(t))}gt(e,t){return this.setLimit("min",e,!1,he.toString(t))}lte(e,t){return this.setLimit("max",e,!0,he.toString(t))}lt(e,t){return this.setLimit("max",e,!1,he.toString(t))}setLimit(e,t,r,s){return new vi({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:he.toString(s)}]})}_addCheck(e){return new vi({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:he.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:he.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:he.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:he.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:he.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:he.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:he.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:he.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:he.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Be.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}vi.create=n=>new vi({checks:[],typeName:ve.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Re(n)});class xi extends Oe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ae.bigint)return this._getInvalidInput(e);let r;const s=new en;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),te(r,{code:q.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),te(r,{code:q.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),te(r,{code:q.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):Be.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return te(t,{code:q.invalid_type,expected:ae.bigint,received:t.parsedType}),Ee}gte(e,t){return this.setLimit("min",e,!0,he.toString(t))}gt(e,t){return this.setLimit("min",e,!1,he.toString(t))}lte(e,t){return this.setLimit("max",e,!0,he.toString(t))}lt(e,t){return this.setLimit("max",e,!1,he.toString(t))}setLimit(e,t,r,s){return new xi({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:he.toString(s)}]})}_addCheck(e){return new xi({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:he.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:he.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:he.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:he.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:he.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}xi.create=n=>{var e;return new xi({checks:[],typeName:ve.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Re(n)})};class lc extends Oe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ae.boolean){const r=this._getOrReturnCtx(e);return te(r,{code:q.invalid_type,expected:ae.boolean,received:r.parsedType}),Ee}return fn(e.data)}}lc.create=n=>new lc({typeName:ve.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Re(n)});class da extends Oe{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ae.date){const i=this._getOrReturnCtx(e);return te(i,{code:q.invalid_type,expected:ae.date,received:i.parsedType}),Ee}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return te(i,{code:q.invalid_date}),Ee}const r=new en;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),te(s,{code:q.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),te(s,{code:q.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):Be.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new da({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:he.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:he.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}da.create=n=>new da({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:ve.ZodDate,...Re(n)});class Hd extends Oe{_parse(e){if(this._getType(e)!==ae.symbol){const r=this._getOrReturnCtx(e);return te(r,{code:q.invalid_type,expected:ae.symbol,received:r.parsedType}),Ee}return fn(e.data)}}Hd.create=n=>new Hd({typeName:ve.ZodSymbol,...Re(n)});class cc extends Oe{_parse(e){if(this._getType(e)!==ae.undefined){const r=this._getOrReturnCtx(e);return te(r,{code:q.invalid_type,expected:ae.undefined,received:r.parsedType}),Ee}return fn(e.data)}}cc.create=n=>new cc({typeName:ve.ZodUndefined,...Re(n)});class uc extends Oe{_parse(e){if(this._getType(e)!==ae.null){const r=this._getOrReturnCtx(e);return te(r,{code:q.invalid_type,expected:ae.null,received:r.parsedType}),Ee}return fn(e.data)}}uc.create=n=>new uc({typeName:ve.ZodNull,...Re(n)});class No extends Oe{constructor(){super(...arguments),this._any=!0}_parse(e){return fn(e.data)}}No.create=n=>new No({typeName:ve.ZodAny,...Re(n)});class Xi extends Oe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return fn(e.data)}}Xi.create=n=>new Xi({typeName:ve.ZodUnknown,...Re(n)});class Rs extends Oe{_parse(e){const t=this._getOrReturnCtx(e);return te(t,{code:q.invalid_type,expected:ae.never,received:t.parsedType}),Ee}}Rs.create=n=>new Rs({typeName:ve.ZodNever,...Re(n)});class zd extends Oe{_parse(e){if(this._getType(e)!==ae.undefined){const r=this._getOrReturnCtx(e);return te(r,{code:q.invalid_type,expected:ae.void,received:r.parsedType}),Ee}return fn(e.data)}}zd.create=n=>new zd({typeName:ve.ZodVoid,...Re(n)});class Sr extends Oe{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==ae.array)return te(t,{code:q.invalid_type,expected:ae.array,received:t.parsedType}),Ee;if(s.exactLength!==null){const a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(te(t,{code:a?q.too_big:q.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(te(t,{code:q.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(te(t,{code:q.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new Zr(t,a,t.path,o)))).then(a=>en.mergeArray(r,a));const i=[...t.data].map((a,o)=>s.type._parseSync(new Zr(t,a,t.path,o)));return en.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new Sr({...this._def,minLength:{value:e,message:he.toString(t)}})}max(e,t){return new Sr({...this._def,maxLength:{value:e,message:he.toString(t)}})}length(e,t){return new Sr({...this._def,exactLength:{value:e,message:he.toString(t)}})}nonempty(e){return this.min(1,e)}}Sr.create=(n,e)=>new Sr({type:n,minLength:null,maxLength:null,exactLength:null,typeName:ve.ZodArray,...Re(e)});function Da(n){if(n instanceof ft){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=qr.create(Da(r))}return new ft({...n._def,shape:()=>e})}else return n instanceof Sr?new Sr({...n._def,type:Da(n.element)}):n instanceof qr?qr.create(Da(n.unwrap())):n instanceof Ei?Ei.create(Da(n.unwrap())):n instanceof Jr?Jr.create(n.items.map(e=>Da(e))):n}class ft extends Oe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Be.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==ae.object){const c=this._getOrReturnCtx(e);return te(c,{code:q.invalid_type,expected:ae.object,received:c.parsedType}),Ee}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Rs&&this._def.unknownKeys==="strip"))for(const c in s.data)a.includes(c)||o.push(c);const l=[];for(const c of a){const u=i[c],d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new Zr(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof Rs){const c=this._def.unknownKeys;if(c==="passthrough")for(const u of o)l.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(c==="strict")o.length>0&&(te(s,{code:q.unrecognized_keys,keys:o}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const u of o){const d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new Zr(s,d,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const u of l){const d=await u.key,f=await u.value;c.push({key:d,value:f,alwaysSet:u.alwaysSet})}return c}).then(c=>en.mergeObjectSync(r,c)):en.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return he.errToObj,new ft({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var s,i,a,o;const l=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,r).message)!==null&&a!==void 0?a:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=he.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new ft({...this._def,unknownKeys:"strip"})}passthrough(){return new ft({...this._def,unknownKeys:"passthrough"})}extend(e){return new ft({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ft({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ve.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ft({...this._def,catchall:e})}pick(e){const t={};return Be.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new ft({...this._def,shape:()=>t})}omit(e){const t={};return Be.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new ft({...this._def,shape:()=>t})}deepPartial(){return Da(this)}partial(e){const t={};return Be.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new ft({...this._def,shape:()=>t})}required(e){const t={};return Be.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof qr;)i=i._def.innerType;t[r]=i}}),new ft({...this._def,shape:()=>t})}keyof(){return JI(Be.objectKeys(this.shape))}}ft.create=(n,e)=>new ft({shape:()=>n,unknownKeys:"strip",catchall:Rs.create(),typeName:ve.ZodObject,...Re(e)});ft.strictCreate=(n,e)=>new ft({shape:()=>n,unknownKeys:"strict",catchall:Rs.create(),typeName:ve.ZodObject,...Re(e)});ft.lazycreate=(n,e)=>new ft({shape:n,unknownKeys:"strip",catchall:Rs.create(),typeName:ve.ZodObject,...Re(e)});class dc extends Oe{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new $n(o.ctx.common.issues));return te(t,{code:q.invalid_union,unionErrors:a}),Ee}if(t.common.async)return Promise.all(r.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const l of r){const c={...t,common:{...t.common,issues:[]},parent:null},u=l._parseSync({data:t.data,path:t.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(l=>new $n(l));return te(t,{code:q.invalid_union,unionErrors:o}),Ee}}get options(){return this._def.options}}dc.create=(n,e)=>new dc({options:n,typeName:ve.ZodUnion,...Re(e)});const us=n=>n instanceof mc?us(n.schema):n instanceof Ar?us(n.innerType()):n instanceof pc?[n.value]:n instanceof Si?n.options:n instanceof gc?Be.objectValues(n.enum):n instanceof yc?us(n._def.innerType):n instanceof cc?[void 0]:n instanceof uc?[null]:n instanceof qr?[void 0,...us(n.unwrap())]:n instanceof Ei?[null,...us(n.unwrap())]:n instanceof my||n instanceof xc?us(n.unwrap()):n instanceof vc?us(n._def.innerType):[];class Jf extends Oe{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ae.object)return te(t,{code:q.invalid_type,expected:ae.object,received:t.parsedType}),Ee;const r=this.discriminator,s=t.data[r],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(te(t,{code:q.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Ee)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const i of t){const a=us(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new Jf({typeName:ve.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...Re(r)})}}function Wp(n,e){const t=ps(n),r=ps(e);if(n===e)return{valid:!0,data:n};if(t===ae.object&&r===ae.object){const s=Be.objectKeys(e),i=Be.objectKeys(n).filter(o=>s.indexOf(o)!==-1),a={...n,...e};for(const o of i){const l=Wp(n[o],e[o]);if(!l.valid)return{valid:!1};a[o]=l.data}return{valid:!0,data:a}}else if(t===ae.array&&r===ae.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const a=n[i],o=e[i],l=Wp(a,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===ae.date&&r===ae.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class fc extends Oe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,a)=>{if(Hp(i)||Hp(a))return Ee;const o=Wp(i.value,a.value);return o.valid?((zp(i)||zp(a))&&t.dirty(),{status:t.value,value:o.data}):(te(r,{code:q.invalid_intersection_types}),Ee)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}fc.create=(n,e,t)=>new fc({left:n,right:e,typeName:ve.ZodIntersection,...Re(t)});class Jr extends Oe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ae.array)return te(r,{code:q.invalid_type,expected:ae.array,received:r.parsedType}),Ee;if(r.data.length<this._def.items.length)return te(r,{code:q.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ee;!this._def.rest&&r.data.length>this._def.items.length&&(te(r,{code:q.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((a,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new Zr(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(i).then(a=>en.mergeArray(t,a)):en.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new Jr({...this._def,rest:e})}}Jr.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Jr({items:n,typeName:ve.ZodTuple,rest:null,...Re(e)})};class hc extends Oe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ae.object)return te(r,{code:q.invalid_type,expected:ae.object,received:r.parsedType}),Ee;const s=[],i=this._def.keyType,a=this._def.valueType;for(const o in r.data)s.push({key:i._parse(new Zr(r,o,r.path,o)),value:a._parse(new Zr(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?en.mergeObjectAsync(t,s):en.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof Oe?new hc({keyType:e,valueType:t,typeName:ve.ZodRecord,...Re(r)}):new hc({keyType:gr.create(),valueType:e,typeName:ve.ZodRecord,...Re(t)})}}class Wd extends Oe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ae.map)return te(r,{code:q.invalid_type,expected:ae.map,received:r.parsedType}),Ee;const s=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([o,l],c)=>({key:s._parse(new Zr(r,o,r.path,[c,"key"])),value:i._parse(new Zr(r,l,r.path,[c,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of a){const c=await l.key,u=await l.value;if(c.status==="aborted"||u.status==="aborted")return Ee;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(c.value,u.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const l of a){const c=l.key,u=l.value;if(c.status==="aborted"||u.status==="aborted")return Ee;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(c.value,u.value)}return{status:t.value,value:o}}}}Wd.create=(n,e,t)=>new Wd({valueType:e,keyType:n,typeName:ve.ZodMap,...Re(t)});class fa extends Oe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ae.set)return te(r,{code:q.invalid_type,expected:ae.set,received:r.parsedType}),Ee;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(te(r,{code:q.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(te(r,{code:q.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function a(l){const c=new Set;for(const u of l){if(u.status==="aborted")return Ee;u.status==="dirty"&&t.dirty(),c.add(u.value)}return{status:t.value,value:c}}const o=[...r.data.values()].map((l,c)=>i._parse(new Zr(r,l,r.path,c)));return r.common.async?Promise.all(o).then(l=>a(l)):a(o)}min(e,t){return new fa({...this._def,minSize:{value:e,message:he.toString(t)}})}max(e,t){return new fa({...this._def,maxSize:{value:e,message:he.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}fa.create=(n,e)=>new fa({valueType:n,minSize:null,maxSize:null,typeName:ve.ZodSet,...Re(e)});class so extends Oe{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ae.function)return te(t,{code:q.invalid_type,expected:ae.function,received:t.parsedType}),Ee;function r(o,l){return Gd({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Vd(),Po].filter(c=>!!c),issueData:{code:q.invalid_arguments,argumentsError:l}})}function s(o,l){return Gd({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Vd(),Po].filter(c=>!!c),issueData:{code:q.invalid_return_type,returnTypeError:l}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Oo){const o=this;return fn(async function(...l){const c=new $n([]),u=await o._def.args.parseAsync(l,i).catch(m=>{throw c.addIssue(r(l,m)),c}),d=await Reflect.apply(a,this,u);return await o._def.returns._def.type.parseAsync(d,i).catch(m=>{throw c.addIssue(s(d,m)),c})})}else{const o=this;return fn(function(...l){const c=o._def.args.safeParse(l,i);if(!c.success)throw new $n([r(l,c.error)]);const u=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(u,i);if(!d.success)throw new $n([s(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new so({...this._def,args:Jr.create(e).rest(Xi.create())})}returns(e){return new so({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new so({args:e||Jr.create([]).rest(Xi.create()),returns:t||Xi.create(),typeName:ve.ZodFunction,...Re(r)})}}class mc extends Oe{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}mc.create=(n,e)=>new mc({getter:n,typeName:ve.ZodLazy,...Re(e)});class pc extends Oe{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return te(t,{received:t.data,code:q.invalid_literal,expected:this._def.value}),Ee}return{status:"valid",value:e.data}}get value(){return this._def.value}}pc.create=(n,e)=>new pc({value:n,typeName:ve.ZodLiteral,...Re(e)});function JI(n,e){return new Si({values:n,typeName:ve.ZodEnum,...Re(e)})}class Si extends Oe{constructor(){super(...arguments),vl.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return te(t,{expected:Be.joinValues(r),received:t.parsedType,code:q.invalid_type}),Ee}if(Kd(this,vl)||qI(this,vl,new Set(this._def.values)),!Kd(this,vl).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return te(t,{received:t.data,code:q.invalid_enum_value,options:r}),Ee}return fn(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Si.create(e,{...this._def,...t})}exclude(e,t=this._def){return Si.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}vl=new WeakMap;Si.create=JI;class gc extends Oe{constructor(){super(...arguments),xl.set(this,void 0)}_parse(e){const t=Be.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==ae.string&&r.parsedType!==ae.number){const s=Be.objectValues(t);return te(r,{expected:Be.joinValues(s),received:r.parsedType,code:q.invalid_type}),Ee}if(Kd(this,xl)||qI(this,xl,new Set(Be.getValidEnumValues(this._def.values))),!Kd(this,xl).has(e.data)){const s=Be.objectValues(t);return te(r,{received:r.data,code:q.invalid_enum_value,options:s}),Ee}return fn(e.data)}get enum(){return this._def.values}}xl=new WeakMap;gc.create=(n,e)=>new gc({values:n,typeName:ve.ZodNativeEnum,...Re(e)});class Oo extends Oe{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ae.promise&&t.common.async===!1)return te(t,{code:q.invalid_type,expected:ae.promise,received:t.parsedType}),Ee;const r=t.parsedType===ae.promise?t.data:Promise.resolve(t.data);return fn(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Oo.create=(n,e)=>new Oo({type:n,typeName:ve.ZodPromise,...Re(e)});class Ar extends Oe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ve.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{te(r,a),a.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(r.data,i);if(r.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return Ee;const l=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return l.status==="aborted"?Ee:l.status==="dirty"||t.value==="dirty"?za(l.value):l});{if(t.value==="aborted")return Ee;const o=this._def.schema._parseSync({data:a,path:r.path,parent:r});return o.status==="aborted"?Ee:o.status==="dirty"||t.value==="dirty"?za(o.value):o}}if(s.type==="refinement"){const a=o=>{const l=s.refinement(o,i);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?Ee:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?Ee:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!ua(a))return a;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>ua(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);Be.assertNever(s)}}Ar.create=(n,e,t)=>new Ar({schema:n,typeName:ve.ZodEffects,effect:e,...Re(t)});Ar.createWithPreprocess=(n,e,t)=>new Ar({schema:e,effect:{type:"preprocess",transform:n},typeName:ve.ZodEffects,...Re(t)});class qr extends Oe{_parse(e){return this._getType(e)===ae.undefined?fn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}qr.create=(n,e)=>new qr({innerType:n,typeName:ve.ZodOptional,...Re(e)});class Ei extends Oe{_parse(e){return this._getType(e)===ae.null?fn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ei.create=(n,e)=>new Ei({innerType:n,typeName:ve.ZodNullable,...Re(e)});class yc extends Oe{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===ae.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}yc.create=(n,e)=>new yc({innerType:n,typeName:ve.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Re(e)});class vc extends Oe{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return oc(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new $n(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new $n(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}vc.create=(n,e)=>new vc({innerType:n,typeName:ve.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Re(e)});class Yd extends Oe{_parse(e){if(this._getType(e)!==ae.nan){const r=this._getOrReturnCtx(e);return te(r,{code:q.invalid_type,expected:ae.nan,received:r.parsedType}),Ee}return{status:"valid",value:e.data}}}Yd.create=n=>new Yd({typeName:ve.ZodNaN,...Re(n)});const lU=Symbol("zod_brand");class my extends Oe{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Vc extends Oe{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?Ee:i.status==="dirty"?(t.dirty(),za(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?Ee:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new Vc({in:e,out:t,typeName:ve.ZodPipeline})}}class xc extends Oe{_parse(e){const t=this._def.innerType._parse(e),r=s=>(ua(s)&&(s.value=Object.freeze(s.value)),s);return oc(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}}xc.create=(n,e)=>new xc({innerType:n,typeName:ve.ZodReadonly,...Re(e)});function lS(n,e){const t=typeof n=="function"?n(e):typeof n=="string"?{message:n}:n;return typeof t=="string"?{message:t}:t}function eR(n,e={},t){return n?No.create().superRefine((r,s)=>{var i,a;const o=n(r);if(o instanceof Promise)return o.then(l=>{var c,u;if(!l){const d=lS(e,r),f=(u=(c=d.fatal)!==null&&c!==void 0?c:t)!==null&&u!==void 0?u:!0;s.addIssue({code:"custom",...d,fatal:f})}});if(!o){const l=lS(e,r),c=(a=(i=l.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0;s.addIssue({code:"custom",...l,fatal:c})}}):No.create()}const cU={object:ft.lazycreate};var ve;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(ve||(ve={}));const uU=(n,e={message:`Input not instance of ${n.name}`})=>eR(t=>t instanceof n,e),tR=gr.create,nR=vi.create,dU=Yd.create,fU=xi.create,rR=lc.create,hU=da.create,mU=Hd.create,pU=cc.create,gU=uc.create,yU=No.create,vU=Xi.create,xU=Rs.create,SU=zd.create,EU=Sr.create,TU=ft.create,bU=ft.strictCreate,wU=dc.create,AU=Jf.create,_U=fc.create,IU=Jr.create,RU=hc.create,CU=Wd.create,LU=fa.create,kU=so.create,DU=mc.create,PU=pc.create,NU=Si.create,OU=gc.create,MU=Oo.create,cS=Ar.create,FU=qr.create,jU=Ei.create,$U=Ar.createWithPreprocess,UU=Vc.create,BU=()=>tR().optional(),VU=()=>nR().optional(),GU=()=>rR().optional(),KU={string:n=>gr.create({...n,coerce:!0}),number:n=>vi.create({...n,coerce:!0}),boolean:n=>lc.create({...n,coerce:!0}),bigint:n=>xi.create({...n,coerce:!0}),date:n=>da.create({...n,coerce:!0})},HU=Ee;var Ie=Object.freeze({__proto__:null,defaultErrorMap:Po,setErrorMap:$$,getErrorMap:Vd,makeIssue:Gd,EMPTY_PATH:U$,addIssueToContext:te,ParseStatus:en,INVALID:Ee,DIRTY:za,OK:fn,isAborted:Hp,isDirty:zp,isValid:ua,isAsync:oc,get util(){return Be},get objectUtil(){return Kp},ZodParsedType:ae,getParsedType:ps,ZodType:Oe,datetimeRegex:ZI,ZodString:gr,ZodNumber:vi,ZodBigInt:xi,ZodBoolean:lc,ZodDate:da,ZodSymbol:Hd,ZodUndefined:cc,ZodNull:uc,ZodAny:No,ZodUnknown:Xi,ZodNever:Rs,ZodVoid:zd,ZodArray:Sr,ZodObject:ft,ZodUnion:dc,ZodDiscriminatedUnion:Jf,ZodIntersection:fc,ZodTuple:Jr,ZodRecord:hc,ZodMap:Wd,ZodSet:fa,ZodFunction:so,ZodLazy:mc,ZodLiteral:pc,ZodEnum:Si,ZodNativeEnum:gc,ZodPromise:Oo,ZodEffects:Ar,ZodTransformer:Ar,ZodOptional:qr,ZodNullable:Ei,ZodDefault:yc,ZodCatch:vc,ZodNaN:Yd,BRAND:lU,ZodBranded:my,ZodPipeline:Vc,ZodReadonly:xc,custom:eR,Schema:Oe,ZodSchema:Oe,late:cU,get ZodFirstPartyTypeKind(){return ve},coerce:KU,any:yU,array:EU,bigint:fU,boolean:rR,date:hU,discriminatedUnion:AU,effect:cS,enum:NU,function:kU,instanceof:uU,intersection:_U,lazy:DU,literal:PU,map:CU,nan:dU,nativeEnum:OU,never:xU,null:gU,nullable:jU,number:nR,object:TU,oboolean:GU,onumber:VU,optional:FU,ostring:BU,pipeline:UU,preprocess:$U,promise:MU,record:RU,set:LU,strictObject:bU,string:tR,symbol:mU,transformer:cS,tuple:IU,undefined:pU,union:wU,unknown:vU,void:SU,NEVER:HU,ZodIssueCode:q,quotelessJson:j$,ZodError:$n});const Ea=v_,zU=x_,sR=E.forwardRef(({className:n,...e},t)=>h.jsx(Gf,{ref:t,className:J("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...e}));sR.displayName=Gf.displayName;const Ii=E.forwardRef(({className:n,children:e,...t},r)=>h.jsxs(zU,{children:[h.jsx(sR,{}),h.jsxs(Kf,{ref:r,className:J("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...t,children:[e,h.jsxs(S_,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[h.jsx(I0,{className:"h-4 w-4"}),h.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ii.displayName=Kf.displayName;const Ri=({className:n,...e})=>h.jsx("div",{className:J("flex flex-col space-y-1.5 text-center sm:text-left",n),...e});Ri.displayName="DialogHeader";const Ci=({className:n,...e})=>h.jsx("div",{className:J("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",n),...e});Ci.displayName="DialogFooter";const Li=E.forwardRef(({className:n,...e},t)=>h.jsx(Hf,{ref:t,className:J("text-lg font-semibold leading-none tracking-tight",n),...e}));Li.displayName=Hf.displayName;const WU=E.forwardRef(({className:n,...e},t)=>h.jsx(zf,{ref:t,className:J("text-sm text-muted-foreground",n),...e}));WU.displayName=zf.displayName;var YU="Label",iR=E.forwardRef((n,e)=>h.jsx(xe.label,{...n,ref:e,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||((s=n.onMouseDown)==null||s.call(n,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));iR.displayName=YU;var aR=iR;const qU=va("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Ne=E.forwardRef(({className:n,...e},t)=>h.jsx(aR,{ref:t,className:J(qU(),n),...e}));Ne.displayName=aR.displayName;const ni=E.forwardRef(({className:n,...e},t)=>h.jsx("textarea",{className:J("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:t,...e}));ni.displayName="Textarea";const QU=Ie.object({name:Ie.string().min(1,"Tn l bt buc"),email:Ie.string().email("Email khng hp l"),phone:Ie.string().regex(/^\d{10}$/,"S in thoi phi gm 10 ch s"),address:Ie.string().optional()});function XU({open:n,onOpenChange:e}){const{toast:t}=ns(),r=_r(),s=Qo({resolver:Xo(QU),defaultValues:{name:"",email:"",phone:"",address:""}}),i=Tr({mutationFn:async o=>await(await Qr("POST","/api/customers",{...o,isActive:!0})).json(),onSuccess:o=>{r.setQueryData(["/api/customers"],l=>l&&[o,...l]),r.invalidateQueries({queryKey:["/api/customers"]}),t({title:"Thnh cng",description:" thm khch hng mi"}),s.reset(),e(!1)},onError:async o=>{let l=o==null?void 0:o.message,c="Khng th thm khch hng";if(l){const u=l.indexOf(": "),d=u>=0?l.slice(u+2):l;try{const f=JSON.parse(d);f!=null&&f.error&&(c=f.error)}catch{c=d}}(/Email  tn ti/i.test(c)||/Email khng hp l/i.test(c))&&s.setError("email",{message:c}),(/S in thoi  tn ti/i.test(c)||/S in thoi.*10 ch s/i.test(c))&&s.setError("phone",{message:c}),t({title:"Li",description:c,variant:"destructive"})}}),a=o=>{i.mutate(o)};return h.jsx(Ea,{open:n,onOpenChange:e,children:h.jsxs(Ii,{className:"sm:max-w-[500px]",children:[h.jsx(Ri,{children:h.jsx(Li,{children:"Thm khch hng mi"})}),h.jsxs("form",{onSubmit:s.handleSubmit(a),className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"name",children:"H v tn *"}),h.jsx(Xe,{id:"name",...s.register("name"),"data-testid":"input-customer-name"}),s.formState.errors.name&&h.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.name.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"email",children:"Email *"}),h.jsx(Xe,{id:"email",type:"email",...s.register("email"),"data-testid":"input-customer-email"}),s.formState.errors.email&&h.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.email.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"phone",children:"S in thoi *"}),h.jsx(Xe,{id:"phone",...s.register("phone"),"data-testid":"input-customer-phone"}),s.formState.errors.phone&&h.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.phone.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"address",children:"a ch"}),h.jsx(ni,{id:"address",...s.register("address"),rows:3,"data-testid":"input-customer-address"})]}),h.jsxs(Ci,{children:[h.jsx(be,{type:"button",variant:"outline",onClick:()=>e(!1),children:"Hy"}),h.jsx(be,{type:"submit",disabled:i.isPending,"data-testid":"button-save-customer",children:i.isPending?"ang lu...":"Lu"})]})]})]})})}function uS(n,[e,t]){return Math.min(t,Math.max(e,n))}function ZU(n){const e=E.useRef({value:n,previous:n});return E.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}var JU=[" ","Enter","ArrowUp","ArrowDown"],eB=[" ","Enter"],Gc="Select",[eh,th,tB]=Rf(Gc),[Zo,yK]=Ir(Gc,[tB,Wo]),nh=Wo(),[nB,ki]=Zo(Gc),[rB,sB]=Zo(Gc),oR=n=>{const{__scopeSelect:e,children:t,open:r,defaultOpen:s,onOpenChange:i,value:a,defaultValue:o,onValueChange:l,dir:c,name:u,autoComplete:d,disabled:f,required:m,form:p}=n,g=nh(e),[v,x]=E.useState(null),[y,S]=E.useState(null),[b,w]=E.useState(!1),_=Wf(c),[A=!1,I]=hi({prop:r,defaultProp:s,onChange:i}),[C,R]=hi({prop:a,defaultProp:o,onChange:l}),P=E.useRef(null),O=v?p||!!v.closest("form"):!0,[U,j]=E.useState(new Set),G=Array.from(U).map($=>$.props.value).join(";");return h.jsx(j0,{...g,children:h.jsxs(nB,{required:m,scope:e,trigger:v,onTriggerChange:x,valueNode:y,onValueNodeChange:S,valueNodeHasChildren:b,onValueNodeHasChildrenChange:w,contentId:xr(),value:C,onValueChange:R,open:A,onOpenChange:I,dir:_,triggerPointerDownPosRef:P,disabled:f,children:[h.jsx(eh.Provider,{scope:e,children:h.jsx(rB,{scope:n.__scopeSelect,onNativeOptionAdd:E.useCallback($=>{j(Y=>new Set(Y).add($))},[]),onNativeOptionRemove:E.useCallback($=>{j(Y=>{const D=new Set(Y);return D.delete($),D})},[]),children:t})}),O?h.jsxs(DR,{"aria-hidden":!0,required:m,tabIndex:-1,name:u,autoComplete:d,value:C,onChange:$=>R($.target.value),disabled:f,form:p,children:[C===void 0?h.jsx("option",{value:""}):null,Array.from(U)]},G):null]})})};oR.displayName=Gc;var lR="SelectTrigger",cR=E.forwardRef((n,e)=>{const{__scopeSelect:t,disabled:r=!1,...s}=n,i=nh(t),a=ki(lR,t),o=a.disabled||r,l=He(e,a.onTriggerChange),c=th(t),u=E.useRef("touch"),[d,f,m]=PR(g=>{const v=c().filter(S=>!S.disabled),x=v.find(S=>S.value===a.value),y=NR(v,g,x);y!==void 0&&a.onValueChange(y.value)}),p=g=>{o||(a.onOpenChange(!0),m()),g&&(a.triggerPointerDownPosRef.current={x:Math.round(g.pageX),y:Math.round(g.pageY)})};return h.jsx($0,{asChild:!0,...i,children:h.jsx(xe.button,{type:"button",role:"combobox","aria-controls":a.contentId,"aria-expanded":a.open,"aria-required":a.required,"aria-autocomplete":"none",dir:a.dir,"data-state":a.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":kR(a.value)?"":void 0,...s,ref:l,onClick:ne(s.onClick,g=>{g.currentTarget.focus(),u.current!=="mouse"&&p(g)}),onPointerDown:ne(s.onPointerDown,g=>{u.current=g.pointerType;const v=g.target;v.hasPointerCapture(g.pointerId)&&v.releasePointerCapture(g.pointerId),g.button===0&&g.ctrlKey===!1&&g.pointerType==="mouse"&&(p(g),g.preventDefault())}),onKeyDown:ne(s.onKeyDown,g=>{const v=d.current!=="";!(g.ctrlKey||g.altKey||g.metaKey)&&g.key.length===1&&f(g.key),!(v&&g.key===" ")&&JU.includes(g.key)&&(p(),g.preventDefault())})})})});cR.displayName=lR;var uR="SelectValue",dR=E.forwardRef((n,e)=>{const{__scopeSelect:t,className:r,style:s,children:i,placeholder:a="",...o}=n,l=ki(uR,t),{onValueNodeHasChildrenChange:c}=l,u=i!==void 0,d=He(e,l.onValueNodeChange);return Nt(()=>{c(u)},[c,u]),h.jsx(xe.span,{...o,ref:d,style:{pointerEvents:"none"},children:kR(l.value)?h.jsx(h.Fragment,{children:a}):i})});dR.displayName=uR;var iB="SelectIcon",fR=E.forwardRef((n,e)=>{const{__scopeSelect:t,children:r,...s}=n;return h.jsx(xe.span,{"aria-hidden":!0,...s,ref:e,children:r||""})});fR.displayName=iB;var aB="SelectPortal",hR=n=>h.jsx(Mc,{asChild:!0,...n});hR.displayName=aB;var ha="SelectContent",mR=E.forwardRef((n,e)=>{const t=ki(ha,n.__scopeSelect),[r,s]=E.useState();if(Nt(()=>{s(new DocumentFragment)},[]),!t.open){const i=r;return i?ya.createPortal(h.jsx(pR,{scope:n.__scopeSelect,children:h.jsx(eh.Slot,{scope:n.__scopeSelect,children:h.jsx("div",{children:n.children})})}),i):null}return h.jsx(gR,{...n,ref:e})});mR.displayName=ha;var or=10,[pR,Di]=Zo(ha),oB="SelectContentImpl",lB=oa("SelectContent.RemoveScroll"),gR=E.forwardRef((n,e)=>{const{__scopeSelect:t,position:r="item-aligned",onCloseAutoFocus:s,onEscapeKeyDown:i,onPointerDownOutside:a,side:o,sideOffset:l,align:c,alignOffset:u,arrowPadding:d,collisionBoundary:f,collisionPadding:m,sticky:p,hideWhenDetached:g,avoidCollisions:v,...x}=n,y=ki(ha,t),[S,b]=E.useState(null),[w,_]=E.useState(null),A=He(e,ee=>b(ee)),[I,C]=E.useState(null),[R,P]=E.useState(null),O=th(t),[U,j]=E.useState(!1),G=E.useRef(!1);E.useEffect(()=>{if(S)return K0(S)},[S]),G0();const $=E.useCallback(ee=>{const[Se,...Ae]=O().map(Ve=>Ve.ref.current),[_e]=Ae.slice(-1),De=document.activeElement;for(const Ve of ee)if(Ve===De||(Ve==null||Ve.scrollIntoView({block:"nearest"}),Ve===Se&&w&&(w.scrollTop=0),Ve===_e&&w&&(w.scrollTop=w.scrollHeight),Ve==null||Ve.focus(),document.activeElement!==De))return},[O,w]),Y=E.useCallback(()=>$([I,S]),[$,I,S]);E.useEffect(()=>{U&&Y()},[U,Y]);const{onOpenChange:D,triggerPointerDownPosRef:N}=y;E.useEffect(()=>{if(S){let ee={x:0,y:0};const Se=_e=>{var De,Ve;ee={x:Math.abs(Math.round(_e.pageX)-(((De=N.current)==null?void 0:De.x)??0)),y:Math.abs(Math.round(_e.pageY)-(((Ve=N.current)==null?void 0:Ve.y)??0))}},Ae=_e=>{ee.x<=10&&ee.y<=10?_e.preventDefault():S.contains(_e.target)||D(!1),document.removeEventListener("pointermove",Se),N.current=null};return N.current!==null&&(document.addEventListener("pointermove",Se),document.addEventListener("pointerup",Ae,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Se),document.removeEventListener("pointerup",Ae,{capture:!0})}}},[S,D,N]),E.useEffect(()=>{const ee=()=>D(!1);return window.addEventListener("blur",ee),window.addEventListener("resize",ee),()=>{window.removeEventListener("blur",ee),window.removeEventListener("resize",ee)}},[D]);const[K,V]=PR(ee=>{const Se=O().filter(De=>!De.disabled),Ae=Se.find(De=>De.ref.current===document.activeElement),_e=NR(Se,ee,Ae);_e&&setTimeout(()=>_e.ref.current.focus())}),W=E.useCallback((ee,Se,Ae)=>{const _e=!G.current&&!Ae;(y.value!==void 0&&y.value===Se||_e)&&(C(ee),_e&&(G.current=!0))},[y.value]),de=E.useCallback(()=>S==null?void 0:S.focus(),[S]),pe=E.useCallback((ee,Se,Ae)=>{const _e=!G.current&&!Ae;(y.value!==void 0&&y.value===Se||_e)&&P(ee)},[y.value]),ge=r==="popper"?Yp:yR,me=ge===Yp?{side:o,sideOffset:l,align:c,alignOffset:u,arrowPadding:d,collisionBoundary:f,collisionPadding:m,sticky:p,hideWhenDetached:g,avoidCollisions:v}:{};return h.jsx(pR,{scope:t,content:S,viewport:w,onViewportChange:_,itemRefCallback:W,selectedItem:I,onItemLeave:de,itemTextRefCallback:pe,focusSelectedItem:Y,selectedItemText:R,position:r,isPositioned:U,searchRef:K,children:h.jsx(Vf,{as:lB,allowPinchZoom:!0,children:h.jsx(Uf,{asChild:!0,trapped:y.open,onMountAutoFocus:ee=>{ee.preventDefault()},onUnmountAutoFocus:ne(s,ee=>{var Se;(Se=y.trigger)==null||Se.focus({preventScroll:!0}),ee.preventDefault()}),children:h.jsx(Go,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:i,onPointerDownOutside:a,onFocusOutside:ee=>ee.preventDefault(),onDismiss:()=>y.onOpenChange(!1),children:h.jsx(ge,{role:"listbox",id:y.contentId,"data-state":y.open?"open":"closed",dir:y.dir,onContextMenu:ee=>ee.preventDefault(),...x,...me,onPlaced:()=>j(!0),ref:A,style:{display:"flex",flexDirection:"column",outline:"none",...x.style},onKeyDown:ne(x.onKeyDown,ee=>{const Se=ee.ctrlKey||ee.altKey||ee.metaKey;if(ee.key==="Tab"&&ee.preventDefault(),!Se&&ee.key.length===1&&V(ee.key),["ArrowUp","ArrowDown","Home","End"].includes(ee.key)){let _e=O().filter(De=>!De.disabled).map(De=>De.ref.current);if(["ArrowUp","End"].includes(ee.key)&&(_e=_e.slice().reverse()),["ArrowUp","ArrowDown"].includes(ee.key)){const De=ee.target,Ve=_e.indexOf(De);_e=_e.slice(Ve+1)}setTimeout(()=>$(_e)),ee.preventDefault()}})})})})})})});gR.displayName=oB;var cB="SelectItemAlignedPosition",yR=E.forwardRef((n,e)=>{const{__scopeSelect:t,onPlaced:r,...s}=n,i=ki(ha,t),a=Di(ha,t),[o,l]=E.useState(null),[c,u]=E.useState(null),d=He(e,A=>u(A)),f=th(t),m=E.useRef(!1),p=E.useRef(!0),{viewport:g,selectedItem:v,selectedItemText:x,focusSelectedItem:y}=a,S=E.useCallback(()=>{if(i.trigger&&i.valueNode&&o&&c&&g&&v&&x){const A=i.trigger.getBoundingClientRect(),I=c.getBoundingClientRect(),C=i.valueNode.getBoundingClientRect(),R=x.getBoundingClientRect();if(i.dir!=="rtl"){const De=R.left-I.left,Ve=C.left-De,_t=A.left-Ve,jt=A.width+_t,Ls=Math.max(jt,I.width),Ce=window.innerWidth-or,it=uS(Ve,[or,Math.max(or,Ce-Ls)]);o.style.minWidth=jt+"px",o.style.left=it+"px"}else{const De=I.right-R.right,Ve=window.innerWidth-C.right-De,_t=window.innerWidth-A.right-Ve,jt=A.width+_t,Ls=Math.max(jt,I.width),Ce=window.innerWidth-or,it=uS(Ve,[or,Math.max(or,Ce-Ls)]);o.style.minWidth=jt+"px",o.style.right=it+"px"}const P=f(),O=window.innerHeight-or*2,U=g.scrollHeight,j=window.getComputedStyle(c),G=parseInt(j.borderTopWidth,10),$=parseInt(j.paddingTop,10),Y=parseInt(j.borderBottomWidth,10),D=parseInt(j.paddingBottom,10),N=G+$+U+D+Y,K=Math.min(v.offsetHeight*5,N),V=window.getComputedStyle(g),W=parseInt(V.paddingTop,10),de=parseInt(V.paddingBottom,10),pe=A.top+A.height/2-or,ge=O-pe,me=v.offsetHeight/2,ee=v.offsetTop+me,Se=G+$+ee,Ae=N-Se;if(Se<=pe){const De=P.length>0&&v===P[P.length-1].ref.current;o.style.bottom="0px";const Ve=c.clientHeight-g.offsetTop-g.offsetHeight,_t=Math.max(ge,me+(De?de:0)+Ve+Y),jt=Se+_t;o.style.height=jt+"px"}else{const De=P.length>0&&v===P[0].ref.current;o.style.top="0px";const _t=Math.max(pe,G+g.offsetTop+(De?W:0)+me)+Ae;o.style.height=_t+"px",g.scrollTop=Se-pe+g.offsetTop}o.style.margin=`${or}px 0`,o.style.minHeight=K+"px",o.style.maxHeight=O+"px",r==null||r(),requestAnimationFrame(()=>m.current=!0)}},[f,i.trigger,i.valueNode,o,c,g,v,x,i.dir,r]);Nt(()=>S(),[S]);const[b,w]=E.useState();Nt(()=>{c&&w(window.getComputedStyle(c).zIndex)},[c]);const _=E.useCallback(A=>{A&&p.current===!0&&(S(),y==null||y(),p.current=!1)},[S,y]);return h.jsx(dB,{scope:t,contentWrapper:o,shouldExpandOnScrollRef:m,onScrollButtonChange:_,children:h.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:b},children:h.jsx(xe.div,{...s,ref:d,style:{boxSizing:"border-box",maxHeight:"100%",...s.style}})})})});yR.displayName=cB;var uB="SelectPopperPosition",Yp=E.forwardRef((n,e)=>{const{__scopeSelect:t,align:r="start",collisionPadding:s=or,...i}=n,a=nh(t);return h.jsx(U0,{...a,...i,ref:e,align:r,collisionPadding:s,style:{boxSizing:"border-box",...i.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Yp.displayName=uB;var[dB,py]=Zo(ha,{}),qp="SelectViewport",vR=E.forwardRef((n,e)=>{const{__scopeSelect:t,nonce:r,...s}=n,i=Di(qp,t),a=py(qp,t),o=He(e,i.onViewportChange),l=E.useRef(0);return h.jsxs(h.Fragment,{children:[h.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),h.jsx(eh.Slot,{scope:t,children:h.jsx(xe.div,{"data-radix-select-viewport":"",role:"presentation",...s,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...s.style},onScroll:ne(s.onScroll,c=>{const u=c.currentTarget,{contentWrapper:d,shouldExpandOnScrollRef:f}=a;if(f!=null&&f.current&&d){const m=Math.abs(l.current-u.scrollTop);if(m>0){const p=window.innerHeight-or*2,g=parseFloat(d.style.minHeight),v=parseFloat(d.style.height),x=Math.max(g,v);if(x<p){const y=x+m,S=Math.min(p,y),b=y-S;d.style.height=S+"px",d.style.bottom==="0px"&&(u.scrollTop=b>0?b:0,d.style.justifyContent="flex-end")}}}l.current=u.scrollTop})})})]})});vR.displayName=qp;var xR="SelectGroup",[fB,hB]=Zo(xR),mB=E.forwardRef((n,e)=>{const{__scopeSelect:t,...r}=n,s=xr();return h.jsx(fB,{scope:t,id:s,children:h.jsx(xe.div,{role:"group","aria-labelledby":s,...r,ref:e})})});mB.displayName=xR;var SR="SelectLabel",ER=E.forwardRef((n,e)=>{const{__scopeSelect:t,...r}=n,s=hB(SR,t);return h.jsx(xe.div,{id:s.id,...r,ref:e})});ER.displayName=SR;var qd="SelectItem",[pB,TR]=Zo(qd),bR=E.forwardRef((n,e)=>{const{__scopeSelect:t,value:r,disabled:s=!1,textValue:i,...a}=n,o=ki(qd,t),l=Di(qd,t),c=o.value===r,[u,d]=E.useState(i??""),[f,m]=E.useState(!1),p=He(e,y=>{var S;return(S=l.itemRefCallback)==null?void 0:S.call(l,y,r,s)}),g=xr(),v=E.useRef("touch"),x=()=>{s||(o.onValueChange(r),o.onOpenChange(!1))};if(r==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return h.jsx(pB,{scope:t,value:r,disabled:s,textId:g,isSelected:c,onItemTextChange:E.useCallback(y=>{d(S=>S||((y==null?void 0:y.textContent)??"").trim())},[]),children:h.jsx(eh.ItemSlot,{scope:t,value:r,disabled:s,textValue:u,children:h.jsx(xe.div,{role:"option","aria-labelledby":g,"data-highlighted":f?"":void 0,"aria-selected":c&&f,"data-state":c?"checked":"unchecked","aria-disabled":s||void 0,"data-disabled":s?"":void 0,tabIndex:s?void 0:-1,...a,ref:p,onFocus:ne(a.onFocus,()=>m(!0)),onBlur:ne(a.onBlur,()=>m(!1)),onClick:ne(a.onClick,()=>{v.current!=="mouse"&&x()}),onPointerUp:ne(a.onPointerUp,()=>{v.current==="mouse"&&x()}),onPointerDown:ne(a.onPointerDown,y=>{v.current=y.pointerType}),onPointerMove:ne(a.onPointerMove,y=>{var S;v.current=y.pointerType,s?(S=l.onItemLeave)==null||S.call(l):v.current==="mouse"&&y.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ne(a.onPointerLeave,y=>{var S;y.currentTarget===document.activeElement&&((S=l.onItemLeave)==null||S.call(l))}),onKeyDown:ne(a.onKeyDown,y=>{var b;((b=l.searchRef)==null?void 0:b.current)!==""&&y.key===" "||(eB.includes(y.key)&&x(),y.key===" "&&y.preventDefault())})})})})});bR.displayName=qd;var Sl="SelectItemText",wR=E.forwardRef((n,e)=>{const{__scopeSelect:t,className:r,style:s,...i}=n,a=ki(Sl,t),o=Di(Sl,t),l=TR(Sl,t),c=sB(Sl,t),[u,d]=E.useState(null),f=He(e,x=>d(x),l.onItemTextChange,x=>{var y;return(y=o.itemTextRefCallback)==null?void 0:y.call(o,x,l.value,l.disabled)}),m=u==null?void 0:u.textContent,p=E.useMemo(()=>h.jsx("option",{value:l.value,disabled:l.disabled,children:m},l.value),[l.disabled,l.value,m]),{onNativeOptionAdd:g,onNativeOptionRemove:v}=c;return Nt(()=>(g(p),()=>v(p)),[g,v,p]),h.jsxs(h.Fragment,{children:[h.jsx(xe.span,{id:l.textId,...i,ref:f}),l.isSelected&&a.valueNode&&!a.valueNodeHasChildren?ya.createPortal(i.children,a.valueNode):null]})});wR.displayName=Sl;var AR="SelectItemIndicator",_R=E.forwardRef((n,e)=>{const{__scopeSelect:t,...r}=n;return TR(AR,t).isSelected?h.jsx(xe.span,{"aria-hidden":!0,...r,ref:e}):null});_R.displayName=AR;var Qp="SelectScrollUpButton",IR=E.forwardRef((n,e)=>{const t=Di(Qp,n.__scopeSelect),r=py(Qp,n.__scopeSelect),[s,i]=E.useState(!1),a=He(e,r.onScrollButtonChange);return Nt(()=>{if(t.viewport&&t.isPositioned){let o=function(){const c=l.scrollTop>0;i(c)};const l=t.viewport;return o(),l.addEventListener("scroll",o),()=>l.removeEventListener("scroll",o)}},[t.viewport,t.isPositioned]),s?h.jsx(CR,{...n,ref:a,onAutoScroll:()=>{const{viewport:o,selectedItem:l}=t;o&&l&&(o.scrollTop=o.scrollTop-l.offsetHeight)}}):null});IR.displayName=Qp;var Xp="SelectScrollDownButton",RR=E.forwardRef((n,e)=>{const t=Di(Xp,n.__scopeSelect),r=py(Xp,n.__scopeSelect),[s,i]=E.useState(!1),a=He(e,r.onScrollButtonChange);return Nt(()=>{if(t.viewport&&t.isPositioned){let o=function(){const c=l.scrollHeight-l.clientHeight,u=Math.ceil(l.scrollTop)<c;i(u)};const l=t.viewport;return o(),l.addEventListener("scroll",o),()=>l.removeEventListener("scroll",o)}},[t.viewport,t.isPositioned]),s?h.jsx(CR,{...n,ref:a,onAutoScroll:()=>{const{viewport:o,selectedItem:l}=t;o&&l&&(o.scrollTop=o.scrollTop+l.offsetHeight)}}):null});RR.displayName=Xp;var CR=E.forwardRef((n,e)=>{const{__scopeSelect:t,onAutoScroll:r,...s}=n,i=Di("SelectScrollButton",t),a=E.useRef(null),o=th(t),l=E.useCallback(()=>{a.current!==null&&(window.clearInterval(a.current),a.current=null)},[]);return E.useEffect(()=>()=>l(),[l]),Nt(()=>{var u;const c=o().find(d=>d.ref.current===document.activeElement);(u=c==null?void 0:c.ref.current)==null||u.scrollIntoView({block:"nearest"})},[o]),h.jsx(xe.div,{"aria-hidden":!0,...s,ref:e,style:{flexShrink:0,...s.style},onPointerDown:ne(s.onPointerDown,()=>{a.current===null&&(a.current=window.setInterval(r,50))}),onPointerMove:ne(s.onPointerMove,()=>{var c;(c=i.onItemLeave)==null||c.call(i),a.current===null&&(a.current=window.setInterval(r,50))}),onPointerLeave:ne(s.onPointerLeave,()=>{l()})})}),gB="SelectSeparator",LR=E.forwardRef((n,e)=>{const{__scopeSelect:t,...r}=n;return h.jsx(xe.div,{"aria-hidden":!0,...r,ref:e})});LR.displayName=gB;var Zp="SelectArrow",yB=E.forwardRef((n,e)=>{const{__scopeSelect:t,...r}=n,s=nh(t),i=ki(Zp,t),a=Di(Zp,t);return i.open&&a.position==="popper"?h.jsx(B0,{...s,...r,ref:e}):null});yB.displayName=Zp;function kR(n){return n===""||n===void 0}var DR=E.forwardRef((n,e)=>{const{value:t,...r}=n,s=E.useRef(null),i=He(e,s),a=ZU(t);return E.useEffect(()=>{const o=s.current,l=window.HTMLSelectElement.prototype,u=Object.getOwnPropertyDescriptor(l,"value").set;if(a!==t&&u){const d=new Event("change",{bubbles:!0});u.call(o,t),o.dispatchEvent(d)}},[a,t]),h.jsx(Fc,{asChild:!0,children:h.jsx("select",{...r,ref:i,defaultValue:t})})});DR.displayName="BubbleSelect";function PR(n){const e=Ht(n),t=E.useRef(""),r=E.useRef(0),s=E.useCallback(a=>{const o=t.current+a;e(o),function l(c){t.current=c,window.clearTimeout(r.current),c!==""&&(r.current=window.setTimeout(()=>l(""),1e3))}(o)},[e]),i=E.useCallback(()=>{t.current="",window.clearTimeout(r.current)},[]);return E.useEffect(()=>()=>window.clearTimeout(r.current),[]),[t,s,i]}function NR(n,e,t){const s=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,i=t?n.indexOf(t):-1;let a=vB(n,Math.max(i,0));s.length===1&&(a=a.filter(c=>c!==t));const l=a.find(c=>c.textValue.toLowerCase().startsWith(s.toLowerCase()));return l!==t?l:void 0}function vB(n,e){return n.map((t,r)=>n[(e+r)%n.length])}var xB=oR,OR=cR,SB=dR,EB=fR,TB=hR,MR=mR,bB=vR,FR=ER,jR=bR,wB=wR,AB=_R,$R=IR,UR=RR,BR=LR;const Tn=xB,bn=SB,ln=E.forwardRef(({className:n,children:e,...t},r)=>h.jsxs(OR,{ref:r,className:J("flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",n),...t,children:[e,h.jsx(EB,{asChild:!0,children:h.jsx(tA,{className:"h-4 w-4 opacity-50"})})]}));ln.displayName=OR.displayName;const VR=E.forwardRef(({className:n,...e},t)=>h.jsx($R,{ref:t,className:J("flex cursor-default items-center justify-center py-1",n),...e,children:h.jsx(EN,{className:"h-4 w-4"})}));VR.displayName=$R.displayName;const GR=E.forwardRef(({className:n,...e},t)=>h.jsx(UR,{ref:t,className:J("flex cursor-default items-center justify-center py-1",n),...e,children:h.jsx(tA,{className:"h-4 w-4"})}));GR.displayName=UR.displayName;const cn=E.forwardRef(({className:n,children:e,position:t="popper",...r},s)=>h.jsx(TB,{children:h.jsxs(MR,{ref:s,className:J("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:t,...r,children:[h.jsx(VR,{}),h.jsx(bB,{className:J("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),h.jsx(GR,{})]})}));cn.displayName=MR.displayName;const _B=E.forwardRef(({className:n,...e},t)=>h.jsx(FR,{ref:t,className:J("py-1.5 pl-8 pr-2 text-sm font-semibold",n),...e}));_B.displayName=FR.displayName;const ke=E.forwardRef(({className:n,children:e,...t},r)=>h.jsxs(jR,{ref:r,className:J("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...t,children:[h.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:h.jsx(AB,{children:h.jsx(eA,{className:"h-4 w-4"})})}),h.jsx(wB,{children:e})]}));ke.displayName=jR.displayName;const IB=E.forwardRef(({className:n,...e},t)=>h.jsx(BR,{ref:t,className:J("-mx-1 my-1 h-px bg-muted",n),...e}));IB.displayName=BR.displayName;const RB=Ie.object({customerId:Ie.string().min(1,"Vui lng chn khch hng"),name:Ie.string().min(1,"Tn th cng l bt buc"),species:Ie.string().min(1,"Loi l bt buc"),breed:Ie.string().optional(),age:Ie.string().optional(),weight:Ie.string().optional(),gender:Ie.string().optional(),microchip:Ie.string().optional()});function KR({open:n,onOpenChange:e,customerId:t}){const{toast:r}=ns(),s=_r(),{data:i=[]}=Je({queryKey:["/api/customers"],enabled:!t}),a=Qo({resolver:Xo(RB),defaultValues:{customerId:t||"",name:"",species:"",breed:"",age:"",weight:"",gender:"",microchip:""}}),o=Tr({mutationFn:async c=>{const u={...c,age:c.age?parseInt(c.age):null,weight:c.weight||null,isActive:!0};return await(await Qr("POST","/api/pets",u)).json()},onSuccess:c=>{s.setQueryData(["/api/pets"],d=>d&&[c,...d]);const u=t||(c==null?void 0:c.customerId);u&&s.setQueryData(["/api/pets",{customerId:u}],d=>d&&[c,...d]),s.invalidateQueries({queryKey:["/api/pets"]}),r({title:"Thnh cng",description:" thm th cng mi"}),a.reset(),e(!1)},onError:async c=>{let u=c==null?void 0:c.message,d="Khng th thm th cng";if(u){const f=u.indexOf(": "),m=f>=0?u.slice(f+2):u;try{const p=JSON.parse(m);p!=null&&p.error&&(d=p.error)}catch{d=m}}/Microchip  tn ti/i.test(d)&&a.setError("microchip",{message:d}),r({title:"Li",description:d,variant:"destructive"})}}),l=c=>{o.mutate(c)};return h.jsx(Ea,{open:n,onOpenChange:e,children:h.jsxs(Ii,{className:"sm:max-w-[500px]",children:[h.jsx(Ri,{children:h.jsx(Li,{children:"Thm th cng mi"})}),h.jsxs("form",{onSubmit:a.handleSubmit(l),className:"space-y-4",children:[!t&&h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"customerId",children:"Khch hng *"}),h.jsxs(Tn,{value:a.watch("customerId"),onValueChange:c=>a.setValue("customerId",c),children:[h.jsx(ln,{"data-testid":"select-customer",children:h.jsx(bn,{placeholder:"Chn khch hng"})}),h.jsx(cn,{children:i.map(c=>h.jsx(ke,{value:c.id,children:c.name},c.id))})]}),a.formState.errors.customerId&&h.jsx("p",{className:"text-sm text-destructive",children:a.formState.errors.customerId.message})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"name",children:"Tn th cng *"}),h.jsx(Xe,{id:"name",...a.register("name"),"data-testid":"input-pet-name"}),a.formState.errors.name&&h.jsx("p",{className:"text-sm text-destructive",children:a.formState.errors.name.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"species",children:"Loi *"}),h.jsxs(Tn,{value:a.watch("species"),onValueChange:c=>a.setValue("species",c),children:[h.jsx(ln,{"data-testid":"select-species",children:h.jsx(bn,{placeholder:"Chn loi"})}),h.jsxs(cn,{children:[h.jsx(ke,{value:"Ch",children:"Ch"}),h.jsx(ke,{value:"Mo",children:"Mo"}),h.jsx(ke,{value:"Chim",children:"Chim"}),h.jsx(ke,{value:"Th",children:"Th"}),h.jsx(ke,{value:"Sc bay",children:"Sc bay"}),h.jsx(ke,{value:"Chn",children:"Chn"}),h.jsx(ke,{value:"Ra",children:"Ra"}),h.jsx(ke,{value:"C",children:"C"}),h.jsx(ke,{value:"Khc",children:"Khc"})]})]})]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"breed",children:"Ging"}),h.jsx(Xe,{id:"breed",...a.register("breed")})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"gender",children:"Gii tnh"}),h.jsxs(Tn,{value:a.watch("gender"),onValueChange:c=>a.setValue("gender",c),children:[h.jsx(ln,{children:h.jsx(bn,{placeholder:"Chn gii tnh"})}),h.jsxs(cn,{children:[h.jsx(ke,{value:"c",children:"c"}),h.jsx(ke,{value:"Ci",children:"Ci"})]})]})]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"age",children:"Tui"}),h.jsx(Xe,{id:"age",type:"number",...a.register("age"),placeholder:"Nhp tui"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"weight",children:"Cn nng (kg)"}),h.jsx(Xe,{id:"weight",...a.register("weight"),placeholder:"Nhp cn nng"})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"microchip",children:"Microchip"}),h.jsx(Xe,{id:"microchip",...a.register("microchip"),placeholder:"Nhp m microchip (nu c)"})]}),h.jsxs(Ci,{children:[h.jsx(be,{type:"button",variant:"outline",onClick:()=>e(!1),children:"Hy"}),h.jsx(be,{type:"submit",disabled:o.isPending,"data-testid":"button-save-pet",children:o.isPending?"ang lu...":"Lu"})]})]})]})})}const CB=Ie.object({name:Ie.string().min(1,"Tn l bt buc"),email:Ie.string().email("Email khng hp l"),phone:Ie.string().regex(/^\d{10}$/,"S in thoi phi gm 10 ch s"),address:Ie.string().optional()});function LB({open:n,onOpenChange:e,customer:t}){const{toast:r}=ns(),s=_r(),i=Qo({resolver:Xo(CB),defaultValues:{name:"",email:"",phone:"",address:""}});E.useEffect(()=>{t&&i.reset({name:t.name||"",email:t.email||"",phone:t.phone||"",address:t.address||""})},[t]);const a=Tr({mutationFn:async l=>await(await Qr("PATCH",`/api/customers/${t.id}`,l)).json(),onSuccess:()=>{s.invalidateQueries({queryKey:["/api/customers"]}),r({title:"Thnh cng",description:" cp nht khch hng"}),e(!1)},onError:l=>{let c=l==null?void 0:l.message,u="Khng th cp nht khch hng";if(c){const d=c.indexOf(": "),f=d>=0?c.slice(d+2):c;try{const m=JSON.parse(f);m!=null&&m.error&&(u=m.error)}catch{u=f}}(/Email  tn ti/i.test(u)||/Email khng hp l/i.test(u))&&i.setError("email",{message:u}),(/S in thoi  tn ti/i.test(u)||/S in thoi.*10 ch s/i.test(u))&&i.setError("phone",{message:u}),r({title:"Li",description:u,variant:"destructive"})}}),o=l=>a.mutate(l);return h.jsx(Ea,{open:n,onOpenChange:e,children:h.jsxs(Ii,{className:"sm:max-w-[500px]",children:[h.jsx(Ri,{children:h.jsx(Li,{children:"Cp nht khch hng"})}),h.jsxs("form",{onSubmit:i.handleSubmit(o),className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"name",children:"H v tn *"}),h.jsx(Xe,{id:"name",...i.register("name")}),i.formState.errors.name&&h.jsx("p",{className:"text-sm text-destructive",children:i.formState.errors.name.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"email",children:"Email *"}),h.jsx(Xe,{id:"email",type:"email",...i.register("email")}),i.formState.errors.email&&h.jsx("p",{className:"text-sm text-destructive",children:i.formState.errors.email.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"phone",children:"S in thoi *"}),h.jsx(Xe,{id:"phone",...i.register("phone")}),i.formState.errors.phone&&h.jsx("p",{className:"text-sm text-destructive",children:i.formState.errors.phone.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"address",children:"a ch"}),h.jsx(ni,{id:"address",...i.register("address"),rows:3})]}),h.jsxs(Ci,{children:[h.jsx(be,{type:"button",variant:"outline",onClick:()=>e(!1),children:"Hy"}),h.jsx(be,{type:"submit",disabled:a.isPending,children:a.isPending?"ang lu...":"Cp nht"})]})]})]})})}function kB(){const[n,e]=E.useState(""),[t,r]=E.useState(!1),[s,i]=E.useState(!1),[a,o]=E.useState(),l=_r(),{toast:c}=ns(),[u,d]=E.useState("all"),[f,m]=E.useState(null),p=E.useMemo(()=>{const _=new URLSearchParams;n.trim()&&_.set("search",n.trim()),u!=="all"&&_.set("active",String(u==="active"));const A=_.toString();return`/api/customers${A?`?${A}`:""}`},[n,u]),{data:g=[],isLoading:v}=Je({queryKey:[p],queryFn:async()=>{const _=await fetch(p);if(!_.ok)throw new Error("Ti danh sch khch hng tht bi");return await _.json()}}),{data:x=[]}=Je({queryKey:["/api/pets"]}),y=_=>x.filter(A=>A.customerId===_).length,S=Tr({mutationFn:async _=>{const A=await fetch(`/api/customers/${_}/approve`,{method:"POST"});if(!A.ok)throw new Error("Duyt khch hng tht bi");return A.json()},onSuccess:()=>{l.invalidateQueries({queryKey:["/api/customers"]}),l.invalidateQueries({queryKey:[p]}),c({title:"Thnh cng",description:" duyt khch hng"})},onError:_=>c({title:"Li",description:(_==null?void 0:_.message)||"Duyt khch hng tht bi",variant:"destructive"})}),b=Tr({mutationFn:async _=>{const A=await fetch(`/api/customers/${_}/deactivate`,{method:"POST"});if(!A.ok)throw new Error("V hiu ha tht bi");return A.json()},onSuccess:()=>{l.invalidateQueries({queryKey:["/api/customers"]}),l.invalidateQueries({queryKey:[p]}),c({title:"Thnh cng",description:" v hiu ha khch hng"})},onError:_=>c({title:"Li",description:(_==null?void 0:_.message)||"V hiu ha tht bi",variant:"destructive"})}),w=_=>{o(_),i(!0)};return v?h.jsx("div",{className:"flex items-center justify-center h-64",children:h.jsx("p",{className:"text-muted-foreground",children:"ang ti..."})}):h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"font-serif text-3xl font-bold","data-testid":"text-page-title",children:"Khch hng"}),h.jsx("p",{className:"text-muted-foreground mt-1",children:"Qun l thng tin khch hng v th cng"})]}),h.jsxs(be,{onClick:()=>r(!0),"data-testid":"button-add-customer",children:[h.jsx(mi,{className:"h-4 w-4 mr-2"}),"Thm khch hng"]})]}),h.jsxs(tt,{children:[h.jsx(Vt,{children:h.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[h.jsxs(Zt,{className:"flex-1",children:["Danh sch khch hng (",g.length,")"]}),h.jsxs("div",{className:"relative w-full sm:w-64",children:[h.jsx(_0,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h.jsx(Xe,{placeholder:"Tm kim...",className:"pl-9",value:n,onChange:_=>e(_.target.value),"data-testid":"input-search"})]}),h.jsx("div",{className:"w-full sm:w-48",children:h.jsxs(Tn,{value:u,onValueChange:_=>d(_),children:[h.jsx(ln,{children:h.jsx(bn,{placeholder:"Trng thi"})}),h.jsxs(cn,{children:[h.jsx(ke,{value:"all",children:"Tt c"}),h.jsx(ke,{value:"active",children:"ang hot ng"}),h.jsx(ke,{value:"pending",children:"Ch duyt"})]})]})}),h.jsxs("div",{className:"flex gap-2 ml-auto",children:[h.jsx(be,{asChild:!0,variant:"outline",children:h.jsx("a",{href:"/api/export/customers",download:!0,children:"Xut khch hng (CSV)"})}),h.jsx(be,{asChild:!0,variant:"outline",children:h.jsx("a",{href:"/api/export/pets",download:!0,children:"Xut th cng (CSV)"})})]})]})}),h.jsx(nt,{children:g.length===0?h.jsxs("div",{className:"text-center py-12",children:[h.jsx("p",{className:"text-muted-foreground mb-4",children:"Cha c khch hng no"}),h.jsxs(be,{onClick:()=>r(!0),children:[h.jsx(mi,{className:"h-4 w-4 mr-2"}),"Thm khch hng u tin"]})]}):h.jsxs(J0,{children:[h.jsx(ey,{children:h.jsxs(sc,{children:[h.jsx(qn,{children:"Khch hng"}),h.jsx(qn,{children:"Lin h"}),h.jsx(qn,{children:"Trng thi"}),h.jsx(qn,{children:"S th cng"}),h.jsx(qn,{className:"text-right",children:"Thao tc"})]})}),h.jsx(ty,{children:g.map(_=>h.jsxs(sc,{"data-testid":`row-customer-${_.id}`,children:[h.jsx(Qn,{children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(Yo,{className:"h-10 w-10",children:h.jsx(qo,{className:"bg-primary/10 text-primary",children:_.name[0]})}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium","data-testid":"text-customer-name",children:_.name}),h.jsx("p",{className:"text-sm text-muted-foreground",children:_.address||"Cha c a ch"})]})]})}),h.jsx(Qn,{children:h.jsxs("div",{className:"space-y-1",children:[h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx(RN,{className:"h-3 w-3 text-muted-foreground"}),h.jsx("span",{className:"text-muted-foreground",children:_.email})]}),h.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[h.jsx(DN,{className:"h-3 w-3 text-muted-foreground"}),h.jsx("span",{className:"text-muted-foreground",children:_.phone})]})]})}),h.jsx(Qn,{children:_.isActive?h.jsx(Rn,{children:"ang hot ng"}):h.jsx(Rn,{variant:"destructive",children:"Ch duyt"})}),h.jsx(Qn,{children:h.jsxs(Rn,{variant:"secondary",children:[y(_.id)," th cng"]})}),h.jsx(Qn,{className:"text-right",children:h.jsxs(l$,{children:[h.jsx(c$,{asChild:!0,children:h.jsx(be,{variant:"ghost",size:"icon","data-testid":`button-actions-${_.id}`,children:h.jsx(AN,{className:"h-4 w-4"})})}),h.jsxs(FI,{align:"end",children:[h.jsx(ka,{onClick:()=>w(_.id),children:"Thm th cng"}),!_.isActive&&h.jsx(ka,{onClick:()=>S.mutate(_.id),children:"Duyt kch hot"}),_.isActive&&h.jsx(ka,{onClick:()=>b.mutate(_.id),children:"V hiu ha"}),h.jsx(ka,{onClick:()=>m(_),children:"Chnh sa"}),h.jsx(ka,{className:"text-destructive",children:"Xa"})]})]})})]},_.id))})]})})]}),h.jsx(XU,{open:t,onOpenChange:r}),h.jsx(KR,{open:s,onOpenChange:i,customerId:a}),h.jsx(LB,{open:!!f,onOpenChange:_=>!_&&m(null),customer:f})]})}function DB(){return h.jsx(kB,{})}var gy="Tabs",[PB,vK]=Ir(gy,[qf]),HR=qf(),[NB,yy]=PB(gy),zR=E.forwardRef((n,e)=>{const{__scopeTabs:t,value:r,onValueChange:s,defaultValue:i,orientation:a="horizontal",dir:o,activationMode:l="automatic",...c}=n,u=Wf(o),[d,f]=hi({prop:r,onChange:s,defaultProp:i});return h.jsx(NB,{scope:t,baseId:xr(),value:d,onValueChange:f,orientation:a,dir:u,activationMode:l,children:h.jsx(xe.div,{dir:u,"data-orientation":a,...c,ref:e})})});zR.displayName=gy;var WR="TabsList",YR=E.forwardRef((n,e)=>{const{__scopeTabs:t,loop:r=!0,...s}=n,i=yy(WR,t),a=HR(t);return h.jsx(V_,{asChild:!0,...a,orientation:i.orientation,dir:i.dir,loop:r,children:h.jsx(xe.div,{role:"tablist","aria-orientation":i.orientation,...s,ref:e})})});YR.displayName=WR;var qR="TabsTrigger",QR=E.forwardRef((n,e)=>{const{__scopeTabs:t,value:r,disabled:s=!1,...i}=n,a=yy(qR,t),o=HR(t),l=JR(a.baseId,r),c=e1(a.baseId,r),u=r===a.value;return h.jsx(G_,{asChild:!0,...o,focusable:!s,active:u,children:h.jsx(xe.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":c,"data-state":u?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:l,...i,ref:e,onMouseDown:ne(n.onMouseDown,d=>{!s&&d.button===0&&d.ctrlKey===!1?a.onValueChange(r):d.preventDefault()}),onKeyDown:ne(n.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&a.onValueChange(r)}),onFocus:ne(n.onFocus,()=>{const d=a.activationMode!=="manual";!u&&!s&&d&&a.onValueChange(r)})})})});QR.displayName=qR;var XR="TabsContent",ZR=E.forwardRef((n,e)=>{const{__scopeTabs:t,value:r,forceMount:s,children:i,...a}=n,o=yy(XR,t),l=JR(o.baseId,r),c=e1(o.baseId,r),u=r===o.value,d=E.useRef(u);return E.useEffect(()=>{const f=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(f)},[]),h.jsx(Rr,{present:s||u,children:({present:f})=>h.jsx(xe.div,{"data-state":u?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":l,hidden:!f,id:c,tabIndex:0,...a,ref:e,style:{...n.style,animationDuration:d.current?"0s":void 0},children:f&&i})})});ZR.displayName=XR;function JR(n,e){return`${n}-trigger-${e}`}function e1(n,e){return`${n}-content-${e}`}var OB=zR,t1=YR,n1=QR,r1=ZR;const s1=OB,vy=E.forwardRef(({className:n,...e},t)=>h.jsx(t1,{ref:t,className:J("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",n),...e}));vy.displayName=t1.displayName;const Qd=E.forwardRef(({className:n,...e},t)=>h.jsx(n1,{ref:t,className:J("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",n),...e}));Qd.displayName=n1.displayName;const Xd=E.forwardRef(({className:n,...e},t)=>h.jsx(r1,{ref:t,className:J("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",n),...e}));Xd.displayName=r1.displayName;const MB=Ie.object({petId:Ie.string().min(1,"Vui lng chn th cng"),customerId:Ie.string().min(1,"Vui lng chn khch hng"),appointmentDate:Ie.string().min(1,"Ngy hn l bt buc"),appointmentTime:Ie.string().min(1,"Gi hn l bt buc"),appointmentType:Ie.string().min(1,"Loi dch v l bt buc"),status:Ie.string().min(1,"Trng thi l bt buc"),notes:Ie.string().optional()});function FB({open:n,onOpenChange:e}){const{toast:t}=ns(),r=_r(),[s,i]=E.useState(!1),{data:a=[]}=Je({queryKey:["/api/customers"]}),o=Qo({resolver:Xo(MB),defaultValues:{petId:"",customerId:"",appointmentDate:"",appointmentTime:"",appointmentType:"",status:"pending",notes:""}}),l=o.watch("customerId"),{data:c=[]}=Je({queryKey:["/api/pets",{customerId:l}],enabled:!!l}),u=Tr({mutationFn:async f=>{const m=new Date(`${f.appointmentDate}T${f.appointmentTime}`),p=new Date;if(m.getTime()<p.getTime())throw new Error("Khng th t lch trong qu kh");const g={petId:f.petId,customerId:f.customerId,appointmentDate:m.toISOString(),appointmentType:f.appointmentType,status:f.status,notes:f.notes};return await(await Qr("POST","/api/appointments",g)).json()},onSuccess:f=>{r.setQueryData(["/api/appointments"],p=>p&&[f,...p]);const m=f!=null&&f.appointmentDate?new Date(f.appointmentDate):void 0;if(m){const p=new Date(m);p.setHours(0,0,0,0),r.setQueryData(["/api/appointments",{date:p.toISOString()}],g=>g&&[f,...g])}r.invalidateQueries({queryKey:["/api/appointments"]}),t({title:"Thnh cng",description:" to lch hn mi"}),o.reset(),e(!1)},onError:f=>{let m=(f==null?void 0:f.message)||"Khng th to lch hn";/th cng.*lch/i.test(m)&&o.setError("appointmentTime",{message:"Th cng  c lch ti khung gi ny"}),/bc s.*khung gi/i.test(m)&&o.setError("appointmentTime",{message:"Khung gi  c t cho bc s"}),/qu kh/i.test(m)&&(o.setError("appointmentDate",{message:m}),o.setError("appointmentTime",{message:m})),t({title:"Li",description:m,variant:"destructive"})}}),d=f=>{u.mutate(f)};return h.jsxs(Ea,{open:n,onOpenChange:e,children:[h.jsxs(Ii,{className:"sm:max-w-[500px]",children:[h.jsx(Ri,{children:h.jsx(Li,{children:"t lch hn mi"})}),h.jsxs("form",{onSubmit:o.handleSubmit(d),className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"customerId",children:"Khch hng *"}),h.jsxs(Tn,{value:o.watch("customerId"),onValueChange:f=>{o.setValue("customerId",f),o.setValue("petId","")},children:[h.jsx(ln,{"data-testid":"select-customer",children:h.jsx(bn,{placeholder:"Chn khch hng"})}),h.jsx(cn,{children:a.map(f=>h.jsx(ke,{value:f.id,children:f.name},f.id))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"petId",children:"Th cng *"}),h.jsxs(Tn,{value:o.watch("petId"),onValueChange:f=>o.setValue("petId",f),disabled:!l,children:[h.jsx(ln,{"data-testid":"select-pet",children:h.jsx(bn,{placeholder:l?"Chn th cng":"Chn khch hng trc"})}),h.jsx(cn,{children:c.map(f=>h.jsxs(ke,{value:f.id,children:[f.name," - ",f.species]},f.id))})]}),l&&h.jsx("div",{children:h.jsx(be,{variant:"ghost",size:"sm",onClick:()=>i(!0),children:"+ Thm th cng mi"})})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"appointmentDate",children:"Ngy hn *"}),h.jsx(Xe,{id:"appointmentDate",type:"date",...o.register("appointmentDate"),"data-testid":"input-appointment-date"}),o.formState.errors.appointmentDate&&h.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.appointmentDate.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"appointmentTime",children:"Gi hn *"}),h.jsx(Xe,{id:"appointmentTime",type:"time",...o.register("appointmentTime"),"data-testid":"input-appointment-time"}),o.formState.errors.appointmentTime&&h.jsx("p",{className:"text-sm text-destructive",children:o.formState.errors.appointmentTime.message})]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"appointmentType",children:"Loi dch v *"}),h.jsxs(Tn,{value:o.watch("appointmentType"),onValueChange:f=>o.setValue("appointmentType",f),children:[h.jsx(ln,{"data-testid":"select-service",children:h.jsx(bn,{placeholder:"Chn dch v"})}),h.jsxs(cn,{children:[h.jsx(ke,{value:"Khm nh k",children:"Khm nh k"}),h.jsx(ke,{value:"Tim phng",children:"Tim phng"}),h.jsx(ke,{value:"Cp cu",children:"Cp cu"}),h.jsx(ke,{value:"Phu thut",children:"Phu thut"}),h.jsx(ke,{value:"Ti khm",children:"Ti khm"}),h.jsx(ke,{value:"Chm sc",children:"Chm sc"})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"status",children:"Trng thi *"}),h.jsxs(Tn,{value:o.watch("status"),onValueChange:f=>o.setValue("status",f),children:[h.jsx(ln,{"data-testid":"select-status",children:h.jsx(bn,{placeholder:"Chn trng thi"})}),h.jsxs(cn,{children:[h.jsx(ke,{value:"pending",children:"Ch xc nhn"}),h.jsx(ke,{value:"confirmed",children:" xc nhn"}),h.jsx(ke,{value:"urgent",children:"Khn cp"})]})]})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"notes",children:"Ghi ch"}),h.jsx(ni,{id:"notes",...o.register("notes"),rows:3,placeholder:"Ghi ch thm v cuc hn..."})]}),h.jsxs(Ci,{children:[h.jsx(be,{type:"button",variant:"outline",onClick:()=>e(!1),children:"Hy"}),h.jsx(be,{type:"submit",disabled:u.isPending,"data-testid":"button-save-appointment",children:u.isPending?"ang lu...":"t lch"})]})]})]}),h.jsx(KR,{open:s,onOpenChange:f=>{i(f),f||r.invalidateQueries({queryKey:["/api/pets"]})},customerId:l||void 0})]})}const dS={confirmed:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-800",pending:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400 border-amber-200 dark:border-amber-800",urgent:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 border-red-200 dark:border-red-800",cancelled:"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400 border-gray-200 dark:border-gray-800",completed:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 border-blue-200 dark:border-blue-800"},fS={confirmed:" xc nhn",pending:"Ch xc nhn",urgent:"Khn cp",cancelled:" hy",completed:"Hon thnh"};function jB(){const[n,e]=E.useState(new Date),[t,r]=E.useState(!1),[s,i]=E.useState(null),{toast:a}=ns(),o=_r(),l=n.toLocaleDateString("vi-VN"),{data:c=[],isLoading:u}=Je({queryKey:["/api/appointments",{date:n.toISOString()}]}),d=Tr({mutationFn:async S=>await(await Qr("PATCH",`/api/appointments/${S}`,{status:"confirmed"})).json(),onSuccess:()=>{o.invalidateQueries({queryKey:["/api/appointments"]}),a({title:" xc nhn",description:"Lch hn  c xc nhn."}),i(null)},onError:()=>{a({title:"Li",description:"Khng th xc nhn lch hn",variant:"destructive"})}}),{data:f=[]}=Je({queryKey:["/api/customers"]}),{data:m=[]}=Je({queryKey:["/api/pets"]}),p=S=>{const b=f.find(w=>w.id===S);return(b==null?void 0:b.name)||"Unknown"},g=S=>{const b=m.find(w=>w.id===S);return(b==null?void 0:b.name)||"Unknown"},v=()=>{const S=new Date(n);S.setDate(S.getDate()+1),e(S)},x=()=>{const S=new Date(n);S.setDate(S.getDate()-1),e(S)},y=()=>{e(new Date)};return u?h.jsx("div",{className:"flex items-center justify-center h-64",children:h.jsx("p",{className:"text-muted-foreground",children:"ang ti..."})}):h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"font-serif text-3xl font-bold","data-testid":"text-page-title",children:"Lch khm"}),h.jsx("p",{className:"text-muted-foreground mt-1",children:"Qun l lch hn khm bnh"})]}),h.jsxs(be,{onClick:()=>r(!0),"data-testid":"button-add-appointment",children:[h.jsx(mi,{className:"h-4 w-4 mr-2"}),"t lch mi"]})]}),h.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[h.jsx(be,{variant:"outline",size:"icon",onClick:x,children:h.jsx(SN,{className:"h-4 w-4"})}),h.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-md bg-muted",children:[h.jsx(kf,{className:"h-4 w-4"}),h.jsx("span",{className:"font-medium",children:l})]}),h.jsx(be,{variant:"outline",size:"icon",onClick:v,children:h.jsx(nA,{className:"h-4 w-4"})}),h.jsx(be,{variant:"outline",onClick:y,children:"Hm nay"})]}),h.jsxs(s1,{defaultValue:"list",className:"w-full",children:[h.jsx(vy,{children:h.jsxs(Qd,{value:"list",children:["Danh sch (",c.length,")"]})}),h.jsx(Xd,{value:"list",className:"mt-4",children:c.length===0?h.jsx(tt,{children:h.jsxs(nt,{className:"py-12 text-center",children:[h.jsx("p",{className:"text-muted-foreground mb-4",children:"Khng c lch hn no trong ngy ny"}),h.jsxs(be,{onClick:()=>r(!0),children:[h.jsx(mi,{className:"h-4 w-4 mr-2"}),"t lch hn"]})]})}):h.jsx("div",{className:"grid gap-4",children:c.map(S=>{const w=new Date(S.appointmentDate).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),_=dS[S.status]||dS.pending;return h.jsx(tt,{className:`border-l-4 ${_}`,"data-testid":`appointment-card-${S.id}`,children:h.jsx(nt,{className:"p-4",children:h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[h.jsx(sA,{className:"h-5 w-5"}),h.jsx("span",{className:"font-mono font-semibold text-lg",children:w})]}),h.jsx("div",{className:"h-12 w-px bg-border"}),h.jsx(Yo,{className:"h-12 w-12",children:h.jsx(qo,{children:g(S.petId)[0]})}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("p",{className:"font-semibold","data-testid":"text-pet-name",children:g(S.petId)}),h.jsx("p",{className:"text-sm text-muted-foreground",children:p(S.customerId)})]}),h.jsxs("div",{className:"text-right",children:[h.jsx(Rn,{variant:"outline",className:"mb-1",children:S.appointmentType}),h.jsx("p",{className:"text-sm text-muted-foreground",children:fS[S.status]})]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(be,{variant:"outline",size:"sm",onClick:()=>i(S),children:"Chi tit"}),S.status==="pending"&&h.jsx(be,{size:"sm",onClick:()=>d.mutate(S.id),children:"Xc nhn"})]})]})})},S.id)})})})]}),h.jsx(FB,{open:t,onOpenChange:r}),h.jsx(Ea,{open:!!s,onOpenChange:S=>!S&&i(null),children:h.jsxs(Ii,{children:[h.jsx(Ri,{children:h.jsx(Li,{children:"Chi tit lch hn"})}),s&&h.jsxs("div",{className:"space-y-2 text-sm",children:[h.jsxs("p",{children:[h.jsx("span",{className:"text-muted-foreground",children:"Thi gian:"})," ",new Date(s.appointmentDate).toLocaleString("vi-VN")]}),h.jsxs("p",{children:[h.jsx("span",{className:"text-muted-foreground",children:"Dch v:"})," ",s.appointmentType]}),h.jsxs("p",{children:[h.jsx("span",{className:"text-muted-foreground",children:"Trng thi:"})," ",fS[s.status]]}),s.notes&&h.jsxs("p",{children:[h.jsx("span",{className:"text-muted-foreground",children:"Ghi ch:"})," ",s.notes]})]}),h.jsxs(Ci,{children:[s&&s.status==="pending"&&h.jsx(be,{onClick:()=>d.mutate(s.id),disabled:d.isPending,children:d.isPending?"ang xc nhn...":"Xc nhn"}),h.jsx(be,{variant:"outline",onClick:()=>i(null),children:"ng"})]})]})})]})}function $B(){return h.jsx(jB,{})}const UB="/assets/cute_golden_retrieve_eabbb615-CeAmlUaX.jpg",BB=Ie.object({petId:Ie.string().min(1,"Vui lng chn th cng"),veterinarianId:Ie.string().min(1,"Vui lng chn bc s"),symptoms:Ie.string().min(1,"Triu chng l bt buc"),diagnosis:Ie.string().min(1,"Chn on l bt buc"),treatment:Ie.string().min(1,"Phng php iu tr l bt buc"),notes:Ie.string().optional()});function VB(){const{toast:n}=ns(),e=_r(),{data:t=[]}=Je({queryKey:["/api/pets"]}),{data:r=[]}=Je({queryKey:["/api/users",{role:"veterinarian"}]}),{data:s=[]}=Je({queryKey:["/api/medical-records"]}),i=Qo({resolver:Xo(BB),defaultValues:{petId:"",veterinarianId:"",symptoms:"",diagnosis:"",treatment:"",notes:""}}),a=i.watch("petId"),o=t.find(u=>u.id===a),l=Tr({mutationFn:async u=>{const d={petId:u.petId,veterinarianId:u.veterinarianId,symptoms:u.symptoms,diagnosis:u.diagnosis,treatment:u.treatment,notes:u.notes};return await(await Qr("POST","/api/medical-records",d)).json()},onSuccess:()=>{e.invalidateQueries({queryKey:["/api/medical-records"]}),n({title:"Thnh cng",description:" lu h s khm bnh"}),i.reset()},onError:()=>{n({title:"Li",description:"Khng th lu h s khm bnh",variant:"destructive"})}}),c=u=>{l.mutate(u)};return h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"font-serif text-3xl font-bold","data-testid":"text-page-title",children:"H s khm bnh"}),h.jsx("p",{className:"text-muted-foreground mt-1",children:"Ghi nhn v qun l h s iu tr"})]}),h.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[h.jsxs(tt,{className:"lg:col-span-2",children:[h.jsx(Vt,{children:h.jsx(Zt,{children:"To h s khm mi"})}),h.jsx(nt,{children:h.jsxs("form",{onSubmit:i.handleSubmit(c),className:"space-y-4",children:[h.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"pet",children:"Th cng *"}),h.jsxs(Tn,{value:i.watch("petId"),onValueChange:u=>i.setValue("petId",u),children:[h.jsx(ln,{id:"pet","data-testid":"select-pet",children:h.jsx(bn,{placeholder:"Chn th cng"})}),h.jsx(cn,{children:t.map(u=>h.jsxs(ke,{value:u.id,children:[u.name," - ",u.species]},u.id))})]}),i.formState.errors.petId&&h.jsx("p",{className:"text-sm text-red-500",children:i.formState.errors.petId.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"doctor",children:"Bc s *"}),h.jsxs(Tn,{value:i.watch("veterinarianId"),onValueChange:u=>i.setValue("veterinarianId",u),children:[h.jsx(ln,{id:"doctor","data-testid":"select-doctor",children:h.jsx(bn,{placeholder:"Chn bc s"})}),h.jsx(cn,{children:r.map(u=>h.jsx(ke,{value:u.id,children:u.name},u.id))})]}),i.formState.errors.veterinarianId&&h.jsx("p",{className:"text-sm text-red-500",children:i.formState.errors.veterinarianId.message})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"symptoms",children:"Triu chng *"}),h.jsx(ni,{id:"symptoms",placeholder:"M t triu chng ca th cng...",...i.register("symptoms"),rows:3,"data-testid":"input-symptoms"}),i.formState.errors.symptoms&&h.jsx("p",{className:"text-sm text-red-500",children:i.formState.errors.symptoms.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"diagnosis",children:"Chn on *"}),h.jsx(ni,{id:"diagnosis",placeholder:"Kt qu chn on...",...i.register("diagnosis"),rows:3,"data-testid":"input-diagnosis"}),i.formState.errors.diagnosis&&h.jsx("p",{className:"text-sm text-red-500",children:i.formState.errors.diagnosis.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"treatment",children:"Phng php iu tr *"}),h.jsx(ni,{id:"treatment",placeholder:"Ghi ch phng php iu tr...",...i.register("treatment"),rows:3,"data-testid":"input-treatment"}),i.formState.errors.treatment&&h.jsx("p",{className:"text-sm text-red-500",children:i.formState.errors.treatment.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"notes",children:"Ghi ch"}),h.jsx(ni,{id:"notes",placeholder:"Ghi ch thm...",...i.register("notes"),rows:2})]}),h.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[h.jsx(be,{type:"button",variant:"outline",onClick:()=>i.reset(),children:"Hy"}),h.jsx(be,{type:"submit",disabled:l.isPending,"data-testid":"button-save-record",children:l.isPending?"ang lu...":"Lu h s"})]})]})})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs(tt,{children:[h.jsx(Vt,{children:h.jsx(Zt,{className:"text-base",children:"Thng tin th cng"})}),h.jsx(nt,{className:"space-y-3",children:o?h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsxs(Yo,{className:"h-16 w-16",children:[h.jsx(X0,{src:o.imageUrl||UB,alt:o.name}),h.jsx(qo,{children:o.name.charAt(0)})]}),h.jsxs("div",{children:[h.jsx("p",{className:"font-semibold",children:o.name}),h.jsx("p",{className:"text-sm text-muted-foreground",children:o.species}),h.jsxs("p",{className:"text-sm text-muted-foreground",children:[o.age," tui, ",o.weight,"kg"]})]})]}),h.jsxs("div",{className:"pt-2 border-t space-y-1",children:[h.jsxs("p",{className:"text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Ging:"})," ",o.breed||"Khng xc nh"]}),h.jsxs("p",{className:"text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Gii tnh:"})," ",o.gender||"Khng xc nh"]}),o.microchip&&h.jsxs("p",{className:"text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Microchip:"})," ",o.microchip]})]})]}):h.jsx("div",{className:"text-center py-8 text-muted-foreground",children:h.jsx("p",{children:"Chn th cng  xem thng tin"})})})]}),h.jsxs(tt,{children:[h.jsx(Vt,{children:h.jsxs(Zt,{className:"text-base flex items-center gap-2",children:[h.jsx(Df,{className:"h-4 w-4"}),"Lch s khm"]})}),h.jsxs(nt,{className:"space-y-3",children:[a?s.filter(u=>u.petId===a).slice(0,5).map(u=>h.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 space-y-1",children:[h.jsxs("div",{className:"flex items-center justify-between gap-2",children:[h.jsx("p",{className:"text-sm font-medium",children:u.diagnosis}),h.jsx(Rn,{variant:"secondary",className:"text-xs",children:"Hon thnh"})]}),h.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(u.visitDate).toLocaleDateString("vi-VN")}),h.jsx("p",{className:"text-xs text-muted-foreground",children:u.symptoms})]},u.id)):h.jsx("div",{className:"text-center py-8 text-muted-foreground",children:h.jsx("p",{children:"Chn th cng  xem lch s"})}),a&&s.filter(u=>u.petId===a).length===0&&h.jsx("div",{className:"text-center py-8 text-muted-foreground",children:h.jsx("p",{children:"Cha c lch s khm"})})]})]})]})]})]})}function GB(){const[n,e]=E.useState(""),{data:t=[],isLoading:r}=Je({queryKey:["/api/medical-records"]}),{data:s=[]}=Je({queryKey:["/api/pets"]}),{data:i=[]}=Je({queryKey:["/api/users",{role:"veterinarian"}]}),a=c=>{const u=s.find(d=>d.id===c);return u?u.name:"Khng xc nh"},o=c=>{const u=i.find(d=>d.id===c);return u?u.name:"Khng xc nh"},l=t.filter(c=>{var u;return((u=c.diagnosis)==null?void 0:u.toLowerCase().includes(n.toLowerCase()))||a(c.petId).toLowerCase().includes(n.toLowerCase())||o(c.veterinarianId).toLowerCase().includes(n.toLowerCase())});return h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"font-serif text-3xl font-bold",children:"Qun l h s khm bnh"}),h.jsx("p",{className:"text-muted-foreground mt-1",children:"To mi v xem lch s h s khm bnh"})]}),h.jsxs(s1,{defaultValue:"records",className:"space-y-4",children:[h.jsxs(vy,{children:[h.jsx(Qd,{value:"records",children:"Danh sch h s"}),h.jsx(Qd,{value:"create",children:"To h s mi"})]}),h.jsxs(Xd,{value:"records",className:"space-y-4",children:[h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:"relative flex-1 max-w-sm",children:h.jsx(Xe,{placeholder:"Tm kim h s...",value:n,onChange:c=>e(c.target.value)})}),h.jsxs(Rn,{variant:"secondary",children:[l.length," h s"]})]}),r?h.jsx("div",{className:"grid gap-4",children:[...Array(3)].map((c,u)=>h.jsx(tt,{children:h.jsx(nt,{className:"p-6",children:h.jsxs("div",{className:"animate-pulse space-y-3",children:[h.jsx("div",{className:"h-4 bg-muted rounded w-1/4"}),h.jsx("div",{className:"h-3 bg-muted rounded w-1/2"}),h.jsx("div",{className:"h-3 bg-muted rounded w-3/4"})]})})},u))}):l.length===0?h.jsx(tt,{children:h.jsxs(nt,{className:"p-12 text-center",children:[h.jsx(Df,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),h.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Khng c h s no"}),h.jsx("p",{className:"text-muted-foreground",children:n?"Khng tm thy h s ph hp":"Cha c h s khm bnh no"})]})}):h.jsx("div",{className:"grid gap-4",children:l.map(c=>h.jsxs(tt,{children:[h.jsx(Vt,{children:h.jsxs("div",{className:"flex items-start justify-between",children:[h.jsxs("div",{className:"space-y-1",children:[h.jsx(Zt,{className:"text-lg",children:c.diagnosis}),h.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(bx,{className:"h-4 w-4"}),a(c.petId)]}),h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx(kf,{className:"h-4 w-4"}),new Date(c.visitDate).toLocaleDateString("vi-VN")]})]})]}),h.jsx(Rn,{variant:"secondary",children:"Hon thnh"})]})}),h.jsxs(nt,{className:"space-y-3",children:[h.jsxs("div",{children:[h.jsx("h4",{className:"font-medium mb-1",children:"Triu chng:"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:c.symptoms})]}),h.jsxs("div",{children:[h.jsx("h4",{className:"font-medium mb-1",children:"iu tr:"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:c.treatment})]}),h.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[h.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[h.jsx(bx,{className:"h-4 w-4"}),"Bc s: ",o(c.veterinarianId)]}),h.jsxs(be,{variant:"outline",size:"sm",children:[h.jsx(_N,{className:"h-4 w-4 mr-2"}),"Xem chi tit"]})]}),c.notes&&h.jsxs("div",{className:"pt-3 border-t",children:[h.jsx("h4",{className:"font-medium mb-1",children:"Ghi ch:"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:c.notes})]})]})]},c.id))})]}),h.jsx(Xd,{value:"create",children:h.jsx(VB,{})})]})]})}const KB=Ie.object({code:Ie.string().min(1,"M l bt buc"),name:Ie.string().min(1,"Tn l bt buc"),category:Ie.string().min(1,"Danh mc l bt buc"),quantity:Ie.string().min(1,"S lng l bt buc"),unit:Ie.string().min(1,"n v l bt buc"),minStockLevel:Ie.string().min(1,"Mc tn kho ti thiu l bt buc"),price:Ie.string().min(1,"Gi l bt buc"),expiryDate:Ie.string().optional()});function HB(){const[n,e]=E.useState(""),[t,r]=E.useState(!1),[s,i]=E.useState("all"),{toast:a}=ns(),o=_r(),{data:l=[],isLoading:c}=Je({queryKey:["/api/inventory",{search:n,category:s!=="all"?s:void 0}]}),u=Qo({resolver:Xo(KB),defaultValues:{code:"",name:"",category:"",quantity:"",unit:"",minStockLevel:"",price:"",expiryDate:""}}),d=Tr({mutationFn:async g=>{const x=await(await Qr("POST","/api/inventory",{code:g.code,name:g.name,category:g.category,unit:g.unit,stock:parseInt(g.quantity),minStock:parseInt(g.minStockLevel),price:g.price})).json();if(g.expiryDate&&g.quantity){const y=`B${Date.now()}`;await Qr("POST","/api/stock-batches",{inventoryId:x.id,batchNumber:y,quantity:parseInt(g.quantity),expiryDate:new Date(g.expiryDate).toISOString(),supplier:""})}return x},onSuccess:()=>{o.invalidateQueries({queryKey:["/api/inventory"]}),o.invalidateQueries({queryKey:["/api/inventory/low-stock"]}),o.invalidateQueries({queryKey:["/api/stock-batches"]}),a({title:"Thnh cng",description:" thm vt t mi"}),u.reset(),r(!1)},onError:()=>{a({title:"Li",description:"Khng th thm vt t",variant:"destructive"})}}),f=g=>{d.mutate(g)},m=Array.from(new Set(l.map(g=>g.category))),p=l.filter(g=>g.quantity<=g.minStockLevel);return c?h.jsx("div",{className:"flex items-center justify-center h-64",children:h.jsx("p",{className:"text-muted-foreground",children:"ang ti..."})}):h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"font-serif text-3xl font-bold","data-testid":"text-page-title",children:"Kho thuc & Vt t"}),h.jsx("p",{className:"text-muted-foreground mt-1",children:"Qun l tn kho v vt t y t"})]}),h.jsxs(be,{onClick:()=>r(!0),"data-testid":"button-add-inventory",children:[h.jsx(mi,{className:"h-4 w-4 mr-2"}),"Thm vt t"]})]}),p.length>0&&h.jsx(tt,{className:"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-950/20",children:h.jsx(nt,{className:"p-4",children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(Tx,{className:"h-5 w-5 text-amber-600 dark:text-amber-500"}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium text-amber-900 dark:text-amber-200",children:"Cnh bo tn kho"}),h.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-400",children:[p.length," vt t sp ht, cn nhp thm"]})]})]})})}),h.jsxs("div",{className:"flex flex-wrap gap-4",children:[h.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[h.jsx(_0,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h.jsx(Xe,{placeholder:"Tm kim vt t...",className:"pl-9",value:n,onChange:g=>e(g.target.value),"data-testid":"input-search"})]}),h.jsxs(Tn,{value:s,onValueChange:i,children:[h.jsx(ln,{className:"w-[180px]",children:h.jsx(bn,{placeholder:"Lc theo danh mc"})}),h.jsxs(cn,{children:[h.jsx(ke,{value:"all",children:"Tt c"}),m.map(g=>h.jsx(ke,{value:g,children:g},g))]})]})]}),h.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:l.length===0?h.jsx(tt,{className:"col-span-full",children:h.jsxs(nt,{className:"py-12 text-center",children:[h.jsx(A0,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),h.jsx("p",{className:"text-muted-foreground mb-4",children:"Cha c vt t no"}),h.jsxs(be,{onClick:()=>r(!0),children:[h.jsx(mi,{className:"h-4 w-4 mr-2"}),"Thm vt t u tin"]})]})}):l.map(g=>{const v=g.quantity<=g.minStockLevel,x=g.expiryDate?new Date(g.expiryDate):null,y=x&&x<new Date(Date.now()+30*24*60*60*1e3);return h.jsxs(tt,{className:v?"border-amber-200 dark:border-amber-800":"","data-testid":`card-inventory-${g.id}`,children:[h.jsxs(Vt,{className:"pb-3",children:[h.jsxs(Zt,{className:"text-base flex items-start justify-between gap-2",children:[h.jsx("span",{className:"flex-1","data-testid":"text-item-name",children:g.name}),v&&h.jsxs(Rn,{variant:"outline",className:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400 border-amber-200 dark:border-amber-800",children:[h.jsx(Tx,{className:"h-3 w-3 mr-1"}),"Sp ht"]})]}),h.jsx("p",{className:"text-sm text-muted-foreground",children:g.category})]}),h.jsxs(nt,{className:"space-y-2",children:[h.jsxs("div",{className:"flex justify-between text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Tn kho:"}),h.jsxs("span",{className:"font-medium font-mono",children:[g.quantity," ",g.unit]})]}),h.jsxs("div",{className:"flex justify-between text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Ti thiu:"}),h.jsxs("span",{className:"font-mono text-muted-foreground",children:[g.minStockLevel," ",g.unit]})]}),h.jsxs("div",{className:"flex justify-between text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Gi:"}),h.jsxs("span",{className:"font-medium",children:["",parseFloat(g.price).toLocaleString()]})]}),x&&h.jsxs("div",{className:"flex justify-between text-sm",children:[h.jsx("span",{className:"text-muted-foreground",children:"Hn s dng:"}),h.jsx("span",{className:y?"text-amber-600 dark:text-amber-400 font-medium":"",children:x.toLocaleDateString("vi-VN")})]})]})]},g.id)})}),h.jsx(Ea,{open:t,onOpenChange:r,children:h.jsxs(Ii,{className:"sm:max-w-[500px]",children:[h.jsx(Ri,{children:h.jsx(Li,{children:"Thm vt t mi"})}),h.jsxs("form",{onSubmit:u.handleSubmit(f),className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"code",children:"M vt t *"}),h.jsx(Xe,{id:"code",...u.register("code"),"data-testid":"input-item-code"}),u.formState.errors.code&&h.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.code.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"name",children:"Tn vt t *"}),h.jsx(Xe,{id:"name",...u.register("name"),"data-testid":"input-item-name"}),u.formState.errors.name&&h.jsx("p",{className:"text-sm text-destructive",children:u.formState.errors.name.message})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"category",children:"Danh mc *"}),h.jsxs(Tn,{value:u.watch("category"),onValueChange:g=>u.setValue("category",g),children:[h.jsx(ln,{"data-testid":"select-category",children:h.jsx(bn,{placeholder:"Chn danh mc"})}),h.jsxs(cn,{children:[h.jsx(ke,{value:"Thuc",children:"Thuc"}),h.jsx(ke,{value:"Vc-xin",children:"Vc-xin"}),h.jsx(ke,{value:"Dng c y t",children:"Dng c y t"}),h.jsx(ke,{value:"Thc phm",children:"Thc phm"}),h.jsx(ke,{value:"Khc",children:"Khc"})]})]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"quantity",children:"S lng *"}),h.jsx(Xe,{id:"quantity",type:"number",...u.register("quantity"),"data-testid":"input-quantity"})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"unit",children:"n v *"}),h.jsx(Xe,{id:"unit",...u.register("unit"),placeholder:"vd: hp, l, vin"})]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"minStockLevel",children:"Tn kho ti thiu *"}),h.jsx(Xe,{id:"minStockLevel",type:"number",...u.register("minStockLevel")})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"price",children:"Gi () *"}),h.jsx(Xe,{id:"price",...u.register("price"),placeholder:"100000"})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{htmlFor:"expiryDate",children:"Hn s dng"}),h.jsx(Xe,{id:"expiryDate",type:"date",...u.register("expiryDate")})]}),h.jsxs(Ci,{children:[h.jsx(be,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Hy"}),h.jsx(be,{type:"submit",disabled:d.isPending,"data-testid":"button-save-inventory",children:d.isPending?"ang lu...":"Lu"})]})]})]})})]})}function zB(){return h.jsx(HB,{})}const hS={paid:{label:" thanh ton",variant:"secondary",className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},pending:{label:"Ch thanh ton",variant:"secondary",className:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400"},overdue:{label:"Qu hn",variant:"destructive",className:""}};function WB(){const n=_r(),{toast:e}=ns(),[t,r]=E.useState(!1),[s,i]=E.useState(""),[a,o]=E.useState(""),{data:l=[]}=Je({queryKey:["/api/customers"]}),{data:c=[],isLoading:u}=Je({queryKey:["/api/invoices"]}),[d,f]=E.useState(""),[m,p]=E.useState("all"),g=E.useMemo(()=>{const y=d.trim().toLowerCase();return c.filter(S=>{const b=m==="all"||S.status===m,w=l.find(I=>I.id===S.customerId),_=`${S.invoiceNumber} ${(w==null?void 0:w.name)||S.customerId} ${S.status}`.toLowerCase(),A=y===""||_.includes(y);return b&&A})},[c,l,d,m]),v=Tr({mutationFn:async y=>await(await Qr("POST","/api/payments",{invoiceId:y.id,amount:y.totalAmount,paymentMethod:"cash"})).json(),onSuccess:()=>{n.invalidateQueries({queryKey:["/api/invoices"]}),n.invalidateQueries({queryKey:["/api/dashboard/stats"]}),e({title:"Thanh ton thnh cng"})},onError:()=>e({title:"Li",description:"Khng th thanh ton",variant:"destructive"})}),x=Tr({mutationFn:async()=>{const y=`I${Date.now()}`;return await(await Qr("POST","/api/invoices",{customerId:s,invoiceNumber:y,totalAmount:a||"0",status:"pending"})).json()},onSuccess:()=>{n.invalidateQueries({queryKey:["/api/invoices"]}),n.invalidateQueries({queryKey:["/api/dashboard/stats"]}),e({title:" to ha n"}),r(!1),i(""),o("")},onError:()=>e({title:"Li",description:"Khng th to ha n",variant:"destructive"})});return h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"font-serif text-3xl font-bold","data-testid":"text-page-title",children:"Ha n"}),h.jsx("p",{className:"text-muted-foreground mt-1",children:"Qun l ha n v thanh ton"})]}),h.jsxs(be,{"data-testid":"button-create-invoice",onClick:()=>r(!0),children:[h.jsx(mi,{className:"h-4 w-4 mr-2"}),"To ha n"]})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[h.jsx(tt,{children:h.jsx(nt,{className:"p-4",children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:h.jsx(Dl,{className:"h-5 w-5 text-primary"})}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm text-muted-foreground",children:"Tng ha n"}),h.jsx("p",{className:"text-2xl font-bold",children:"2.85M"})]})]})})}),h.jsx(tt,{children:h.jsx(nt,{className:"p-4",children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"p-2 rounded-lg bg-green-500/10",children:h.jsx(Dl,{className:"h-5 w-5 text-green-600"})}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm text-muted-foreground",children:" thu"}),h.jsx("p",{className:"text-2xl font-bold",children:"2.05M"})]})]})})}),h.jsx(tt,{children:h.jsx(nt,{className:"p-4",children:h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"p-2 rounded-lg bg-amber-500/10",children:h.jsx(Dl,{className:"h-5 w-5 text-amber-600"})}),h.jsxs("div",{children:[h.jsx("p",{className:"text-sm text-muted-foreground",children:"Cha thu"}),h.jsx("p",{className:"text-2xl font-bold",children:"800K"})]})]})})})]}),h.jsxs(tt,{children:[h.jsx(Vt,{children:h.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[h.jsx(Zt,{className:"flex-1",children:"Danh sch ha n"}),h.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[h.jsxs("div",{className:"relative w-full sm:w-64",children:[h.jsx(_0,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h.jsx(Xe,{placeholder:"Tm kim ha n...",className:"pl-9",value:d,onChange:y=>f(y.target.value),"data-testid":"input-search"})]}),h.jsxs(Tn,{value:m,onValueChange:p,children:[h.jsx(ln,{className:"w-[160px]",children:h.jsx(bn,{placeholder:"Lc trng thi"})}),h.jsxs(cn,{children:[h.jsx(ke,{value:"all",children:"Tt c"}),h.jsx(ke,{value:"pending",children:"Ch thanh ton"}),h.jsx(ke,{value:"paid",children:" thanh ton"}),h.jsx(ke,{value:"overdue",children:"Qu hn"})]})]})]})]})}),h.jsx(nt,{children:u?h.jsx("p",{className:"text-muted-foreground",children:"ang ti..."}):g.length===0?h.jsxs("div",{className:"text-center py-12",children:[h.jsx("p",{className:"text-muted-foreground mb-4",children:"Cha c ha n ph hp"}),h.jsxs(be,{onClick:()=>r(!0),children:[h.jsx(mi,{className:"h-4 w-4 mr-2"}),"To ha n"]})]}):h.jsxs(J0,{children:[h.jsx(ey,{children:h.jsxs(sc,{children:[h.jsx(qn,{children:"M ha n"}),h.jsx(qn,{children:"Ngy"}),h.jsx(qn,{children:"Khch hng"}),h.jsx(qn,{className:"text-right",children:"S tin"}),h.jsx(qn,{children:"Trng thi"}),h.jsx(qn,{className:"text-right",children:"Thao tc"})]})}),h.jsx(ty,{children:g.map(y=>{const S=hS[y.status]||hS.pending,b=l.find(w=>w.id===y.customerId);return h.jsxs(sc,{"data-testid":`row-invoice-${y.id}`,children:[h.jsx(Qn,{className:"font-mono font-medium",children:y.invoiceNumber}),h.jsx(Qn,{className:"font-mono text-sm",children:new Date(y.issuedAt).toLocaleDateString("vi-VN")}),h.jsx(Qn,{children:(b==null?void 0:b.name)||y.customerId}),h.jsxs(Qn,{className:"text-right font-mono font-semibold",children:["",parseFloat(y.totalAmount).toLocaleString()]}),h.jsx(Qn,{children:h.jsx(Rn,{variant:S.variant,className:S.className,children:S.label})}),h.jsx(Qn,{className:"text-right",children:h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx(be,{variant:"outline",size:"sm",children:"Xem"}),y.status==="pending"&&h.jsx(be,{size:"sm",onClick:()=>v.mutate(y),disabled:v.isPending,children:v.isPending?"ang x l...":"Thanh ton"})]})})]},y.id)})})]})})]}),h.jsx(Ea,{open:t,onOpenChange:r,children:h.jsxs(Ii,{children:[h.jsx(Ri,{children:h.jsx(Li,{children:"To ha n"})}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{children:"Khch hng"}),h.jsxs(Tn,{value:s,onValueChange:i,children:[h.jsx(ln,{children:h.jsx(bn,{placeholder:"Chn khch hng"})}),h.jsx(cn,{children:l.map(y=>h.jsx(ke,{value:y.id,children:y.name},y.id))})]})]}),h.jsxs("div",{className:"space-y-2",children:[h.jsx(Ne,{children:"S tin"}),h.jsx(Xe,{value:a,onChange:y=>o(y.target.value),placeholder:"100000"})]})]}),h.jsxs(Ci,{children:[h.jsx(be,{variant:"outline",onClick:()=>r(!1),children:"Hy"}),h.jsx(be,{onClick:()=>x.mutate(),disabled:!s||!a||x.isPending,children:x.isPending?"ang to...":"To ha n"})]})]})})]})}const re=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},YB=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=qB},qB=Number.MAX_SAFE_INTEGER||9007199254740991;let fe=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),F=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),T=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var Fe={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},oe={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Ia{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class QB{constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ia(e),this.fast_=new Ia(t),this.defaultTTFB_=s,this.ttfb_=new Ia(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new Ia(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new Ia(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Ia(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,s=e/1e3,i=r/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function XB(n,e,t){return(e=JB(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Ze(){return Ze=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ze.apply(null,arguments)}function mS(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,r)}return t}function We(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?mS(Object(t),!0).forEach(function(r){XB(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):mS(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function ZB(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function JB(n){var e=ZB(n,"string");return typeof e=="symbol"?e:e+""}class rr{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=Us,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const Us=function(){},e3={trace:Us,debug:Us,log:Us,warn:Us,info:Us,error:Us};function Jp(){return Ze({},e3)}function t3(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):Us}function pS(n,e,t){return e[n]?e[n].bind(e):t3(n,t)}const eg=Jp();function n3(n,e,t){const r=Jp();if(typeof console=="object"&&n===!0||typeof n=="object"){const s=["debug","log","info","warn","error"];s.forEach(i=>{r[i]=pS(i,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.13`)}catch{return Jp()}s.forEach(i=>{eg[i]=pS(i,n)})}else Ze(eg,r);return r}const Ye=eg;function Ti(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function r3(n){return typeof self<"u"&&n===self.ManagedMediaSource}function i1(n,e){const t=Object.keys(n),r=Object.keys(e),s=t.length,i=r.length;return!s||!i||s===i&&!t.some(a=>r.indexOf(a)===-1)}function Un(n,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(n);if(e){const u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}const t=n.length;let r,s,i,a="",o=0;for(;o<t;){if(r=n[o++],r===0&&e)return a;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:s=n[o++],a+=String.fromCharCode((r&31)<<6|s&63);break;case 14:s=n[o++],i=n[o++],a+=String.fromCharCode((r&15)<<12|(s&63)<<6|(i&63)<<0);break}}return a}function on(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}function a1(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function s3(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var em={exports:{}},gS;function i3(){return gS||(gS=1,function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var f=o.parseURL(c);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return u.alwaysNormalize?(f.path=o.normalizePath(f.path),o.buildURLFromParts(f)):c;var m=o.parseURL(l);if(!m)throw new Error("Error trying to parse base URL.");if(!m.netLoc&&m.path&&m.path[0]!=="/"){var p=s.exec(m.path);m.netLoc=p[1],m.path=p[2]}m.netLoc&&!m.path&&(m.path="/");var g={scheme:m.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(g.netLoc=m.netLoc,f.path[0]!=="/"))if(!f.path)g.path=m.path,f.params||(g.params=m.params,f.query||(g.query=m.query));else{var v=m.path,x=v.substring(0,v.lastIndexOf("/")+1)+f.path;g.path=o.normalizePath(x)}return g.path===null&&(g.path=u.alwaysNormalize?o.normalizePath(f.path):f.path),o.buildURLFromParts(g)},parseURL:function(l){var c=r.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=o})()}(em)),em.exports}var xy=i3();class Sy{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var et={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class o1{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,o3(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let s;r.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(r[1]),this._byteRange=[s,parseInt(r[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[et.AUDIO]:null,[et.VIDEO]:null,[et.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Sy),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=xy.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[et.AUDIO]=null,e[et.VIDEO]=null,e[et.AUDIOVIDEO]=null}}function wt(n){return n.sn!=="initSegment"}class tm extends o1{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(re(e)&&re(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const r=Object.keys(t);if(r.length===1){const s=this._decryptdata=t[r[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=re(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const r=Object.keys(this.levelkeys),s=r.length;if(s>1||s===1&&(t=this.levelkeys[r[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!re(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return wt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const s=t[e];s&&!((r=this._decryptdata)!=null&&r.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,s,i,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:i,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,i)}}class a3 extends o1{constructor(e,t,r,s,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function l1(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||l1(t,e)}}function o3(n,e){const t=l1(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const yS=Math.pow(2,32)-1,l3=[].push,c1={video:1,audio:2,id3:3,text:4};function Rt(n){return String.fromCharCode.apply(null,n)}function u1(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function Te(n,e){const t=d1(n,e);return t<0?4294967296+t:t}function vS(n,e){let t=Te(n,e);return t*=Math.pow(2,32),t+=Te(n,e+4),t}function d1(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function c3(n){const e=n.byteLength;for(let t=0;t<e;){const r=Te(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function Me(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let s=0;s<r;){const i=Te(n,s),a=Rt(n.subarray(s+4,s+8)),o=i>1?s+i:r;if(a===e[0])if(e.length===1)t.push(n.subarray(s+8,o));else{const l=Me(n.subarray(s+8,o),e.slice(1));l.length&&l3.apply(t,l)}s=o}return t}function u3(n){const e=[],t=n[0];let r=8;const s=Te(n,r);r+=4;let i=0,a=0;t===0?(i=Te(n,r),a=Te(n,r+4),r+=8):(i=vS(n,r),a=vS(n,r+8),r+=16),r+=2;let o=n.length+a;const l=u1(n,r);r+=2;for(let c=0;c<l;c++){let u=r;const d=Te(n,u);u+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return Ye.warn("SIDX has hierarchical references (not supported)"),null;const p=Te(n,u);u+=4,e.push({referenceSize:f,subsegmentDuration:p,info:{duration:p/s,start:o,end:o+f-1}}),o+=f,u+=4,r=u}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:l,references:e}}function f1(n){const e=[],t=Me(n,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],a=Me(i,["tkhd"])[0];if(a){let o=a[0];const l=Te(a,o===0?12:20),c=Me(i,["mdia","mdhd"])[0];if(c){o=c[0];const u=Te(c,o===0?12:20),d=Me(i,["mdia","hdlr"])[0];if(d){const f=Rt(d.subarray(8,12)),m={soun:et.AUDIO,vide:et.VIDEO}[f],p=Me(i,["mdia","minf","stbl","stsd"])[0],g=d3(p);m?(e[l]={timescale:u,type:m,stsd:g},e[m]=We({timescale:u,id:l},g)):e[l]={timescale:u,type:f,stsd:g}}}}}return Me(n,["moov","mvex","trex"]).forEach(s=>{const i=Te(s,4),a=e[i];a&&(a.default={duration:Te(s,12),flags:Te(s,20)})}),e}function d3(n){const e=n.subarray(8),t=e.subarray(86),r=Rt(e.subarray(4,8));let s=r,i;const a=r==="enca"||r==="encv";if(a){const c=Me(e,[r])[0].subarray(r==="enca"?28:78);Me(c,["sinf"]).forEach(d=>{const f=Me(d,["schm"])[0];if(f){const m=Rt(f.subarray(4,8));if(m==="cbcs"||m==="cenc"){const p=Me(d,["frma"])[0];p&&(s=Rt(p))}}})}const o=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const l=Me(t,["avcC"])[0];l&&l.length>3&&(s+="."+vu(l[1])+vu(l[2])+vu(l[3]),i=yu(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=Me(e,[r])[0],c=Me(l.subarray(28),["esds"])[0];if(c&&c.length>7){let u=4;if(c[u++]!==3)break;u=nm(c,u),u+=2;const d=c[u++];if(d&128&&(u+=2),d&64&&(u+=c[u++]),c[u++]!==4)break;u=nm(c,u);const f=c[u++];if(f===64)s+="."+vu(f);else break;if(u+=12,c[u++]!==5)break;u=nm(c,u);const m=c[u++];let p=(m&248)>>3;p===31&&(p+=1+((m&7)<<3)+((c[u]&224)>>5)),s+="."+p}break}case"hvc1":case"hev1":{const l=Me(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],u=["","A","B","C"][c>>6],d=c&31,f=Te(l,2),m=(c&32)>>5?"H":"L",p=l[12],g=l.subarray(6,12);s+="."+u+d,s+="."+f3(f).toString(16).toUpperCase(),s+="."+m+p;let v="";for(let x=g.length;x--;){const y=g[x];(y||v)&&(v="."+y.toString(16).toUpperCase()+v)}s+=v}i=yu(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=yu(s,t)||s;break}case"vp09":{const l=Me(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],u=l[5],d=l[6]>>4&15;s+="."+Nr(c)+"."+Nr(u)+"."+Nr(d)}break}case"av01":{const l=Me(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,u=l[1]&31,d=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,m=(l[2]&32)>>5,p=c===2&&f?m?12:10:f?10:8,g=(l[2]&16)>>4,v=(l[2]&8)>>3,x=(l[2]&4)>>2,y=l[2]&3;s+="."+c+"."+Nr(u)+d+"."+Nr(p)+"."+g+"."+v+x+y+"."+Nr(1)+"."+Nr(1)+"."+Nr(1)+"."+0,i=yu("dav1",t)}break}}return{codec:s,encrypted:a,supplemental:i}}function yu(n,e){const t=Me(e,["dvvC"]),r=t.length?t[0]:Me(e,["dvcC"])[0];if(r){const s=r[2]>>1&127,i=r[2]<<5&32|r[3]>>3&31;return n+"."+Nr(s)+"."+Nr(i)}}function f3(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function nm(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function vu(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Nr(n){return(n<10?"0":"")+n}function h3(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&h1(n,(r,s)=>{const i=r.subarray(8,24);i.some(a=>a!==0)||(Ye.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${on(i)} -> ${on(t)}`),r.set(t,8))})}function m3(n){const e=[];return h1(n,t=>e.push(t.subarray(8,24))),e}function h1(n,e){Me(n,["moov","trak"]).forEach(r=>{const s=Me(r,["mdia","minf","stbl","stsd"])[0];if(!s)return;const i=s.subarray(8);let a=Me(i,["enca"]);const o=a.length>0;o||(a=Me(i,["encv"])),a.forEach(l=>{const c=o?l.subarray(28):l.subarray(78);Me(c,["sinf"]).forEach(d=>{const f=m1(d);f&&e(f,o)})})})}function m1(n){const e=Me(n,["schm"])[0];if(e){const t=Rt(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const r=Me(n,["schi","tenc"])[0];if(r)return r}}}function p3(n,e,t){const r={},s=Me(n,["moof","traf"]);for(let i=0;i<s.length;i++){const a=s[i],o=Me(a,["tfhd"])[0],l=Te(o,4),c=e[l];if(!c)continue;r[l]||(r[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const u=r[l],d=Me(a,["tfdt"])[0];if(d){const S=d[0];let b=Te(d,4);S===1&&(b===yS?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(b*=yS+1,b+=Te(d,8))),re(b)&&(!re(u.start)||b<u.start)&&(u.start=b)}const f=c.default,m=Te(o,0)|(f==null?void 0:f.flags);let p=(f==null?void 0:f.duration)||0;m&8&&(m&2?p=Te(o,12):p=Te(o,8));const g=Me(a,["trun"]);let v=u.start||0,x=0,y=p;for(let S=0;S<g.length;S++){const b=g[S],w=Te(b,4),_=u.sampleCount;u.sampleCount+=w;const A=b[3]&1,I=b[3]&4,C=b[2]&1,R=b[2]&2,P=b[2]&4,O=b[2]&8;let U=8,j=w;for(A&&(U+=4),I&&w&&(!(b[U+1]&1)&&u.keyFrameIndex===void 0&&(u.keyFrameIndex=_),U+=4,C?(y=Te(b,U),U+=4):y=p,R&&(U+=4),O&&(U+=4),v+=y,x+=y,j--);j--;)C?(y=Te(b,U),U+=4):y=p,R&&(U+=4),P&&(b[U+1]&1||u.keyFrameIndex===void 0&&(u.keyFrameIndex=u.sampleCount-(j+1),u.keyFrameStart=v),U+=4),O&&(U+=4),v+=y,x+=y;!x&&p&&(x+=p*w)}u.duration+=x}if(!Object.keys(r).some(i=>r[i].duration)){let i=1/0,a=0;const o=Me(n,["sidx"]);for(let l=0;l<o.length;l++){const c=u3(o[l]);if(c!=null&&c.references){i=Math.min(i,c.earliestPresentationTime/c.timescale);const u=c.references.reduce((d,f)=>d+f.info.duration||0,0);a=Math.max(a,u+c.earliestPresentationTime/c.timescale)}}a&&re(a)&&Object.keys(r).forEach(l=>{r[l].duration||(r[l].duration=a*r[l].timescale-r[l].start)})}return r}function g3(n){const e={valid:null,remainder:null},t=Me(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function nr(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function xS(n,e){const t=[],r=e.samples,s=e.timescale,i=e.id;let a=!1;return Me(r,["moof"]).map(l=>{const c=l.byteOffset-8;Me(l,["traf"]).map(d=>{const f=Me(d,["tfdt"]).map(m=>{const p=m[0];let g=Te(m,4);return p===1&&(g*=Math.pow(2,32),g+=Te(m,8)),g/s})[0];return f!==void 0&&(n=f),Me(d,["tfhd"]).map(m=>{const p=Te(m,4),g=Te(m,0)&16777215,v=(g&1)!==0,x=(g&2)!==0,y=(g&8)!==0;let S=0;const b=(g&16)!==0;let w=0;const _=(g&32)!==0;let A=8;p===i&&(v&&(A+=8),x&&(A+=4),y&&(S=Te(m,A),A+=4),b&&(w=Te(m,A),A+=4),_&&(A+=4),e.type==="video"&&(a=rh(e.codec)),Me(d,["trun"]).map(I=>{const C=I[0],R=Te(I,0)&16777215,P=(R&1)!==0;let O=0;const U=(R&4)!==0,j=(R&256)!==0;let G=0;const $=(R&512)!==0;let Y=0;const D=(R&1024)!==0,N=(R&2048)!==0;let K=0;const V=Te(I,4);let W=8;P&&(O=Te(I,W),W+=4),U&&(W+=4);let de=O+c;for(let pe=0;pe<V;pe++){if(j?(G=Te(I,W),W+=4):G=S,$?(Y=Te(I,W),W+=4):Y=w,D&&(W+=4),N&&(C===0?K=Te(I,W):K=d1(I,W),W+=4),e.type===et.VIDEO){let ge=0;for(;ge<Y;){const me=Te(r,de);if(de+=4,y3(a,r[de])){const ee=r.subarray(de,de+me);Ey(ee,a?2:1,n+K/s,t)}de+=me,ge+=me+4}}n+=G/s}}))})})}),t}function rh(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function y3(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Ey(n,e,t,r){const s=p1(n);let i=0;i+=e;let a=0,o=0,l=0;for(;i<s.length;){a=0;do{if(i>=s.length)break;l=s[i++],a+=l}while(l===255);o=0;do{if(i>=s.length)break;l=s[i++],o+=l}while(l===255);const c=s.length-i;let u=i;if(o<c)i+=o;else if(o>c){Ye.error(`Malformed SEI payload. ${o} is too small, only ${c} bytes left to parse.`);break}if(a===4){if(s[u++]===181){const f=u1(s,u);if(u+=2,f===49){const m=Te(s,u);if(u+=4,m===1195456820){const p=s[u++];if(p===3){const g=s[u++],v=31&g,x=64&g,y=x?2+v*3:0,S=new Uint8Array(y);if(x){S[0]=g;for(let b=1;b<y;b++)S[b]=s[u++]}r.push({type:p,payloadType:a,pts:t,bytes:S})}}}}}else if(a===5&&o>16){const d=[];for(let p=0;p<16;p++){const g=s[u++].toString(16);d.push(g.length==1?"0"+g:g),(p===3||p===5||p===7||p===9)&&d.push("-")}const f=o-16,m=new Uint8Array(f);for(let p=0;p<f;p++)m[p]=s[u++];r.push({payloadType:a,pts:t,uuid:d.join(""),userData:Un(m),userDataBytes:m})}}}function p1(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const s=e-t.length,i=new Uint8Array(s);let a=0;for(r=0;r<s;a++,r++)a===t[0]&&(a++,t.shift()),i[r]=n[a];return i}function v3(n){const e=n[0];let t="",r="",s=0,i=0,a=0,o=0,l=0,c=0;if(e===0){for(;Rt(n.subarray(c,c+1))!=="\0";)t+=Rt(n.subarray(c,c+1)),c+=1;for(t+=Rt(n.subarray(c,c+1)),c+=1;Rt(n.subarray(c,c+1))!=="\0";)r+=Rt(n.subarray(c,c+1)),c+=1;r+=Rt(n.subarray(c,c+1)),c+=1,s=Te(n,12),i=Te(n,16),o=Te(n,20),l=Te(n,24),c=28}else if(e===1){c+=4,s=Te(n,c),c+=4;const d=Te(n,c);c+=4;const f=Te(n,c);for(c+=4,a=2**32*d+f,YB(a)||(a=Number.MAX_SAFE_INTEGER,Ye.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Te(n,c),c+=4,l=Te(n,c),c+=4;Rt(n.subarray(c,c+1))!=="\0";)t+=Rt(n.subarray(c,c+1)),c+=1;for(t+=Rt(n.subarray(c,c+1)),c+=1;Rt(n.subarray(c,c+1))!=="\0";)r+=Rt(n.subarray(c,c+1)),c+=1;r+=Rt(n.subarray(c,c+1)),c+=1}const u=n.subarray(c,n.byteLength);return{schemeIdUri:t,value:r,timeScale:s,presentationTime:a,presentationTimeDelta:i,eventDuration:o,id:l,payload:u}}function x3(n,...e){const t=e.length;let r=8,s=t;for(;s--;)r+=e[s].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=r&255,i.set(n,4),s=0,r=8;s<t;s++)i.set(e[s],r),r+=e[s].byteLength;return i}function S3(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,s;r=0,s=new Uint8Array;let i;r>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),x3([112,115,115,104],new Uint8Array([r,0,0,0]),n,i,s,a,t)}function E3(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const s=new DataView(n,r),i=T3(s);e.push(i),r+=i.size}}return e}function T3(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const i=n.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const a=n.buffer,o=on(new Uint8Array(a,t+12,16));let l=null,c=null,u=0;if(i===0)u=28;else{const f=n.getUint32(28);if(!f||r<32+f*16)return{offset:t,size:e};l=[];for(let m=0;m<f;m++)l.push(new Uint8Array(a,t+32+m*16,16));u=32+f*16}if(!u)return{offset:t,size:e};const d=n.getUint32(u);return e-32<d?{offset:t,size:e}:(c=new Uint8Array(a,t+u+4,d),{version:i,systemId:o,kids:l,data:c,offset:t,size:e})}const g1=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Mo={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Ty(n,e){const t=Mo[e];return!!t&&!!t[n.slice(0,4)]}function Sc(n,e,t=!0){return!n.split(",").some(r=>!by(r,e,t))}function by(n,e,t=!0){var r;const s=Ti(t);return(r=s==null?void 0:s.isTypeSupported(Ec(n,e)))!=null?r:!1}function Ec(n,e){return`${e}/mp4;codecs=${n}`}function SS(n){if(n){const e=n.substring(0,4);return Mo.video[e]}return 2}function Zd(n){const e=g1();return n.split(",").reduce((t,r)=>{const i=e&&rh(r)?9:Mo.video[r];return i?(i*2+t)/(t?3:2):(Mo.audio[r]+t)/(t?2:1)},0)}const rm={};function b3(n,e=!0){if(rm[n])return rm[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let s=0;s<t.length;s++){var r;if(by(t[s],"audio",e))return rm[n]=t[s],t[s];if(t[s]==="mp3"&&(r=Ti(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const w3=/flac|opus|mp4a\.40\.34/i;function Jd(n,e=!0){return n.replace(w3,t=>b3(t.toLowerCase(),e))}function A3(n,e){const t=[];if(n){const r=n.split(",");for(let s=0;s<r.length;s++)Ty(r[s],"video")||t.push(r[s])}return e&&t.push(e),t.join(",")}function Zu(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(ES(n,"audio")||ES(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function ES(n,e){return Ty(n,e)&&by(n,e)}function _3(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function I3(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function TS(n){const e=Ti(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function tg(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const R3={supported:!0,powerEfficient:!0,smooth:!0},C3={supported:!1,smooth:!1,powerEfficient:!1},y1={supported:!0,configurations:[],decodingInfoResults:[R3]};function v1(n,e){return{supported:!1,configurations:e,decodingInfoResults:[C3],error:n}}function L3(n,e,t,r,s,i){const a=n.videoCodec,o=n.audioCodec?n.audioGroups:null,l=i==null?void 0:i.audioCodec,c=i==null?void 0:i.channels,u=c?parseInt(c):l?1/0:2;let d=null;if(o!=null&&o.length)try{o.length===1&&o[0]?d=e.groups[o[0]].channels:d=o.reduce((f,m)=>{if(m){const p=e.groups[m];if(!p)throw new Error(`Audio track group ${m} not found`);Object.keys(p.channels).forEach(g=>{f[g]=(f[g]||0)+p.channels[g]})}return f},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(f=>rh(f))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(s,8e6))||!!d&&re(u)&&Object.keys(d).some(f=>parseInt(f)>u)}function x1(n,e,t,r={}){const s=n.videoCodec;if(!s&&!n.audioCodec||!t)return Promise.resolve(y1);const i=[],a=k3(n),o=a.length,l=D3(n,e,o>0),c=l.length;for(let u=o||1*c||1;u--;){const d={type:"media-source"};if(o&&(d.video=a[u%o]),c){d.audio=l[u%c];const f=d.audio.bitrate;d.video&&f&&(d.video.bitrate-=f)}i.push(d)}if(s){const u=navigator.userAgent;if(s.split(",").some(d=>rh(d))&&g1())return Promise.resolve(v1(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),i))}return Promise.all(i.map(u=>{const d=N3(u);return r[d]||(r[d]=t.decodingInfo(u))})).then(u=>({supported:!u.some(d=>!d.supported),configurations:i,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:i,decodingInfoResults:[],error:u}))}function k3(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),r=S1(n),s=n.width||640,i=n.height||480,a=n.frameRate||30,o=n.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:Ec(I3(l),"video"),width:s,height:i,bitrate:r,framerate:a};return o!=="sdr"&&(c.transferFunction=o),c}):[]}function D3(n,e,t){var r;const s=(r=n.audioCodec)==null?void 0:r.split(","),i=S1(n);return s&&n.audioGroups?n.audioGroups.reduce((a,o)=>{var l;const c=o?(l=e.groups[o])==null?void 0:l.tracks:null;return c?c.reduce((u,d)=>{if(d.groupId===o){const f=parseFloat(d.channels||"");s.forEach(m=>{const p={contentType:Ec(m,"audio"),bitrate:t?P3(m,i):i};f&&(p.channels=""+f),u.push(p)})}return u},a):a},[]):[]}function P3(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function S1(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function N3(n){let e="";const{audio:t,video:r}=n;if(r){const s=tg(r.contentType);e+=`${s}_r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${Math.ceil(r.bitrate/1e5)}`}if(t){const s=tg(t.contentType);e+=`${r?"_":""}${s}_c${t.channels}`}return e}const ng=["NONE","TYPE-0","TYPE-1",null];function O3(n){return ng.indexOf(n)>-1}const ef=["SDR","PQ","HLG"];function M3(n){return!!n&&ef.indexOf(n)>-1}var Ju={No:"",Yes:"YES",v2:"v2"};function bS(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,s=r<e/2;return e&&s?t?Ju.v2:Ju.Yes:Ju.No}class wS{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Tc{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return AS(this._audioGroups,e)}hasSubtitleGroup(e){return AS(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function AS(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function F3(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function j3(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||ef.slice(0);const s=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&F3(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const $3=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},rt=(n,e)=>JSON.stringify(n,$3(e));function U3(n,e,t,r,s){const i=Object.keys(n),a=r==null?void 0:r.channels,o=r==null?void 0:r.audioCodec,l=s==null?void 0:s.videoCodec,c=a&&parseInt(a)===2;let u=!1,d=!1,f=1/0,m=1/0,p=1/0,g=1/0,v=0,x=[];const{preferHDR:y,allowedVideoRanges:S}=j3(e,s);for(let I=i.length;I--;){const C=n[i[I]];u||(u=C.channels[2]>0),f=Math.min(f,C.minHeight),m=Math.min(m,C.minFramerate),p=Math.min(p,C.minBitrate),S.filter(P=>C.videoRanges[P]>0).length>0&&(d=!0)}f=re(f)?f:0,m=re(m)?m:0;const b=Math.max(1080,f),w=Math.max(30,m);p=re(p)?p:t,t=Math.max(p,t),d||(e=void 0);const _=i.length>1;return{codecSet:i.reduce((I,C)=>{const R=n[C];if(C===I)return I;if(x=d?S.filter(P=>R.videoRanges[P]>0):[],_){if(R.minBitrate>t)return kr(C,`min bitrate of ${R.minBitrate} > current estimate of ${t}`),I;if(!R.hasDefaultAudio)return kr(C,"no renditions with default or auto-select sound found"),I;if(o&&C.indexOf(o.substring(0,4))%5!==0)return kr(C,`audio codec preference "${o}" not found`),I;if(a&&!c){if(!R.channels[a])return kr(C,`no renditions with ${a} channel sound found (channels options: ${Object.keys(R.channels)})`),I}else if((!o||c)&&u&&R.channels[2]===0)return kr(C,"no renditions with stereo sound found"),I;if(R.minHeight>b)return kr(C,`min resolution of ${R.minHeight} > maximum of ${b}`),I;if(R.minFramerate>w)return kr(C,`min framerate of ${R.minFramerate} > maximum of ${w}`),I;if(!x.some(P=>R.videoRanges[P]>0))return kr(C,`no variants with VIDEO-RANGE of ${rt(x)} found`),I;if(l&&C.indexOf(l.substring(0,4))%5!==0)return kr(C,`video codec preference "${l}" not found`),I;if(R.maxScore<v)return kr(C,`max score of ${R.maxScore} < selected max of ${v}`),I}return I&&(Zd(C)>=Zd(I)||R.fragmentError>n[I].fragmentError)?I:(g=R.minIndex,v=R.maxScore,C)},void 0),videoRanges:x,preferHDR:y,minFramerate:m,minBitrate:p,minIndex:g}}function kr(n,e){Ye.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function E1(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const s=t.channels||"2";return r.channels[s]=(r.channels[s]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function B3(n,e,t,r){return n.slice(t,r+1).reduce((s,i,a)=>{if(!i.codecSet)return s;const o=i.audioGroups;let l=s[i.codecSet];l||(s[i.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,i.bitrate);const c=Math.min(i.height,i.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,i.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,i.score),l.fragmentError+=i.fragmentError,l.videoRanges[i.videoRange]=(l.videoRanges[i.videoRange]||0)+1,o&&o.forEach(u=>{if(!u)return;const d=e.groups[u];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+d.channels[f]}))}),s},{})}function _S(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}=n;return{lang:e,assocLang:t,characteristics:r,channels:s,audioCodec:i}}function Kr(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const s=e[r];if(Zi(n,s,t))return r}return-1}function Zi(n,e,t){const{groupId:r,name:s,lang:i,assocLang:a,default:o}=n,l=n.forced;return(r===void 0||e.groupId===r)&&(s===void 0||e.name===s)&&(i===void 0||V3(i,e.lang))&&(i===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||G3(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function V3(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function G3(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(s=>r.indexOf(s)===-1)}function Fi(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function K3(n,e,t,r,s){const i=e[r],o=e.reduce((f,m,p)=>{const g=m.uri;return(f[g]||(f[g]=[])).push(p),f},{})[i.uri];o.length>1&&(r=Math.max.apply(Math,o));const l=i.videoRange,c=i.frameRate,u=i.codecSet.substring(0,4),d=IS(e,r,f=>{if(f.videoRange!==l||f.frameRate!==c||f.codecSet.substring(0,4)!==u)return!1;const m=f.audioGroups,p=t.filter(g=>!m||m.indexOf(g.groupId)!==-1);return Kr(n,p,s)>-1});return d>-1?d:IS(e,r,f=>{const m=f.audioGroups,p=t.filter(g=>!m||m.indexOf(g.groupId)!==-1);return Kr(n,p,s)>-1})}function IS(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function tf(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class H3 extends rr{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:s,partCurrent:i,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!s||!l)return;const c=performance.now(),u=i?i.stats:s.stats,d=i?i.duration:s.duration,f=c-u.loading.start,m=a.minAutoLevel,p=s.level,g=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||p<=m){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const v=g>-1&&g!==p,x=!!t||v;if(!x&&(l.paused||!l.playbackRate||!l.readyState))return;const y=a.mainForwardBufferInfo;if(!x&&y===null)return;const S=this.bwEstimator.getEstimateTTFB(),b=Math.abs(l.playbackRate);if(f<=Math.max(S,1e3*(d/(b*2))))return;const w=y?y.len/b:0,_=u.loading.first?u.loading.first-u.loading.start:-1,A=u.loaded&&_>-1,I=this.getBwEstimate(),C=a.levels,R=C[p],P=Math.max(u.loaded,Math.round(d*(s.bitrate||R.averageBitrate)/8));let O=A?f-_:f;O<1&&A&&(O=Math.min(f,u.loaded*8/I));const U=A?u.loaded*1e3/O:0,j=S/1e3,G=U?(P-u.loaded)/U:P*8/I+j;if(G<=w)return;const $=U?U*8:I,Y=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,D=this.hls.config.abrBandWidthUpFactor;let N=Number.POSITIVE_INFINITY,K;for(K=p-1;K>m;K--){const pe=C[K].maxBitrate,ge=!C[K].details||Y;if(N=this.getTimeToLoadFrag(j,$,d*pe,ge),N<Math.min(w,d+j))break}if(N>=G||N>d*10)return;A?this.bwEstimator.sample(f-Math.min(S,_),u.loaded):this.bwEstimator.sampleTTFB(f);const V=C[K].maxBitrate;this.getBwEstimate()*D>V&&this.resetEstimator(V);const W=this.findBestLevel(V,m,K,0,w,1,1);W>-1&&(K=W),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${p} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${w.toFixed(3)} s
      Estimated load time for current fragment: ${G.toFixed(3)} s
      Estimated load time for down switch fragment: ${N.toFixed(3)} s
      TTFB estimate: ${_|0} ms
      Current BW estimate: ${re(I)?I|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${K} @ ${V|0} bps`),a.nextLoadLevel=a.nextAutoLevel=K,this.clearTimer();const de=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===K&&K>0){const pe=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${K>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${pe.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,K>m){let ge=this.findBestLevel(this.hls.levels[m].bitrate,m,K,0,pe,1,1);ge===-1&&(ge=m),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ge,this.resetEstimator(this.hls.levels[ge].bitrate)}}};v||G>N*2?de():this.timer=self.setInterval(de,N*1e3),a.trigger(T.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new QB(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.FRAG_LOADING,this.onFragLoading,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this),e.on(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(T.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.FRAG_LOADING,this.onFragLoading,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this),e.off(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(T.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(T.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var s;this.fragCurrent=r,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case F.BUFFER_ADD_CODEC_ERROR:case F.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case F.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:s,partCurrent:i}=this;if(r&&s&&r.sn===s.sn&&r.level===s.level){const a=performance.now(),o=i?i.stats:r.stats,l=a-o.loading.start,c=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&c>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,c),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,r,s){const i=e+r/t,a=s?e+this.lastLevelLoadSec:0;return i+a}onLevelLoaded(e,t){const r=this.hls.config,{loading:s}=t.stats,i=s.end-s.first;re(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if(t.type===oe.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=r?r.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+s.loaded,l=(a.loaded?a.loaded.duration:0)+i;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const i={stats:s,frag:t,part:r,id:t.type};this.onFragBuffered(T.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:r.stats;if(i.aborted||this.ignoreFragment(r))return;const a=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==oe.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,s,1,1);if(i>-1)return i;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=r&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,i)&&a[e].loadError<=a[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:s,config:i,minAutoLevel:a}=r,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=i.abrBandWidthFactor,d=i.abrBandWidthUpFactor;if(c){const v=this.findBestLevel(l,a,s,c,0,u,d);if(v>=0)return this.rebufferNotice=-1,v}let f=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay;if(!c){const v=this.bitrateTestDelay;v&&(f=(o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay)-v,this.info(`bitrate test took ${Math.round(1e3*v)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),u=d=1)}const m=this.findBestLevel(l,a,s,c,f,u,d);if(this.rebufferNotice!==m&&(this.rebufferNotice=m,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${m}`)),m>-1)return m;const p=r.levels[a],g=r.loadLevelObj;return g&&(p==null?void 0:p.bitrate)<g.bitrate?a:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,s,i,a,o){var l;const c=s+i,u=this.lastLoadedFragLevel,d=u===-1?this.hls.firstLevel:u,{fragCurrent:f,partCurrent:m}=this,{levels:p,allAudioTracks:g,loadLevel:v,config:x}=this.hls;if(p.length===1)return 0;const y=p[d],S=!!((l=this.hls.latestLevelDetails)!=null&&l.live),b=v===-1||u===-1;let w,_="SDR",A=(y==null?void 0:y.frameRate)||0;const{audioPreference:I,videoPreference:C}=x,R=this.audioTracksByGroup||(this.audioTracksByGroup=E1(g));let P=-1;if(b){if(this.firstSelection!==-1)return this.firstSelection;const $=this.codecTiers||(this.codecTiers=B3(p,R,t,r)),Y=U3($,_,e,I,C),{codecSet:D,videoRanges:N,minFramerate:K,minBitrate:V,minIndex:W,preferHDR:de}=Y;P=W,w=D,_=de?N[N.length-1]:N[0],A=K,e=Math.max(e,V),this.log(`picked start tier ${rt(Y)}`)}else w=y==null?void 0:y.codecSet,_=y==null?void 0:y.videoRange;const O=m?m.duration:f?f.duration:0,U=this.bwEstimator.getEstimateTTFB()/1e3,j=[];for(let $=r;$>=t;$--){var G;const Y=p[$],D=$>d;if(!Y)continue;if(x.useMediaCapabilities&&!Y.supportedResult&&!Y.supportedPromise){const ge=navigator.mediaCapabilities;typeof(ge==null?void 0:ge.decodingInfo)=="function"&&L3(Y,R,_,A,e,I)?(Y.supportedPromise=x1(Y,R,ge,this.supportedCache),Y.supportedPromise.then(me=>{if(!this.hls)return;Y.supportedResult=me;const ee=this.hls.levels,Se=ee.indexOf(Y);me.error?this.warn(`MediaCapabilities decodingInfo error: "${me.error}" for level ${Se} ${rt(me)}`):me.supported?me.decodingInfoResults.some(Ae=>Ae.smooth===!1||Ae.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Se} not smooth or powerEfficient: ${rt(me)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Se} ${rt(me)}`),Se>-1&&ee.length>1&&(this.log(`Removing unsupported level ${Se}`),this.hls.removeLevel(Se),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(me=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${me}`)})):Y.supportedResult=y1}if((w&&Y.codecSet!==w||_&&Y.videoRange!==_||D&&A>Y.frameRate||!D&&A>0&&A<Y.frameRate||(G=Y.supportedResult)!=null&&(G=G.decodingInfoResults)!=null&&G.some(ge=>ge.smooth===!1))&&(!b||$!==P)){j.push($);continue}const N=Y.details,K=(m?N==null?void 0:N.partTarget:N==null?void 0:N.averagetargetduration)||O;let V;D?V=o*e:V=a*e;const W=O&&s>=O*2&&i===0?Y.averageBitrate:Y.maxBitrate,de=this.getTimeToLoadFrag(U,V,W*K,N===void 0);if(V>=W&&($===u||Y.loadError===0&&Y.fragmentError===0)&&(de<=U||!re(de)||S&&!this.bitrateTestDelay||de<c)){const ge=this.forcedAutoLevel;return $!==v&&(ge===-1||ge!==v)&&(j.length&&this.trace(`Skipped level(s) ${j.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${p[j[0]].codecs}" ${p[j[0]].videoRange}; not compatible with "${w}" ${_}`),this.info(`switch candidate:${d}->${$} adjustedbw(${Math.round(V)})-bitrate=${Math.round(V-W)} ttfb:${U.toFixed(1)} avgDuration:${K.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${de.toFixed(1)} firstSelection:${b} codecSet:${Y.codecSet} videoRange:${Y.videoRange} hls.loadLevel:${v}`)),b&&(this.firstSelection=$),$}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const T1={search:function(n,e){let t=0,r=n.length-1,s=null,i=null;for(;t<=r;){s=(t+r)/2|0,i=n[s];const a=e(i);if(a>0)t=s+1;else if(a<0)r=s-1;else return i}return null}};function z3(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!re(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const s=n[n.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let i=0;i<n.length;++i){const a=n[i];if(Y3(e,t,a))return a}return null}function ma(n,e,t=0,r=0,s=.005){let i=null;if(n){i=e[1+n.sn-e[0].sn]||null;const o=n.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),i&&n.level!==i.level&&i.end<=n.end&&(i=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!n||n.level===i.level)&&RS(t,r,i)===0||W3(i,n,Math.min(s,r))))return i;const a=T1.search(e,RS.bind(null,t,r));return a&&(a!==n||!i)?a:i}function W3(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return n.start<=r}return!1}function RS(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function Y3(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function b1(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let r=n.fragments;const{fragmentHint:s}=n;s&&(r=r.concat(s));let i;return T1.search(r,a=>a.cc<e?1:a.cc>e?-1:(i=a,a.end<=t?1:a.start>t?-1:0)),i||null}return null}function nf(n){switch(n.details){case F.FRAG_LOAD_TIMEOUT:case F.KEY_LOAD_TIMEOUT:case F.LEVEL_LOAD_TIMEOUT:case F.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function w1(n){return n.details.startsWith("key")}function A1(n){return w1(n)&&!!n.frag&&!n.frag.decryptdata}function CS(n,e){const t=nf(e);return n.default[`${t?"timeout":"error"}Retry`]}function wy(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function LS(n){return We(We({},n),{errorRetry:null,timeoutRetry:null})}function rf(n,e,t,r){if(!n)return!1;const s=r==null?void 0:r.code,i=e<n.maxNumRetry&&(q3(s)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,i):i}function q3(n){return rg(n)||!!n&&(n<400||n>499)}function rg(n){return n===0&&navigator.onLine===!1}var Ut={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Ln={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class Q3 extends rr{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(T.ERROR,this.onError,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(T.ERROR,this.onError,this),e.off(T.ERROR,this.onErrorOut,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===oe.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||r===-1?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if((r=e.details)!=null&&r.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(a=>s.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const s=this.hls,i=t.context;switch(t.details){case F.FRAG_LOAD_ERROR:case F.FRAG_LOAD_TIMEOUT:case F.KEY_LOAD_ERROR:case F.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case F.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=io();return}case F.FRAG_GAP:case F.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Ut.SendAlternateToPenaltyBox;return}case F.LEVEL_EMPTY_ERROR:case F.LEVEL_PARSING_ERROR:{var a;const l=t.parent===oe.MAIN?t.level:s.loadLevel;t.details===F.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case F.LEVEL_LOAD_ERROR:case F.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case F.AUDIO_TRACK_LOAD_ERROR:case F.AUDIO_TRACK_LOAD_TIMEOUT:case F.SUBTITLE_LOAD_ERROR:case F.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const l=s.loadLevelObj;if(l&&(i.type===Fe.AUDIO_TRACK&&l.hasAudioGroup(i.groupId)||i.type===Fe.SUBTITLE_TRACK&&l.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=Ut.SendAlternateToPenaltyBox,t.errorAction.flags=Ln.MoveAllAlternatesMatchingHost;return}}return;case F.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Ut.SendAlternateToPenaltyBox,flags:Ln.MoveAllAlternatesMatchingHDCP};return;case F.KEY_SYSTEM_SESSION_UPDATE_FAILED:case F.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case F.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Ut.SendAlternateToPenaltyBox,flags:Ln.MoveAllAlternatesMatchingKey};return;case F.BUFFER_ADD_CODEC_ERROR:case F.REMUX_ALLOC_ERROR:case F.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:s.loadLevel)}return;case F.INTERNAL_EXCEPTION:case F.BUFFER_APPENDING_ERROR:case F.BUFFER_FULL_ERROR:case F.LEVEL_SWITCH_ERROR:case F.BUFFER_STALLED_ERROR:case F.BUFFER_SEEK_OVER_HOLE:case F.BUFFER_NUDGE_ON_STALL:t.errorAction=io();return}t.type===fe.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=io())}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,s=CS(r.config.playlistLoadPolicy,e),i=this.playlistError++;if(rf(s,i,nf(e),e.response))return{action:Ut.RetryRequest,flags:Ln.None,retryConfig:s,retryCount:i};const o=this.getLevelSwitchAction(e,t);return s&&(o.retryConfig=s,o.retryCount=i),o}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:a}=t.config,o=CS(w1(e)?a:i,e),l=t.levels.reduce((u,d)=>u+d.fragmentError,0);if(s&&(e.details!==F.FRAG_GAP&&s.fragmentError++,!A1(e)&&rf(o,l,nf(e),e.response)))return{action:Ut.RetryRequest,flags:Ln.None,retryConfig:o,retryCount:l};const c=this.getLevelSwitchAction(e,r);return o&&(c.retryConfig=o,c.retryCount=l),c}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const s=this.hls.levels[t];if(s){var i,a;const c=e.details;s.loadError++,c===F.BUFFER_APPEND_ERROR&&s.fragmentError++;let u=-1;const{levels:d,loadLevel:f,minAutoLevel:m,maxAutoLevel:p}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const g=(i=e.frag)==null?void 0:i.type,x=(g===oe.AUDIO&&c===F.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===F.BUFFER_ADD_CODEC_ERROR||c===F.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:_})=>s.audioCodec!==_),S=e.sourceBufferName==="video"&&(c===F.BUFFER_ADD_CODEC_ERROR||c===F.BUFFER_APPEND_ERROR)&&d.some(({codecSet:_,audioCodec:A})=>s.codecSet!==_&&s.audioCodec===A),{type:b,groupId:w}=(a=e.context)!=null?a:{};for(let _=d.length;_--;){const A=(_+f)%d.length;if(A!==f&&A>=m&&A<=p&&d[A].loadError===0){var o,l;const I=d[A];if(c===F.FRAG_GAP&&g===oe.MAIN&&e.frag){const C=d[A].details;if(C){const R=ma(e.frag,C.fragments,e.frag.start);if(R!=null&&R.gap)continue}}else{if(b===Fe.AUDIO_TRACK&&I.hasAudioGroup(w)||b===Fe.SUBTITLE_TRACK&&I.hasSubtitleGroup(w))continue;if(g===oe.AUDIO&&(o=s.audioGroups)!=null&&o.some(C=>I.hasAudioGroup(C))||g===oe.SUBTITLE&&(l=s.subtitleGroups)!=null&&l.some(C=>I.hasSubtitleGroup(C))||x&&s.audioCodec===I.audioCodec||S&&s.codecSet===I.codecSet||!x&&s.codecSet!==I.codecSet)continue}u=A;break}}if(u>-1&&r.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:Ut.SendAlternateToPenaltyBox,flags:Ln.None,nextAutoLevel:u}}return{action:Ut.SendAlternateToPenaltyBox,flags:Ln.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Ut.DoNothing:break;case Ut.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==F.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s}=r,i=r.nextAutoLevel;switch(s){case Ln.None:this.switchLevel(e,i);break;case Ln.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),c=t.levels[l],u=c==null?void 0:c.attrs["HDCP-LEVEL"];if(r.hdcpLevel=u,u==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(u){t.maxHdcpLevel=ng[ng.indexOf(u)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Ln.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const c=this.hls.levels,u=c.length;for(let f=u;f--;)if(this.variantHasKey(c[f],l)){var a,o;this.log(`Banned key found in level ${f} (${c[f].bitrate}bps) or audio group "${(a=c[f].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${on(l.keyId||[])}`),c[f].fragmentError++,c[f].loadError++,this.log(`Removing level ${f} with key error (${e.error})`),this.hls.removeLevel(f)}const d=e.frag;if(this.hls.levels.length<u)r.resolved=!0;else if(d&&d.type!==oe.MAIN){const f=d.decryptdata;f&&!l.matches(f)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===F.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=tg(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===r&&(this.log(`Removing level ${i} for ${e.details} ("${r}" not supported)`),this.hls.removeLevel(i))}}}function io(n){const e={action:Ut.DoNothing,flags:Ln.None};return n&&(e.resolved=!0),e}var kt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class X3{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.BUFFER_APPENDED,this.onBufferAppended,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.BUFFER_APPENDED,this.onBufferAppended,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let s=r.length;s--;){const i=r[s];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:s}=this,i=Object.keys(s);for(let a=i.length;a--;){const o=s[i[a]];if((o==null?void 0:o.body.type)===t&&(!r||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,r,s,i){this.timeRanges&&(this.timeRanges[e]=t);const a=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||i)){l.body.type===r&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(u=>{const d=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,s=Ra(r),i=this.fragments[s];if(!i||i.buffered&&r.gap)return;const a=!r.relurl;Object.keys(t).forEach(o=>{const l=r.elementaryStreams[o];if(!l)return;const c=t[o],u=a||l.partial===!0;i.range[o]=this.getBufferedTimes(r,e.part,u,c)}),i.loaded=null,Object.keys(i.range).length?(i.buffered=!0,(i.body.endList=r.endList||i.body.endList)&&(this.endListFragments[i.body.type]=i),xu(i)||this.removeParts(r.sn-1,r.type)):this.removeFragment(i.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=kS(r,s=>s.fragment.sn>=e))}fragBuffered(e,t){const r=Ra(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,r,s){const i={time:[],partial:r},a=e.start,o=e.end,l=e.minEndPTS||o,c=e.maxStartPTS||a;for(let u=0;u<s.length;u++){const d=s.start(u)-this.bufferPadding,f=s.end(u)+this.bufferPadding;if(c>=d&&l<=f){i.time.push({startPTS:Math.max(a,s.start(u)),endPTS:Math.min(o,s.end(u))});break}else if(a<f&&o>d){const m=Math.max(a,s.start(u)),p=Math.min(o,s.end(u));p>m&&(i.partial=!0,i.time.push({startPTS:m,endPTS:p}))}else if(o<=d)break}return i}getPartialFragment(e){let t=null,r,s,i,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&xu(u)&&(s=u.body.start-o,i=u.body.end+o,e>=s&&e<=i&&(r=Math.min(e-s,i-e),a<=r&&(t=u.body,a=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||xu(t))}getState(e){const t=Ra(e),r=this.fragments[t];return r?r.buffered?xu(r)?kt.PARTIAL:kt.OK:kt.APPENDING:kt.NOT_LOADED}isTimeBuffered(e,t,r){let s,i;for(let a=0;a<r.length;a++){if(s=r.start(a)-this.bufferPadding,i=r.end(a)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,s=t.part?null:t,i=Ra(r);this.fragments[i]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:i,type:a}=t;if(r.sn==="initSegment")return;const o=r.type;if(s){let c=this.activePartLists[o];c||(this.activePartLists[o]=c=[]),c.push(s)}this.timeRanges=i;const l=i[a];this.detectEvictedFragments(a,l,o,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Ra(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let s=r.length;s--;){const i=t[r[s]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==r||s&&!l.gap||l.start<t&&l.end>e&&(o.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=Ra(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const s=e.sn;this.activePartLists[e.type]=kS(r,i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(r=>r.clearElementaryStreamInfo())}}function xu(n){var e,t,r;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(r=n.range.audiovideo)!=null&&r.partial)}function Ra(n){return`${n.type}_${n.level}_${n.sn}`}function kS(n,e){return n.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var bi={cbc:0,ctr:1};class Z3{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case bi.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case bi.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function J3(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class e4{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let s=0;s<4;s++)r[s]=t.getUint32(s*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],i=r[1],a=r[2],o=r[3],l=this.invSubMix,c=l[0],u=l[1],d=l[2],f=l[3],m=new Uint32Array(256);let p=0,g=0,v=0;for(v=0;v<256;v++)v<128?m[v]=v<<1:m[v]=v<<1^283;for(v=0;v<256;v++){let x=g^g<<1^g<<2^g<<3^g<<4;x=x>>>8^x&255^99,e[p]=x,t[x]=p;const y=m[p],S=m[y],b=m[S];let w=m[x]*257^x*16843008;s[p]=w<<24|w>>>8,i[p]=w<<16|w>>>16,a[p]=w<<8|w>>>24,o[p]=w,w=b*16843009^S*65537^y*257^p*16843008,c[x]=w<<24|w>>>8,u[x]=w<<16|w>>>16,d[x]=w<<8|w>>>24,f[x]=w,p?(p=y^m[m[m[b^y]]],g^=m[m[g]]):p=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const a=this.ksRows=(i+6+1)*4;let o,l;const c=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),d=this.sBox,f=this.rcon,m=this.invSubMix,p=m[0],g=m[1],v=m[2],x=m[3];let y,S;for(o=0;o<a;o++){if(o<i){y=c[o]=t[o];continue}S=y,o%i===0?(S=S<<8|S>>>24,S=d[S>>>24]<<24|d[S>>>16&255]<<16|d[S>>>8&255]<<8|d[S&255],S^=f[o/i|0]<<24):i>6&&o%i===4&&(S=d[S>>>24]<<24|d[S>>>16&255]<<16|d[S>>>8&255]<<8|d[S&255]),c[o]=y=(c[o-i]^S)>>>0}for(l=0;l<a;l++)o=a-l,l&3?S=c[o]:S=c[o-4],l<4||o<=4?u[l]=S:u[l]=p[d[S>>>24]]^g[d[S>>>16&255]]^v[d[S>>>8&255]]^x[d[S&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,i=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],c=o[1],u=o[2],d=o[3],f=this.uint8ArrayToUint32Array_(r);let m=f[0],p=f[1],g=f[2],v=f[3];const x=new Int32Array(e),y=new Int32Array(x.length);let S,b,w,_,A,I,C,R,P,O,U,j,G,$;const Y=this.networkToHostOrderSwap;for(;t<x.length;){for(P=Y(x[t]),O=Y(x[t+1]),U=Y(x[t+2]),j=Y(x[t+3]),A=P^i[0],I=j^i[1],C=U^i[2],R=O^i[3],G=4,$=1;$<s;$++)S=l[A>>>24]^c[I>>16&255]^u[C>>8&255]^d[R&255]^i[G],b=l[I>>>24]^c[C>>16&255]^u[R>>8&255]^d[A&255]^i[G+1],w=l[C>>>24]^c[R>>16&255]^u[A>>8&255]^d[I&255]^i[G+2],_=l[R>>>24]^c[A>>16&255]^u[I>>8&255]^d[C&255]^i[G+3],A=S,I=b,C=w,R=_,G=G+4;S=a[A>>>24]<<24^a[I>>16&255]<<16^a[C>>8&255]<<8^a[R&255]^i[G],b=a[I>>>24]<<24^a[C>>16&255]<<16^a[R>>8&255]<<8^a[A&255]^i[G+1],w=a[C>>>24]<<24^a[R>>16&255]<<16^a[A>>8&255]<<8^a[I&255]^i[G+2],_=a[R>>>24]<<24^a[A>>16&255]<<16^a[I>>8&255]<<8^a[C&255]^i[G+3],y[t]=Y(S^m),y[t+1]=Y(_^p),y[t+2]=Y(w^g),y[t+3]=Y(b^v),m=P,p=O,g=U,v=j,t=t+4}return y.buffer}}class t4{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=n4(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function n4(n){switch(n){case bi.cbc:return"AES-CBC";case bi.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const r4=16;class Ay{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?J3(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,s){return this.useSoftware?new Promise((i,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,r,s);const l=this.flush();l?i(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,s)}softwareDecrypt(e,t,r,s){const{currentIV:i,currentResult:a,remainderData:o}=this;if(s!==bi.cbc||t.byteLength!==16)return Ye.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=nr(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;i&&(r=i);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new e4),c.expandKey(t);const u=a;return this.currentResult=c.decrypt(l.buffer,0,r),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,r,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,s));this.key=t,this.fastAesKey=new t4(this.subtle,t,s)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Z3(this.subtle,new Uint8Array(r),s).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(Ye.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r,s)))}onWebCryptoError(e,t,r,s){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,s);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%r4;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(Ye.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const DS=Math.pow(2,17);class s4{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new fs({type:fe.NETWORK_ERROR,details:F.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,a=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(p=>p[0]==="GAP")){l(NS(e));return}else e.gap=!1;const c=this.loader=i?new i(s):new a(s),u=PS(e);e.loader=c;const d=LS(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:DS};e.stats=c.stats;const m={onSuccess:(p,g,v,x)=>{this.resetLoader(e,c);let y=p.data;v.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(y.slice(0,16)),y=y.slice(16)),o({frag:e,part:null,payload:y,networkDetails:x})},onError:(p,g,v,x)=>{this.resetLoader(e,c),l(new fs({type:fe.NETWORK_ERROR,details:F.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:We({url:r,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:v,stats:x}))},onAbort:(p,g,v)=>{this.resetLoader(e,c),l(new fs({type:fe.NETWORK_ERROR,details:F.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:v,stats:p}))},onTimeout:(p,g,v)=>{this.resetLoader(e,c),l(new fs({type:fe.NETWORK_ERROR,details:F.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:v,stats:p}))}};t&&(m.onProgress=(p,g,v,x)=>t({frag:e,part:null,payload:v,networkDetails:x})),c.load(u,f,m)})}loadPart(e,t,r){this.abort();const s=this.config,i=s.fLoader,a=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(NS(e,t));return}const c=this.loader=i?new i(s):new a(s),u=PS(e,t);e.loader=c;const d=LS(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:DS};t.stats=c.stats,c.load(u,f,{onSuccess:(m,p,g,v)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const x={frag:e,part:t,payload:m.data,networkDetails:v};r(x),o(x)},onError:(m,p,g,v)=>{this.resetLoader(e,c),l(new fs({type:fe.NETWORK_ERROR,details:F.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:We({url:u.url,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:g,stats:v}))},onAbort:(m,p,g)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new fs({type:fe.NETWORK_ERROR,details:F.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:g,stats:m}))},onTimeout:(m,p,g)=>{this.resetLoader(e,c),l(new fs({type:fe.NETWORK_ERROR,details:F.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:m}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,i=s.total;if(r.loaded+=s.loaded,i){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(r.loaded/i),l),d=(l-c)*Math.round(r.loaded/c);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const a=r.loading,o=s.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function PS(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(re(s)&&re(i)){var a;let o=s,l=i;if(n.sn==="initSegment"&&i4((a=n.decryptdata)==null?void 0:a.method)){const c=i-s;c%16&&(l=i+(16-c%16)),s!==0&&(r.resetIV=!0,o=s-16)}r.rangeStart=o,r.rangeEnd=l}return r}function NS(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:fe.MEDIA_ERROR,details:F.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new fs(r)}function i4(n){return n==="AES-128"||n==="AES-256"}class fs extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class _1 extends rr{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class _y{constructor(e,t,r,s=0,i=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Su(),this.buffering={audio:Su(),video:Su(),audiovideo:Su()},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=i,this.partial=a}}function Su(){return{start:0,executeStart:0,executeEnd:0,end:0}}const OS={length:0,start:()=>0,end:()=>0};class we{static isBuffered(e,t){if(e){const r=we.getBuffered(e);for(let s=r.length;s--;)if(t>=r.start(s)&&t<=r.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=we.getBuffered(e);return we.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const s=we.bufferedRanges(e);if(s.length)return we.bufferedInfo(s,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((u,d)=>u.start-d.start||d.end-u.end);let s=-1,i=[];if(r)for(let u=0;u<e.length;u++){t>=e[u].start&&t<=e[u].end&&(s=u);const d=i.length;if(d){const f=i[d-1].end;e[u].start-f<r?e[u].end>f&&(i[d-1].end=e[u].end):i.push(e[u])}else i.push(e[u])}else i=e;let a=0,o,l=t,c=t;for(let u=0;u<i.length;u++){const d=i[u].start,f=i[u].end;if(s===-1&&t>=d&&t<=f&&(s=u),t+r>=d&&t<f)l=d,c=f,a=c-t;else if(t+r<d){o=d;break}}return{len:a,start:l||0,end:c||0,nextStart:o,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||OS}catch(t){return Ye.log("failed to get media.buffered",t),OS}}}const I1=/\{\$([a-zA-Z0-9-_]+)\}/g;function MS(n){return I1.test(n)}function sg(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(I1,r=>{const s=r.substring(2,r.length-1),i=t==null?void 0:t[s];return i===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),r):i})}return e}function FS(n,e,t){let r=n.variableList;r||(n.variableList=r={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(s))i=a.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(a){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else s=e.NAME,i=e.VALUE;s in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):r[s]=i||""}function a4(n,e,t){const r=e.IMPORT;if(t&&r in t){let s=n.variableList;s||(n.variableList=s={}),s[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const o4=/^(\d+)x(\d+)$/,jS=/(.+?)=(".*?"|.*?)(?:,|$)/g;class dt{constructor(e,t){typeof e=="string"&&(e=dt.parseAttrList(e,t)),Ze(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)r[s]=parseInt(t.slice(s*2,s*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((s,i)=>(s[i.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=o4.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const s={},i='"';for(jS.lastIndex=0;(r=jS.exec(e))!==null;){const a=r[1].trim();let o=r[2];const l=o.indexOf(i)===0&&o.lastIndexOf(i)===o.length-1;let c=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))o=sg(t,o);else if(!c&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ye.warn(`${e}: attribute ${a} is missing quotes`)}s[a]=o}return s}}const l4="com.apple.hls.interstitial";function c4(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function u4(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class R1{constructor(e,t,r=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:r,t){const i=t.attr;for(const a in i)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==i[a]){Ye.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=Ze(new dt({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);re(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ye.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(re(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===l4}get isValid(){return!!this.id&&!this._badValueForSameId&&re(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const d4=10;class f4{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return this.fragments.length?re(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||d4}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function sf(n,e){return n.length===e.length?!n.some((t,r)=>t!==e[r]):!1}function $S(n,e){return!n&&!e?!0:!n||!e?!1:sf(n,e)}function ao(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function Iy(n){switch(n){case"AES-128":case"AES-256":return bi.cbc;case"AES-256-CTR":return bi.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function Ry(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function ig(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function h4(n){const e=ig(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function C1(n){const e=function(r,s,i){const a=r[s];r[s]=r[i],r[i]=a};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function L1(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),s=r[r.length-1].split(",");if(s.length===2){const i=s[0]==="base64",a=s[1];i?(r.splice(-1,1),t=Ry(a)):t=h4(a)}}return t}const af=typeof self<"u"?self:void 0;var mt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Bt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ed(n){switch(n){case Bt.FAIRPLAY:return mt.FAIRPLAY;case Bt.PLAYREADY:return mt.PLAYREADY;case Bt.WIDEVINE:return mt.WIDEVINE;case Bt.CLEARKEY:return mt.CLEARKEY}}function sm(n){switch(n){case mt.FAIRPLAY:return Bt.FAIRPLAY;case mt.PLAYREADY:return Bt.PLAYREADY;case mt.WIDEVINE:return Bt.WIDEVINE;case mt.CLEARKEY:return Bt.CLEARKEY}}function El(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[mt.FAIRPLAY,mt.WIDEVINE,mt.PLAYREADY,mt.CLEARKEY].filter(s=>!!e[s]):[];return!r[mt.WIDEVINE]&&t&&r.push(mt.WIDEVINE),r}const k1=function(n){return af!=null&&(n=af.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function m4(n,e,t,r){let s;switch(n){case mt.FAIRPLAY:s=["cenc","sinf"];break;case mt.WIDEVINE:case mt.PLAYREADY:s=["cenc"];break;case mt.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return p4(s,e,t,r)}function p4(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function g4(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function D1(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=Ry(o).subarray(0,16);return C1(l),l}}return null}let Eu={};class Ji{static clearKeyUriToKeyIdMap(){Eu={}}static setKeyIdForUri(e,t){Eu[e]=t}constructor(e,t,r,s=[1],i=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ao(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(a1(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&sf(e.keyFormatVersions,this.keyFormatVersions)&&$S(e.iv,this.iv)&&$S(e.keyId,this.keyId)}isSupported(){if(this.method){if(ao(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Bt.FAIRPLAY:case Bt.WIDEVINE:case Bt.PLAYREADY:case Bt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(ao(this.method)){let i=this.iv;return i||(typeof e!="number"&&(Ye.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=v4(e)),new Ji(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=Eu[this.uri];if(i&&!sf(this.keyId,i)&&Ji.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=L1(this.uri);if(r)switch(this.keyFormat){case Bt.WIDEVINE:if(this.pssh=r,!this.keyId){const i=E3(r.buffer);if(i.length){var s;const a=i[0];this.keyId=(s=a.kids)!=null&&s.length?a.kids[0]:null}}this.keyId||(this.keyId=US(t));break;case Bt.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=S3(i,null,r),this.keyId=D1(r);break}default:{let i=r.subarray(0,16);if(i.length!==16){const a=new Uint8Array(16);a.set(i,16-i.length),i=a}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=y4(t),i||(i=US(t),i||(i=Eu[this.uri])),i&&(this.keyId=i,Ji.setKeyIdForUri(this.uri,i))}return this}}function y4(n){const e=n==null?void 0:n[Bt.WIDEVINE];return e?e.keyId:null}function US(n){const e=n==null?void 0:n[Bt.PLAYREADY];if(e){const t=L1(e.uri);if(t)return D1(t)}return null}function v4(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const BS=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,VS=/#EXT-X-MEDIA:(.*)/g,x4=/^#EXT(?:INF|-X-TARGETDURATION):/m,im=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),S4=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Hr{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static resolve(e,t){return xy.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return x4.test(e)}static parseMasterPlaylist(e,t){const r=MS(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},i=[];if(BS.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let a;for(;(a=BS.exec(e))!=null;)if(a[1]){var o;const c=new dt(a[1],s),u=sg(s,a[2]),d={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Hr.resolve(u,t)},f=c.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),HS(c.CODECS,d);const m=c["SUPPLEMENTAL-CODECS"];m&&(d.supplemental={},HS(m,d.supplemental)),(o=d.unknownCodecs)!=null&&o.length||i.push(d),s.levels.push(d)}else if(a[3]){const c=a[3],u=a[4];switch(c){case"SESSION-DATA":{const d=new dt(u,s),f=d["DATA-ID"];f&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[f]=d);break}case"SESSION-KEY":{const d=GS(u,t,s);d.encrypted&&d.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(d)):Ye.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const d=new dt(u,s);FS(s,d,t)}break}case"CONTENT-STEERING":{const d=new dt(u,s);s.contentSteering={uri:Hr.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=KS(u);break}}}const l=i.length>0&&i.length<s.levels.length;return s.levels=l?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,r){let s;const i={},a=r.levels,o={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(VS.lastIndex=0;(s=VS.exec(e))!==null;){const c=new dt(s[1],r),u=c.TYPE;if(u){const d=o[u],f=i[u]||[];i[u]=f;const m=c.LANGUAGE,p=c["ASSOC-LANGUAGE"],g=c.CHANNELS,v=c.CHARACTERISTICS,x=c["INSTREAM-ID"],y={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||m||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:m,url:c.URI?Hr.resolve(c.URI,t):""};if(p&&(y.assocLang=p),g&&(y.channels=g),v&&(y.characteristics=v),x&&(y.instreamId=x),d!=null&&d.length){const S=Hr.findGroup(d,y.groupId)||d[0];zS(y,S,"audioCodec"),zS(y,S,"textCodec")}f.push(y)}}return i}static parseLevelPlaylist(e,t,r,s,i,a){var o;const l={url:t},c=new f4(t),u=c.fragments,d=[];let f=null,m=0,p=0,g=0,v=0,x=0,y=null,S=new tm(s,l),b,w,_,A=-1,I=!1,C=null,R;if(im.lastIndex=0,c.m3u8=e,c.hasVariableRefs=MS(e),((o=im.exec(e))==null?void 0:o[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(b=im.exec(e))!==null;){I&&(I=!1,S=new tm(s,l),S.playlistOffset=g,S.setStart(g),S.sn=m,S.cc=v,x&&(S.bitrate=x),S.level=r,f&&(S.initSegment=f,f.rawProgramDateTime&&(S.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),C&&(S.setByteRange(C),C=null)));const j=b[1];if(j){S.duration=parseFloat(j);const G=(" "+b[2]).slice(1);S.title=G||null,S.tagList.push(G?["INF",j,G]:["INF",j])}else if(b[3]){if(re(S.duration)){S.playlistOffset=g,S.setStart(g),_&&YS(S,_,c),S.sn=m,S.level=r,S.cc=v,u.push(S);const G=(" "+b[3]).slice(1);S.relurl=sg(c,G),ag(S,y,d),y=S,g+=S.duration,m++,p=0,I=!0}}else{if(b=b[0].match(S4),!b){Ye.warn("No matches on slow regex match for level playlist!");continue}for(w=1;w<b.length&&b[w]===void 0;w++);const G=(" "+b[w]).slice(1),$=(" "+b[w+1]).slice(1),Y=b[w+2]?(" "+b[w+2]).slice(1):null;switch(G){case"BYTERANGE":y?S.setByteRange($,y):S.setByteRange($);break;case"PROGRAM-DATE-TIME":S.rawProgramDateTime=$,S.tagList.push(["PROGRAM-DATE-TIME",$]),A===-1&&(A=u.length);break;case"PLAYLIST-TYPE":c.type&&os(c,G,b),c.type=$.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?os(c,G,b):u.length>0&&qS(c,G,b),m=c.startSN=parseInt($);break;case"SKIP":{c.skippedSegments&&os(c,G,b);const D=new dt($,c),N=D.decimalInteger("SKIPPED-SEGMENTS");if(re(N)){c.skippedSegments+=N;for(let V=N;V--;)u.push(null);m+=N}const K=D.enumeratedString("RECENTLY-REMOVED-DATERANGES");K&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(K.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&os(c,G,b),c.targetduration=Math.max(parseInt($),1);break;case"VERSION":c.version!==null&&os(c,G,b),c.version=parseInt($);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||os(c,G,b),c.live=!1;break;case"#":($||Y)&&S.tagList.push(Y?[$,Y]:[$]);break;case"DISCONTINUITY":v++,S.tagList.push(["DIS"]);break;case"GAP":S.gap=!0,S.tagList.push([G]);break;case"BITRATE":S.tagList.push([G,$]),x=parseInt($)*1e3,re(x)?S.bitrate=x:x=0;break;case"DATERANGE":{const D=new dt($,c),N=new R1(D,c.dateRanges[D.ID],c.dateRangeTagCount);c.dateRangeTagCount++,N.isValid||c.skippedSegments?c.dateRanges[N.id]=N:Ye.warn(`Ignoring invalid DATERANGE tag: "${$}"`),S.tagList.push(["EXT-X-DATERANGE",$]);break}case"DEFINE":{{const D=new dt($,c);"IMPORT"in D?a4(c,D,a):FS(c,D,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?os(c,G,b):u.length>0&&qS(c,G,b),c.startCC=v=parseInt($);break;case"KEY":{const D=GS($,t,c);if(D.isSupported()){if(D.method==="NONE"){_=void 0;break}_||(_={});const N=_[D.keyFormat];N!=null&&N.matches(D)||(N&&(_=Ze({},_)),_[D.keyFormat]=D)}else Ye.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${$}"`);break}case"START":c.startTimeOffset=KS($);break;case"MAP":{const D=new dt($,c);if(S.duration){const N=new tm(s,l);WS(N,D,r,_),f=N,S.initSegment=f,f.rawProgramDateTime&&!S.rawProgramDateTime&&(S.rawProgramDateTime=f.rawProgramDateTime)}else{const N=S.byteRangeEndOffset;if(N){const K=S.byteRangeStartOffset;C=`${N-K}@${K}`}else C=null;WS(S,D,r,_),f=S,I=!0}f.cc=v;break}case"SERVER-CONTROL":{R&&os(c,G,b),R=new dt($),c.canBlockReload=R.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=R.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&R.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=R.optionalFloat("PART-HOLD-BACK",0),c.holdBack=R.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&os(c,G,b);const D=new dt($);c.partTarget=D.decimalFloatingPoint("PART-TARGET");break}case"PART":{let D=c.partList;D||(D=c.partList=[]);const N=p>0?D[D.length-1]:void 0,K=p++,V=new dt($,c),W=new a3(V,S,l,K,N);D.push(W),S.duration+=W.duration;break}case"PRELOAD-HINT":{const D=new dt($,c);c.preloadHint=D;break}case"RENDITION-REPORT":{const D=new dt($,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(D);break}default:Ye.warn(`line parsed but not handled: ${b}`);break}}}y&&!y.relurl?(u.pop(),g-=y.duration,c.partList&&(c.fragmentHint=y)):c.partList&&(ag(S,y,d),S.cc=v,c.fragmentHint=S,_&&YS(S,_,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const P=u.length,O=u[0],U=u[P-1];if(g+=c.skippedSegments*c.targetduration,g>0&&P&&U){c.averagetargetduration=g/P;const j=U.sn;c.endSN=j!=="initSegment"?j:0,c.live||(U.endList=!0),A>0&&(T4(u,A),O&&d.unshift(O))}return c.fragmentHint&&(g+=c.fragmentHint.duration),c.totalduration=g,d.length&&c.dateRangeTagCount&&O&&P1(d,c),c.endCC=v,c}}function P1(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];n.push(o),t++}else return;const r=n[t-1],s=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let o=i.length;o--;){const l=e.dateRanges[i[o]],c=l.startDate.getTime();l.tagAnchor=r.ref;for(let u=t;u--;){var a;if(((a=n[u])==null?void 0:a.sn)<e.startSN)break;const d=E4(e,c,n,u,s);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function E4(n,e,t,r,s){const i=t[r];if(i){const o=i.programDateTime;if(e>=o||r===0){var a;const l=(((a=t[r+1])==null?void 0:a.start)||s)-i.start;if(e<=o+l*1e3){const c=t[r].sn-n.startSN;if(c<0)return-1;const u=n.fragments;if(u.length>t.length){const f=(t[r+1]||u[u.length-1]).sn-n.startSN;for(let m=f;m>c;m--){const p=u[m].programDateTime;if(e>=p&&e<p+u[m].duration*1e3)return m}}return c}}}return-1}function GS(n,e,t){var r,s;const i=new dt(n,t),a=(r=i.METHOD)!=null?r:"",o=i.URI,l=i.hexadecimalInteger("IV"),c=i.KEYFORMATVERSIONS,u=(s=i.KEYFORMAT)!=null?s:"identity";o&&i.IV&&!l&&Ye.error(`Invalid IV: ${i.IV}`);const d=o?Hr.resolve(o,e):"",f=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Ji(a,d,u,f,l,i.KEYID)}function KS(n){const t=new dt(n).decimalFloatingPoint("TIME-OFFSET");return re(t)?t:null}function HS(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const s=t.filter(i=>Ty(i,r));s.length&&(e[`${r}Codec`]=s.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function zS(n,e,t){const r=e[t];r&&(n[t]=r)}function T4(n,e){let t=n[e];for(let r=e;r--;){const s=n[r];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function ag(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function WS(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function YS(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&r.push(n)}function os(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function qS(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function am(n,e){const t=e.startPTS;if(re(t)){let r=0,s;e.sn>n.sn?(r=t-n.start,s=n):(r=n.start-t,s=e),s.duration!==r&&s.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function N1(n,e,t,r,s,i,a){r-t<=0&&(a.warn("Fragment should have a positive duration",e),r=t+e.duration,i=s+e.duration);let l=t,c=r;const u=e.startPTS,d=e.endPTS;if(re(u)){const x=Math.abs(u-t);n&&x>n.totalduration?a.warn(`media timestamps and playlist times differ by ${x}s for level ${e.level} ${n.url}`):re(e.deltaPTS)?e.deltaPTS=Math.max(x,e.deltaPTS):e.deltaPTS=x,l=Math.max(t,u),t=Math.min(t,u),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,c=Math.min(r,d),r=Math.max(r,d),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const f=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=s,e.endPTS=r,e.minEndPTS=c,e.endDTS=i;const m=e.sn;if(!n||m<n.startSN||m>n.endSN)return 0;let p;const g=m-n.startSN,v=n.fragments;for(v[g]=e,p=g;p>0;p--)am(v[p],v[p-1]);for(p=g;p<v.length-1;p++)am(v[p],v[p+1]);return n.fragmentHint&&am(v[v.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,f}function b4(n,e,t){if(n===e)return;let r=null;const s=n.fragments;for(let u=s.length-1;u>=0;u--){const d=s[u].initSegment;if(d){r=d;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;_4(n,e,(u,d,f,m)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==u.cc){const p=u.cc-d.cc;for(let g=f;g<m.length;g++)m[g].cc+=p;e.endCC=m[m.length-1].cc}re(u.startPTS)&&re(u.endPTS)&&(d.setStart(d.startPTS=u.startPTS),d.startDTS=u.startDTS,d.maxStartPTS=u.maxStartPTS,d.endPTS=u.endPTS,d.endDTS=u.endDTS,d.minEndPTS=u.minEndPTS,d.setDuration(u.endPTS-u.startPTS),d.duration&&(i=d),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(d.elementaryStreams=u.elementaryStreams),d.loader=u.loader,u.hasStats&&(d.stats=u.stats),u.initSegment&&(d.initSegment=u.initSegment,r=u.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(r&&o.forEach(u=>{var d;u&&(!u.initSegment||u.initSegment.relurl===((d=r)==null?void 0:d.relurl))&&(u.initSegment=r)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(u=>!u),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=w4(n.dateRanges,e,t));const u=n.fragments.filter(d=>d.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<o.length;d++)o[d].programDateTime===null&&ag(o[d],o[d-1],u);P1(u,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const u=F1(n,e.startSN-1);e.startCC=(l=u==null?void 0:u.cc)!=null?l:a[0].cc}A4(n.partList,e.partList,(u,d)=>{d.elementaryStreams=u.elementaryStreams,d.stats=u.stats}),i?N1(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):O1(n,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const u=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=u),e.driftEndTime=c,e.driftEnd=u}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function w4(n,e,t){const{dateRanges:r,recentlyRemovedDateranges:s}=e,i=Ze({},n);s&&s.forEach(l=>{delete i[l]});const o=Object.keys(i).length;return o?(Object.keys(r).forEach(l=>{const c=i[l],u=new R1(r[l].attr,c);u.isValid?(i[l]=u,c||(u.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${rt(r[l].attr)}"`)}),i):r}function A4(n,e,t){if(n&&e){let r=0;for(let s=0,i=n.length;s<=i;s++){const a=n[s],o=e[s+r];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):r--}}}function _4(n,e,t){const r=e.skippedSegments,s=Math.max(n.startSN,e.startSN)-e.startSN,i=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,a=e.startSN-n.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let c=s;c<=i;c++){const u=l[a+c];let d=o[c];if(r&&!d&&u&&(d=e.fragments[c]=u),u&&d){t(u,d,c,o);const f=u.relurl,m=d.relurl;if(f&&I4(f,m)){e.playlistParsingError=QS(`media sequence mismatch ${d.sn}:`,n,e,u,d);return}else if(u.cc!==d.cc){e.playlistParsingError=QS(`discontinuity sequence mismatch (${u.cc}!=${d.cc})`,n,e,u,d);return}}}}function QS(n,e,t,r,s){return new Error(`${n} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function O1(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,s=n.fragments,i=r>=0;let a=0;if(i&&r<s.length)a=s[r].start;else if(i&&e.startSN===n.endSN+1)a=n.fragmentEnd;else if(i&&t)a=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=n.fragmentStart;else return;og(e,a)}function og(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function M1(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const i=r[r.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function F1(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function XS(n,e,t){return n?j1(n.partList,e,t):null}function j1(n,e,t){if(n)for(let r=n.length;r--;){const s=n[r];if(s.index===t&&s.fragment.sn===e)return s}return null}function $1(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function I4(n,e){return n!==e&&e?ZS(n)!==ZS(e):!1}function ZS(n){return n.replace(/\?[^?]*$/,"")}function Ol(n,e){for(let r=0,s=n.length;r<s;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function R4(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function JS(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function U1(n,e){const t=e.fragments;for(let r=0,s=t.length;r<s;r++)JS(t[r],n);e.fragmentHint&&JS(e.fragmentHint,n),e.alignedSliding=!0}function C4(n,e){n&&(B1(e,n),e.alignedSliding||of(e,n),!e.alignedSliding&&!e.skippedSegments&&O1(n,e,!1))}function B1(n,e){if(!R4(e,n))return;const t=Math.min(e.endCC,n.endCC),r=Ol(e.fragments,t),s=Ol(n.fragments,t);if(!r||!s)return;Ye.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=r.start-s.start;U1(i,n)}function of(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let s,i;const a=Math.min(e.endCC,n.endCC);e.startCC<a&&n.startCC<a&&(s=Ol(r,a),i=Ol(t,a)),(!s||!i)&&(s=r[Math.floor(r.length/2)],i=Ol(t,s.cc)||t[Math.floor(t.length/2)]);const o=s.programDateTime,l=i.programDateTime;if(!o||!l)return;const c=(l-o)/1e3-(i.start-s.start);U1(c,n)}function un(n,e,t){wn(n,e,t),n.addEventListener(e,t)}function wn(n,e,t){n.removeEventListener(e,t)}const L4={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},z={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Cy extends _1{constructor(e,t,r,s,i){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=z.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:c,state:u}=this,d=l?l.currentTime:0,f=we.bufferInfo(c||l,d,a.maxBufferHole),m=!f.len;if(this.log(`Media seeking to ${re(d)?d.toFixed(3):d}, state: ${u}, ${m?"out of":"in"} buffer`),this.state===z.ENDED)this.resetLoadingState();else if(o){const p=a.maxFragLookUpTolerance,g=o.start-p,v=o.start+o.duration+p;if(m||v<f.start||g>f.end){const x=d>v;(d<g||x)&&(x&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const p=this.lastCurrentTime;if(d>p&&(this.lastCurrentTime=d),!this.loadingParts){const g=Math.max(f.end,d),v=this.shouldLoadParts(this.getLevelDetails(),g);v&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${g.toFixed(2)}`),this.loadingParts=v)}}this.hls.hasEnoughToStart||(this.log(`Setting ${m?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,m&&(this.startPosition=d)),m&&this.state===z.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new s4(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ay(e.config)}registerListeners(){const{hls:e}=this;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===z.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=z.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,s=this.config.timelineOffset||0;if(r<=s)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=we.bufferedInfo(i,e.start,0));const a=e.nextStart;if(a&&a>s&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const u=l[l.length-1];return we.isBuffered(this.media,u.start+u.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;un(r,"seeking",this.onMediaSeeking),un(r,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===z.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),wn(s,"seeking",this.onMediaSeeking),wn(s,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=z.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const s=i=>{const a=i.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(a,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,r,s).then(i=>{if(!i)return;const a=this.state,o=i.frag;if(this.fragContextChanged(o)){(a===z.FRAG_LOADING||!this.fragCurrent&&a===z.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=z.IDLE);return}"payload"in i&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(T.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===z.STOPPED||this.state===z.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===kt.APPENDING){const i=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,i),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===kt.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:r};this.hls.trigger(T.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const s=r==null?void 0:r.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:s}=this,{frag:i,payload:a}=r,o=i.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&ao(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,Iy(o.method)).catch(c=>{throw s.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:i}),c}).then(c=>{const u=self.performance.now();return s.trigger(T.FRAG_DECRYPTED,{frag:i,payload:c,stats:{tstart:l,tdecrypt:u}}),r.payload=c,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===z.STOPPED||this.state===z.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==z.STOPPED&&(this.state=z.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,s;const i=e.tracks;if(i&&!t.encrypted&&((r=i.audio)!=null&&r.encrypted||(s=i.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(T.ERROR,{type:fe.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?L4.toString(we.getBuffered(r)):"(detached)"})`),wt(e)){var s;if(e.type!==oe.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=z.IDLE;return}}const i=(s=this.levels)==null?void 0:s[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=z.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:i}=e,a=!i||i.length===0||i.some(l=>!l),o=new _y(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var i;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=z.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(T.KEY_LOADED,f),this.state===z.KEY_LOADING&&(this.state=z.IDLE),f}),this.hls.trigger(T.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(wt(e)&&(!l||e.sn!==l.sn)){const f=this.shouldLoadParts(t.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=f)}if(r=Math.max(e.start,r||0),this.loadingParts&&wt(e)){const f=a.partList;if(f&&s){r>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const m=this.getNextPart(f,e,r);if(m>-1){const p=f[m];e=this.fragCurrent=p.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${p.index} (${m}/${f.length-1}) of ${this.fragInfo(e,!1,p)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=p.start+p.duration,this.state=z.FRAG_LOADING;let g;return o?g=o.then(v=>!v||this.fragContextChanged(v.frag)?null:this.doFragPartsLoad(e,p,t,s)).catch(v=>this.handleFragLoadError(v)):g=this.doFragPartsLoad(e,p,t,s).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(T.FRAG_LOADING,{frag:e,part:p,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):g}else if(!e.url||this.loadedEndOfParts(f,r))return Promise.resolve(null)}}if(wt(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=a.partList)==null?void 0:c.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),re(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=z.FRAG_LOADING;const u=this.config.progressive;let d;return u&&o?d=o.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,s)).catch(f=>this.handleFragLoadError(f)):d=Promise.all([this.fragmentLoader.load(e,u?s:void 0),o]).then(([f])=>(!u&&s&&s(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(T.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,r,s){return new Promise((i,a)=>{var o;const l=[],c=(o=r.details)==null?void 0:o.partList,u=d=>{this.fragmentLoader.loadPart(e,d,s).then(f=>{l[d.index]=f;const m=f.part;this.hls.trigger(T.FRAG_LOADED,f);const p=XS(r.details,e.sn,d.index+1)||j1(c,e.sn,d.index+1);if(p)u(p);else return i({frag:e,part:m,partsLoaded:l})}).catch(a)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===F.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===fe.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(T.ERROR,t)}else this.hls.trigger(T.ERROR,{type:fe.OTHER_ERROR,details:F.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==z.PARSING){!this.fragCurrent&&this.state!==z.STOPPED&&this.state!==z.ERROR&&(this.state=z.IDLE);return}const{frag:r,part:s,level:i}=t,a=self.performance.now();r.stats.parsing.end=a,s&&(s.stats.parsing.end=a);const o=this.getLevelDetails(),c=o&&r.sn>o.endSN||this.shouldLoadParts(o,r.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(r,s,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const i=e.partList[0];if(i.fragment.type===oe.SUBTITLE)return!1;const a=i.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=a){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:i,part:a}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const o=t[s],l=o.details,c=a>-1?XS(l,i,a):null,u=c?c.fragment:F1(l,i,r);return u?(r&&r!==u&&(u.stats=r.stats),{frag:u,part:c,level:o}):null}bufferFragmentData(e,t,r,s,i){if(this.state!==z.PARSING)return;const{data1:a,data2:o}=e;let l=a;if(o&&(l=nr(a,o)),!l.length)return;const c=this.initPTS[t.cc],u=c?-c.baseTime/c.timescale:void 0,d={type:e.type,frag:t,part:r,chunkMeta:s,offset:u,parent:t.type,data:l};if(this.hls.trigger(T.BUFFER_APPENDING,d),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!we.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,s=we.bufferInfo(t,r,0),i=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),o=Math.max(Math.min(e.start-a,s.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var r;const s=this.getLoadPosition();if(!re(s))return null;const a=this.lastCurrentTime>s||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,a)}getFwdBufferInfoAtPos(e,t,r,s){const i=we.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&(i.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(i.nextStart,a.end)-t,s);return we.bufferInfo(e,t,o)}}return i}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,s=Math.max(Math.min(e-t,r.maxBufferLength),t),i=Math.max(e-t*3,r.maxMaxBufferLength/2,s);return i>=s?(r.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=oe.MAIN){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:i}=this,a=r[0].start,o=i.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=i.initialLiveManifestSize;if(s<d)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var c;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const f=this.hls.startPosition,m=this.hls.liveSyncPosition,p=l?(f!==-1&&f>=a?f:m)||l.start:e;this.log(`Setting startPosition to ${p} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${m} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=p}}else e<=a&&(l=r[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let u=this.filterReplacedPrimary(l,t);if(!u&&l){const d=l.sn-t.startSN;u=this.filterReplacedPrimary(r[d+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===kt.OK||r===kt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,i){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&r.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s,0);if(o!==null&&r.len+o.len>=i){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(eE(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(eE(this.config)&&e.type!==oe.SUBTITLE){const r=this.hls.interstitialsManager,s=r==null?void 0:r.bufferingItem;if(s){const a=s.event;if(a){if(a.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const i=r==null?void 0:r.playerQueue;if(i)for(let a=i.length;a--;){const o=i[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let s=-1,i=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const c=e[o];if(a=a&&!c.independent,s>-1&&r<c.start)break;const u=c.loaded;u?s=-1:(i||(c.independent||a)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${c.start}`),s=o),i=u}return s}loadedEndOfParts(e,t){let r;for(let s=e.length;s--;){if(r=e[s],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=z3(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const a=t[i-e.startSN];r.cc===a.cc&&(s=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=b1(e,r.cc,r.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:i}=this,{fragments:a,endSN:o}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:c}=s,u=r.partList,d=!!(this.loadingParts&&u!=null&&u.length&&l);d&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let f;if(e<t){var m;const g=e<this.lastCurrentTime||e>t-c||(m=this.media)!=null&&m.paused||!this.startFragRequested?0:c;f=ma(i,a,e,g)}else f=a[a.length-1];if(f){const p=f.sn-r.startSN,g=this.fragmentTracker.getState(f);if((g===kt.OK||g===kt.PARTIAL&&f.gap)&&(i=f),i&&f.sn===i.sn&&(!d||u[0].fragment.sn>f.sn||!r.live)&&f.level===i.level){const x=a[p+1];f.sn<o&&this.fragmentTracker.getState(x)!==kt.OK?f=x:f=null}}return f}alignPlaylists(e,t,r){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,a=!t,o=e.alignedSliding&&re(i);if(a||!o&&!i){C4(r,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),l}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const s=this.timelineOffset;if(r===-1){const i=this.startTimeOffset!==null,a=i?this.startTimeOffset:e.startTimeOffset;a!==null&&re(a)?(r=t+a,a<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${a} found in ${i?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+s}this.nextLoadPosition=r+s}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&wt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==z.FRAG_LOADING_WAITING_RETRY)&&(this.state=z.IDLE)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const x=this.getCurrentContext(t.chunkMeta);x&&(t.frag=x.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var i;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const a=t.details===F.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(s,!0);const o=t.errorAction;if(!o){this.state=z.ERROR;return}const{action:l,flags:c,retryCount:u=0,retryConfig:d}=o,f=!!d,m=f&&l===Ut.RetryRequest,p=f&&!o.resolved&&c===Ln.MoveAllAlternatesMatchingHost,g=(r=this.hls.latestLevelDetails)==null?void 0:r.live;if(!m&&p&&wt(s)&&!s.endList&&g&&!A1(t))this.resetFragmentErrors(e),this.treatAsGap(s),o.resolved=!0;else if((m||p)&&u<d.maxNumRetry){var v;const x=rg((v=t.response)==null?void 0:v.code),y=wy(d,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+y,this.state=z.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,x){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${u+1}/${d.maxNumRetry} in ${y}ms`)}else if(d)if(this.resetFragmentErrors(e),u<d.maxNumRetry)!a&&l!==Ut.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else l===Ut.SendAlternateToPenaltyBox?this.state=z.WAITING_LEVEL:this.state=z.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!rg(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=z.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===z.PARSING||this.state===z.PARSED){const t=e.frag,r=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,r),i=s&&s.len>.5;i&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const a=!i;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===oe.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==z.STOPPED&&(this.state=z.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const s=we.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),this.state===z.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==z.STOPPED&&(this.state=z.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){const i=r.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const d=u.endPTS-u.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${d})`),l||!1;const f=s?0:N1(i,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS,this);return this.hls.trigger(T.LEVEL_PTS_UPDATED,{details:i,level:r,drift:f,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)){var o;if(r.fragmentError===0&&this.treatAsGap(e,r),((o=this.transmuxer)==null?void 0:o.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=z.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(T.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===oe.MAIN?"level":"track"}fragInfo(e,t=!0,r){var s,i;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((s=t&&!r?e.startPTS:(r||e).start)!=null?s:NaN).toFixed(3)}-${((i=t&&!r?e.endPTS:(r||e).end)!=null?i:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function eE(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class V1{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=k4(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function k4(n,e){const t=new Uint8Array(e);let r=0;for(let s=0;s<n.length;s++){const i=n[s];t.set(i,r),r+=i.length}return t}var om={exports:{}},tE;function D4(){return tE||(tE=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function i(l,c,u,d,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var m=new s(u,d||l,f),p=t?t+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],m]:l._events[p].push(m):(l._events[p]=m,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,m=d.length,p=new Array(m);f<m;f++)p[f]=d[f].fn;return p},o.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,u,d,f,m,p){var g=t?t+c:c;if(!this._events[g])return!1;var v=this._events[g],x=arguments.length,y,S;if(v.fn){switch(v.once&&this.removeListener(c,v.fn,void 0,!0),x){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,u),!0;case 3:return v.fn.call(v.context,u,d),!0;case 4:return v.fn.call(v.context,u,d,f),!0;case 5:return v.fn.call(v.context,u,d,f,m),!0;case 6:return v.fn.call(v.context,u,d,f,m,p),!0}for(S=1,y=new Array(x-1);S<x;S++)y[S-1]=arguments[S];v.fn.apply(v.context,y)}else{var b=v.length,w;for(S=0;S<b;S++)switch(v[S].once&&this.removeListener(c,v[S].fn,void 0,!0),x){case 1:v[S].fn.call(v[S].context);break;case 2:v[S].fn.call(v[S].context,u);break;case 3:v[S].fn.call(v[S].context,u,d);break;case 4:v[S].fn.call(v[S].context,u,d,f);break;default:if(!y)for(w=1,y=new Array(x-1);w<x;w++)y[w-1]=arguments[w];v[S].fn.apply(v[S].context,y)}}return!0},o.prototype.on=function(c,u,d){return i(this,c,u,d,!1)},o.prototype.once=function(c,u,d){return i(this,c,u,d,!0)},o.prototype.removeListener=function(c,u,d,f){var m=t?t+c:c;if(!this._events[m])return this;if(!u)return a(this,m),this;var p=this._events[m];if(p.fn)p.fn===u&&(!f||p.once)&&(!d||p.context===d)&&a(this,m);else{for(var g=0,v=[],x=p.length;g<x;g++)(p[g].fn!==u||f&&!p[g].once||d&&p[g].context!==d)&&v.push(p[g]);v.length?this._events[m]=v.length===1?v[0]:v:a(this,m)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&a(this,u)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(om)),om.exports}var P4=D4(),Ly=s3(P4);const bc="1.6.13",Fo={};function N4(){return typeof __HLS_WORKER_BUNDLE__=="function"}function O4(){const n=Fo[bc];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return Fo[bc]=s,s}function M4(n){const e=Fo[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Fo[n]=s,s}function F4(n){const e=Fo[n||bc];if(e&&e.clientCount--===1){const{worker:r,objectURL:s}=e;delete Fo[n||bc],s&&self.URL.revokeObjectURL(s),r.terminate()}}function G1(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function ky(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function sh(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function wc(n,e){const t=e;let r=0;for(;ky(n,e);){r+=10;const s=sh(n,e+6);r+=s,G1(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)}function j4(n,e,t,r){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],a=i>>2&15;if(a>12){const m=new Error(`invalid ADTS sampling index:${a}`);n.emit(T.ERROR,T.ERROR,{type:fe.MEDIA_ERROR,details:F.FRAG_PARSING_ERROR,fatal:!0,error:m,reason:m.message});return}const o=(i>>6&3)+1,l=e[t+3]>>6&3|(i&1)<<2,c="mp4a.40."+o,u=s[a];let d=a;(o===5||o===29)&&(d-=3);const f=[o<<3|(d&14)>>1,(d&1)<<7|l<<3];return Ye.log(`manifest codec:${r}, parsed codec:${c}, channels:${l}, rate:${u} (ADTS object type:${o} sampling index:${a})`),{config:f,samplerate:u,channelCount:l,codec:c,parsedCodec:c,manifestCodec:r}}function K1(n,e){return n[e]===255&&(n[e+1]&246)===240}function H1(n,e){return n[e+1]&1?7:9}function Dy(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function $4(n,e){return e+5<n.length}function lf(n,e){return e+1<n.length&&K1(n,e)}function U4(n,e){return $4(n,e)&&K1(n,e)&&Dy(n,e)<=n.length-e}function B4(n,e){if(lf(n,e)){const t=H1(n,e);if(e+t>=n.length)return!1;const r=Dy(n,e);if(r<=t)return!1;const s=e+r;return s===n.length||lf(n,s)}return!1}function z1(n,e,t,r,s){if(!n.samplerate){const i=j4(e,t,r,s);if(!i)return;Ze(n,i)}}function W1(n){return 1024*9e4/n}function V4(n,e){const t=H1(n,e);if(e+t<=n.length){const r=Dy(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function Y1(n,e,t,r,s){const i=W1(n.samplerate),a=r+s*i,o=V4(e,t);let l;if(o){const{frameLength:d,headerLength:f}=o,m=f+d,p=Math.max(0,t+m-e.length);p?(l=new Uint8Array(m-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+m);const g={unit:l,pts:a};return p||n.samples.push(g),{sample:g,length:m,missing:p}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:c,missing:-1}}function G4(n,e){return ky(n,e)&&sh(n,e+6)+10<=n.length-e}function K4(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function lm(n,e=0,t=1/0){return H4(n,e,t,Uint8Array)}function H4(n,e,t,r){const s=z4(n);let i=1;"BYTES_PER_ELEMENT"in r&&(i=r.BYTES_PER_ELEMENT);const a=W4(n)?n.byteOffset:0,o=(a+n.byteLength)/i,l=(a+e)/i,c=Math.floor(Math.max(0,Math.min(l,o))),u=Math.floor(Math.min(c+Math.max(t,0),o));return new r(s,c,u-c)}function z4(n){return n instanceof ArrayBuffer?n:n.buffer}function W4(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function Y4(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const s=Un(lm(n.data,1,r)),i=n.data[2+r],a=n.data.subarray(3+r).indexOf(0);if(a===-1)return;const o=Un(lm(n.data,3+r,a));let l;return s==="-->"?l=Un(lm(n.data,4+r+a)):l=K4(n.data.subarray(4+r+a)),e.mimeType=s,e.pictureType=i,e.description=o,e.data=l,e}function q4(n){if(n.size<2)return;const e=Un(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function Q4(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=Un(n.data.subarray(t),!0);t+=r.length+1;const s=Un(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Un(n.data.subarray(1));return{key:n.type,info:"",data:e}}function X4(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=Un(n.data.subarray(t),!0);t+=r.length+1;const s=Un(n.data.subarray(t));return{key:n.type,info:r,data:s}}const e=Un(n.data);return{key:n.type,info:"",data:e}}function Z4(n){return n.type==="PRIV"?q4(n):n.type[0]==="W"?X4(n):n.type==="APIC"?Y4(n):Q4(n)}function J4(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=sh(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const Tu=10,eV=10;function q1(n){let e=0;const t=[];for(;ky(n,e);){const r=sh(n,e+6);n[e+5]>>6&1&&(e+=Tu),e+=Tu;const s=e+r;for(;e+eV<s;){const i=J4(n.subarray(e)),a=Z4(i);a&&t.push(a),e+=i.size+Tu}G1(n,e)&&(e+=Tu)}return t}function Q1(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function tV(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function Py(n){const e=q1(n);for(let t=0;t<e.length;t++){const r=e[t];if(Q1(r))return tV(r)}}let On=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function Ur(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Ny{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=nr(this.cachedData,e),this.cachedData=null);let r=wc(e,0),s=r?r.length:0,i;const a=this._audioTrack,o=this._id3Track,l=r?Py(r):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&re(l))&&(this.basePTS=nV(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:On.audioId3,duration:Number.POSITIVE_INFINITY});s<c;){if(this.canParse(e,s)){const u=this.appendFrame(a,e,s);u?(this.frameIndex++,this.lastPTS=u.sample.pts,s+=u.length,i=s):s=c}else G4(e,s)?(r=wc(e,s),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:On.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,i=s):s++;if(s===c&&i!==c){const u=e.slice(i);this.cachedData?this.cachedData=nr(this.cachedData,u):this.cachedData=u}}return{audioTrack:a,videoTrack:Ur(),id3Track:o,textTrack:Ur()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Ur(),id3Track:this._id3Track,textTrack:Ur()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const nV=(n,e,t)=>{if(re(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let bu=null;const rV=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],sV=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],iV=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],aV=[0,1,1,4];function X1(n,e,t,r,s){if(t+24>e.length)return;const i=Z1(e,t);if(i&&t+i.frameLength<=e.length){const a=i.samplesPerFrame*9e4/i.sampleRate,o=r+s*a,l={unit:e.subarray(t,t+i.frameLength),pts:o,dts:o};return n.config=[],n.channelCount=i.channelCount,n.samplerate=i.sampleRate,n.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function Z1(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,s=n[e+2]>>4&15,i=n[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const a=n[e+2]>>1&1,o=n[e+3]>>6,l=t===3?3-r:r===3?3:4,c=rV[l*14+s-1]*1e3,d=sV[(t===3?0:t===2?1:2)*3+i],f=o===3?1:2,m=iV[t][r],p=aV[r],g=m*8*p,v=Math.floor(m*c/d+a)*p;if(bu===null){const S=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);bu=S?parseInt(S[1]):0}return!!bu&&bu<=87&&r===2&&c>=224e3&&o===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:f,frameLength:v,samplesPerFrame:g}}}function Oy(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function J1(n,e){return e+1<n.length&&Oy(n,e)}function oV(n,e){return Oy(n,e)&&4<=n.length-e}function eC(n,e){if(e+1<n.length&&Oy(n,e)){const r=Z1(n,e);let s=4;r!=null&&r.frameLength&&(s=r.frameLength);const i=e+s;return i===n.length||J1(n,i)}return!1}class lV extends Ny{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=wc(e,0);let s=(r==null?void 0:r.length)||0;if(eC(e,s))return!1;for(let i=e.length;s<i;s++)if(B4(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return U4(e,t)}appendFrame(e,t,r){z1(e,this.observer,t,r,e.manifestCodec);const s=Y1(e,t,r,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const tC=(n,e)=>{let t=0,r=5;e+=r;const s=new Uint32Array(1),i=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=n[e];const o=Math.min(r,8),l=8-o;i[0]=4278190080>>>24+l<<l,s[0]=(a[0]&i[0])>>l,t=t?t<<o|s[0]:s[0],e+=1,r-=o}return t};class cV extends Ny{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const s=nC(e,t,r,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=wc(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Py(t)!==void 0&&tC(e,r)<16}}function nC(n,e,t,r,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const o=[48e3,44100,32e3][i],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(t+u>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const m=(e[t+6]<<8|e[t+7])>>12-f&1,g=[2,1,2,3,3,4,4,5][d]+m,v=e[t+5]>>3,x=e[t+5]&7,y=new Uint8Array([i<<6|v<<1|x>>2,(x&3)<<6|d<<3|m<<2|l>>4,l<<4&224]),S=1536/o*9e4,b=r+s*S,w=e.subarray(t,t+u);return n.config=y,n.channelCount=g,n.samplerate=o,n.samples.push({unit:w,pts:b}),u}class uV extends Ny{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=wc(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&Py(t)!==void 0&&tC(e,r)<=16)return!1;for(let s=e.length;r<s;r++)if(eC(e,r))return Ye.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return oV(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return X1(e,t,r,this.basePTS,this.frameIndex)}}const dV=/\/emsg[-/]ID3/i;class fV{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const i=this.videoTrack=Ur("video",1),a=this.audioTrack=Ur("audio",1),o=this.txtTrack=Ur("text",1);if(this.id3Track=Ur("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=f1(e);if(l.video){const{id:c,timescale:u,codec:d,supplemental:f}=l.video;i.id=c,i.timescale=o.timescale=u,i.codec=d,i.supplemental=f}if(l.audio){const{id:c,timescale:u,codec:d}=l.audio;a.id=c,a.timescale=u,a.codec=d}o.id=c1.text,i.sampleDuration=0,i.duration=a.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return c3(e)}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=nr(this.remainderData,e));const o=g3(r);this.remainderData=o.remainder,s.samples=o.valid||new Uint8Array}else s.samples=r;const a=this.extractID3Track(s,t);return i.samples=xS(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=xS(e,t),{videoTrack:t,audioTrack:Ur(),id3Track:s,textTrack:Ur()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=Me(e.samples,["emsg"]);s&&s.forEach(i=>{const a=v3(i);if(dV.test(a.schemeIdUri)){const o=nE(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=a.payload;r.samples.push({data:c,len:c.byteLength,dts:o,pts:o,type:On.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=nE(a,t);r.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:On.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function nE(n,e){return re(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class hV{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Ay(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,bi.cbc)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),a=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)r.set(e.subarray(i,i+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(r.subarray(s,s+16),i);return e}decryptAvcSample(e,t,r,s,i){const a=p1(i.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)}).catch(s)}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(r>=i.length);r++){const a=i[r];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,r,s,a),!this.decrypter.isSync()))return}}}}class rC{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,s;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const i=r.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,s=r.length;if(s){const i=r[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const s=t.byteLength;let i=e.naluState||0;const a=i,o=[];let l=0,c,u,d,f=-1,m=0;for(i===-1&&(f=0,m=this.getNALuType(t,0),i=0,l=1);l<s;){if(c=t[l++],!i){i=c?0:1;continue}if(i===1){i=c?0:2;continue}if(!c)i=3;else if(c===1){if(u=l-i-1,f>=0){const p={data:t.subarray(f,u),type:m};o.push(p)}else{const p=this.getLastNalUnit(e.samples);p&&(a&&l<=4-a&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-a)),u>0&&(p.data=nr(p.data,t.subarray(0,u)),p.state=0))}l<s?(d=this.getNALuType(t,l),f=l,m=d,i=0):i=-1}else i=0}if(f>=0&&i>=0){const p={data:t.subarray(f,s),type:m,state:i};o.push(p)}if(o.length===0){const p=this.getLastNalUnit(e.samples);p&&(p.data=nr(p.data,t))}return e.naluState=i,o}}class Ml{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(r,r+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&Ye.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class mV extends rC{parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let a=this.VideoSample,o,l=!1;r.data=null,a&&i.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(c=>{var u,d;switch(c.type){case 1:{let g=!1;o=!0;const v=c.data;if(l&&v.length>4){const x=this.readSliceType(v);(x===2||x===4||x===7||x===9)&&(g=!0)}if(g){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.frame=!0,a.key=g;break}case 5:o=!0,(u=a)!=null&&u.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,Ey(c.data,1,r.pts,t.samples);break}case 7:{var m,p;o=!0,l=!0;const g=c.data,v=this.readSPS(g);if(!e.sps||e.width!==v.width||e.height!==v.height||((m=e.pixelRatio)==null?void 0:m[0])!==v.pixelRatio[0]||((p=e.pixelRatio)==null?void 0:p[1])!==v.pixelRatio[1]){e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.sps=[g];const x=g.subarray(1,4);let y="avc1.";for(let S=0;S<3;S++){let b=x[S].toString(16);b.length<2&&(b="0"+b),y+=b}e.codec=y}break}case 8:o=!0,e.pps=[c.data];break;case 9:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(c)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Ml(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,s=8,i;for(let a=0;a<e;a++)s!==0&&(i=t.readEG(),s=(r+i+256)%256),r=s===0?r:s}readSPS(e){const t=new Ml(e);let r=0,s=0,i=0,a=0,o,l,c;const u=t.readUByte.bind(t),d=t.readBits.bind(t),f=t.readUEG.bind(t),m=t.readBoolean.bind(t),p=t.skipBits.bind(t),g=t.skipEG.bind(t),v=t.skipUEG.bind(t),x=this.skipScalingList.bind(this);u();const y=u();if(d(5),p(3),u(),v(),y===100||y===110||y===122||y===244||y===44||y===83||y===86||y===118||y===128){const I=f();if(I===3&&p(1),v(),v(),p(1),m())for(l=I!==3?8:12,c=0;c<l;c++)m()&&(c<6?x(16,t):x(64,t))}v();const S=f();if(S===0)f();else if(S===1)for(p(1),g(),g(),o=f(),c=0;c<o;c++)g();v(),p(1);const b=f(),w=f(),_=d(1);_===0&&p(1),p(1),m()&&(r=f(),s=f(),i=f(),a=f());let A=[1,1];if(m()&&m())switch(u()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((b+1)*16-r*2-s*2),height:(2-_)*(w+1)*16-(_?2:4)*(i+a),pixelRatio:A}}}class pV extends rC{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,s){const i=this.parseNALu(e,r.data,s);let a=this.VideoSample,o,l=!1;r.data=null,a&&i.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(c=>{var u,d;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(u=a)!=null&&u.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,Ey(c.data,2,r.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ze(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const m=this.readSPS(c.data);e.width=m.width,e.height=m.height,e.pixelRatio=m.pixelRatio,e.codec=m.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const p in m.params)e.params[p]=m.params[p]}this.pushParameterSet(e.sps,c.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const m=this.readPPS(c.data);for(const p in m)e.params[p]=m[p]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:o=!1;break}a&&o&&a.units.push(c)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[r]=e[s],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Ml(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:s}}readSPS(e){const t=new Ml(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const s=t.readBits(2),i=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),d=t.readUByte(),f=t.readUByte(),m=t.readUByte(),p=t.readUByte(),g=t.readUByte(),v=t.readUByte(),x=t.readUByte(),y=[],S=[];for(let Ce=0;Ce<r;Ce++)y.push(t.readBoolean()),S.push(t.readBoolean());if(r>0)for(let Ce=r;Ce<8;Ce++)t.readBits(2);for(let Ce=0;Ce<r;Ce++)y[Ce]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),S[Ce]&&t.readUByte();t.readUEG();const b=t.readUEG();b==3&&t.skipBits(1);const w=t.readUEG(),_=t.readUEG(),A=t.readBoolean();let I=0,C=0,R=0,P=0;A&&(I+=t.readUEG(),C+=t.readUEG(),R+=t.readUEG(),P+=t.readUEG());const O=t.readUEG(),U=t.readUEG(),j=t.readUEG(),G=t.readBoolean();for(let Ce=G?0:r;Ce<=r;Ce++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let it=0;it<4;it++)for(let zt=0;zt<(it===3?2:6);zt++)if(!t.readBoolean())t.readUEG();else{const Kn=Math.min(64,1<<4+(it<<1));it>1&&t.readEG();for(let ss=0;ss<Kn;ss++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const D=t.readUEG();let N=0;for(let Ce=0;Ce<D;Ce++){let it=!1;if(Ce!==0&&(it=t.readBoolean()),it){Ce===D&&t.readUEG(),t.readBoolean(),t.readUEG();let zt=0;for(let gn=0;gn<=N;gn++){const Kn=t.readBoolean();let ss=!1;Kn||(ss=t.readBoolean()),(Kn||ss)&&zt++}N=zt}else{const zt=t.readUEG(),gn=t.readUEG();N=zt+gn;for(let Kn=0;Kn<zt;Kn++)t.readUEG(),t.readBoolean();for(let Kn=0;Kn<gn;Kn++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ce=t.readUEG();for(let it=0;it<Ce;it++){for(let zt=0;zt<j+4;zt++)t.readBits(1);t.readBits(1)}}let V=0,W=1,de=1,pe=!0,ge=1,me=0;t.readBoolean(),t.readBoolean();let ee=!1;if(t.readBoolean()){if(t.readBoolean()){const L=t.readUByte(),B=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],H=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];L>0&&L<16?(W=B[L-1],de=H[L-1]):L===255&&(W=t.readBits(16),de=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ee=t.readBoolean(),ee&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ge=t.readBits(32),me=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const H=t.readBoolean(),se=t.readBoolean();let Z=!1;(H||se)&&(Z=t.readBoolean(),Z&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Z&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let X=0;X<=r;X++){pe=t.readBoolean();const ce=pe||t.readBoolean();let $e=!1;ce?t.readEG():$e=t.readBoolean();const ut=$e?1:t.readUEG()+1;if(H)for(let yt=0;yt<ut;yt++)t.readUEG(),t.readUEG(),Z&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(se)for(let yt=0;yt<ut;yt++)t.readUEG(),t.readUEG(),Z&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),V=t.readUEG())}let Ae=w,_e=_;if(A){let Ce=1,it=1;b===1?Ce=it=2:b==2&&(Ce=2),Ae=w-Ce*C-Ce*I,_e=_-it*P-it*R}const De=s?["A","B","C"][s]:"",Ve=o<<24|l<<16|c<<8|u;let _t=0;for(let Ce=0;Ce<32;Ce++)_t=(_t|(Ve>>Ce&1)<<31-Ce)>>>0;let jt=_t.toString(16);return a===1&&jt==="2"&&(jt="6"),{codecString:`hvc1.${De}${a}.${jt}.${i?"H":"L"}${x}.B0`,params:{general_tier_flag:i,general_profile_idc:a,general_profile_space:s,general_profile_compatibility_flags:[o,l,c,u],general_constraint_indicator_flags:[d,f,m,p,g,v],general_level_idc:x,bit_depth:O+8,bit_depth_luma_minus8:O,bit_depth_chroma_minus8:U,min_spatial_segmentation_idc:V,chroma_format_idc:b,frame_rate:{fixed:pe,fps:me/ge}},width:Ae,height:_e,pixelRatio:[W,de]}}readPPS(e){const t=new Ml(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let a=1;return i&&s?a=0:i?a=3:s&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ot=188;class Bs{constructor(e,t,r,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=s,this.videoParser=null}static probe(e,t){const r=Bs.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Ot*5,t-Ot)+1,s=0;for(;s<r;){let i=!1,a=-1,o=0;for(let l=s;l<t;l+=Ot)if(e[l]===71&&(t-l===Ot||e[l+Ot]===71)){if(o++,a===-1&&(a=l,a!==0&&(r=Math.min(a+Ot*99,e.length-Ot)+1)),i||(i=lg(e,l)===0),i&&o>1&&(a===0&&o>2||l+Ot>r))return a}else{if(o)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:c1[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Bs.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=Bs.createTrack("audio",s),this._id3Track=Bs.createTrack("id3"),this._txtTrack=Bs.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,s=!1){r||(this.sampleAes=null);let i;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=a.pid,d=a.pesData,f=o.pid,m=l.pid,p=o.pesData,g=l.pesData,v=null,x=this.pmtParsed,y=this._pmtId,S=e.length;if(this.remainderData&&(e=nr(this.remainderData,e),S=e.length,this.remainderData=null),S<Ot&&!s)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};const b=Math.max(0,Bs.syncOffset(e));S-=(S-b)%Ot,S<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,S,e.buffer.byteLength-S));let w=0;for(let A=b;A<S;A+=Ot)if(e[A]===71){const I=!!(e[A+1]&64),C=lg(e,A),R=(e[A+3]&48)>>4;let P;if(R>1){if(P=A+5+e[A+4],P===A+Ot)continue}else P=A+4;switch(C){case u:I&&(d&&(i=Ca(d,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,c,i,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(P,A+Ot)),d.size+=A+Ot-P);break;case f:if(I){if(p&&(i=Ca(p,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,i);break;case"mp3":this.parseMPEGPES(o,i);break;case"ac3":this.parseAC3PES(o,i);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(P,A+Ot)),p.size+=A+Ot-P);break;case m:I&&(g&&(i=Ca(g,this.logger))&&this.parseID3PES(l,i),g={data:[],size:0}),g&&(g.data.push(e.subarray(P,A+Ot)),g.size+=A+Ot-P);break;case 0:I&&(P+=e[P]+1),y=this._pmtId=gV(e,P);break;case y:{I&&(P+=e[P]+1);const O=yV(e,P,this.typeSupported,r,this.observer,this.logger);u=O.videoPid,u>0&&(a.pid=u,a.segmentCodec=O.segmentVideoCodec),f=O.audioPid,f>0&&(o.pid=f,o.segmentCodec=O.segmentAudioCodec),m=O.id3Pid,m>0&&(l.pid=m),v!==null&&!x&&(this.logger.warn(`MPEG-TS PMT found at ${A} after unknown PID '${v}'. Backtracking to sync byte @${b} to parse all TS packets.`),v=null,A=b-188),x=this.pmtParsed=!0;break}case 17:case 8191:break;default:v=C;break}}else w++;w>0&&cg(this.observer,new Error(`Found ${w} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,o.pesData=p,l.pesData=g;const _={audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};return s&&this.extractRemainingSamples(_),_}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:i}=e,a=r.pesData,o=t.pesData,l=s.pesData;let c;if(a&&(c=Ca(a,this.logger))?(this.readyVideoParser(r.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(r,i,c,!0),r.pesData=null)):r.pesData=a,o&&(c=Ca(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(c=Ca(l,this.logger))?(this.parseID3PES(s,c),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new hV(this.observer,this.config,t);return this.decrypt(s,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new mV:e==="hevc"&&(this.videoParser=new pV))}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const d=s.missing,f=s.sample.unit.byteLength;if(d===-1)i=nr(s.sample.unit,i);else{const m=f-d;s.sample.unit.set(i.subarray(0,d),m),e.samples.push(s.sample),r=s.missing}}let a,o;for(a=r,o=i.length;a<o-1&&!lf(i,a);a++);if(a!==r){let d;const f=a<o-1;if(f?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES",cg(this.observer,new Error(d),f,this.logger),!f)return}z1(e,this.observer,i,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(s){const d=W1(e.samplerate);l=s.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;a<o;)if(u=Y1(e,i,a,l,c),a+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;a<o-1&&!lf(i,a);a++);}parseMPEGPES(e,t){const r=t.data,s=r.length;let i=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<s;)if(J1(r,a)){const l=X1(e,r,a,o,i);if(l)a+=l.length,i++;else break}else a++}parseAC3PES(e,t){{const r=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=r.length;let a=0,o=0,l;for(;o<i&&(l=nC(e,r,o,s,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=Ze({},t,{type:this._videoTrack?On.emsg:On.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function lg(n,e){return((n[e+1]&31)<<8)+n[e+2]}function gV(n,e){return(n[e+10]&31)<<8|n[e+11]}function yV(n,e,t,r,s,i){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(n[e+1]&15)<<8|n[e+2],l=e+3+o-4,c=(n[e+10]&15)<<8|n[e+11];for(e+=12+c;e<l;){const u=lg(n,e),d=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){cm("ADTS AAC",i);break}case 15:a.audioPid===-1&&(a.audioPid=u);break;case 21:a.id3Pid===-1&&(a.id3Pid=u);break;case 219:if(!r){cm("H.264",i);break}case 27:a.videoPid===-1&&(a.videoPid=u);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=u,a.segmentAudioCodec="mp3");break;case 193:if(!r){cm("AC-3",i);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=u,a.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&d>0){let f=e+5,m=d;for(;m>2;){switch(n[f]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=u,a.segmentAudioCodec="ac3");break}const g=n[f+1]+2;f+=g,m-=g}}break;case 194:case 135:return cg(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),a;case 36:a.videoPid===-1&&(a.videoPid=u,a.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=d+5}return a}function cg(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(T.ERROR,T.ERROR,{type:fe.MEDIA_ERROR,details:F.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function cm(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Ca(n,e){let t=0,r,s,i,a,o;const l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=nr(l[0],l[1]),l.splice(1,1);if(r=l[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(s=(r[4]<<8)+r[5],s&&s>n.size-6)return null;const u=r[7];u&192&&(a=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,u&64?(o=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),i=r[8];let d=i+9;if(n.size<=d)return null;n.size-=d;const f=new Uint8Array(n.size);for(let m=0,p=l.length;m<p;m++){r=l[m];let g=r.byteLength;if(d)if(d>g){d-=g;continue}else r=r.subarray(d),g-=d,d=0;f.set(r,t),t+=g}return s&&(s-=i+3),{data:f,pts:a,dts:o,len:s}}return null}class vV{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Ns=Math.pow(2,32)-1;class M{static init(){M.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in M.types)M.types.hasOwnProperty(e)&&(M.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);M.HDLR_TYPES={video:t,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);M.STTS=M.STSC=M.STCO=i,M.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),M.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),M.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),M.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);M.FTYP=M.box(M.types.ftyp,a,l,a,o),M.DINF=M.box(M.types.dinf,M.box(M.types.dref,s))}static box(e,...t){let r=8,s=t.length;const i=s;for(;s--;)r+=t[s].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=r&255,a.set(e,4),s=0,r=8;s<i;s++)a.set(t[s],r),r+=t[s].byteLength;return a}static hdlr(e){return M.box(M.types.hdlr,M.HDLR_TYPES[e])}static mdat(e){return M.box(M.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(Ns+1)),s=Math.floor(t%(Ns+1));return M.box(M.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return M.box(M.types.mdia,M.mdhd(e.timescale||0,e.duration||0),M.hdlr(e.type),M.minf(e))}static mfhd(e){return M.box(M.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?M.box(M.types.minf,M.box(M.types.smhd,M.SMHD),M.DINF,M.stbl(e)):M.box(M.types.minf,M.box(M.types.vmhd,M.VMHD),M.DINF,M.stbl(e))}static moof(e,t,r){return M.box(M.types.moof,M.mfhd(e),M.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=M.trak(e[t]);return M.box.apply(null,[M.types.moov,M.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(M.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=M.trex(e[t]);return M.box.apply(null,[M.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(Ns+1)),s=Math.floor(t%(Ns+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return M.box(M.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,r[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return M.box(M.types.sdtp,r)}static stbl(e){return M.box(M.types.stbl,M.stsd(e),M.box(M.types.stts,M.STTS),M.box(M.types.stsc,M.STSC),M.box(M.types.stsz,M.STSZ),M.box(M.types.stco,M.STCO))}static avc1(e){let t=[],r=[],s,i,a;for(s=0;s<e.sps.length;s++)i=e.sps[s],a=i.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],a=i.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(i));const o=M.box(M.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),l=e.width,c=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return M.box(M.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,M.box(M.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),M.box(M.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return M.box(M.types.mp4a,M.audioStsd(e),M.box(M.types.esds,M.esds(e)))}static mp3(e){return M.box(M.types[".mp3"],M.audioStsd(e))}static ac3(e){return M.box(M.types["ac-3"],M.audioStsd(e),M.box(M.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return M.box(M.types.stsd,M.STSD,M.mp4a(e));if(t==="ac3"&&e.config)return M.box(M.types.stsd,M.STSD,M.ac3(e));if(t==="mp3"&&e.codec==="mp3")return M.box(M.types.stsd,M.STSD,M.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return M.box(M.types.stsd,M.STSD,M.avc1(e));if(t==="hevc"&&e.vps)return M.box(M.types.stsd,M.STSD,M.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),s=e.width||0,i=e.height||0,a=Math.floor(r/(Ns+1)),o=Math.floor(r%(Ns+1));return M.box(M.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const r=M.sdtp(e),s=e.id,i=Math.floor(t/(Ns+1)),a=Math.floor(t%(Ns+1));return M.box(M.types.traf,M.box(M.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),M.box(M.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,a>>24,a>>16&255,a>>8&255,a&255])),M.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,M.box(M.types.trak,M.tkhd(e),M.mdia(e))}static trex(e){const t=e.id;return M.box(M.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],s=r.length,i=12+16*s,a=new Uint8Array(i);let o,l,c,u,d,f;for(t+=8+i,a.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<s;o++)l=r[o],c=l.duration,u=l.size,d=l.flags,f=l.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*o);return M.box(M.types.trun,a)}static initSegment(e){M.types||M.init();const t=M.moov(e);return nr(M.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],s=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let a=i.length;for(let p=0;p<r.length;p+=1){a+=3;for(let g=0;g<r[p].length;g+=1)a+=2+r[p][g].length}const o=new Uint8Array(a);o.set(i,0),a=i.length;const l=r.length-1;for(let p=0;p<r.length;p+=1){o.set(new Uint8Array([32+p|(p===l?128:0),0,r[p].length]),a),a+=3;for(let g=0;g<r[p].length;g+=1)o.set(new Uint8Array([r[p][g].length>>8,r[p][g].length&255]),a),a+=2,o.set(r[p][g],a),a+=r[p][g].length}const c=M.box(M.types.hvcC,o),u=e.width,d=e.height,f=e.pixelRatio[0],m=e.pixelRatio[1];return M.box(M.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,M.box(M.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),M.box(M.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,m>>24,m>>16&255,m>>8&255,m&255])))}}M.types=void 0;M.HDLR_TYPES=void 0;M.STTS=void 0;M.STSC=void 0;M.STCO=void 0;M.STSZ=void 0;M.VMHD=void 0;M.SMHD=void 0;M.STSD=void 0;M.FTYP=void 0;M.DINF=void 0;const sC=9e4;function My(n,e,t=1,r=!1){const s=n*e*t;return r?Math.round(s):s}function xV(n,e,t=1,r=!1){return My(n,e,1/t,r)}function dl(n,e=!1){return My(n,1e3,1/sC,e)}function SV(n,e=1){return My(n,sC,1/e)}function rE(n){const{baseTime:e,timescale:t,trackId:r}=n;return`${e/t} (${e}/${t}) trackId: ${r}`}const EV=10*1e3,TV=1024,bV=1152,wV=1536;let La=null,um=null;function sE(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class td extends rr{constructor(e,t,r,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,La===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);La=a?parseInt(a[1]):0}if(um===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);um=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&rE(t)} > ${e&&rE(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,s=e.reduce((i,a)=>{let o=a.pts,l=o-i;return l<-4294967296&&(t=!0,o=Dn(o,r),l=o-i),l>0?i:o},r);return t&&this.debug("PTS rollover detected"),s}remux(e,t,r,s,i,a,o,l){let c,u,d,f,m,p,g=i,v=i;const x=e.pid>-1,y=t.pid>-1,S=t.samples.length,b=e.samples.length>0,w=o&&S>0||S>1;if((!x||b)&&(!y||w)||this.ISGenerated||o){if(this.ISGenerated){var A,I,C,R;const j=this.videoTrackConfig;(j&&(t.width!==j.width||t.height!==j.height||((A=t.pixelRatio)==null?void 0:A[0])!==((I=j.pixelRatio)==null?void 0:I[0])||((C=t.pixelRatio)==null?void 0:C[1])!==((R=j.pixelRatio)==null?void 0:R[1]))||!j&&w||this.nextAudioTs===null&&b)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,i,a));const P=this.isVideoContiguous;let O=-1,U;if(w&&(O=AV(t.samples),!P&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,O>0){this.warn(`Dropped ${O} out of ${S} video samples due to a missing keyframe`);const j=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(O),t.dropped+=O,v+=(t.samples[0].pts-j)/t.inputTimeScale,U=v}else O===-1&&(this.warn(`No keyframe found out of ${S} video samples`),p=!1);if(this.ISGenerated){if(b&&w){const j=this.getVideoStartPts(t.samples),$=(Dn(e.samples[0].pts,j)-j)/t.inputTimeScale;g+=Math.max(0,$),v+=Math.max(0,-$)}if(b){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,i,a)),u=this.remuxAudio(e,g,this.isAudioContiguous,a,y||w||l===oe.AUDIO?v:void 0),w){const j=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,i,a)),c=this.remuxVideo(t,v,P,j)}}else w&&(c=this.remuxVideo(t,v,P,0));c&&(c.firstKeyFrame=O,c.independent=O!==-1,c.firstKeyFramePTS=U)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(m=iC(r,i,this._initPTS,this._initDTS)),s.samples.length&&(f=aC(s,i,this._initPTS))),{audio:u,video:c,initSegment:d,independent:p,text:f,id3:m}}computeInitPts(e,t,r,s){const i=Math.round(r*t);let a=Dn(e,i);if(a<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-a)/t} ${s}`);a<i+t;)a+=8589934592;return a-i}generateIS(e,t,r,s){const i=e.samples,a=t.samples,o=this.typeSupported,l={},c=this._initPTS;let u=!c||s,d="audio/mp4",f,m,p,g=-1;if(u&&(f=m=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):M.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(g=e.id,p=e.inputTimeScale,!c||p!==c.timescale?f=m=this.computeInitPts(i[0].pts,p,r,"audio"):u=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:M.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(g=t.id,p=t.inputTimeScale,!c||p!==c.timescale){const v=this.getVideoStartPts(a),x=Dn(a[0].dts,v),y=this.computeInitPts(x,p,r,"video"),S=this.computeInitPts(v,p,r,"video");m=Math.min(m,y),f=Math.min(f,S)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(c&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${r} ${f/p} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${f/p} (${f}/${p}) trackId: ${g}`),this._initPTS={baseTime:f,timescale:p,trackId:g},this._initDTS={baseTime:m,timescale:p,trackId:g}):f=p=void 0,{tracks:l,initPTS:f,timescale:p,trackId:g}}remuxVideo(e,t,r,s){const i=e.inputTimeScale,a=e.samples,o=[],l=a.length,c=this._initPTS,u=c.baseTime*i/c.timescale;let d=this.nextVideoTs,f=8,m=this.videoSampleDuration,p,g,v=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,y=!1;if(!r||d===null){const V=u+t*i,W=a[0].pts-Dn(a[0].dts,a[0].pts);La&&d!==null&&Math.abs(V-W-(d+u))<15e3?r=!0:d=V-W-u}const S=d+u;for(let V=0;V<l;V++){const W=a[V];W.pts=Dn(W.pts,S),W.dts=Dn(W.dts,S),W.dts<a[V>0?V-1:V].dts&&(y=!0)}y&&a.sort(function(V,W){const de=V.dts-W.dts,pe=V.pts-W.pts;return de||pe}),p=a[0].dts,g=a[a.length-1].dts;const b=g-p,w=b?Math.round(b/(l-1)):m||e.inputTimeScale/30;if(r){const V=p-S,W=V>w,de=V<-1;if((W||de)&&(W?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${dl(V,!0)} ms (${V}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${dl(-V,!0)} ms (${V}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!de||S>=a[0].pts||La)){p=S;const pe=a[0].pts-V;if(W)a[0].dts=p,a[0].pts=pe;else{let ge=!0;for(let me=0;me<a.length&&!(a[me].dts>pe&&ge);me++){const ee=a[me].pts;if(a[me].dts-=V,a[me].pts-=V,me<a.length-1){const Se=a[me+1].pts,Ae=a[me].pts,_e=Se<=Ae,De=Se<=ee;ge=_e==De}}}this.log(`Video: Initial PTS/DTS adjusted: ${dl(pe,!0)}/${dl(p,!0)}, delta: ${dl(V,!0)} ms`)}}p=Math.max(0,p);let _=0,A=0,I=p;for(let V=0;V<l;V++){const W=a[V],de=W.units,pe=de.length;let ge=0;for(let me=0;me<pe;me++)ge+=de[me].data.length;A+=ge,_+=pe,W.length=ge,W.dts<I?(W.dts=I,I+=w/4|0||1):I=W.dts,v=Math.min(W.pts,v),x=Math.max(W.pts,x)}g=a[l-1].dts;const C=A+4*_+8;let R;try{R=new Uint8Array(C)}catch(V){this.observer.emit(T.ERROR,T.ERROR,{type:fe.MUX_ERROR,details:F.REMUX_ALLOC_ERROR,fatal:!1,error:V,bytes:C,reason:`fail allocating video mdat ${C}`});return}const P=new DataView(R.buffer);P.setUint32(0,C),R.set(M.types.mdat,4);let O=!1,U=Number.POSITIVE_INFINITY,j=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY,$=Number.NEGATIVE_INFINITY;for(let V=0;V<l;V++){const W=a[V],de=W.units;let pe=0;for(let ee=0,Se=de.length;ee<Se;ee++){const Ae=de[ee],_e=Ae.data,De=Ae.data.byteLength;P.setUint32(f,De),f+=4,R.set(_e,f),f+=De,pe+=4+De}let ge;if(V<l-1)m=a[V+1].dts-W.dts,ge=a[V+1].pts-W.pts;else{const ee=this.config,Se=V>0?W.dts-a[V-1].dts:w;if(ge=V>0?W.pts-a[V-1].pts:w,ee.stretchShortVideoTrack&&this.nextAudioTs!==null){const Ae=Math.floor(ee.maxBufferHole*i),_e=(s?v+s*i:this.nextAudioTs+u)-W.pts;_e>Ae?(m=_e-Se,m<0?m=Se:O=!0,this.log(`It is approximately ${_e/90} ms to the next segment; using duration ${m/90} ms for the last video frame.`)):m=Se}else m=Se}const me=Math.round(W.pts-W.dts);U=Math.min(U,m),G=Math.max(G,m),j=Math.min(j,ge),$=Math.max($,ge),o.push(sE(W.key,m,pe,me))}if(o.length){if(La){if(La<70){const V=o[0].flags;V.dependsOn=2,V.isNonSync=0}}else if(um&&$-j<G-U&&w/G<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let V=p;for(let W=0,de=o.length;W<de;W++){const pe=V+o[W].duration,ge=V+o[W].cts;if(W<de-1){const me=pe+o[W+1].cts;o[W].duration=me-ge}else o[W].duration=W?o[W-1].duration:w;o[W].cts=0,V=pe}}}m=O||!m?w:m;const Y=g+m;this.nextVideoTs=d=Y-u,this.videoSampleDuration=m,this.isVideoContiguous=!0;const K={data1:M.moof(e.sequenceNumber++,p,Ze(e,{samples:o})),data2:R,startPTS:(v-u)/i,endPTS:(x+m-u)/i,startDTS:(p-u)/i,endDTS:d/i,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,K}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return bV;case"ac3":return wV;default:return TV}}remuxAudio(e,t,r,s,i){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,c=this.getSamplesPerFrame(e),u=c*l,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,m=[],p=i!==void 0;let g=e.samples,v=f?0:8,x=this.nextAudioTs||-1;const y=d.baseTime*a/d.timescale,S=y+t*a;if(this.isAudioContiguous=r=r||g.length&&x>0&&(s&&Math.abs(S-(x+y))<9e3||Math.abs(Dn(g[0].pts,S)-(x+y))<20*u),g.forEach(function($){$.pts=Dn($.pts,S)}),!r||x<0){const $=g.length;if(g=g.filter(Y=>Y.pts>=0),$!==g.length&&this.warn(`Removed ${g.length-$} of ${$} samples (initPTS ${y} / ${a})`),!g.length)return;i===0?x=0:s&&!p?x=Math.max(0,S-y):x=g[0].pts-y}if(e.segmentCodec==="aac"){const $=this.config.maxAudioFramesDrift;for(let Y=0,D=x+y;Y<g.length;Y++){const N=g[Y],K=N.pts,V=K-D,W=Math.abs(1e3*V/a);if(V<=-$*u&&p)Y===0&&(this.warn(`Audio frame @ ${(K/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*V/a)} ms.`),this.nextAudioTs=x=K-y,D=K);else if(V>=$*u&&W<EV&&p){let de=Math.round(V/u);for(D=K-de*u;D<0&&de&&u;)de--,D+=u;Y===0&&(this.nextAudioTs=x=D-y),this.warn(`Injecting ${de} audio frames @ ${((D-y)/a).toFixed(3)}s due to ${Math.round(1e3*V/a)} ms gap.`);for(let pe=0;pe<de;pe++){let ge=vV.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ge||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ge=N.unit.subarray()),g.splice(Y,0,{unit:ge,pts:D}),D+=u,Y++}}N.pts=D,D+=u}}let b=null,w=null,_,A=0,I=g.length;for(;I--;)A+=g[I].unit.byteLength;for(let $=0,Y=g.length;$<Y;$++){const D=g[$],N=D.unit;let K=D.pts;if(w!==null){const W=m[$-1];W.duration=Math.round((K-w)/l)}else if(r&&e.segmentCodec==="aac"&&(K=x+y),b=K,A>0){A+=v;try{_=new Uint8Array(A)}catch(W){this.observer.emit(T.ERROR,T.ERROR,{type:fe.MUX_ERROR,details:F.REMUX_ALLOC_ERROR,fatal:!1,error:W,bytes:A,reason:`fail allocating audio mdat ${A}`});return}f||(new DataView(_.buffer).setUint32(0,A),_.set(M.types.mdat,4))}else return;_.set(N,v);const V=N.byteLength;v+=V,m.push(sE(!0,c,V,0)),w=K}const C=m.length;if(!C)return;const R=m[m.length-1];x=w-y,this.nextAudioTs=x+l*R.duration;const P=f?new Uint8Array(0):M.moof(e.sequenceNumber++,b/l,Ze({},e,{samples:m}));e.samples=[];const O=(b-y)/a,U=x/a,G={data1:P,data2:_,startPTS:O,endPTS:U,startDTS:O,endDTS:U,type:"audio",hasAudio:!0,hasVideo:!1,nb:C};return this.isAudioContiguous=!0,G}}function Dn(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function AV(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function iC(n,e,t,r){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let o=0;o<s;o++){const l=n.samples[o];l.pts=Dn(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=Dn(l.dts-r.baseTime*i/r.timescale,e*i)/i}const a=n.samples;return n.samples=[],{samples:a}}function aC(n,e,t){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let a=0;a<r;a++){const o=n.samples[a];o.pts=Dn(o.pts-t.baseTime*s/t.timescale,e*s)/s}n.samples.sort((a,o)=>a.pts-o.pts);const i=n.samples;return n.samples=[],{samples:i}}class _V extends rr{constructor(e,t,r,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:a}=this.initData=f1(e);if(t)h3(e,t);else{const l=i||a;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}i&&(r=iE(i,et.AUDIO,this)),a&&(s=iE(a,et.VIDEO,this));const o={};i&&a?o.audiovideo={container:"video/mp4",codec:r+","+s,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:i?o.audio={container:"audio/mp4",codec:r,encrypted:i.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:s,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,r,s,i,a){var o,l;let{initPTS:c,lastEndTime:u}=this;const d={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};re(u)||(u=this.lastEndTime=i||0);const f=t.samples;if(!f.length)return d;const m={initPTS:void 0,timescale:void 0,trackId:void 0};let p=this.initData;if((o=p)!=null&&o.length||(this.generateInitSegment(f),p=this.initData),!((l=p)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1);const g=p3(f,p,this),v=p.audio?g[p.audio.id]:null,x=p.video?g[p.video.id]:null,y=wu(x,1/0),S=wu(v,1/0),b=wu(x,0,!0),w=wu(v,0,!0);let _=i,A=0;const I=v&&(!x||!c&&S<y||c&&c.trackId===p.audio.id),C=I?v:x;if(C){const D=C.timescale,N=C.start-i*D,K=I?p.audio.id:p.video.id;_=C.start/D,A=I?w-S:b-y,(a||!c)&&(IV(c,_,i,A)||D!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${i} ${N/D} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${_-i} (${N}/${D}) trackId: ${K}`),c=null,m.initPTS=N,m.timescale=D,m.trackId=K)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);c?(m.initPTS=c.baseTime,m.timescale=c.timescale,m.trackId=c.trackId):((!m.timescale||m.trackId===void 0||m.initPTS===void 0)&&(this.warn("Could not set initPTS"),m.initPTS=_,m.timescale=1,m.trackId=-1),this.initPTS=c={baseTime:m.initPTS,timescale:m.timescale,trackId:m.trackId});const R=_-c.baseTime/c.timescale,P=R+A;A>0?this.lastEndTime=P:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const O=!!p.audio,U=!!p.video;let j="";O&&(j+="audio"),U&&(j+="video");const G=(p.audio?p.audio.encrypted:!1)||(p.video?p.video.encrypted:!1),$={data1:f,startPTS:R,startDTS:R,endPTS:P,endDTS:P,type:j,hasAudio:O,hasVideo:U,nb:1,dropped:0,encrypted:G};d.audio=O&&!U?$:void 0,d.video=U?$:void 0;const Y=x==null?void 0:x.sampleCount;if(Y){const D=x.keyFrameIndex,N=D!==-1;$.nb=Y,$.dropped=D===0||this.isVideoContiguous?0:N?D:Y,$.independent=N,$.firstKeyFrame=D,N&&x.keyFrameStart&&($.firstKeyFramePTS=(x.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(d.independent=N),this.isVideoContiguous||(this.isVideoContiguous=N),$.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${D}/${Y} dropped: ${$.dropped} start: ${$.firstKeyFramePTS||"NA"}`)}return d.initSegment=m,d.id3=iC(r,i,c,c),s.samples.length&&(d.text=aC(s,i,c)),d}}function wu(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function IV(n,e,t,r){if(n===null)return!0;const s=Math.max(r,1),i=e-n.baseTime/n.timescale;return Math.abs(i-t)>s}function iE(n,e,t){const r=n.codec;return r&&r.length>4?r:e===et.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?Jd(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let hs;try{hs=self.performance.now.bind(self.performance)}catch{hs=Date.now}const nd=[{demux:fV,remux:_V},{demux:Bs,remux:td},{demux:lV,remux:td},{demux:uV,remux:td}];nd.splice(2,0,{demux:cV,remux:td});class aE{constructor(e,t,r,s,i,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=i,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const i=r.transmuxing;i.executeStart=hs();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:c,discontinuity:u,trackSwitch:d,accurateTimeOffset:f,timeOffset:m,initSegmentChange:p}=s||o,{audioCodec:g,videoCodec:v,defaultInitPts:x,duration:y,initSegmentData:S}=l,b=RV(a,t);if(b&&ao(b.method)){const I=this.getDecrypter(),C=Iy(b.method);if(I.isSync()){let R=I.softwareDecrypt(a,b.key.buffer,b.iv.buffer,C);if(r.part>-1){const O=I.flush();R=O&&O.buffer}if(!R)return i.executeEnd=hs(),dm(r);a=new Uint8Array(R)}else return this.asyncResult=!0,this.decryptionPromise=I.webCryptoDecrypt(a,b.key.buffer,b.iv.buffer,C).then(R=>{const P=this.push(R,null,r);return this.decryptionPromise=null,P}),this.decryptionPromise}const w=this.needsProbing(u,d);if(w){const I=this.configureTransmuxer(a);if(I)return this.logger.warn(`[transmuxer] ${I.message}`),this.observer.emit(T.ERROR,T.ERROR,{type:fe.MEDIA_ERROR,details:F.FRAG_PARSING_ERROR,fatal:!1,error:I,reason:I.message}),i.executeEnd=hs(),dm(r)}(u||d||p||w)&&this.resetInitSegment(S,g,v,y,t),(u||p||w)&&this.resetInitialTimestamp(x),c||this.resetContiguity();const _=this.transmux(a,b,m,f,r);this.asyncResult=Ac(_);const A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,i.executeEnd=hs(),_}flush(e){const t=e.transmuxing;t.executeStart=hs();const{decrypter:r,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const a=[],{timeOffset:o}=s;if(r){const d=r.flush();d&&a.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=hs();const d=[dm(e)];return this.asyncResult?Promise.resolve(d):d}const u=l.flush(o);return Ac(u)?(this.asyncResult=!0,u.then(d=>(this.flushRemux(a,d,e),a))):(this.flushRemux(a,u,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:i,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===oe.MAIN?"level":"track"} ${r.level}`);const u=this.remuxer.remux(s,i,a,o,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:r}),r.transmuxing.executeEnd=hs()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,i){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,r,s),o.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,i){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,r,s,i):a=this.transmuxUnencrypted(e,r,s,i),a}transmuxUnencrypted(e,t,r,s){const{audioTrack:i,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,a,o,l,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,i){return this.demuxer.demuxSampleAes(e,t,r).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,r,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s}=this;let i;for(let d=0,f=nd.length;d<f;d++){var a;if((a=nd[d].demux)!=null&&a.probe(e,this.logger)){i=nd[d];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,c=i.remux,u=i.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(r,t,s,this.logger)),(!o||!(o instanceof u))&&(this.demuxer=new u(r,t,s,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ay(this.config)),e}}function RV(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const dm=n=>({remuxResult:{},chunkMeta:n});function Ac(n){return"then"in n&&n.then instanceof Function}class CV{constructor(e,t,r,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=i||null}}class LV{constructor(e,t,r,s,i,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=a}}let oE=0;class oC{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=oE++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,u=this.hls;if(!(!u||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var d;const f=(d=this.workerContext)==null?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{u.logger[c.data.logType]&&u.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,u.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(T.ERROR,{type:fe.OTHER_ERROR,details:F.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const a=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===T.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new Ly,this.observer.on(T.FRAG_DECRYPTED,a),this.observer.on(T.ERROR,a);const o=TS(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(i.workerPath||N4()){try{i.workerPath?(l.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=M4(i.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=O4());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:rt(i)})}catch(u){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new aE(this.observer,o,i,"",t,e.logger)}return}}this.transmuxer=new aE(this.observer,o,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=oE++;const t=this.hls.config,r=TS(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:rt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),F4(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,s,i,a,o,l,c,u){var d,f;c.transmuxing.start=self.performance.now();const{instanceNo:m,transmuxer:p}=this,g=a?a.start:i.start,v=i.decryptdata,x=this.frag,y=!(x&&i.cc===x.cc),S=!(x&&c.level===x.level),b=x?c.sn-x.sn:-1,w=this.part?c.part-this.part.index:-1,_=b===0&&c.id>1&&c.id===(x==null?void 0:x.stats.chunkCount),A=!S&&(b===1||b===0&&(w===1||_&&w<=0)),I=self.performance.now();(S||b||i.stats.parsing.start===0)&&(i.stats.parsing.start=I),a&&(w||!A)&&(a.stats.parsing.start=I);const C=!(x&&((d=i.initSegment)==null?void 0:d.url)===((f=x.initSegment)==null?void 0:f.url)),R=new LV(y,A,l,S,g,C);if(!A||y||C){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===oe.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${y}
        trackSwitch: ${S}
        contiguous: ${A}
        accurateTimeOffset: ${l}
        timeOffset: ${g}
        initSegmentChange: ${C}`);const P=new CV(r,s,t,o,u);this.configureTransmuxer(P)}if(this.frag=i,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:m,cmd:"demux",data:e,decryptdata:v,chunkMeta:c,state:R},e instanceof ArrayBuffer?[e]:[]);else if(p){const P=p.push(e,v,c,R);Ac(P)?P.then(O=>{this.handleTransmuxComplete(O)}).catch(O=>{this.transmuxerError(O,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(P)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const s=r.flush(e);Ac(s)?s.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const lE=100;class kV extends Cy{constructor(e,t,r){super(e,t,r,"audio-stream-controller",oe.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(T.BUFFER_RESET,this.onBufferReset,this),e.on(T.BUFFER_CREATED,this.onBufferCreated,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(T.FRAG_LOADING,this.onFragLoading,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(T.BUFFER_RESET,this.onBufferReset,this),e.off(T.BUFFER_CREATED,this.onBufferCreated,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(T.FRAG_LOADING,this.onFragLoading,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:a}){if(r===oe.MAIN){const o=t.cc,l=this.fragCurrent;if(this.initPTS[o]={baseTime:s,timescale:i,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${s/i} (${s}/${i}) trackId: ${a}`),this.mainAnchor=t,this.state===z.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==o)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==o?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===z.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const s=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&(s==null?void 0:s.cc)===t.cc)return;const i=(s||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=b1(a,i,o);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===z.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=z.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(lE),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=z.IDLE):this.state=z.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case z.IDLE:this.doTickIdle();break;case z.WAITING_TRACK:{const{levels:e,trackId:t}=this,r=e==null?void 0:e[t],s=r==null?void 0:r.details;if(s&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(s))break;this.state=z.WAITING_INIT_PTS}break}case z.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case z.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:s,complete:i}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=z.FRAG_LOADING;const o=s.flush().buffer,l={frag:t,part:r,payload:o,networkDetails:null};this._handleFragmentLoadProgress(l),i&&super._handleFragmentLoadComplete(l)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=z.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:s,trackId:i}=this,a=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(r!=null&&r[i]))return;const o=r[i],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=z.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,et.AUDIO,oe.AUDIO));const u=this.getFwdBufferInfo(c,oe.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,l)){t.trigger(T.BUFFER_EOS,{type:"audio"}),this.state=z.ENDED;return}const d=u.len,f=t.maxBufferLength,m=l.fragments,p=m[0].start,g=this.getLoadPosition(),v=this.flushing?g:u.end;if(this.switchingTrack&&s){const S=g;l.PTSKnown&&S<p&&(u.end>p||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=p+.05)}if(d>=f&&!this.switchingTrack&&v<m[m.length-1].start)return;let x=this.getNextFragment(v,l);if(x&&this.isLoopLoading(x,v)&&(x=this.getNextFragmentLoopLoading(x,l,u,oe.MAIN,f)),!x){this.bufferFlushed=!0;return}let y=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&y&&wt(x)&&!x.endList&&(!l.live||!this.loadingParts&&v<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(y)===kt.OK&&(this.mainFragLoading=y=null),y&&wt(y))){if(x.start>y.end){const b=this.fragmentTracker.getFragAtPos(v,oe.MAIN);b&&b.end>y.end&&(y=b,this.mainFragLoading={frag:b,targetBufferTime:null})}if(x.start>y.end)return}this.loadFragment(x,o,v)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Tc(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==z.STOPPED&&(this.setInterval(lE),this.state=z.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(T.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:s}=this,{details:i,id:a,groupId:o,track:l}=t;if(!s){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const c=this.mainDetails;if(!c||i.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==z.STOPPED&&(this.state=z.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const u=s[a];let d=0;if(i.live||(r=u.details)!=null&&r.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(u.details){var f;d=this.alignPlaylists(i,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}i.alignedSliding||(B1(i,c),i.alignedSliding||of(i,c),d=i.fragmentStart)}u.details=i,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,d),this.hls.trigger(T.AUDIO_TRACK_UPDATED,{details:i,id:a,groupId:t.groupId}),this.state===z.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=z.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const c=l[o];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new oC(this.hls,oe.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const m=this.initPTS[r.cc],p=(t=r.initSegment)==null?void 0:t.data;if(m!==void 0){const v=s?s.index:-1,x=v!==-1,y=new _y(r.level,r.sn,r.stats.chunkCount,i.byteLength,v,x);f.push(i,p,d,"",r,s,u.totalduration,!1,y,m)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${u.startSN} ,${u.endSN}],track ${o}`);const{cache:g}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new V1,complete:!1};g.push(new Uint8Array(i)),this.state!==z.STOPPED&&(this.state=z.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===oe.MAIN&&wt(t.frag)&&(this.mainFragLoading=t,this.state===z.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r.type!==oe.AUDIO){!this.audioOnly&&r.type===oe.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(wt(r)){this.fragPrevious=r;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(T.AUDIO_TRACK_SWITCHED,We({},i)))}this.fragBufferedComplete(r,s),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=z.ERROR;return}switch(t.details){case F.FRAG_GAP:case F.FRAG_PARSING_ERROR:case F.FRAG_DECRYPT_ERROR:case F.FRAG_LOAD_ERROR:case F.FRAG_LOAD_TIMEOUT:case F.KEY_LOAD_ERROR:case F.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(oe.AUDIO,t);break;case F.AUDIO_TRACK_LOAD_ERROR:case F.AUDIO_TRACK_LOAD_TIMEOUT:case F.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===z.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===Fe.AUDIO_TRACK&&(this.state=z.IDLE);break;case F.BUFFER_ADD_CODEC_ERROR:case F.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case F.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case F.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==et.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==et.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===z.ENDED&&(this.state=z.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,oe.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:i,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:c,level:u}=o,{details:d}=u,{audio:f,text:m,id3:p,initSegment:g}=i;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=z.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),g!=null&&g.tracks){const v=l.initSegment||l;if(this.unhandledEncryptionError(g,l))return;this._bufferInitSegment(u,g.tracks,v,a),s.trigger(T.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:r,tracks:g.tracks})}if(f){const{startPTS:v,endPTS:x,startDTS:y,endDTS:S}=f;c&&(c.elementaryStreams[et.AUDIO]={startPTS:v,endPTS:x,startDTS:y,endDTS:S}),l.setElementaryStreamInfo(et.AUDIO,v,x,y,S),this.bufferFragmentData(f,l,c,a)}if(p!=null&&(t=p.samples)!=null&&t.length){const v=Ze({id:r,frag:l,details:d},p);s.trigger(T.FRAG_PARSING_METADATA,v)}if(m){const v=Ze({id:r,frag:l,details:d},m);s.trigger(T.FRAG_PARSING_USERDATA,v)}}_bufferInitSegment(e,t,r,s){if(this.state!==z.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=oe.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${a}/${i.codec}]`),a&&a.split(",").length===1&&(i.levelCodec=a),this.hls.trigger(T.BUFFER_CODECS,t);const o=i.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:s,parent:r.type,data:o};this.hls.trigger(T.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===kt.NOT_LOADED||s===kt.PARTIAL){var i;if(!wt(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=z.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&of(t.details,a)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:s,characteristics:i,audioCodec:a,channels:o}=this.bufferedTrack;Zi({name:t,lang:r,assocLang:s,characteristics:i,audioCodec:a,channels:o},e,Fi)||(tf(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(T.AUDIO_TRACK_SWITCHED,We({},e))}}class Fy extends rr{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const s=t==null?void 0:t.renditionReports;if(s){let i=-1;for(let a=0;a<s.length;a++){const o=s[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=o.URI||""}if(l===e){i=a;break}else l===e.substring(0,l.length)&&(i=a)}if(i!==-1){const a=s[i],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let l=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const c=r&&bS(r);return new wS(o,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:s,stats:i}=t,a=self.performance.now(),o=i.loading.first?Math.max(0,a-i.loading.first):0;s.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==s.appliedTimelineOffset){const u=Math.max(l||0,0);s.appliedTimelineOffset=u,s.fragments.forEach(d=>{d.setStart(d.playlistOffset+u)})}if(s.live||r!=null&&r.live){const u="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(r),r&&s.fragments.length>0){b4(r,s,this);const y=s.playlistParsingError;if(y){this.warn(y);const S=this.hls;if(!S.config.ignorePlaylistParsingErrors){var c;const{networkDetails:b}=t;S.trigger(T.ERROR,{type:fe.NETWORK_ERROR,details:F.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:y,reason:y.message,level:t.level||void 0,parent:(c=s.fragments[0])==null?void 0:c.type,networkDetails:b,stats:i});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=i.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,m=(s.edge-f)*1e3,p=M1(s,m);if(s.requestScheduled+p<a?s.requestScheduled=a:s.requestScheduled+=p,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let g,v,x;if(s.canBlockReload&&s.endSN&&s.advanced){const y=this.hls.config.lowLatencyMode,S=s.lastPartSn,b=s.endSN,w=s.lastPartIndex,_=w!==-1,A=S===b;_?A?(v=b+1,x=y?0:w):(v=S,x=y?w+1:s.maxPartIndex):v=b+1;const I=s.age,C=I+s.ageHeader;let R=Math.min(C-s.partTarget,s.targetduration*1.5);if(R>0){if(C>s.targetduration*3)this.log(`Playlist last advanced ${I.toFixed(2)}s ago. Omitting segment and part directives.`),v=void 0,x=void 0;else if(r!=null&&r.tuneInGoal&&C-s.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${R} with playlist age: ${s.age}`),R=0;else{const P=Math.floor(R/s.targetduration);if(v+=P,x!==void 0){const O=Math.round(R%s.targetduration/s.partTarget);x+=O}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${I.toFixed(2)}s goal: ${R} skip sn ${P} to part ${x}`)}s.tuneInGoal=R}if(g=this.getDeliveryDirectives(s,t.deliveryDirectives,v,x),y||!A){s.requestScheduled=a,this.loadingPlaylist(u,g);return}}else(s.canBlockReload||s.canSkipUntil)&&(g=this.getDeliveryDirectives(s,t.deliveryDirectives,v,x));g&&v!==void 0&&s.canBlockReload&&(s.requestScheduled=i.loading.first+Math.max(p-o*2,p/2)),this.scheduleLoading(u,g,s)}else this.clearTimer()}scheduleLoading(e,t,r){const s=r||e.details;if(!s){this.loadingPlaylist(e,t);return}const i=self.performance.now(),a=s.requestScheduled;if(i>=a){this.loadingPlaylist(e,t);return}const o=a-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,r,s){let i=bS(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,i=Ju.No),new wS(r,s,i)}checkRetry(e){const t=e.details,r=nf(e),s=e.errorAction,{action:i,retryCount:a=0,retryConfig:o}=s||{},l=!!s&&!!o&&(i===Ut.RetryRequest||!s.resolved&&i===Ut.SendAlternateToPenaltyBox);if(l){var c;if(a>=o.maxNumRetry)return!1;if(r&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=wy(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}function lC(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!_c(n[t].attrs,e[t].attrs))return!1;return!0}function _c(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>n[s]!==e[s])}function ug(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class DV extends Fy{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.LEVEL_LOADING,this.onLevelLoading,this),e.off(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(T.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(T.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==s){this.warn(`Audio track with id:${r} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,m)=>{f.id=m});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!i&&l){const f=Kr(l,o,Fi);if(f>-1)i=o[f];else{const m=Kr(l,this.tracks);i=this.tracks[m]}}let c=this.findTrackId(i);c===-1&&i&&(c=this.findTrackId(null));const u={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(T.AUDIO_TRACKS_UPDATED,u);const d=this.trackId;if(c!==-1&&d===-1)this.setAudioTrack(c);else if(o.length&&d===-1){var a;const f=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(f.message),this.hls.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===Fe.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const s=this.currentTrack;if(s&&Zi(e,s,Fi))return s;const i=Kr(e,this.tracksInGroup,Fi);if(i>-1){const a=this.tracksInGroup[i];return this.setAudioTrack(i),a}else if(s){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=K3(e,t.levels,r,a,Fi);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=Kr(e,r);if(a>-1)return r[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===r&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(T.AUDIO_TRACK_SWITCHING,We({},s)),i))return;const a=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(!(this.selectDefaultTrack&&!s.default)&&(!e||Zi(e,s,Fi)))return r}if(e){const{name:r,lang:s,assocLang:i,characteristics:a,audioCodec:o,channels:l}=e;for(let c=0;c<t.length;c++){const u=t[c];if(Zi({name:r,lang:s,assocLang:i,characteristics:a,audioCodec:o,channels:l},u,Fi))return c}for(let c=0;c<t.length;c++){const u=t[c];if(_c(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const u=t[c];if(_c(e.attrs,u.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&tf(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(T.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}}class PV{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(i){var r;if(s.onError(i),this.queues===null||this.tracks===null)return;const a=(r=this.tracks[e])==null?void 0:r.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],s=r==null?void 0:r.buffer;return s?`SourceBuffer${s.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const cE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,cC="HlsJsTrackRemovedError";class NV extends Error{constructor(e){super(e),this.name=cC}}class OV extends rr{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:s,mediaSource:i}=this;r&&this.log("Media source opened"),!(!s||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(T.MEDIA_ATTACHED,{media:s,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:s}=this;r!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=r3(Ti(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.BUFFER_RESET,this.onBufferReset,this),e.on(T.BUFFER_APPENDING,this.onBufferAppending,this),e.on(T.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.BUFFER_EOS,this.onBufferEos,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.FRAG_PARSED,this.onFragParsed,this),e.on(T.FRAG_CHANGED,this.onFragChanged,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.BUFFER_RESET,this.onBufferReset,this),e.off(T.BUFFER_APPENDING,this.onBufferAppending,this),e.off(T.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.BUFFER_EOS,this.onBufferEos,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.FRAG_PARSED,this.onFragParsed,this),e.off(T.FRAG_CHANGED,this.onFragChanged,this),e.off(T.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const a=this.isQueued();(i||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?Ze(r,s.tracks):this.sourceBuffers.forEach(i=>{const[a]=i;a&&(r[a]=Ze({},this.tracks[a]),this.removeBuffer(a)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const s=Ti(this.appendSource);if(s){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(a),i)this._objectUrl=r.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&a instanceof l,uE(r),MV(r,o),r.load()}catch{r.src=o}else r.src=o}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,s=t.tracks,i=s?Object.keys(s):null,a=i?i.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&i&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${rt(r,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${rt(s,(l,c)=>l==="initSegment"?void 0:c)}}`),!i1(s,r)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,u=Math.max(l,(c==null?void 0:c.fragments[0].start)||0);if(u-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(r)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(T.MEDIA_DETACHING,{}),this.onMediaAttaching(T.MEDIA_ATTACHING,t),e.currentTime=u;return}this.transferData=void 0,i.forEach(l=>{const c=l,u=s[c];if(u){const d=u.buffer;if(d){const f=this.fragmentTracker,m=u.id;if(f.hasFragments(m)||f.hasParts(m)){const v=we.getBuffered(d);f.detectEvictedFragments(c,v,m,null,!0)}const p=fm(c),g=[c,d];this.sourceBuffers[p]=g,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,u)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:i,_objectUrl:a}=this;if(i){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=i.readyState==="open";try{const l=i.sourceBuffers;for(let c=l.length;c--;)o&&l[c].abort(),i.removeSourceBuffer(l[c]);o&&i.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),r||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(s.removeAttribute("src"),this.appendSource&&uE(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(T.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[fm(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new PV(this.tracks)}onBufferCodecs(e,t){var r;const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&i.some(l=>!s[l]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`);return}i.forEach(l=>{var c,u;const d=t[l],{id:f,codec:m,levelCodec:p,container:g,metadata:v,supplemental:x}=d;let y=s[l];const S=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[l],b=S!=null&&S.buffer?S:y,w=(b==null?void 0:b.pendingCodec)||(b==null?void 0:b.codec),_=b==null?void 0:b.levelCodec;y||(y=s[l]={buffer:void 0,listeners:[],codec:m,supplemental:x,container:g,levelCodec:p,metadata:v,id:f});const A=Zu(w,_),I=A==null?void 0:A.replace(cE,"$1");let C=Zu(m,p);const R=(u=C)==null?void 0:u.replace(cE,"$1");C&&A&&I!==R&&(l.slice(0,5)==="audio"&&(C=Jd(C,this.appendSource)),this.log(`switching codec ${w} to ${C}`),C!==(y.pendingCodec||y.codec)&&(y.pendingCodec=C),y.container=g,this.appendChangeType(l,g,C))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((r=t.audio)==null?void 0:r.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const s=`${t};codecs=${r}`,i={label:`change-type=${s}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),o.changeType(s),a.codec=r,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,s=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,oe.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>s||l!=null&&l.buffer&&we.isBuffered(l.buffer,s)||((o=this.fragmentTracker.getAppendedFrag(s,oe.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:s,type:i,parent:a,frag:o,part:l,chunkMeta:c,offset:u}=t,d=c.buffering[i],{sn:f,cc:m}=o,p=self.performance.now();d.start=p;const g=o.stats.buffering,v=l?l.stats.buffering:null;g.start===0&&(g.start=p),v&&v.start===0&&(v.start=p);const x=r.audio;let y=!1;i==="audio"&&(x==null?void 0:x.container)==="audio/mpeg"&&(y=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const S=r.video,b=S==null?void 0:S.buffer;if(b&&f!=="initSegment"){const A=l||o,I=this.blockedAudioAppend;if(i==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(S.ending||S.ended)){const R=A.start+A.duration*.05,P=b.buffered,O=this.currentOp("video");!P.length&&!O?this.blockAudio(A):!O&&!we.isBuffered(b,R)&&this.lastVideoAppendEnd<R&&this.blockAudio(A)}else if(i==="video"){const C=A.end;if(I){const R=I.frag.start;(C>R||C<this.lastVideoAppendEnd||we.isBuffered(b,R))&&this.unblockAudio()}this.lastVideoAppendEnd=C}}const w=(l||o).start,_={label:`append-${i}`,execute:()=>{var A;d.executeStart=self.performance.now();const I=(A=this.tracks[i])==null?void 0:A.buffer;I&&(y?this.updateTimestampOffset(I,w,.1,i,f,m):u!==void 0&&re(u)&&this.updateTimestampOffset(I,u,1e-6,i,f,m)),this.appendExecutor(s,i)},onStart:()=>{},onComplete:()=>{const A=self.performance.now();d.executeEnd=d.end=A,g.first===0&&(g.first=A),v&&v.first===0&&(v.first=A);const I={};this.sourceBuffers.forEach(([C,R])=>{C&&(I[C]=we.getBuffered(R))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(T.BUFFER_APPENDED,{type:i,frag:o,part:l,chunkMeta:c,parent:o.type,timeRanges:I})},onError:A=>{var I;const C={type:fe.MEDIA_ERROR,parent:o.type,details:F.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:o,part:l,chunkMeta:c,error:A,err:A,fatal:!1},R=(I=this.media)==null?void 0:I.error;if(A.code===DOMException.QUOTA_EXCEEDED_ERR||A.name=="QuotaExceededError"||"quota"in A)C.details=F.BUFFER_FULL_ERROR;else if(A.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!R)C.errorAction=io(!0);else if(A.name===cC&&this.sourceBufferCount===0)C.errorAction=io(!0);else{const P=++this.appendErrors[i];this.warn(`Failed ${P}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${R||"no media error"})`),(P>=this.hls.config.appendErrorMaxRetry||R)&&(C.fatal=!0)}this.hls.trigger(T.ERROR,C)}};this.log(`queuing "${i}" append sn: ${f}${l?" p: "+l.index:""} of ${o.type===oe.MAIN?"level":"track"} ${o.level} cc: ${m}`),this.append(_,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(T.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:r,startOffset:s,endOffset:i}=t;r?this.append(this.getFlushOp(r,s,i),r):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,s,i),a)})}onFragParsed(e,t){const{frag:r,part:s}=t,i=[],a=s?s.elementaryStreams:r.elementaryStreams;a[et.AUDIOVIDEO]?i.push("audiovideo"):(a[et.AUDIO]&&i.push("audio"),a[et.VIDEO]&&i.push("video"));const o=()=>{const l=self.performance.now();r.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const c=s?s.stats:r.stats;this.hls.trigger(T.FRAG_BUFFERED,{frag:r,part:s,stats:c,id:r.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(o,i).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const s=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(T.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(T.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===F.BUFFER_APPEND_ERROR&&t.frag){var r;const s=(r=t.errorAction)==null?void 0:r.nextAutoLevel;re(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const s=e.config,i=r.currentTime,a=t.levelTargetDuration,o=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(re(o)&&o>=0){const c=Math.max(o,a),u=Math.floor(i/a)*a-c;this.flushBackBuffer(i,a,u)}const l=s.frontBufferFlushThreshold;if(re(l)&&l>0){const c=Math.max(s.maxBufferLength,l),u=Math.max(c,a),d=Math.floor(i/a)*a+u;this.flushFrontBuffer(i,a,d)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const o=we.getBuffered(i);if(o.length>0&&r>o.start(0)){var a;this.hls.trigger(T.BACK_BUFFER_REACHED,{bufferEnd:r});const l=this.tracks[s];if((a=this.details)!=null&&a.live)this.hls.trigger(T.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l!=null&&l.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(T.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:s})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([s,i])=>{if(i){const a=we.getBuffered(i),o=a.length;if(o<2)return;const l=a.start(o-1),c=a.end(o-1);if(r>l||e>=l&&e<=c)return;this.hls.trigger(T.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),u=Math.max(c,s);return{duration:1/0,start:c,end:u}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return re(i)?{duration:i}:null;const a=this.media.duration,o=re(r.duration)?r.duration:0;return s>o&&s>a||!re(a)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:r}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(re(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${r}.`),s.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${rt(r)}`),this.tracksReady){var s;const i=(s=this.transferData)==null?void 0:s.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const s=this.tracks[t];e[t]={buffer:r,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(T.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const a=i,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),c=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(a)?" Queued":""} ${rt(o)}`);try{const u=r.addSourceBuffer(c),d=fm(a),f=[a,u];t[d]=f,o.buffer=u}catch(u){var s;this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(a),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[a],this.hls.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:a,mimeType:c,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let s=e.codec;r&&(t==="video"||t==="audiovideo")&&Sc(r,"video")&&(s=A3(s,r));const i=Zu(s,e.levelCodec);return i?t.slice(0,5)==="audio"?Jd(i,this.appendSource):i:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(T.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${s}`,t),this.hls.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.currentOp(e);i&&i.onError(s)}updateTimestampOffset(e,t,r,s,i,a){const o=t-e.timestampOffset;Math.abs(o)>=r&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:s,mediaSource:i}=this,a=this.tracks[e],o=a==null?void 0:a.buffer;if(!s||!i||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=re(s.duration)?s.duration:1/0,c=re(i.duration)?i.duration:1/0,u=Math.max(0,t),d=Math.min(r,l,c);d>u&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${u},${d}] from the ${e} SourceBuffer`),o.remove(u,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],s=r==null?void 0:r.buffer;if(!s)throw new NV(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,s=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(a=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const s=(r=this.tracks[t])==null?void 0:r.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const s=this.tracks[e];if(!s)return;const i=s.buffer;if(!i)return;const a=r.bind(this,e);s.listeners.push({event:t,listener:a}),i.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(s=>{r.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function uE(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function MV(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function fm(n){return n==="audio"?1:0}class jy{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(T.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(T.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(T.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(T.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&re(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,jy.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const s=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let i=e.length-1;const a=Math.max(t,r);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&s(l,e[o+1])){i=o;break}}return i}}const FV={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},yn=FV,jV={HLS:"h"},$V=jV;class es{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof es?r:new es(r))),this.value=e,this.params=t}}const UV="Dict";function BV(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function VV(n,e,t,r){return new Error(`failed to ${n} "${BV(e)}" as ${t}`,{cause:r})}function ts(n,e,t){return VV("serialize",n,e,t)}class uC{constructor(e){this.description=e}}const dE="Bare Item",GV="Boolean";function KV(n){if(typeof n!="boolean")throw ts(n,GV);return n?"?1":"?0"}function HV(n){return btoa(String.fromCharCode(...n))}const zV="Byte Sequence";function WV(n){if(ArrayBuffer.isView(n)===!1)throw ts(n,zV);return`:${HV(n)}:`}const YV="Integer";function qV(n){return n<-999999999999999||999999999999999<n}function dC(n){if(qV(n))throw ts(n,YV);return n.toString()}function QV(n){return`@${dC(n.getTime()/1e3)}`}function fC(n,e){if(n<0)return-fC(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const s=Math.floor(n*t);return(s%2===0?s:s+1)/t}else return Math.round(n*t)/t}const XV="Decimal";function ZV(n){const e=fC(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw ts(n,XV);const t=e.toString();return t.includes(".")?t:`${t}.0`}const JV="String",eG=/[\x00-\x1f\x7f]+/;function tG(n){if(eG.test(n))throw ts(n,JV);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function nG(n){return n.description||n.toString().slice(7,-1)}const rG="Token";function fE(n){const e=nG(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw ts(e,rG);return e}function dg(n){switch(typeof n){case"number":if(!re(n))throw ts(n,dE);return Number.isInteger(n)?dC(n):ZV(n);case"string":return tG(n);case"symbol":return fE(n);case"boolean":return KV(n);case"object":if(n instanceof Date)return QV(n);if(n instanceof Uint8Array)return WV(n);if(n instanceof uC)return fE(n);default:throw ts(n,dE)}}const sG="Key";function fg(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw ts(n,sG);return n}function $y(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${fg(e)}`:`;${fg(e)}=${dg(t)}`).join("")}function hC(n){return n instanceof es?`${dg(n.value)}${$y(n.params)}`:dg(n)}function iG(n){return`(${n.value.map(hC).join(" ")})${$y(n.params)}`}function aG(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw ts(n,UV);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof es||(i=new es(i));let a=fg(s);return i.value===!0?a+=$y(i.params):(a+="=",Array.isArray(i.value)?a+=iG(i):a+=hC(i)),a}).join(`,${r}`)}function mC(n,e){return aG(n,e)}const Dr="CMCD-Object",vt="CMCD-Request",Pi="CMCD-Session",Os="CMCD-Status",oG={br:Dr,ab:Dr,d:Dr,ot:Dr,tb:Dr,tpb:Dr,lb:Dr,tab:Dr,lab:Dr,url:Dr,pb:vt,bl:vt,tbl:vt,dl:vt,ltc:vt,mtp:vt,nor:vt,nrr:vt,rc:vt,sn:vt,sta:vt,su:vt,ttfb:vt,ttfbb:vt,ttlb:vt,cmsdd:vt,cmsds:vt,smrt:vt,df:vt,cs:vt,ts:vt,cid:Pi,pr:Pi,sf:Pi,sid:Pi,st:Pi,v:Pi,msd:Pi,bs:Os,bsd:Os,cdn:Os,rtp:Os,bg:Os,pt:Os,ec:Os,e:Os},lG={REQUEST:vt};function cG(n){return Object.keys(n).reduce((e,t)=>{var r;return(r=n[t])===null||r===void 0||r.forEach(s=>e[s]=t),e},{})}function uG(n,e){const t={};if(!n)return t;const r=Object.keys(n),s=e?cG(e):{};return r.reduce((i,a)=>{var o;const l=oG[a]||s[a]||lG.REQUEST,c=(o=i[l])!==null&&o!==void 0?o:i[l]={};return c[a]=n[a],i},t)}function dG(n){return["ot","sf","st","e","sta"].includes(n)}function fG(n){return typeof n=="number"?re(n):n!=null&&n!==""&&n!==!1}const pC="event";function hG(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const s=t.pathname.split("/").slice(1),i=r.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const rd=n=>Math.round(n),hg=(n,e)=>Array.isArray(n)?n.map(t=>hg(t,e)):n instanceof es&&typeof n.value=="string"?new es(hg(n.value,e),n.params):(e.baseUrl&&(n=hG(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),Au=n=>rd(n/100)*100,mG=(n,e)=>{let t=n;return e.version>=2&&(n instanceof es&&typeof n.value=="string"?t=new es([n]):typeof n=="string"&&(t=[n])),hg(t,e)},pG={br:rd,d:rd,bl:Au,dl:Au,mtp:Au,nor:mG,rtp:Au,tb:rd},gC="request",yC="response",Uy=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],gG=["e"],yG=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function ih(n){return yG.test(n)}function vG(n){return Uy.includes(n)||gG.includes(n)||ih(n)}const vC=["d","dl","nor","ot","rtp","su"];function xG(n){return Uy.includes(n)||vC.includes(n)||ih(n)}const SG=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function EG(n){return Uy.includes(n)||vC.includes(n)||SG.includes(n)||ih(n)}const TG=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function bG(n){return TG.includes(n)||ih(n)}const wG={[yC]:EG,[pC]:vG,[gC]:xG};function xC(n,e={}){const t={};if(n==null||typeof n!="object")return t;const r=e.version||n.v||1,s=e.reportingMode||gC,i=r===1?bG:wG[s];let a=Object.keys(n).filter(i);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const l=s===yC||s===pC;l&&!a.includes("ts")&&a.push("ts"),r>1&&!a.includes("v")&&a.push("v");const c=Ze({},pG,e.formatters),u={version:r,reportingMode:s,baseUrl:e.baseUrl};return a.sort().forEach(d=>{let f=n[d];const m=c[d];if(typeof m=="function"&&(f=m(f,u)),d==="v"){if(r===1)return;f=r}d=="pr"&&f===1||(l&&d==="ts"&&!re(f)&&(f=Date.now()),fG(f)&&(dG(d)&&typeof f=="string"&&(f=new uC(f)),t[d]=f))}),t}function AG(n,e={}){const t={};if(!n)return t;const r=xC(n,e),s=uG(r,e==null?void 0:e.customHeaderMap);return Object.entries(s).reduce((i,[a,o])=>{const l=mC(o,{whitespace:!1});return l&&(i[a]=l),i},t)}function _G(n,e,t){return Ze(n,AG(e,t))}const IG="CMCD";function RG(n,e={}){return n?mC(xC(n,e),{whitespace:!1}):""}function CG(n,e={}){if(!n)return"";const t=RG(n,e);return encodeURIComponent(t)}function LG(n,e={}){if(!n)return"";const t=CG(n,e);return`${IG}=${t}`}const hE=/CMCD=[^&#]+/;function kG(n,e,t){const r=LG(e,t);if(!r)return n;if(hE.test(n))return n.replace(hE,r);const s=n.includes("?")?"&":"?";return`${n}${s}${r}`}class DG{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:yn.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const{frag:i,part:a}=s,o=this.hls.levels[i.level],l=this.getObjectType(i),c={d:(a||i).duration*1e3,ot:l};(l===yn.VIDEO||l===yn.AUDIO||l==yn.MUXED)&&(c.br=o.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const u=a?this.getNextPart(a):this.getNextFrag(i);u!=null&&u.url&&u.url!==i.url&&(c.nor=u.url),this.apply(s,c)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHED,this.onMediaDetached,this),e.on(T.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHED,this.onMediaDetached,this),e.off(T.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:$V.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ze(t,this.createData());const r=t.ot===yn.INIT||t.ot===yn.VIDEO||t.ot===yn.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((a,o)=>(s.includes(o)&&(a[o]=t[o]),a),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),_G(e.headers,t,i)):e.url=kG(e.url,t,i)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const s=e.sn-r.startSN;return r.fragments[s+1]}}getNextPart(e){var t;const{index:r,fragment:s}=e,i=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:a}=s;for(let o=i.length-1;o>=0;o--){const l=i[o];if(l.index===r&&l.fragment.sn===a)return i[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return yn.TIMED_TEXT;if(e.sn==="initSegment")return yn.INIT;if(t==="audio")return yn.AUDIO;if(t==="main")return this.hls.audioTracks.length?yn.VIDEO:yn.MUXED}getTopBandwidth(e){let t=0,r;const s=this.hls;if(e===yn.AUDIO)r=s.audioTracks;else{const i=s.maxAutoLevel,a=i>-1?i+1:s.levels.length;r=s.levels.slice(0,a)}return r.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===yn.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:we.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,a,o){t(i),this.loader.load(i,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new r(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,a,o){t(i),this.loader.load(i,a,o)}}}}const PG=3e5;class NG extends rr{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===Ut.SendAlternateToPenaltyBox&&r.flags===Ln.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:c}=t.context;o&&s?a=this.getPathwayForGroupId(o,c,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!i&&s&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),r.resolved=this.pathwayId!==a),t.details===F.BUFFER_APPEND_ERROR&&!t.fatal?r.resolved=!0:r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${s&&s.length} priorities: ${rt(i)} penalized: ${rt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(i=>{s-r[i]>PG&&delete r[i]});for(let i=0;i<e.length;i++){const a=e[i];if(a in r)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,$1(t),this.hls.trigger(T.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[o];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,r){const s=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===Fe.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===Fe.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(i=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=i;if(t.some(u=>u.pathwayId===a))return;const c=this.getLevelsForPathway(o).map(u=>{const d=new dt(u.attrs);d["PATHWAY-ID"]=a;const f=d.AUDIO&&`${d.AUDIO}_clone_${a}`,m=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;f&&(r[d.AUDIO]=f,d.AUDIO=f),m&&(s[d.SUBTITLES]=m,d.SUBTITLES=m);const p=SC(u.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),g=new Tc({attrs:d,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:p,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let v=1;v<u.audioGroups.length;v++)g.addGroupId("audio",`${u.audioGroups[v]}_clone_${a}`);if(u.subtitleGroups)for(let v=1;v<u.subtitleGroups.length;v++)g.addGroupId("text",`${u.subtitleGroups[v]}_clone_${a}`);return g});t.push(...c),mE(this.audioTracks,r,l,a),mE(this.subtitleTracks,s,l,a)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+u)}const i={responseType:"json",url:s.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(u,d,f,m)=>{this.log(`Loaded steering manifest: "${s}"`);const p=u.data;if((p==null?void 0:p.VERSION)!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":g,"PATHWAY-CLONES":v,"PATHWAY-PRIORITY":x}=p;if(g)try{this.uri=new self.URL(g,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${g}`);return}this.scheduleRefresh(this.uri||f.url),v&&this.clonePathways(v);const y={steeringManifest:p,url:s.toString()};this.hls.trigger(T.STEERING_MANIFEST_LOADED,y),x&&this.updatePathwayPriority(x)},onError:(u,d,f,m)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${d.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let p=this.timeToLoad*1e3;if(u.code===429){const g=this.loader;if(typeof(g==null?void 0:g.getResponseHeader)=="function"){const v=g.getResponseHeader("Retry-After");v&&(p=parseFloat(v)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,p)},onTimeout:(u,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const s=(r=this.hls)==null?void 0:r.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function mE(n,e,t,r){n&&Object.keys(e).forEach(s=>{const i=n.filter(a=>a.groupId===s).map(a=>{const o=Ze({},a);return o.details=void 0,o.attrs=new dt(o.attrs),o.url=o.attrs.URI=SC(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[s],o.attrs["PATHWAY-ID"]=r,o});n.push(...i)})}function SC(n,e,t,r){const{HOST:s,PARAMS:i,[t]:a}=r;let o;e&&(o=a==null?void 0:a[e],o&&(n=o));const l=new self.URL(n);return s&&!o&&(l.host=s),i&&Object.keys(i).sort().forEach(c=>{c&&l.searchParams.set(c,i[c])}),l.href}class oo extends rr{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=oo.CDMCleanupPromise?[oo.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:r,initData:s}=t,i=`"${t.type}" event: init data type: "${r}"`;if(this.debug(i),s!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=El(this.config));const o=a.map(sm).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=ed(a);if(r!=="sinf"||o!==mt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${r}" for selected key-system ${o}`);return}let l;try{const m=Rt(new Uint8Array(s)),p=Ry(JSON.parse(m).sinf),g=m1(p);if(!g)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(g.subarray(8,24))}catch(m){this.warn(`${i} Failed to parse sinf: ${m}`);return}const c=on(l),{keyIdToKeySessionPromise:u,mediaKeySessions:d}=this;let f=u[c];for(let m=0;m<d.length;m++){const p=d[m],g=p.decryptdata;if(!g.keyId)continue;const v=on(g.keyId);if(sf(l,g.keyId)||g.uri.replace(/-/g,"").indexOf(c)!==-1){if(f=u[v],!f)continue;if(g.pssh)break;delete u[v],g.pssh=new Uint8Array(s),g.keyId=l,f=u[c]=f.then(()=>this.generateRequestWithPreferredKeySession(p,r,s,"encrypted-event-key-match")),f.catch(x=>this.handleError(x));break}}f||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(T.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(T.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(T.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(T.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(T.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,s=t==null?void 0:t[e];if(s)return s.licenseUrl;if(e===mt.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t==null?void 0:t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(a,o,l)=>!!a&&l.indexOf(a)===o,s=t.map(a=>a.audioCodec).filter(r),i=t.map(a=>a.videoCodec).filter(r);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((a,o)=>{const l=c=>{const u=c.shift();this.getMediaKeysPromise(u,s,i).then(d=>a({keySystem:u,mediaKeys:d})).catch(d=>{c.length?l(c):d instanceof Cn?o(d):o(new Cn({type:fe.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return k1===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(e,t)}getMediaKeysPromise(e,t,r){var s;const i=m4(e,t,r,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(s=a)==null?void 0:s.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${rt(i)}`),o=this.requestMediaKeySystemAccess(e,i);const l=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),o.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const u=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=l.mediaKeys=c.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,u.then(m=>m?this.setMediaKeysServerCertificate(f,e,m):f)));return d.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),d})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${on(e.keyId||[])} keyUri: ${e.uri}`);const s=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),s=_u(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${on(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>sm(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const i=sm(s);i?t(i):r(new Error(`Unable to find format for key-system "${s}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=El(this.config),r=e.map(ed).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const s=OG(e,t[r]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,r=_u(t),s=this.bannedKeyIds[r];if(s||this.getKeyStatus(t)==="internal-error"){const o=pE(s||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const a=this.keyIdToKeySessionPromise[r];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(l,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:c,decryptdata:t}))))).then(l=>{const c="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,c,u,"playlist-key")});return o.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[r]=o,o}return a.catch(o=>{if(o instanceof Cn){const l=We({},o.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const c=new Cn(l,o.message);this.handleError(c,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Cn){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${on(r.keyId||[])})`:""}`),this.hls.trigger(T.ERROR,e.data)}else this.error(e.message),this.hls.trigger(T.ERROR,{type:fe.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=_u(e),r=this.keyIdToKeySessionPromise[t];if(!r){const s=ed(e.keyFormat),i=s?[s]:El(this.config);return this.attemptKeySystemAccess(i)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=El(this.config)),e.length===0)throw new Cn({type:fe.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${rt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>r.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,r,s){var i;const a=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(a)try{const p=a.call(this.hls,t,r,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");t=p.initDataType,r=p.initData?p.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(p){if(this.warn(p.message),this.hls&&this.hls.config.debug)throw p}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const o=_u(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${o} URI: ${l} (init data type: ${t} length: ${r.byteLength})`);const c=new Ly,u=e._onmessage=p=>{const g=e.mediaKeysSession;if(!g){c.emit("error",new Error("invalid state"));return}const{messageType:v,message:x}=p;this.log(`"${v}" message event for session "${g.sessionId}" message size: ${x.byteLength}`),v==="license-request"||v==="license-renewal"?this.renewLicense(e,x).catch(y=>{c.eventNames().length?c.emit("error",y):this.handleError(y)}):v==="license-release"?e.keySystem===mt.FAIRPLAY&&this.updateKeySession(e,ig("acknowledged")).then(()=>this.removeSession(e)).catch(y=>this.handleError(y)):this.warn(`unhandled media key message type "${v}"`)},d=(p,g)=>{g.keyStatus=p;let v;p.startsWith("usable")?c.emit("resolved"):p==="internal-error"||p==="output-restricted"||p==="output-downscaled"?v=pE(p,g.decryptdata):p==="expired"?v=new Error(`key expired (keyId: ${o})`):p==="released"?v=new Error("key released"):p==="status-pending"||this.warn(`unhandled key status change "${p}" (keyId: ${o})`),v&&(c.eventNames().length?c.emit("error",v):this.handleError(v))},f=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const v=this.getKeyStatuses(e);if(!Object.keys(v).some(b=>v[b]!=="status-pending"))return;if(v[o]==="expired"){this.log(`Expired key ${rt(v)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let y=v[o];if(y)d(y,e);else{var S;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(S=e.keyStatusTimeouts)[o]||(S[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const w=this.getKeyStatus(e.decryptdata);if(w&&w!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${w} from other session.`),d(w,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),y="internal-error",d(y,e)},1e3)),this.log(`No status for keyId ${o} (${rt(v)}).`)}};un(e.mediaKeysSession,"message",u),un(e.mediaKeysSession,"keystatuseschange",f);const m=new Promise((p,g)=>{c.on("error",g),c.on("resolved",p)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${l}`)}).catch(p=>{throw new Cn({type:fe.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_NO_SESSION,error:p,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>m).catch(p=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw p}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,s)=>{if(typeof s=="string"&&typeof r=="object"){const o=s;s=r,r=o}const i="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);e.keySystem===mt.PLAYREADY&&i.length===16&&C1(i);const a=on(i);r==="internal-error"&&(this.bannedKeyIds[a]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=r}),t}fetchServerCertificate(e){const t=this.config,r=t.loader,s=new r(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:i},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,m,p,g)=>{a(f.data)},onError:(f,m,p,g)=>{o(new Cn({type:fe.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:We({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${i}). Status: ${f.code} (${f.text})`))},onTimeout:(f,m,p)=>{o(new Cn({type:fe.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(f,m,p)=>{o(new Error("aborted"))}};s.load(l,u,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((s,i)=>{e.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),s(e)}).catch(a=>{i(new Cn({type:fe.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(s=>{throw new Cn({type:fe.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(r,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let u;for(let d=0,f=i.length;d<f;d++){var a,o;u=i[d];const m=(a=u.querySelector("name"))==null?void 0:a.textContent,p=(o=u.querySelector("value"))==null?void 0:o.textContent;m&&p&&e.setRequestHeader(m,p)}}const l=s.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return ig(atob(c))}setupLicenseXHR(e,t,r,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,s)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",t,!0),i.call(this.hls,e,t,r,s)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,o,a,e)}catch(u){this.error(u)}s(l)}else{const l=r.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||o.status>=400&&o.status<500)i(new Cn({type:fe.KEY_SYSTEM_ERROR,details:F.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==mt.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,un(r,"encrypted",this.onMediaEncrypted),un(r,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(wn(e,"encrypted",this.onMediaEncrypted),wn(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ji.clearKeyUriToKeyIdMap();const s=r.length;oo.CDMCleanupPromise=Promise.all(r.map(i=>this.removeSession(i)).concat((t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(i=>{this.log(`Could not clear media keys: ${i}`),this.hls&&this.hls.trigger(T.ERROR,{type:fe.OTHER_ERROR,details:F.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${i}`)})}))||Promise.resolve())).catch(i=>{this.log(`Could not close sessions and clear media keys: ${i}`),this.hls&&this.hls.trigger(T.ERROR,{type:fe.OTHER_ERROR,details:F.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${i}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null,this.bannedKeyIds={}}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${on((s==null?void 0:s.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(c=>self.clearTimeout(a[c]));const{drmSystemOptions:o}=this.config;return(g4(o)?new Promise((c,u)=>{self.setTimeout(()=>u(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(u)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(T.ERROR,{type:fe.OTHER_ERROR,details:F.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(T.ERROR,{type:fe.OTHER_ERROR,details:F.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}oo.CDMCleanupPromise=void 0;function _u(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return on(n.keyId)}function OG(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class Cn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function pE(n,e){const t=n==="output-restricted",r=t?F.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:F.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Cn({type:fe.KEY_SYSTEM_ERROR,details:r,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class MG{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(T.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(T.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,a=r-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/i,c=this.hls;if(c.trigger(T.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:r}),l>0&&a>c.config.fpsDroppedMonitoringThreshold*o){let u=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger(T.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function EC(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function TC(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){Ye.debug(`[texttrack-utils]: ${r}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,n.addCue(s)}catch(s){Ye.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(n.mode=t)}function Wa(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function mg(n,e,t,r){const s=n.mode;if(s==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const i=jG(n.cues,e,t);for(let a=0;a<i.length;a++)(!r||r(i[a]))&&n.removeCue(i[a])}s==="disabled"&&(n.mode=s)}function FG(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,s=t,i;for(;r<=s;)if(i=Math.floor((s+r)/2),e<n[i].startTime)s=i-1;else if(e>n[i].startTime&&r<t)r=i+1;else return i;return n[r].startTime-e<e-n[s].startTime?r:s}function jG(n,e,t){const r=[],s=FG(n,e);if(s>-1)for(let i=s,a=n.length;i<a;i++){const o=n[i];if(o.startTime>=e&&o.endTime<=t)r.push(o);else if(o.startTime>t)return r}return r}function sd(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class $G extends Fy{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=sd(this.media.textTracks);for(let i=0;i<r.length;i++)if(r[i].mode==="hidden")t=r[i];else if(r[i].mode==="showing"){t=r[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(T.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.LEVEL_LOADING,this.onLevelLoading,this),e.off(T.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(T.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;sd(r.textTracks).forEach(a=>{Wa(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:s,details:i}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==s){this.warn(`Subtitle track with id:${r} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(u=>!r||r.indexOf(u.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(u=>u.default)&&(this.selectDefaultTrack=!1),a.forEach((u,d)=>{u.id=d});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!i&&o){this.selectDefaultTrack=!1;const u=Kr(o,a);if(u>-1)i=a[u];else{const d=Kr(o,this.tracks);i=this.tracks[d]}}let l=this.findTrackId(i);l===-1&&i&&(l=this.findTrackId(null));const c={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(T.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(r&&!i.default||!r&&!e)&&(!e||Zi(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(_c(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(_c(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(ug(s,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Fe.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&Zi(e,r))return r;const s=Kr(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(r)return null;{const i=Kr(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(T.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=sd(e.textTracks),r=this.currentTrack;let s;if(r&&(s=t.filter(i=>ug(r,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!re(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(T.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:a,groupId:o="",name:l,type:c,url:u}=s;this.hls.trigger(T.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:c,url:u});const d=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(d)}}function UG(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}function Fl(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const lo=.025;let cf=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function BG(n,e,t){return`${n.identifier}-${t+1}-${Fl(e)}`}class VG{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return hm(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=hm(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=re(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return hm(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<lo))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?cf.Range:cf.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return GG(this)}}function hm(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<lo)?e.start:e.start+e.duration}function bC(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function mm(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function GG(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Pa(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class KG{constructor(e,t,r,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(T.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=r,this.assetItem=s;const a=()=>{this.hasDetails=!0};i.once(T.LEVEL_LOADED,a),i.once(T.AUDIO_TRACK_LOADED,a),i.once(T.SUBTITLE_TRACK_LOADED,a),i.on(T.MEDIA_ATTACHING,(o,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(T.BUFFER_APPENDED,()=>{const u=this.bufferedEnd;this.reachedPlayout(u)&&(this._bufferedEosTime=u,i.trigger(T.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=bC(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,i=we.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=r-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=we.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,r){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,r){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Pa(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const gE=.033;class HG extends rr{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(i=s[r])!=null&&i.event;){var i;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let s=0;s<r.length;s++){let i=r[s];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return s}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let s=e;s<=t&&r[s];s++){const i=r[s].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var r;if(((r=t[s].event)==null?void 0:r.identifier)===e)return s}return-1}findAssetIndex(e,t){const r=e.assetList,s=r.length;if(s>1)for(let i=0;i<s;i++){const a=r[i];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||i===s-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const r=t.assetList,s=r[r.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:s}=r,i=this.events,a=this.parseDateRanges(s,{url:r.url},t),o=Object.keys(s),l=i?i.filter(c=>!o.includes(c.identifier)):[];a.length&&a.sort((c,u)=>{const d=c.cue.pre,f=c.cue.post,m=u.cue.pre,p=u.cue.post;if(d&&!m)return-1;if(m&&!d||f&&!p)return 1;if(p&&!f)return-1;if(!d&&!m&&!f&&!p){const g=c.startTime,v=u.startTime;if(g!==v)return g-v}return c.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=a,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],r=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,a=this.parseSchedule(s,e);(r||t.length||(i==null?void 0:i.length)!==a.length||a.some((l,c)=>Math.abs(l.playout.start-i[c].playout.start)>.005||Math.abs(l.playout.end-i[c].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const s=[],i=Object.keys(e);for(let a=0;a<i.length;a++){const o=i[a],l=e[o];if(l.isInterstitial){let c=this.eventMap[o];c?c.setDateRange(l):(c=new VG(l,t),this.eventMap[o]=c,r===!1&&(c.appendInPlace=r)),s.push(c)}}return s}parseSchedule(e,t){const r=[],s=t.main.details,i=s.live?1/0:s.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((u,d)=>{const f=u.cue.pre,m=u.cue.post,p=e[d-1]||null,g=u.appendInPlace,v=m?i:u.startOffset,x=u.duration,y=u.timelineOccupancy===cf.Range?x:0,S=u.resumptionOffset,b=(p==null?void 0:p.startTime)===v,w=v+u.cumulativeDuration;let _=g?w+x:v+S;if(f||!m&&v<=0){const I=c;c+=y,u.timelineStart=w;const C=a;a+=x,r.push({event:u,start:w,end:_,playout:{start:C,end:a},integrated:{start:I,end:c}})}else if(v<=i){if(!b){const R=v-l;if(R>gE){const P=l,O=c;c+=R;const U=a;a+=R;const j={previousEvent:e[d-1]||null,nextEvent:u,start:P,end:P+R,playout:{start:U,end:a},integrated:{start:O,end:c}};r.push(j)}else R>0&&p&&(p.cumulativeDuration+=R,r[r.length-1].end=v)}m&&(_=w),u.timelineStart=w;const I=c;c+=y;const C=a;a+=x,r.push({event:u,start:w,end:_,playout:{start:C,end:a},integrated:{start:I,end:c}})}else return;const A=u.resumeTime;m||A>i?l=i:l=A}),l<i){var o;const u=l,d=c,f=i-l;c+=f;const m=a;a+=f,r.push({previousEvent:((o=r[r.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:u+f,playout:{start:m,end:a},integrated:{start:d,end:c}})}this.setDurations(i,a,c)}else r.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,s=r.live?1/0:r.edge;let i=0,a=-1;e.forEach((o,l)=>{const c=o.cue.pre,u=o.cue.post,d=c?0:u?s:o.startTime;this.updateAssetDurations(o),a===d?o.cumulativeDuration=i:(i=0,a=d),!u&&o.snapOptions.in&&(o.resumeAnchor=ma(null,r.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<gE&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const m=re(o.resumeOffset)?o.resumeOffset:o.duration;i+=m})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(r-s)>lo?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(r>=l)return this.log(`"${e.identifier}" resumption ${r} past ${a} playlist end ${l}`),!1;const c=ma(null,o.fragments,r);if(!c)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const u=a==="audio"?.175:0;return Math.abs(c.start-r)<lo+u||Math.abs(c.end-r)<lo+u?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${a} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,s=!1,i=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],l=t+r;o.startOffset=r,o.timelineStart=l,s||(s=o.duration===null),i||(i=!!o.error);const c=o.error?0:o.duration||0;r+=c}s&&!i?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ar(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class zG{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let s;try{s=bC(r,this.hls.sessionId,e.baseUrl)}catch(f){const m=this.assignAssetListError(e,F.ASSET_LIST_LOAD_ERROR,f,r);this.hls.trigger(T.ERROR,m);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,a=i.loader,o=new a(i),l={responseType:"json",url:s.href},c=i.interstitialAssetListLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,m,p,g)=>{const v=f.data,x=v==null?void 0:v.ASSETS;if(!Array.isArray(x)){const y=this.assignAssetListError(e,F.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),p.url,m,g);this.hls.trigger(T.ERROR,y);return}e.assetListResponse=v,this.hls.trigger(T.ASSET_LIST_LOADED,{event:e,assetListResponse:v,networkDetails:g})},onError:(f,m,p,g)=>{const v=this.assignAssetListError(e,F.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${m.url})`),m.url,g,p);this.hls.trigger(T.ERROR,v)},onTimeout:(f,m,p)=>{const g=this.assignAssetListError(e,F.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${m.url})`),m.url,f,p);this.hls.trigger(T.ERROR,g)}};return o.load(l,u,d),this.hls.trigger(T.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,r,s,i,a){return e.error=r,{type:fe.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:r,networkDetails:a,stats:i}}}function yE(n){n==null||n.play().catch(()=>{})}function Iu(n,e){return`[${n}] Advancing timeline position to ${e}`}class WG extends rr{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled||!this.schedule)return;const s=r-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const a=s<=-.01;this.timelinePos=r,this.bufferedPos=r;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(r,r-s)&&this.updateSchedule(!0),this.checkBuffer(),a&&r<o.start||r>=o.end){var l;const m=this.findItemIndex(o);let p=this.schedule.findItemIndexAtTime(r);if(p===-1&&(p=m+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${r} (resolving from ${m} to ${p})`)),!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a&&p>m){const g=this.schedule.findJumpRestrictedIndex(m+1,p);if(g>m){this.setSchedulePosition(g);return}}this.setSchedulePosition(p);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(o)){const m=o.event.assetList[0];m&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,m))}return}const u=c.timelineStart,d=c.duration||0;if(a&&r<u||r>=u+d){var f;(f=o.event)!=null&&f.appendInPlace&&(this.clearInterstitial(o.event,o),this.flushFrontBuffer(r)),this.setScheduleToAssetAtTime(r,c)}},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(r>=s.end){this.timelinePos=s.end;const o=this.findItemIndex(s);this.setSchedulePosition(o+1)}const i=this.playingAsset;if(!i)return;const a=i.timelineStart+(i.duration||0);r>=a&&this.setScheduleToAssetAtTime(r,i)},this.onScheduleUpdate=(r,s)=>{const i=this.schedule;if(!i)return;const a=this.playingItem,o=i.events||[],l=i.items||[],c=i.durations,u=r.map(g=>g.identifier),d=!!(o.length||u.length);(d||s)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(g=>ar(g))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`);let f=null,m=null;a&&(f=this.updateItem(a,this.timelinePos),this.itemsMatch(a,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const p=this.bufferingItem;if(p&&(m=this.updateItem(p,this.bufferedPos),this.itemsMatch(p,m)?this.bufferingItem=m:p.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(p.event,null))),r.forEach(g=>{g.assetList.forEach(v=>{this.clearAssetPlayer(v.identifier,null)})}),this.playerQueue.forEach(g=>{if(g.interstitial.appendInPlace){const v=g.assetItem.timelineStart,x=g.timelineOffset-v;if(x)try{g.timelineOffset=v}catch(y){Math.abs(x)>lo&&this.warn(`${y} ("${g.assetId}" ${g.timelineOffset}->${v})`)}}}),d||s){if(this.hls.trigger(T.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:c,removedIds:u}),this.isInterstitial(a)&&u.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(f,a),p&&m!==f&&this.trimInPlace(m,p),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new zG(e),this.schedule=new HG(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(T.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(T.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(T.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(T.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(T.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(T.BUFFER_APPENDED,this.onBufferAppended,this),e.on(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(T.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(T.MEDIA_ENDED,this.onMediaEnded,this),e.on(T.ERROR,this.onError,this),e.on(T.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(T.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(T.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(T.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(T.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(T.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(T.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.BUFFER_APPENDED,this.onBufferAppended,this),e.off(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(T.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(T.MEDIA_ENDED,this.onMediaEnded,this),e.off(T.ERROR,this.onError,this),e.off(T.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){wn(e,"play",this.onPlay),wn(e,"pause",this.onPause),wn(e,"seeking",this.onSeeking),wn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;un(r,"seeking",this.onSeeking),un(r,"timeupdate",this.onTimeupdate),un(r,"play",this.onPlay),un(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!s){this.clearScheduleState();const i=this.findItemIndex(r);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(this.media=null,!r&&(s&&this.removeMediaListeners(s),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=d=>d&&e.getAssetPlayer(d.identifier),s=(d,f,m,p,g)=>{if(d){let v=d[f].start;const x=d.event;if(x){if(f==="playout"||x.timelineOccupancy!==cf.Point){const y=r(m);(y==null?void 0:y.interstitial)===x&&(v+=y.assetItem.startOffset+y[g])}}else{const y=p==="bufferedPos"?a():e[p];v+=y-d.start}return v}return 0},i=(d,f)=>{var m;if(d!==0&&f!=="primary"&&(m=e.schedule)!=null&&m.length){var p;const g=e.schedule.findItemIndexAtTime(d),v=(p=e.schedule.items)==null?void 0:p[g];if(v){const x=v[f].start-v.start;return d+x}}return d},a=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?o("primary"):Math.max(d,0)},o=d=>{var f,m;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((m=e.schedule)==null?void 0:m.durations[d])||0},l=(d,f)=>{var m,p;const g=e.effectivePlayingItem;if(g!=null&&(m=g.event)!=null&&m.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${f}"`);const v=e.effectivePlayingItem,x=e.schedule.findItemIndexAtTime(d,f),y=(p=e.schedule.items)==null?void 0:p[x],S=e.getBufferingPlayer(),b=S==null?void 0:S.interstitial,w=b==null?void 0:b.appendInPlace,_=v&&e.itemsMatch(v,y);if(v&&(w||_)){const A=r(e.playingAsset),I=(A==null?void 0:A.media)||e.primaryMedia;if(I){const C=f==="primary"?I.currentTime:s(v,f,e.playingAsset,"timelinePos","currentTime"),R=d-C,P=(w?C:I.currentTime)+R;if(P>=0&&(!A||w||P<=A.duration)){I.currentTime=P;return}}}if(y){let A=d;if(f!=="primary"){const C=y[f].start,R=d-C;A=y.start+R}const I=!e.isInterstitial(y);if((!e.isInterstitial(v)||v.event.appendInPlace)&&(I||y.event.appendInPlace)){const C=e.media||(w?S==null?void 0:S.media:null);C&&(C.currentTime=A)}else if(v){const C=e.findItemIndex(v);if(x>C){const P=e.schedule.findJumpRestrictedIndex(C+1,x);if(P>C){e.setSchedulePosition(P);return}}let R=0;if(I)e.timelinePos=A,e.checkBuffer();else{const P=y.event.assetList,O=d-(y[f]||y).start;for(let U=P.length;U--;){const j=P[U];if(j.duration&&O>=j.startOffset&&O<j.startOffset+j.duration){R=U;break}}}e.setSchedulePosition(x,R)}}},c=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const f=t();return e.isInterstitial(f)?f:null},u={get bufferedEnd(){const d=t(),f=e.bufferingItem;if(f&&f===d){var m;return s(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((m=e.bufferingAsset)==null?void 0:m.startOffset)||0}return 0},get currentTime(){const d=c(),f=e.effectivePlayingItem;return f&&f===d?s(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=c(),m=e.effectivePlayingItem;m&&m===f&&l(d+m.playout.start,"playout")},get duration(){const d=c();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=(d=c())==null?void 0:d.event.assetList;return f?f.map(m=>e.getAssetPlayer(m.identifier)):[]},get playingIndex(){var d;const f=(d=c())==null?void 0:d.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return c()?u:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return a()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return o("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return o("integrated")},get seekableStart(){var d;return i(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,f=d==null?void 0:d.event;if(f&&!f.restrictions.skip){const m=e.findItemIndex(d);if(f.appendInPlace){const p=d.playout.start+d.event.duration;l(p+.001,"playout")}else e.advanceAfterAssetEnded(f,m,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const i=(t=s)==null?void 0:t.currentTime;if(!(i===void 0||!re(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,s=e.media;if(r&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${rt(i)}`),this.detachedData=i}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var r,s;if(e.media===t)return;let i=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,c=(r=this.detachedData)==null?void 0:r.mediaSource;let u;if(a.media)l&&(i=a.transferMedia(),this.detachedData=i),u="Primary";else if(c){const p=this.getBufferingPlayer();p?(i=p.transferMedia(),u=`${p}`):u="detached MediaSource"}else u="detached media";if(!i){if(c)i=this.detachedData,this.log(`using detachedData: MediaSource ${rt(i)}`);else if(!this.detachedData||a.media===t){const p=this.playerQueue;p.length>1&&p.forEach(g=>{if(o&&g.interstitial.appendInPlace!==l){const v=g.interstitial;this.clearInterstitial(g.interstitial,null),v.appendInPlace=!1,v.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${v}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=i&&"mediaSource"in i&&((s=i.mediaSource)==null?void 0:s.readyState)!=="closed",f=d&&i?i:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const m=this.schedule;if(f===i&&m){const p=o&&e.assetId===m.assetIdAtEnd;f.overrides={duration:m.duration,endOfStream:!o||p,cueRemoval:!o}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,s=this.effectivePlayingItem;if(r===-1){const i=this.hls.startPosition;if(this.log(Iu("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(i>=0||!this.primaryLive){const a=this.timelinePos=i>0?i:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(s&&!this.playingItem){const i=e.findItemIndex(s);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const r=e.event,s=r.findAssetIndex(t),i=mm(r,s);if(!r.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,r){const s=mm(e,r);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const i=this.schedule.items;if(i){const a=t+1,o=i.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(Iu("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const i=e.assetList[s];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const s=t.parentIdentifier,i=r.getEvent(s);if(i){const a=r.findEventIndex(s),o=r.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,a,o-1)}}setSchedulePosition(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(!s||this.playbackDisabled)return;const i=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&ar(i)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const u=a.event,d=this.playingAsset,f=d==null?void 0:d.identifier,m=f?this.getAssetPlayer(f):null;if(m&&f&&(!this.eventItemsMatch(a,i)||t!==void 0&&f!==u.assetList[t].identifier)){var l;const p=u.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${p+1}/${u.assetList.length} ${Pa(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(T.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:p,event:u,schedule:s.slice(0),scheduleIndex:e,player:m}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(u,this.findItemIndex(this.playingItem),p);return}this.retreiveMediaSource(f,i),m.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&m.detachMedia()}if(!this.eventItemsMatch(a,i)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${ar(a)}`),u.hasPlayed=!0,this.hls.trigger(T.INTERSTITIAL_ENDED,{event:u,schedule:s.slice(0),scheduleIndex:e}),u.cue.once)){var c;this.updateSchedule();const p=(c=this.schedule)==null?void 0:c.items;if(i&&p){const g=this.findItemIndex(i);this.advanceSchedule(g,p,t,a,o)}return}}this.advanceSchedule(e,s,t,a,o)}advanceSchedule(e,t,r,s,i){const a=this.schedule;if(!a)return;const o=t[e]||null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(u=>{const d=u.interstitial,f=a.findEventIndex(d.identifier);(f<e||f>e+1)&&this.clearInterstitial(d,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const u=o.event;if(r===void 0){r=a.findAssetIndex(u,this.timelinePos);const p=mm(u,r-1);if(u.isAssetPastPlayoutLimit(p)||u.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(u,e,r);return}r=p}const d=this.waitingItem;this.assetsBuffered(o,l)||this.setBufferingItem(o);let f=this.preloadAssets(u,r);if(this.eventItemsMatch(o,d||s)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${ar(o)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(T.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const m=u.assetList[r];if(!m){this.advanceAfterAssetEnded(u,e,r||0);return}if(f||(f=this.getAssetPlayer(m.identifier)),f===null||f.destroyed){const p=u.assetList.length;this.warn(`asset ${r+1}/${p} player destroyed ${u}`),f=this.createAssetPlayer(u,m,r),f.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(m))return;this.startAssetPlayer(f,r,t,e,l),this.shouldPlay&&yE(f.media)}else o?(this.resumePrimary(o,e,s),this.shouldPlay&&yE(this.hls.media)):i&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var s,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ar(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(Iu("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!r)return;const a=(i=this.schedule)==null?void 0:i.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${ar(e)}`),this.hls.trigger(T.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(r<s.fragmentStart||r>s.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:we.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,s),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(Iu("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((r=s.mainForwardBufferInfo)==null?void 0:r.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(T.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(T.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const s=We(We({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=We(We({},this.altSelection),{},{audio:r});return}const i=We(We({},s),{},{audio:r});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=We(We({},this.altSelection),{},{subtitles:r});return}const i=We(We({},s),{},{subtitles:r});this.mediaSelection=i}onAudioTrackSwitching(e,t){const r=_S(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=_S(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const i=t[s];if(i.cue.post){var r;const a=this.schedule.findEventIndex(i.identifier),o=(r=this.schedule.items)==null?void 0:r[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const s=(r=this.schedule)==null?void 0:r.items;if(e&&s){const i=this.findItemIndex(e,t);return s[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(i.identifier,null)});const r=e.end+.25,s=we.bufferInfo(this.primaryMedia,r,0);(s.end>r||(s.nextStart||0)>r)&&(this.log(`trim buffered interstitial ${ar(e)} (was ${ar(t)})`),this.attachPrimary(r,null,!0),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&((t=this.schedule)==null||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=(t=this.schedule)==null?void 0:t.items;if(!r)return;const s=we.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,r,e)}updateBufferedPos(e,t,r){const s=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const u=this.findItemIndex(i),d=Math.min(u+1,t.length-1),f=t[d];if((l===-1&&i&&e>=i.end||(c=f.event)!=null&&c.appendInPlace&&e+.01>=f.start)&&(l=d),this.isInterstitial(i)){const m=i.event;if(d-o>1&&m.appendInPlace===!1||m.assetList.length===0&&m.assetListLoader)return}if(this.bufferedPos=e,l>u&&l>o)this.bufferedToItem(f);else{const m=this.primaryDetails;this.primaryLive&&m&&e>m.edge-m.targetduration&&f.start<m.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else r&&a&&!this.itemsMatch(a,i)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const i=this.getAssetPlayer(s.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:s,events:i}=r;if(!s||!i)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${ar(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const c=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((u,d)=>{const f=this.getAssetPlayer(u.identifier);f&&(d===c&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(T.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,s=r.assetList.length===0&&!r.assetListLoader,i=r.cue.once;if(s||!i){const a=this.preloadAssets(r,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const r=e.assetUrl,s=e.assetList.length,i=s===0&&!e.assetListLoader,a=e.cue.once;if(i){const l=e.timelineStart;if(e.appendInPlace){var o;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(o=f.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,u===-1&&(u=this.hls.liveSyncPosition||0)),u&&!(e.cue.pre||e.cue.post)){const f=u-l;f>0&&(c=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:s} ${e}${c?` live-start: ${u} start-offset: ${c}`:""}`),r)return this.createAsset(e,0,0,l,e.duration,r);const d=this.assetListLoader.loadAssetList(e,c);d&&(e.assetListLoader=d)}else if(!a&&s){for(let c=t;c<s;c++){const u=e.assetList[c],d=this.getAssetPlayerQueueIndex(u.identifier);(d===-1||this.playerQueue[d].destroyed)&&!u.error&&this.createAssetPlayer(e,u,c)}const l=e.assetList[t];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(T.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,s,i,a){const o={parentIdentifier:e.identifier,identifier:BG(e,a,t),duration:i,startOffset:r,timelineStart:s,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,r){const s=this.hls,i=s.userConfig;let a=i.videoPreference;const o=s.loadLevelObj||s.levels[s.currentLevel];(a||o)&&(a=Ze({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=s.audioTracks[s.audioTrack],c=s.subtitleTracks[s.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const b=this.timelinePos-t.timelineStart;if(b>1){const w=t.duration;w&&b<w&&(u=b)}}const d=t.identifier,f=We(We({},i),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||i.audioPreference,subtitlePreference:c||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const m=f.cmcd;m!=null&&m.sessionId&&m.contentId&&(f.cmcd=Ze({},m,{contentId:Fl(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const p=new KG(this.HlsPlayerClass,f,e,t);this.playerQueue.push(p),e.assetList[r]=t;let g=!0;const v=b=>{if(b.live){var w;const I=new Error(`Interstitials MUST be VOD assets ${e}`),C={fatal:!0,type:fe.OTHER_ERROR,details:F.INTERSTITIAL_ASSET_ITEM_ERROR,error:I},R=((w=this.schedule)==null?void 0:w.findEventIndex(e.identifier))||-1;this.handleAssetItemError(C,e,R,r,I.message);return}const _=b.edge-b.fragmentStart,A=t.duration;(g||A===null||_>A)&&(g=!1,this.log(`Interstitial asset "${d}" duration change ${A} > ${_}`),t.duration=_,this.updateSchedule())};p.on(T.LEVEL_UPDATED,(b,{details:w})=>v(w)),p.on(T.LEVEL_PTS_UPDATED,(b,{details:w})=>v(w)),p.on(T.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const x=(b,w)=>{const _=this.getAssetPlayer(d);if(_&&w.tracks){_.off(T.BUFFER_CODECS,x),_.tracks=w.tracks;const A=this.primaryMedia;this.bufferingAsset===_.assetItem&&A&&!_.media&&this.bufferAssetPlayer(_,A)}};p.on(T.BUFFER_CODECS,x);const y=()=>{var b;const w=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${w}`),!w||!this.schedule)return;const _=this.schedule.findEventIndex(e.identifier),A=(b=this.schedule.items)==null?void 0:b[_];this.isInterstitial(A)&&this.advanceAssetBuffering(A,t)};p.on(T.BUFFERED_TO_END,y);const S=b=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const _=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,_,b)};return p.once(T.MEDIA_ENDED,S(r)),p.once(T.PLAYOUT_LIMIT_REACHED,S(1/0)),p.on(T.ERROR,(b,w)=>{if(!this.schedule)return;const _=this.getAssetPlayer(d);if(w.details===F.BUFFER_STALLED_ERROR){if(_!=null&&_.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(w,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${w.error} ${e}`)}),p.on(T.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const w=new Error(`Asset player destroyed unexpectedly ${d}`),_={fatal:!0,type:fe.OTHER_ERROR,details:F.INTERSTITIAL_ASSET_ITEM_ERROR,error:w};this.handleAssetItemError(_,e,this.schedule.findEventIndex(e.identifier),r,w.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Pa(t)}`),this.hls.trigger(T.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:p}),p}clearInterstitial(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){const s=this.playerQueue[r];this.log(`clear ${s} toSegment: ${t&&ar(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(r,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,s,i){const{interstitial:a,assetItem:o,assetId:l}=e,c=a.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,r[s]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${Pa(o)}`),this.hls.trigger(T.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:r.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var r,s;if(!this.schedule)return;const{interstitial:i,assetItem:a}=e,o=this.schedule.findEventIndex(i.identifier),l=(r=this.schedule.items)==null?void 0:r[o];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=a;const c=this.getBufferingPlayer();if(c===e)return;const u=i.appendInPlace;if(u&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const d=(c==null?void 0:c.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(u&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!i1(d,e.tracks)){const f=new Error(`Asset ${Pa(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),m={fatal:!0,type:fe.OTHER_ERROR,details:F.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},p=i.findAssetIndex(a);this.handleAssetItemError(m,i,o,p,f.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const s=r.currentTime,i=t.findAssetIndex(e,s),a=e.assetList[i];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const l=o.currentTime||s-a.timelineStart,c=o.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${o} ${e} (media.currentTime: ${s})`),l&&(c/r.playbackRate<.5||o.bufferedInPlaceToEnd(r))&&o.hls){const u=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,u,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,s,i){if(e.details===F.BUFFER_STALLED_ERROR)return;const a=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&Pa(a)} ${e.error}`),!this.schedule)return;const o=(a==null?void 0:a.identifier)||"",l=this.getAssetPlayerQueueIndex(o),c=this.playerQueue[l]||null,u=this.schedule.items,d=Ze({},e,{fatal:!1,errorAction:io(!0),asset:a,assetListIndex:s,event:t,schedule:u,scheduleIndex:r,player:c});if(this.hls.trigger(T.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const f=this.playingAsset,m=this.bufferingAsset,p=new Error(i);if(a&&(this.clearAssetPlayer(o,null),a.error=p),!t.assetList.some(g=>!g.error))t.error=p;else for(let g=s;g<t.assetList.length;g++)this.resetAssetPlayer(t.assetList[g].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===o?this.advanceAfterAssetEnded(t,r,s):m&&m.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,m)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${ar(r)} error: ${e.error}`);let s=this.timelinePos;s===-1&&(s=this.hls.startPosition);const i=this.updateItem(r,s);if(this.itemsMatch(r,i)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const a=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var r,s;const i=t.event,a=i.identifier,o=t.assetListResponse.ASSETS;if(!((r=this.schedule)!=null&&r.hasEvent(a)))return;const l=i.timelineStart,c=i.duration;let u=0;o.forEach((g,v)=>{const x=parseFloat(g.DURATION);this.createAsset(i,v,u,l+u,x,g.URI),u+=x}),i.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${c}) ${i}`);const d=this.waitingItem,f=(d==null?void 0:d.event.identifier)===a;this.updateSchedule();const m=(s=this.bufferingItem)==null?void 0:s.event;if(f){var p;const g=this.schedule.findEventIndex(a),v=(p=this.schedule.items)==null?void 0:p[g];if(v){if(!this.playingItem&&this.timelinePos>v.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==g){i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(v)}this.setSchedulePosition(g)}else if((m==null?void 0:m.identifier)===a){const g=i.assetList[0];if(g){const v=this.getAssetPlayer(g.identifier);if(m.appendInPlace){const x=this.primaryMedia;v&&x&&this.bufferAssetPlayer(v,x)}else v&&v.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case F.ASSET_LIST_PARSING_ERROR:case F.ASSET_LIST_LOAD_ERROR:case F.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&(this.updateSchedule(!0),this.primaryFallback(r));break}case F.BUFFER_STALLED_ERROR:{const r=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&r.event.appendInPlace){this.handleInPlaceStall(r.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const vE=500;class YG extends Cy{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",oe.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(T.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(T.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(T.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(T.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(T.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=z.IDLE,this.setInterval(vE),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(this.fragContextChanged(r)||(wt(r)&&(this.fragPrevious=r),this.state=z.IDLE),!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let a;const o=r.start;for(let c=0;c<i.length;c++)if(o>=i[c].start&&o<=i[c].end){a=i[c];break}const l=r.start+r.duration;a?a.end=l:(a={start:o,end:l},i.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(r===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=i){a.shift();continue}else if(a[o].start<i)a[o].start=i;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(r,i,oe.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===oe.SUBTITLE&&(t.details===F.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==z.STOPPED&&(this.state=z.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&lC(this.levels,t)){this.levels=t.map(r=>new Tc(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const s=new Tc(r);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,oe.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==z.STOPPED&&this.setInterval(vE)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:s,levels:i}=this,{details:a,id:o}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=i[o];if(o>=i.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(a.live||(r=l.details)!=null&&r.live){if(a.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const f=d.fragments[0];if(!l.details)a.hasProgramDateTime&&d.hasProgramDateTime?(of(a,d),c=a.fragmentStart):f&&(c=f.start,og(a,c));else{var u;c=this.alignPlaylists(a,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),c===0&&f&&(c=f.start,og(a,c))}d&&!this.startFragRequested&&this.setStartPosition(d,c)}l.details=a,this.levelLastLoaded=l,o===s&&(this.hls.trigger(T.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===z.IDLE&&(ma(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&s!=null&&s.key&&s.iv&&ao(s.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer,Iy(s.method)).catch(o=>{throw i.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();i.trigger(T.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=z.IDLE})}}doTick(){if(!this.media){this.state=z.IDLE;return}if(this.state===z.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:s}=this,i=this.getLoadPosition(),a=we.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:o,len:l}=a,c=r.details,u=this.hls.maxBufferLength+c.levelTargetDuration;if(l>u)return;const d=c.fragments,f=d.length,m=c.edge;let p=null;const g=this.fragPrevious;if(o<m){const y=s.maxFragLookUpTolerance,S=o>m-y?0:y;p=ma(g,d,Math.max(d[0].start,o),S),!p&&g&&g.start<d[0].start&&(p=d[0])}else p=d[f-1];if(p=this.filterReplacedPrimary(p,r.details),!p)return;const v=p.sn-c.startSN,x=d[v-1];if(x&&x.cc===p.cc&&this.fragmentTracker.getState(x)===kt.NOT_LOADED&&(p=x),this.fragmentTracker.getState(p)===kt.NOT_LOADED){const y=this.mapToInitFragWhenRequired(p);y&&this.loadFragment(y,r,o)}}}loadFragment(e,t,r){wt(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new qG(this.tracksBuffered[this.currentTrackId]||[])}}class qG{constructor(e){this.buffered=void 0;const t=(r,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const QG={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},wC=n=>String.fromCharCode(QG[n]||n),lr=15,ls=100,XG={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},ZG={17:2,18:4,21:6,22:8,23:10,19:13,20:15},JG={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},e8={25:2,26:4,29:6,30:8,31:10,27:13,28:15},t8=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class n8{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;Ye.log(`${this.time} [${e}] ${r}`)}}}const Ni=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class AC{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class r8{constructor(){this.uchar=" ",this.penState=new AC}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class s8{constructor(e){this.chars=[],this.pos=0,this.currPenState=new AC,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<ls;t++)this.chars.push(new r8);this.logger=e}equals(e){for(let t=0;t<ls;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<ls;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<ls;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ls&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ls)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=wC(e);if(this.pos>=ls){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<ls;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<ls;r++){const s=this.chars[r].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class pm{constructor(e){this.rows=[],this.currRow=lr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<lr;t++)this.rows.push(new s8(e));this.logger=e}reset(){for(let e=0;e<lr;e++)this.rows[e].clear();this.currRow=lr-1}equals(e){let t=!0;for(let r=0;r<lr;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<lr;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<lr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+rt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<lr;o++)this.rows[o].clear();const i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[i].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[i+c])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,a=Math.max(i-1,0);r.setCursor(e.indent),e.color=r.chars[a].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+rt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let i=0;i<lr;i++){const a=this.rows[i].getTextString();a&&(s=i+1,e?t.push("Row "+s+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class xE{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new pm(r),this.nonDisplayedMemory=new pm(r),this.lastOutputScreen=new pm(r),this.currRollUpRow=this.displayedMemory.rows[lr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[lr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[r]}this.logger.log(2,"MIDROW: "+rt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class SE{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=a8(),this.logger=void 0;const s=this.logger=new n8;this.channels=[null,new xE(e,t,s),new xE(e+1,r,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const s=t[r]&127,i=t[r+1]&127;let a=!1,o=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+Ni([t[r],t[r+1]])+"] -> ("+Ni([s,i])+")");const l=this.cmdHistory;if(s>=16&&s<=31){if(i8(s,i,l)){Ru(null,null,l),this.logger.log(3,()=>"Repeated command ("+Ni([s,i])+") is dropped");continue}Ru(s,i,this.cmdHistory),a=this.parseCmd(s,i),a||(a=this.parseMidrow(s,i)),a||(a=this.parsePAC(s,i)),a||(a=this.parseBackgroundAttributes(s,i))}else Ru(null,null,l);if(!a&&(o=this.parseChars(s,i),o)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ni([s,i])+" orig: "+Ni([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(r||s))return!1;const i=e===20||e===21||e===23?1:2,a=this.channels[i];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ni([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const a=e<=23?1:2;t>=64&&t<=95?r=a===1?XG[e]:JG[e]:r=a===1?ZG[e]:e8[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(r,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,s.underline=(r&1)===1,r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((r-16)/2)*4,s}parseChars(e,t){let r,s=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let a;i===17?a=t+80:i===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+wC(a)+"' in channel "+r),s=[a]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Ni(s).join(",")),s}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(r||s))return!1;let i;const a={};e===16||e===24?(i=Math.floor((t-32)/2),a.background=t8[i],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Ru(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Ru(n,e,t){t.a=n,t.b=e}function i8(n,e,t){return t.a===n&&t.b===e}function a8(){return{a:null,b:null}}var By=function(){if(af!=null&&af.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const c=l.toLowerCase();return~o.indexOf(c)?c:!1}function r(o){return t(n,o)}function s(o){return t(e,o)}function i(o,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const d in u)o[d]=u[d]}return o}function a(o,l,c){const u=this,d={enumerable:!0};u.hasBeenReset=!1;let f="",m=!1,p=o,g=l,v=c,x=null,y="",S=!0,b="auto",w="start",_=50,A="middle",I=50,C="middle";Object.defineProperty(u,"id",i({},d,{get:function(){return f},set:function(R){f=""+R}})),Object.defineProperty(u,"pauseOnExit",i({},d,{get:function(){return m},set:function(R){m=!!R}})),Object.defineProperty(u,"startTime",i({},d,{get:function(){return p},set:function(R){if(typeof R!="number")throw new TypeError("Start time must be set to a number.");p=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",i({},d,{get:function(){return g},set:function(R){if(typeof R!="number")throw new TypeError("End time must be set to a number.");g=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",i({},d,{get:function(){return v},set:function(R){v=""+R,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",i({},d,{get:function(){return x},set:function(R){x=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",i({},d,{get:function(){return y},set:function(R){const P=r(R);if(P===!1)throw new SyntaxError("An invalid or illegal string was specified.");y=P,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",i({},d,{get:function(){return S},set:function(R){S=!!R,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",i({},d,{get:function(){return b},set:function(R){if(typeof R!="number"&&R!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");b=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",i({},d,{get:function(){return w},set:function(R){const P=s(R);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");w=P,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",i({},d,{get:function(){return _},set:function(R){if(R<0||R>100)throw new Error("Position must be between 0 and 100.");_=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",i({},d,{get:function(){return A},set:function(R){const P=s(R);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");A=P,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",i({},d,{get:function(){return I},set:function(R){if(R<0||R>100)throw new Error("Size must be between 0 and 100.");I=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",i({},d,{get:function(){return C},set:function(R){const P=s(R);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");C=P,this.hasBeenReset=!0}})),u.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class o8{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function _C(n){function e(r,s,i,a){return(r|0)*3600+(s|0)*60+(i|0)+parseFloat(a||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class l8{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function IC(n,e,t,r){const s=r?n.split(r):[n];for(const i in s){if(typeof s[i]!="string")continue;const a=s[i].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const pg=new By(0,0,""),Cu=pg.align==="middle"?"middle":"center";function c8(n,e,t){const r=n;function s(){const o=_C(n);if(o===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),o}function i(o,l){const c=new l8;IC(o,function(f,m){let p;switch(f){case"region":for(let g=t.length-1;g>=0;g--)if(t[g].id===m){c.set(f,t[g].region);break}break;case"vertical":c.alt(f,m,["rl","lr"]);break;case"line":p=m.split(","),c.integer(f,p[0]),c.percent(f,p[0])&&c.set("snapToLines",!1),c.alt(f,p[0],["auto"]),p.length===2&&c.alt("lineAlign",p[1],["start",Cu,"end"]);break;case"position":p=m.split(","),c.percent(f,p[0]),p.length===2&&c.alt("positionAlign",p[1],["start",Cu,"end","line-left","line-right","auto"]);break;case"size":c.percent(f,m);break;case"align":c.alt(f,m,["start",Cu,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&pg.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",Cu);let d=c.get("position","auto");d==="auto"&&pg.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function a(){n=n.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),a(),e.endTime=s(),a(),i(n,e)}function RC(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class u8{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new o8,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let i=t.buffer,a=0;for(i=RC(i);a<i.length&&i[a]!=="\r"&&i[a]!==`
`;)++a;const o=i.slice(0,a);return i[a]==="\r"&&++a,i[a]===`
`&&++a,t.buffer=i.slice(a),o}function s(i){IC(i,function(a,o){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=r();const o=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:i=r(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new By(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{c8(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=i.indexOf("-->")!==-1;if(!i||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const d8=/\r\n|\n\r|\n|\r/g,gm=function(e,t,r=0){return e.slice(r,r+t.length)===t},f8=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!re(t)||!re(r)||!re(s)||!re(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*s,t+=60*60*1e3*i,t};function Vy(n,e,t){return Fl(n.toString())+Fl(e.toString())+Fl(t)}const h8=function(e,t,r){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(a=i)!=null&&a.new;){var a;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=r};function m8(n,e,t,r,s,i,a){const o=new u8,l=Un(new Uint8Array(n)).trim().replace(d8,`
`).split(`
`),c=[],u=e?SV(e.baseTime,e.timescale):0;let d="00:00.000",f=0,m=0,p,g=!0;o.oncue=function(v){const x=t[r];let y=t.ccOffset;const S=(f-u)/9e4;if(x!=null&&x.new&&(m!==void 0?y=t.ccOffset=x.start:h8(t,r,S)),S){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}y=S-t.presentationOffset}const b=v.endTime-v.startTime,w=Dn((v.startTime+y-m)*9e4,s*9e4)/9e4;v.startTime=Math.max(w,0),v.endTime=Math.max(w+b,0);const _=v.text.trim();v.text=decodeURIComponent(encodeURIComponent(_)),v.id||(v.id=Vy(v.startTime,v.endTime,_)),v.endTime>0&&c.push(v)},o.onparsingerror=function(v){p=v},o.onflush=function(){if(p){a(p);return}i(c)},l.forEach(v=>{if(g)if(gm(v,"X-TIMESTAMP-MAP=")){g=!1,v.slice(16).split(",").forEach(x=>{gm(x,"LOCAL:")?d=x.slice(6):gm(x,"MPEGTS:")&&(f=parseInt(x.slice(7)))});try{m=f8(d)/1e3}catch(x){p=x}return}else v===""&&(g=!1);o.parse(v+`
`)}),o.flush()}const ym="stpp.ttml.im1t",CC=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,LC=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,p8={left:"start",center:"center",right:"end",start:"start",end:"end"};function EE(n,e,t,r){const s=Me(new Uint8Array(n),["mdat"]);if(s.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(o=>Un(o)),a=xV(e.baseTime,1,e.timescale);try{i.forEach(o=>t(g8(o,a)))}catch(o){r(o)}}function g8(n,e){const s=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(i).reduce((d,f)=>(d[f]=s.getAttribute(`ttp:${f}`)||i[f],d),{}),o=s.getAttribute("xml:space")!=="preserve",l=TE(vm(s,"styling","style")),c=TE(vm(s,"layout","region")),u=vm(s,"body","[begin]");return[].map.call(u,d=>{const f=kC(d,o);if(!f||!d.hasAttribute("begin"))return null;const m=Sm(d.getAttribute("begin"),a),p=Sm(d.getAttribute("dur"),a);let g=Sm(d.getAttribute("end"),a);if(m===null)throw bE(d);if(g===null){if(p===null)throw bE(d);g=m+p}const v=new By(m-e,g-e,f);v.id=Vy(v.startTime,v.endTime,v.text);const x=c[d.getAttribute("region")],y=l[d.getAttribute("style")],S=y8(x,y,l),{textAlign:b}=S;if(b){const w=p8[b];w&&(v.lineAlign=w),v.align=b}return Ze(v,S),v}).filter(d=>d!==null)}function vm(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function TE(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function kC(n,e){return[].slice.call(n.childNodes).reduce((t,r,s)=>{var i;return r.nodeName==="br"&&s?t+`
`:(i=r.childNodes)!=null&&i.length?kC(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function y8(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(s=t[a]),i.reduce((o,l)=>{const c=xm(e,r,l)||xm(n,r,l)||xm(s,r,l);return c&&(o[l]=c),o},{})}function xm(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function bE(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Sm(n,e){if(!n)return null;let t=_C(n);return t===null&&(CC.test(n)?t=v8(n,e):LC.test(n)&&(t=x8(n,e))),t}function v8(n,e){const t=CC.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function x8(n,e){const t=LC.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Lu{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class S8{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=AE(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(T.FRAG_LOADING,this.onFragLoading,this),e.on(T.FRAG_LOADED,this.onFragLoaded,this),e.on(T.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(T.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(T.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(T.FRAG_LOADING,this.onFragLoading,this),e.off(T.FRAG_LOADED,this.onFragLoaded,this),e.off(T.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(T.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(T.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(T.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Lu(this,"textTrack1"),t=new Lu(this,"textTrack2"),r=new Lu(this,"textTrack3"),s=new Lu(this,"textTrack4");this.cea608Parser1=new SE(1,e,t),this.cea608Parser2=new SE(3,r,s)}addCues(e,t,r,s,i){let a=!1;for(let o=i.length;o--;){const l=i[o],c=E8(l[0],l[1],t,r);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),a=!0,c/(r-t)>.5))return}if(a||i.push([t,r]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,r,s)}else{const o=this.Cues.newCue(null,t,r,s);this.hls.trigger(T.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:i,trackId:a}){const{unparsedVttFrags:o}=this;r===oe.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:i,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(T.FRAG_LOADED,l):this.hls.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let s=0;s<r.textTracks.length;s++){const i=r.textTracks[s];if(wE(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:i,languageCode:a}=t[e],o=this.getExistingTrack(i,a);if(o)r[e]=o,Wa(r[e]),EC(r[e],s);else{const l=this.createTextTrack("captions",i,a);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,s={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(T.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:s}=this;Object.keys(s).forEach(i=>{Wa(s[i]),delete s[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=AE(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Wa(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(i=>i.textCodec===ym);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(lC(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const a=this.media,o=a?sd(a.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(o){let d=null;for(let f=0;f<o.length;f++)if(o[f]&&wE(o[f],l)){d=o[f],o[f]=null;break}d&&(u=d)}if(u)Wa(u);else{const d=DC(l);u=this.createTextTrack(d,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),o!=null&&o.length){const l=o.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(T.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const s=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!s)return;const i=`textTrack${s[1]}`,a=this.captionsProperties[i];a&&(a.label=r.name,r.lang&&(a.languageCode=r.lang),a.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===oe.MAIN){var r,s;const{cea608Parser1:i,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:c}=t.frag,u=(r=(s=t.part)==null?void 0:s.index)!=null?r:-1;i&&a&&(c!==o+1||c===o&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(i.reset(),a.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if(r.type===oe.SUBTITLE)if(s.byteLength){const i=r.decryptdata,a="stats"in t;if(i==null||!i.encrypted||a){const o=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),o&&o.textCodec===ym?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;EE(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),r.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{r.logger.log(`Failed to parse IMSC1: ${s}`),r.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:i,unparsedVttFrags:a}=this,o=i.length-1;if(!i[r.cc]&&o===-1){a.push(e);return}const l=this.hls,c=(t=r.initSegment)!=null&&t.data?nr(r.initSegment.data,new Uint8Array(s)).buffer:s;m8(c,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,u=>{this._appendCues(u,r.level),l.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},u=>{const d=u.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(r,s),l.logger.log(`Failed to parse VTT cue: ${u}`),!(d&&o>r.cc)&&l.trigger(T.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:u})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||EE(t,this.initPTS[e.cc],()=>{r.textCodec=ym,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>TC(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;r.trigger(T.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===oe.SUBTITLE&&this.onFragLoaded(T.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:s}=t;if(!(r.type===oe.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let i=0;i<s.length;i++){const a=s[i].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(s[i].pts,o[0]),this.cea608Parser2.addData(s[i].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:i}){const{media:a}=this;if(!(!a||a.currentTime<r)){if(!i||i==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>mg(o[l],t,r))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>mg(o[l],t,s))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let s=2;for(let i=0;i<r;i++){const a=e[s++],o=127&e[s++],l=127&e[s++];if(o===0&&l===0)continue;if((4&a)!==0){const u=3&a;(u===0||u===1)&&(t[u].push(o),t[u].push(l))}}return t}}function DC(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function wE(n,e){return!!n&&n.kind===DC(e)&&ug(e,n)}function E8(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function AE(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const T8=/\s/,b8={newCue(n,e,t,r){const s=[];let i,a,o,l,c;const u=self.VTTCue||self.TextTrackCue;for(let f=0;f<r.rows.length;f++)if(i=r.rows[f],o=!0,l=0,c="",!i.isEmpty()){var d;for(let g=0;g<i.chars.length;g++)T8.test(i.chars[g].uchar)&&o?l++:(c+=i.chars[g].uchar,o=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const m=RC(c.trim()),p=Vy(e,t,m);n!=null&&(d=n.cues)!=null&&d.getCueById(p)||(a=new u(e,t,m),a.id=p,a.line=f+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(a))}return n&&s.length&&(s.sort((f,m)=>f.line==="auto"||m.line==="auto"?0:f.line>8&&m.line>8?m.line-f.line:f.line-m.line),s.forEach(f=>TC(n,f))),s}};function w8(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const A8=/(\d+)-(\d+)\/(\d+)/;class _E{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||C8,this.controller=new self.AbortController,this.stats=new Sy}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=_8(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&re(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(Ac(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const m=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},c-(m-s.loading.start)),!d.ok){const{status:g,statusText:v}=d;throw new L8(v||"fetch, bad network response",g,d)}s.loading.first=m,s.total=R8(d.headers)||s.total;const p=(f=this.callbacks)==null?void 0:f.onProgress;return p&&re(t.highWaterMark)?this.loadProgressively(d,s,e,t.highWaterMark,p):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var f,m;const p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const g=d[o];g&&(s.loaded=s.total=g);const v={url:p.url,data:d,code:p.status},x=(f=this.callbacks)==null?void 0:f.onProgress;x&&!re(t.highWaterMark)&&x(s,e,d,p),(m=this.callbacks)==null||m.onSuccess(v,s,e,p)}).catch(d=>{var f;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const m=d&&d.code||0,p=d?d.message:null;(f=this.callbacks)==null||f.onError({code:m,text:p},e,d?d.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,i){const a=new V1,o=e.body.getReader(),l=()=>o.read().then(c=>{if(c.done)return a.dataLength&&i(t,r,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const u=c.value,d=u.length;return t.loaded+=d,d<s||a.dataLength?(a.push(u),a.dataLength>=s&&i(t,r,a.flush().buffer,e)):i(t,r,u.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function _8(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ze({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function I8(n){const e=A8.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function R8(n){const e=n.get("Content-Range");if(e){const r=I8(e);if(re(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function C8(n,e){return new self.Request(n.url,e)}class L8 extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const k8=/^age:\s*[\d.]+\s*$/im;class PC{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Sy,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return i(r,t.url)}).catch(a=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),i(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:r.status,text:a.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:a}=r.loadPolicy;if(s)for(const o in s)e.setRequestHeader(o,s[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&re(i)?i:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!r.aborted&&s>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,u=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const p=u??t.response;if(p!=null){var a,o;r.loading.end=Math.max(self.performance.now(),r.loading.first);const g=t.responseType==="arraybuffer"?p.byteLength:p.length;r.loaded=r.total=g,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const v=(a=this.callbacks)==null?void 0:a.onProgress;v&&v(r,e,p,t);const x={url:t.responseURL,data:p,code:c};(o=this.callbacks)==null||o.onSuccess(x,r,e,t);return}}const d=i.loadPolicy.errorRetry,f=r.retry,m={url:e.url,data:void 0,code:c};if(rf(d,f,!1,m))this.retry(d);else{var l;Ye.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(rf(e,t,!0))this.retry(e);else{var r;Ye.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=wy(e,r.retry),r.retry++,Ye.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&k8.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const D8={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},P8=We(We({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:PC,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:H3,bufferController:OV,capLevelController:jy,errorController:Q3,fpsController:MG,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:k1,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:D8},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},N8()),{},{subtitleStreamController:YG,subtitleTrackController:$G,timelineController:S8,audioStreamController:kV,audioTrackController:DV,emeController:oo,cmcdController:DG,contentSteeringController:NG,interstitialsController:WG});function N8(){return{cueHandler:b8,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function O8(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=gg(n),s=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,c=[];i.forEach(u=>{const d=`${a}Loading${u}`,f=e[d];if(f!==void 0&&l){c.push(d);const m=r[o].default;switch(e[o]={default:m},u){case"TimeOut":m.maxLoadTimeMs=f,m.maxTimeToFirstByteMs=f;break;case"MaxRetry":m.errorRetry.maxNumRetry=f,m.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":m.errorRetry.retryDelayMs=f,m.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":m.errorRetry.maxRetryDelayMs=f,m.timeoutRetry.maxRetryDelayMs=f;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${o}": ${rt(e[o])}`)}),We(We({},r),e)}function gg(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(gg):Object.keys(n).reduce((e,t)=>(e[t]=gg(n[t]),e),{}):n}function M8(n,e){const t=n.loader;t!==_E&&t!==PC?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):w8()&&(n.loader=_E,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const id=2,F8=.1,j8=.05,$8=100;class U8 extends _1{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(T.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval($8),this.mediaSource=t.mediaSource;const r=this.media=t.media;un(r,"playing",this.onMediaPlaying),un(r,"waiting",this.onMediaWaiting),un(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(wn(r,"playing",this.onMediaPlaying),wn(r,"waiting",this.onMediaWaiting),wn(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,s;const i=(r=this.hls)==null?void 0:r.config;if(!i)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,c=!this.seeking&&o,u=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(T.MEDIA_ENDED,{stalled:!1}));return}if(!we.getBuffered(a).length){this.nudgeRetry=0;return}const d=we.bufferInfo(a,e,0),f=d.nextStart||0,m=this.fragmentTracker;if(o&&m&&this.hls){const _=IE(this.hls.inFlightFragments,e),A=d.len>id,I=!f||_||f-e>id&&!m.getPartialFragment(e);if(A||I)return;this.moved=!1}const p=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&m){if(!(d.len>0)&&!f)return;const A=Math.max(f,d.start||0)-e,C=!!(p!=null&&p.live)?p.targetduration*2:id,R=ku(e,m);if(A>0&&(A<=C||R)){a.paused||this._trySkipBufferHole(R);return}}const g=i.detectStallWithCurrentTimeMs,v=self.performance.now(),x=this.waiting;let y=this.stalled;if(y===null)if(x>0&&v-x<g)y=this.stalled=x;else{this.stalled=v;return}const S=v-y;if(!o&&(S>=g||x)&&this.hls){var b;if(((b=this.mediaSource)==null?void 0:b.readyState)==="ended"&&!(p!=null&&p.live)&&Math.abs(e-((p==null?void 0:p.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(T.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const w=we.bufferInfo(a,e,i.maxBufferHole);this._tryFixBufferStall(w,S,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(T.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&s&&s.length>1&&e>s.end(0)){const i=we.bufferedInfo(we.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const a=we.timeRangesToArray(s),o=we.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=we.bufferedInfo(a,e,0).bufferedIndex,c=a[o].end,u=a[o+1].start;if((l===-1||l>o)&&u-c<1&&e-c<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${u} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let f=ku(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const m=we.bufferInfo(this.media,e,0);this.hls.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:m.len,bufferInfo:m})}}}}}_tryFixBufferStall(e,t,r){var s,i;const{fragmentTracker:a,media:o}=this,l=(s=this.hls)==null?void 0:s.config;if(!o||!a||!l)return;const c=(i=this.hls)==null?void 0:i.latestLevelDetails,u=ku(r,a);if((u||c!=null&&c.live&&r<c.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const d=e.buffered,f=this.adjacentTraversal(e,r);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-r<l.maxBufferHole||f))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,s=e.nextStart;if(r&&s){const i=r.getFragAtPos(t,oe.MAIN),a=r.getFragAtPos(s,oe.MAIN);if(i&&a)return a.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:s,stalled:i}=this;if(!s&&i!==null&&r&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${rt(e)})`);this.warn(a.message),t.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:s}=this,i=(t=this.hls)==null?void 0:t.config;if(!s||!r||!i)return 0;const a=s.currentTime,o=we.bufferInfo(s,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const u=o.len<=i.maxBufferHole,d=o.len>0&&o.len<1&&s.readyState<3,f=l-a;if(f>0&&(u||d)){if(f>i.maxBufferHole){let p=!1;if(a===0){const g=r.getAppendedFrag(0,oe.MAIN);g&&l<g.end&&(p=!0)}if(!p&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||IE(this.hls.inFlightFragments,l))return 0;let v=!1,x=e.end;for(;x<l;){const y=ku(x,r);if(y)x+=y.duration;else{v=!0;break}}if(v)return 0}}const m=Math.max(l+j8,a+F8);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${m}`),this.moved=!0,s.currentTime=m,!(e!=null&&e.gap)){const p=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${m}`),g={type:fe.MEDIA_ERROR,details:F.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?g.part=e:g.frag=e),this.hls.trigger(T.ERROR,g)}return m}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:s}=this,i=t==null?void 0:t.config;if(!r||!i)return 0;const a=r.currentTime;if(this.nudgeRetry++,s<i.nudgeMaxRetry){const o=a+(s+1)*i.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),r.currentTime=o,t.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${i.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function IE(n,e){const t=RE(n.main);if(t&&t.start<=e)return t;const r=RE(n.audio);return r&&r.start<=e?r:null}function RE(n){if(!n)return null;switch(n.state){case z.IDLE:case z.STOPPED:case z.ENDED:case z.ERROR:return null}return n.frag}function ku(n,e){return e.getAppendedFrag(n,oe.MAIN)||e.getPartialFragment(n)}const B8=.25;function yg(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Em(n,e,t,r,s){let i=new n(e,t,"");try{i.value=r,s&&(i.type=s)}catch{i=new n(e,t,rt(s?We({type:s},r):r))}return i}const Du=(()=>{const n=yg();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class V8{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(T.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(T.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(T.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Wa(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return EC(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:s}=this.hls.config;if(!r&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=yg();if(a)for(let o=0;o<i.length;o++){const l=i[o].type;if(l===On.emsg&&!r||!s)continue;const c=q1(i[o].data),u=i[o].pts;let d=u+i[o].duration;d>Du&&(d=Du),d-u<=0&&(d=u+B8);for(let m=0;m<c.length;m++){const p=c[m];if(!Q1(p)){this.updateId3CueEnds(u,l);const g=Em(a,u,d,p,l);g&&this.id3Track.addCue(g)}}}}updateId3CueEnds(e,t){var r;const s=(r=this.id3Track)==null?void 0:r.cues;if(s)for(let i=s.length;i--;){const a=s[i];a.type===t&&a.startTime<e&&a.endTime===Du&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:i,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(i&&(o||l)){let c;s==="audio"?c=u=>u.type===On.audioId3&&l:s==="video"?c=u=>u.type===On.emsg&&o:c=u=>u.type===On.audioId3&&l||u.type===On.emsg&&o,mg(i,t,r,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:s,enableDateRangeMetadataCues:i,interstitialsController:a}=this.hls.config;if(!i)return;const o=yg();if(r&&s&&!a){const{fragmentStart:g,fragmentEnd:v}=e;let x=this.assetCue;x?(x.startTime=g,x.endTime=v):o&&(x=this.assetCue=Em(o,g,v,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),x&&(x.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(x),x.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,u=Object.keys(c);let d=this.dateRangeCuesAppended;if(l&&t){var f;if((f=l.cues)!=null&&f.length){const g=Object.keys(d).filter(v=>!u.includes(v));for(let v=g.length;v--;){var m;const x=g[v],y=(m=d[x])==null?void 0:m.cues;delete d[x],y&&Object.keys(y).forEach(S=>{const b=y[S];if(b){b.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(b)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const p=e.fragments[e.fragments.length-1];if(!(u.length===0||!re(p==null?void 0:p.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let g=0;g<u.length;g++){const v=u[g],x=c[v],y=x.startTime,S=d[v],b=(S==null?void 0:S.cues)||{};let w=(S==null?void 0:S.durationKnown)||!1,_=Du;const{duration:A,endDate:I}=x;if(I&&A!==null)_=y+A,w=!0;else if(x.endOnNext&&!w){const R=u.reduce((P,O)=>{if(O!==x.id){const U=c[O];if(U.class===x.class&&U.startDate>x.startDate&&(!P||x.startDate<P.startDate))return U}return P},null);R&&(_=R.startTime,w=!0)}const C=Object.keys(x.attr);for(let R=0;R<C.length;R++){const P=C[R];if(!c4(P))continue;const O=b[P];if(O)w&&!(S!=null&&S.durationKnown)?O.endTime=_:Math.abs(O.startTime-y)>.01&&(O.startTime=y,O.endTime=_);else if(o){let U=x.attr[P];u4(P)&&(U=a1(U));const G=Em(o,y,_,{key:P,data:U},On.dateRange);G&&(G.id=v,this.id3Track.addCue(G),b[P]=G,a&&(P==="X-ASSET-LIST"||P==="X-ASSET-URL")&&G.addEventListener("enter",this.onEventCueEnter))}}d[v]={cues:b,dateRange:x,durationKnown:w}}}}}class G8{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:a}=this.config;if(!i||a===1||!r.live)return;const o=this.targetLatency;if(o===null)return;const l=s-o,c=Math.min(this.maxLatency,o+r.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,a)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,m=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(t,m)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let c=o&&r||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=i!==void 0?i:a*s);const u=s;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const s=r.edge,i=e-t-this.edgeStalled,a=s-r.totalduration,o=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,i),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(T.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(T.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===F.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,s;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class K8 extends Fy{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this),e.on(T.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this),e.off(T.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,s=[],i={},a={};let o=!1,l=!1,c=!1;t.levels.forEach(u=>{const d=u.attrs;let{audioCodec:f,videoCodec:m}=u;f&&(u.audioCodec=f=Jd(f,r)||void 0),m&&(m=u.videoCodec=_3(m));const{width:p,height:g,unknownCodecs:v}=u,x=(v==null?void 0:v.length)||0;if(o||(o=!!(p&&g)),l||(l=!!m),c||(c=!!f),x||f&&!this.isAudioSupported(f)||m&&!this.isVideoSupported(m)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:y,"FRAME-RATE":S,"HDCP-LEVEL":b,"PATHWAY-ID":w,RESOLUTION:_,"VIDEO-RANGE":A}=d,C=`${`${w||"."}-`}${u.bitrate}-${_}-${S}-${y}-${A}-${b}`;if(i[C])if(i[C].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const R=a[C]+=1;u.attrs["PATHWAY-ID"]=new Array(R+1).join(".");const P=this.createLevel(u);i[C]=P,s.push(P)}else i[C].addGroupId("audio",d.AUDIO),i[C].addGroupId("text",d.SUBTITLES);else{const R=this.createLevel(u);i[C]=R,a[C]=1,s.push(R)}}),this.filterAndSortMediaOptions(s,t,o,l,c)}createLevel(e){const t=new Tc(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(s.message),t.supportedResult=v1(s,[])}return t}isAudioSupported(e){return Sc(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Sc(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,s,i){var a;let o=[],l=[],c=e;const u=((a=t.stats)==null?void 0:a.parsing)||{};if((r||s)&&i&&(c=c.filter(({videoCodec:y,videoRange:S,width:b,height:w})=>(!!y||!!(b&&w))&&M3(S))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let y="no level with compatible codecs found in manifest",S=y;t.levels.length&&(S=`one or more CODECS in variant not supported: ${rt(t.levels.map(w=>w.attrs.CODECS).filter((w,_,A)=>A.indexOf(w)===_))}`,this.warn(S),y+=` (${S})`);const b=new Error(y);this.hls.trigger(T.ERROR,{type:fe.MEDIA_ERROR,details:F.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:b,reason:S})}}),u.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(y=>!y.audioCodec||this.isAudioSupported(y.audioCodec)),CE(o)),t.subtitles&&(l=t.subtitles,CE(l));const d=c.slice(0);c.sort((y,S)=>{if(y.attrs["HDCP-LEVEL"]!==S.attrs["HDCP-LEVEL"])return(y.attrs["HDCP-LEVEL"]||"")>(S.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&y.height!==S.height)return y.height-S.height;if(y.frameRate!==S.frameRate)return y.frameRate-S.frameRate;if(y.videoRange!==S.videoRange)return ef.indexOf(y.videoRange)-ef.indexOf(S.videoRange);if(y.videoCodec!==S.videoCodec){const b=SS(y.videoCodec),w=SS(S.videoCodec);if(b!==w)return w-b}if(y.uri===S.uri&&y.codecSet!==S.codecSet){const b=Zd(y.codecSet),w=Zd(S.codecSet);if(b!==w)return w-b}return y.averageBitrate!==S.averageBitrate?y.averageBitrate-S.averageBitrate:0});let f=d[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==d.length)){for(let y=0;y<d.length;y++)if(d[y].pathwayId===c[0].pathwayId){f=d[y];break}}this._levels=c;for(let y=0;y<c.length;y++)if(c[y]===f){var m;this._firstLevel=y;const S=f.bitrate,b=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${S}`),((m=this.hls.userConfig)==null?void 0:m.abrEwmaDefaultEstimate)===void 0){const w=Math.min(S,this.hls.config.abrEwmaDefaultEstimateMax);w>b&&b===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=w)}break}const p=i&&!s,g=this.hls.config,v=!!(g.audioStreamController&&g.audioTrackController),x={levels:c,audioTracks:o,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:v&&!p&&o.some(y=>!!y.url)};u.end=performance.now(),this.hls.trigger(T.MANIFEST_PARSED,x)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(T.ERROR,{type:fe.OTHER_ERROR,details:F.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:u,reason:u.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&s&&i===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${r}${i?" with Pathway "+i:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(T.LEVEL_SWITCHING,l);const c=a.details;if(!c||c.live){const u=this.switchParams(a.uri,s==null?void 0:s.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===Fe.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===oe.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(i=>!!r[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:i}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${s}`),(o=t.deliveryDirectives)!=null&&o.skip&&(i.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(s,t,l)}else(r=t.deliveryDirectives)!=null&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],a=e.details,o=a==null?void 0:a.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(T.LEVEL_LOADING,{url:r,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((i,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(o=>o.level=-1)),!1));$1(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=r.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(T.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(T.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function CE(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function NC(){return self.SourceBuffer||self.WebKitSourceBuffer}function OC(){if(!Ti())return!1;const e=NC();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function H8(){if(!OC())return!1;const n=Ti();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Ec(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Ec(e,"audio"))))}function z8(){var n;const e=NC();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const W8=100;class Y8 extends Cy{constructor(e,t,r){super(e,t,r,"stream-controller",oe.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,i=s?s.currentTime:null;if(i===null||!re(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const a=this.getFwdBufferInfoAtPos(s,i,oe.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(T.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.LEVEL_LOADED,this.onLevelLoaded,this),e.on(T.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(T.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(T.BUFFER_CREATED,this.onBufferCreated,this),e.on(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(T.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(T.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.LEVEL_LOADED,this.onLevelLoaded,this),e.off(T.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(T.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(T.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(T.BUFFER_CREATED,this.onBufferCreated,this),e.off(T.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(T.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:s}=this;if(this.stopLoad(),this.setInterval(W8),this.level=-1,!this.startFragRequested){let i=s.startLevel;i===-1&&(s.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=s.firstAutoLevel),s.nextLoadLevel=i,this.level=s.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=z.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=z.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case z.WAITING_LEVEL:{const{levels:e,level:t}=this,r=e==null?void 0:e[t],s=r==null?void 0:r.details;if(s&&(!s.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(s))break;this.state=z.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=z.IDLE;break}break}case z.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===z.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[i]))return;const a=r[i],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const g={};this.altAudio===2&&(g.type="video"),this.hls.trigger(T.BUFFER_EOS,g),this.state=z.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const c=a.details;if(!c||this.state===z.WAITING_LEVEL||this.waitForLive(a)){this.level=i,this.state=z.WAITING_LEVEL,this.startFragRequested=!1;return}const u=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(u>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:o.end;let m=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&m&&wt(m)&&this.fragmentTracker.getState(m)!==kt.OK){var p;const v=((p=this.backtrackFragment)!=null?p:m).sn-c.startSN,x=c.fragments[v-1];x&&m.cc===x.cc&&(m=x,this.fragmentTracker.removeFragment(x))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,f)){if(!m.gap){const v=this.audioOnly&&!this.altAudio?et.AUDIO:et.VIDEO,x=(v===et.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;x&&this.afterBufferFlushed(x,v,oe.MAIN)}m=this.getNextFragmentLoopLoading(m,c,o,oe.MAIN,d)}m&&(m.initSegment&&!m.initSegment.data&&!this.bitrateTest&&(m=m.initSegment),this.loadFragment(m,a,f))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);s===kt.NOT_LOADED||s===kt.PARTIAL?wt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,oe.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<i.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],c=this.fragLastKbps;c&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:r=0}else r=0;const a=this.getBufferedFrag(t.currentTime+r);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,c=o.duration,u=Math.max(a.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case z.KEY_LOADING:case z.FRAG_LOADING:case z.FRAG_LOADING_WAITING_RETRY:case z.PARSING:case z.PARSED:this.state=z.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;un(r,"playing",this.onMediaPlaying),un(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(wn(r,"playing",this.onMediaPlaying),wn(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(T.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,s=!1;for(let i=0;i<t.levels.length;i++){const a=t.levels[i].audioCodec;a&&(r=r||a.indexOf("mp4a.40.2")!==-1,s=s||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=r&&s&&!z8(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==z.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=z.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:s,startFragRequested:i}=this,a=t.level,o=t.details,l=o.totalduration;if(!s){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const c=t.levelInfo,u=this.fragCurrent;u&&(this.state===z.FRAG_LOADING||this.state===z.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let d=0;if(o.live||(r=c.details)!=null&&r.live){var f;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(c.details=o,this.levelLastLoaded=c,i||this.setStartPosition(o,d),this.hls.trigger(T.LEVEL_UPDATED,{details:o,level:a}),this.state===z.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=z.IDLE}i&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,i=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=i>=a-t.maxFragLookUpTolerance&&i<=o;if(s!==null&&r.duration>s&&(i<s||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&r.readyState<4||i<o-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),r.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const d=we.bufferInfo(r,s,0);if(!((c=d.buffered)!=null&&c.length)){r.currentTime=s;return}if(d.start<=i){r.currentTime=s;return}const{nextStart:m}=we.bufferedInfo(d.buffered,i,0);m&&(r.currentTime=m)}else r.currentTime=s}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:i}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const o=a[r.level];if(!o){this.warn(`Level ${r.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const c=o.videoCodec,u=l.PTSKnown||!l.live,d=(t=r.initSegment)==null?void 0:t.data,f=this._getAudioCodec(o),m=this.transmuxer=this.transmuxer||new oC(this.hls,oe.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=s?s.index:-1,g=p!==-1,v=new _y(r.level,r.sn,r.stats.chunkCount,i.byteLength,p,g),x=this.initPTS[r.cc];m.push(i,d,f,c,r,s,l.totalduration,u,v,x)}onAudioTrackSwitching(e,t){const r=this.hls,s=this.altAudio===2;if(tf(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.fragmentTracker.removeAllFragments(),r.once(T.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(T.AUDIO_TRACK_SWITCHED,t)}),r.trigger(T.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(T.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=tf(t.url,this.hls);if(r){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,i,a=!1;for(const o in r){const l=r[o];if(l.id==="main"){if(i=o,s=l,o==="video"){const c=r[o];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t,i=r.type===oe.MAIN;if(i){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===z.PARSED&&(this.state=z.IDLE);return}const o=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),wt(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}const a=this.media;a&&(!this._hasEnoughToStart&&we.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=z.ERROR;return}switch(t.details){case F.FRAG_GAP:case F.FRAG_PARSING_ERROR:case F.FRAG_DECRYPT_ERROR:case F.FRAG_LOAD_ERROR:case F.FRAG_LOAD_TIMEOUT:case F.KEY_LOAD_ERROR:case F.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(oe.MAIN,t);break;case F.LEVEL_LOAD_ERROR:case F.LEVEL_LOAD_TIMEOUT:case F.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===z.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===Fe.LEVEL&&(this.state=z.IDLE);break;case F.BUFFER_ADD_CODEC_ERROR:case F.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case F.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case F.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=z.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==et.AUDIO||!this.altAudio){const r=(t===et.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,oe.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&r&&(r+=s);const i=this.getLevelDetails(),a=we.getBuffered(e),o=a.length?a.start(0):0,l=o-r,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*((i==null?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),r+=l,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${o}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:s}=this,i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=z.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=i.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),s.trigger(T.FRAG_LOADED,r),i.bitrateTest=!1}).catch(r=>{this.state===z.STOPPED||this.state===z.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:s,chunkMeta:i}=e,a=this.getCurrentContext(i);if(!a){this.resetWhenMissingContext(i);return}const{frag:o,part:l,level:c}=a,{video:u,text:d,id3:f,initSegment:m}=s,{details:p}=c,g=this.altAudio?void 0:s.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=z.PARSING,m){const v=m.tracks;if(v){const b=o.initSegment||o;if(this.unhandledEncryptionError(m,o))return;this._bufferInitSegment(c,v,b,i),r.trigger(T.FRAG_PARSING_INIT_SEGMENT,{frag:b,id:t,tracks:v})}const x=m.initPTS,y=m.timescale,S=this.initPTS[o.cc];if(re(x)&&(!S||S.baseTime!==x||S.timescale!==y)){const b=m.trackId;this.initPTS[o.cc]={baseTime:x,timescale:y,trackId:b},r.trigger(T.INIT_PTS_FOUND,{frag:o,id:t,initPTS:x,timescale:y,trackId:b})}}if(u&&p){g&&u.type==="audiovideo"&&this.logMuxedErr(o);const v=p.fragments[o.sn-1-p.startSN],x=o.sn===p.startSN,y=!v||o.cc>v.cc;if(s.independent!==!1){const{startPTS:S,endPTS:b,startDTS:w,endDTS:_}=u;if(l)l.elementaryStreams[u.type]={startPTS:S,endPTS:b,startDTS:w,endDTS:_};else if(u.firstKeyFrame&&u.independent&&i.id===1&&!y&&(this.couldBacktrack=!0),u.dropped&&u.independent){const A=this.getMainFwdBufferInfo(),I=(A?A.end:this.getLoadPosition())+this.config.maxBufferHole,C=u.firstKeyFramePTS?u.firstKeyFramePTS:S;if(!x&&I<C-this.config.maxBufferHole&&!y){this.backtrack(o);return}else y&&(o.gap=!0);o.setElementaryStreamInfo(u.type,o.start,b,o.start,_,!0)}else x&&S-(p.appliedTimelineOffset||0)>id&&(o.gap=!0);o.setElementaryStreamInfo(u.type,S,b,w,_),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(u,o,l,i,x||y)}else if(x||y)o.gap=!0;else{this.backtrack(o);return}}if(g){const{startPTS:v,endPTS:x,startDTS:y,endDTS:S}=g;l&&(l.elementaryStreams[et.AUDIO]={startPTS:v,endPTS:x,startDTS:y,endDTS:S}),o.setElementaryStreamInfo(et.AUDIO,v,x,y,S),this.bufferFragmentData(g,o,l,i)}if(p&&f!=null&&f.samples.length){const v={id:t,frag:o,details:p,samples:f.samples};r.trigger(T.FRAG_PARSING_METADATA,v)}if(p&&d){const v={id:t,frag:o,details:p,samples:d.samples};r.trigger(T.FRAG_PARSING_USERDATA,v)}}logMuxedErr(e){this.warn(`${wt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,s){if(this.state!==z.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:i,video:a,audiovideo:o}=t;if(i){const c=e.audioCodec;let u=Zu(i.codec,c);u==="mp4a"&&(u="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const f=i.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),c&&c!==u&&this.log(`Swapping manifest audio codec "${c}" for "${u}"`),i.levelCodec=u,i.id=oe.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${u||""}/${c||""}/${i.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=oe.MAIN;const c=a.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${a.codec!==c?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(T.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const d=t[c].initSegment;d!=null&&d.byteLength&&this.hls.trigger(T.BUFFER_APPENDING,{type:c,data:d,frag:r,part:null,chunkMeta:s,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,oe.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=z.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(we.isBuffered(e,r)?t=this.getAppendedFrag(r):we.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(T.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(T.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return re(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(re(t)){const r=this.getLevelDetails(),s=this.currentFrag||(r?ma(null,r.fragments,t):null);if(s){const i=s.programDateTime;if(i!==null){const a=i+(t-s.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class q8 extends rr{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[r].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=F.KEY_LOAD_ERROR,r,s,i){return new fs({type:fe.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:s})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,i=t.length;s<i;s++){const a=t[s];if(e.cc<=a.cc&&(!wt(e)||!wt(a)||e.sn<a.sn)||!r&&s==i-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const l=ed(o);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const s=El(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,F.KEY_LOAD_ERROR,c))}const a=i.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,F.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=Tm(i);let l=this.keyIdToKeyInfo[o];if((r=l)!=null&&r.decryptdata.key)return i.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(s=l)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(u=>{const{keyInfo:d}=u;return i.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${i.keyId?" keyId: "+on(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[o]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,F.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const a=m3(t.initSegment.data);if(a.length){const o=a[0];o.some(l=>l!==0)&&(this.log(`Using keyId found in init segment ${on(o)}`),e.decryptdata.keyId=o,Ji.setKeyIdForUri(e.decryptdata.uri,o))}}const i=this.emeController.loadKey(r);return(e.keyLoadPromise=i.then(a=>(e.mediaKeySessionContext=a,r))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=r.loader,i=new s(r);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=r.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,m,p,g)=>{const{frag:v,keyInfo:x}=p,y=Tm(x.decryptdata);if(!v.decryptdata||x!==this.keyIdToKeyInfo[y])return o(this.createKeyLoadError(v,F.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),g));x.decryptdata.key=v.decryptdata.key=new Uint8Array(f.data),v.keyLoader=null,x.loader=null,a({frag:v,keyInfo:x})},onError:(f,m,p,g)=>{this.resetLoader(m),o(this.createKeyLoadError(t,F.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),p,We({url:l.url,data:void 0},f)))},onTimeout:(f,m,p)=>{this.resetLoader(m),o(this.createKeyLoadError(t,F.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(f,m,p)=>{this.resetLoader(m),o(this.createKeyLoadError(t,F.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};i.load(l,u,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null);const a=Tm(r.decryptdata)||s;delete this.keyIdToKeyInfo[a],i&&i.destroy()}}function Tm(n){if(n.keyFormat!==Bt.FAIRPLAY){const e=n.keyId;if(e)return on(e)}return n.uri}function LE(n){const{type:e}=n;switch(e){case Fe.AUDIO_TRACK:return oe.AUDIO;case Fe.SUBTITLE_TRACK:return oe.SUBTITLE;default:return oe.MAIN}}function bm(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class Q8{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(T.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.LEVEL_LOADING,this.onLevelLoading,this),e.on(T.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(T.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(T.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(T.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.LEVEL_LOADING,this.onLevelLoading,this),e.off(T.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(T.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(T.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,s=t.loader,i=r||s,a=new i(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Fe.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:s,pathwayId:i,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:r,level:s,pathwayId:i,responseType:"text",type:Fe.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:a,track:o}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:Fe.AUDIO_TRACK,url:i,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:i,deliveryDirectives:a,track:o}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:Fe.SUBTITLE_TRACK,url:i,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const r=this.loaders[Fe.LEVEL];if(r){const s=r.context;s&&!t.levels.some(i=>i===s.levelOrTrack)&&(r.abort(),delete this.loaders[Fe.LEVEL])}}load(e){var t;const r=this.hls.config;let s=this.getInternalLoader(e);if(s){const c=this.hls.logger,u=s.context;if(u&&u.levelOrTrack===e.levelOrTrack&&(u.url===e.url||u.deliveryDirectives&&!e.deliveryDirectives)){u.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${u.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===Fe.MANIFEST?i=r.manifestLoadPolicy.default:i=Ze({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),re((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===Fe.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===Fe.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===Fe.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,d=c.targetduration;if(u&&d){const f=Math.max(u*3,d*.8)*1e3;i=Ze({},i,{maxTimeToFirstByteMs:Math.min(f,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,i.maxTimeToFirstByteMs)})}}}const a=i.errorRetry||i.timeoutRetry||{},o={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(c,u,d,f)=>{const m=this.getInternalLoader(d);this.resetInternalLoader(d.type);const p=c.data;u.parsing.start=performance.now(),Hr.isMediaPlaylist(p)||d.type!==Fe.MANIFEST?this.handleTrackOrLevelPlaylist(c,u,d,f||null,m):this.handleMasterPlaylist(c,u,d,f)},onError:(c,u,d,f)=>{this.handleNetworkError(u,d,!1,c,f)},onTimeout:(c,u,d)=>{this.handleNetworkError(u,d,!0,void 0,c)}};s.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,s){const i=this.hls,a=e.data,o=bm(e,r),l=Hr.parseMasterPlaylist(a,o);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,r,l.playlistParsingError,s,t);return}const{contentSteering:c,levels:u,sessionData:d,sessionKeys:f,startTimeOffset:m,variableList:p}=l;this.variableList=p,u.forEach(y=>{const{unknownCodecs:S}=y;if(S){const{preferManagedMediaSource:b}=this.hls.config;let{audioCodec:w,videoCodec:_}=y;for(let A=S.length;A--;){const I=S[A];Sc(I,"audio",b)?(y.audioCodec=w=w?`${w},${I}`:I,Mo.audio[w.substring(0,4)]=2,S.splice(A,1)):Sc(I,"video",b)&&(y.videoCodec=_=_?`${_},${I}`:I,Mo.video[_.substring(0,4)]=2,S.splice(A,1))}}});const{AUDIO:g=[],SUBTITLES:v,"CLOSED-CAPTIONS":x}=Hr.parseMasterPlaylistMedia(a,o,l);g.length&&!g.some(S=>!S.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new dt({}),bitrate:0,url:""})),i.trigger(T.MANIFEST_LOADED,{levels:u,audioTracks:g,subtitles:v,captions:x,contentSteering:c,url:o,stats:t,networkDetails:s,sessionData:d,sessionKeys:f,startTimeOffset:m,variableList:p})}handleTrackOrLevelPlaylist(e,t,r,s,i){const a=this.hls,{id:o,level:l,type:c}=r,u=bm(e,r),d=re(l)?l:re(o)?o:0,f=LE(r),m=Hr.parseLevelPlaylist(e.data,u,d,f,0,this.variableList);if(c===Fe.MANIFEST){const p={attrs:new dt({}),bitrate:0,details:m,name:"",url:u};m.requestScheduled=t.loading.start+M1(m,0),a.trigger(T.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:u,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=m,this.handlePlaylistLoaded(m,e,t,r,s,i)}handleManifestParsingError(e,t,r,s,i){this.hls.trigger(T.ERROR,{type:fe.NETWORK_ERROR,details:F.MANIFEST_PARSING_ERROR,fatal:t.type===Fe.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,r=!1,s,i){let a=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===Fe.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===Fe.AUDIO_TRACK||e.type===Fe.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=F.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case Fe.MANIFEST:l=r?F.MANIFEST_LOAD_TIMEOUT:F.MANIFEST_LOAD_ERROR,c=!0;break;case Fe.LEVEL:l=r?F.LEVEL_LOAD_TIMEOUT:F.LEVEL_LOAD_ERROR,c=!1;break;case Fe.AUDIO_TRACK:l=r?F.AUDIO_TRACK_LOAD_TIMEOUT:F.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case Fe.SUBTITLE_TRACK:l=r?F.SUBTITLE_TRACK_LOAD_TIMEOUT:F.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);const d={type:fe.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:o,networkDetails:t,stats:i};if(s){const f=(t==null?void 0:t.url)||e.url;d.response=We({url:f,data:void 0},s)}this.hls.trigger(T.ERROR,d)}handlePlaylistLoaded(e,t,r,s,i,a){const o=this.hls,{type:l,level:c,levelOrTrack:u,id:d,groupId:f,deliveryDirectives:m}=s,p=bm(t,s),g=LE(s);let v=typeof s.level=="number"&&g===oe.MAIN?c:void 0;const x=e.playlistParsingError;if(x){if(this.hls.logger.warn(`${x} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(T.ERROR,{type:fe.NETWORK_ERROR,details:F.LEVEL_PARSING_ERROR,fatal:!1,url:p,error:x,reason:x.message,response:t,context:s,level:v,parent:g,networkDetails:i,stats:r});return}e.playlistParsingError=null}if(!e.fragments.length){const y=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(T.ERROR,{type:fe.NETWORK_ERROR,details:F.LEVEL_EMPTY_ERROR,fatal:!1,url:p,error:y,reason:y.message,response:t,context:s,level:v,parent:g,networkDetails:i,stats:r});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case Fe.MANIFEST:case Fe.LEVEL:if(v){if(!u)v=0;else if(u!==o.levels[v]){const y=o.levels.indexOf(u);y>-1&&(v=y)}}o.trigger(T.LEVEL_LOADED,{details:e,levelInfo:u||o.levels[0],level:v||0,id:d||0,stats:r,networkDetails:i,deliveryDirectives:m,withoutMultiVariant:l===Fe.MANIFEST});break;case Fe.AUDIO_TRACK:o.trigger(T.AUDIO_TRACK_LOADED,{details:e,track:u,id:d||0,groupId:f||"",stats:r,networkDetails:i,deliveryDirectives:m});break;case Fe.SUBTITLE_TRACK:o.trigger(T.SUBTITLE_TRACK_LOADED,{details:e,track:u,id:d||0,groupId:f||"",stats:r,networkDetails:i,deliveryDirectives:m});break}}}class ys{static get version(){return bc}static isMSESupported(){return OC()}static isSupported(){return H8()}static getMediaSource(){return Ti()}static get Events(){return T}static get MetadataSchema(){return On}static get ErrorTypes(){return fe}static get ErrorDetails(){return F}static get DefaultConfig(){return ys.defaultConfig?ys.defaultConfig:P8}static set DefaultConfig(e){ys.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Ly,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=n3(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=O8(ys.DefaultConfig,e,t);this.userConfig=e,r.progressive&&M8(r,t);const{abrController:s,bufferController:i,capLevelController:a,errorController:o,fpsController:l}=r,c=new o(this),u=this.abrController=new s(this),d=new X3(this),f=r.interstitialsController,m=f?this.interstitialsController=new f(this,ys):null,p=this.bufferController=new i(this,d),g=this.capLevelController=new a(this),v=new l(this),x=new Q8(this),y=r.contentSteeringController,S=y?new y(this):null,b=this.levelController=new K8(this,S),w=new V8(this),_=new q8(this.config,this.logger),A=this.streamController=new Y8(this,d,_),I=this.gapController=new U8(this,d);g.setStreamController(A),v.setStreamController(A);const C=[x,b,A];m&&C.splice(1,0,m),S&&C.splice(1,0,S),this.networkControllers=C;const R=[u,p,I,g,v,w,d];this.audioTrackController=this.createController(r.audioTrackController,C);const P=r.audioStreamController;P&&C.push(this.audioStreamController=new P(this,d,_)),this.subtitleTrackController=this.createController(r.subtitleTrackController,C);const O=r.subtitleStreamController;O&&C.push(this.subtititleStreamController=new O(this,d,_)),this.createController(r.timelineController,R),_.emeController=this.emeController=this.createController(r.emeController,R),this.cmcdController=this.createController(r.cmcdController,R),this.latencyController=this.createController(G8,R),this.coreComponents=R,C.push(c);const U=c.onErrorOut;typeof U=="function"&&this.on(T.ERROR,U,c),this.on(T.MANIFEST_LOADED,x.onManifestLoaded,x)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,s){this._emitter.off(e,t,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const s=e===T.ERROR;this.trigger(T.ERROR,{type:fe.OTHER_ERROR,details:F.INTERNAL_EXCEPTION,fatal:s,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(T.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(T.ERROR,{type:fe.OTHER_ERROR,details:F.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,s=t?e:{media:r};this._media=r,this.trigger(T.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(T.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(T.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,s=this._url=xy.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(T.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[oe.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[oe.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[oe.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=UG()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){O3(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,r)for(let i=s;i--;){const a=e[i].attrs["HDCP-LEVEL"];if(a&&a<=r)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=E1(t);return x1(e,r,navigator.mediaCapabilities)}}ys.defaultConfig=void 0;const X8=va("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),MC=E.forwardRef(({className:n,variant:e,...t},r)=>h.jsx("div",{ref:r,role:"alert",className:J(X8({variant:e}),n),...t}));MC.displayName="Alert";const Z8=E.forwardRef(({className:n,...e},t)=>h.jsx("h5",{ref:t,className:J("mb-1 font-medium leading-none tracking-tight",n),...e}));Z8.displayName="AlertTitle";const FC=E.forwardRef(({className:n,...e},t)=>h.jsx("div",{ref:t,className:J("text-sm [&_p]:leading-relaxed",n),...e}));FC.displayName="AlertDescription";function J8(){const{data:n=[],isLoading:e}=Je({queryKey:["/api/camera-streams"]}),t=E.useRef({}),[r,s]=E.useState("all"),[i,a]=E.useState(""),o=E.useMemo(()=>{const l=i.trim().toLowerCase();return n.filter(c=>{const u=r==="all"||(c.isActive?"online":"offline")===r,d=`${c.petName||c.petId} ${c.roomNumber||""}`.toLowerCase(),f=l===""||d.includes(l);return u&&f})},[n,r,i]);return E.useEffect(()=>{n.forEach(l=>{const c=l==null?void 0:l.streamUrl,u=t.current[l.id];if(!c||!u)return;if((c.endsWith(".m3u8")||c.includes(".m3u8"))&&ys.isSupported()){const f=new ys({enableWorker:!0});f.loadSource(c),f.attachMedia(u)}else u.src=c})},[n]),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("h1",{className:"font-serif text-3xl font-bold","data-testid":"text-page-title",children:"Gim st Camera"}),h.jsx("p",{className:"text-muted-foreground mt-1",children:"Theo di th cng ang lu tr"})]}),h.jsxs(MC,{children:[h.jsx(rA,{className:"h-4 w-4"}),h.jsx(FC,{children:"Ch ch nhn, nhn vin v qun l c php xem camera. D liu c lu trong 24-48 gi."})]}),e?h.jsx("p",{className:"text-muted-foreground",children:"ang ti..."}):h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("input",{className:"w-full sm:w-64 rounded-md border px-3 py-2 text-sm",placeholder:"Tm theo pet/ phng...",value:i,onChange:l=>a(l.target.value)}),h.jsxs("select",{className:"rounded-md border px-3 py-2 text-sm",value:r,onChange:l=>s(l.target.value),children:[h.jsx("option",{value:"all",children:"Tt c"}),h.jsx("option",{value:"online",children:"Trc tuyn"}),h.jsx("option",{value:"offline",children:"Offline"})]})]}),h.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[o.map(l=>h.jsxs(tt,{"data-testid":`camera-card-${l.id}`,children:[h.jsxs(Vt,{className:"pb-3",children:[h.jsxs("div",{className:"flex items-center justify-between gap-2",children:[h.jsx(Zt,{className:"text-base font-medium",children:l.petName||l.petId}),h.jsx(Rn,{variant:l.isActive?"default":"secondary",children:l.isActive?"Trc tuyn":"Offline"})]}),h.jsx("p",{className:"text-sm text-muted-foreground",children:l.roomNumber||"Phng"})]}),h.jsxs(nt,{className:"space-y-3",children:[h.jsxs("div",{className:"relative aspect-video bg-muted rounded-md overflow-hidden",children:[l.isActive&&l.streamUrl?h.jsx("video",{ref:c=>t.current[l.id]=c,className:"object-cover w-full h-full",controls:!0,playsInline:!0}):h.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:h.jsxs("div",{className:"text-center",children:[h.jsx(Jw,{className:"h-12 w-12 text-muted-foreground mx-auto mb-2"}),h.jsx("p",{className:"text-sm text-muted-foreground",children:"Camera offline"})]})}),l.isActive&&h.jsx("div",{className:"absolute top-2 left-2",children:h.jsxs("div",{className:"flex items-center gap-1 bg-red-500 text-white px-2 py-1 rounded text-xs font-medium",children:[h.jsx("div",{className:"h-2 w-2 bg-white rounded-full animate-pulse"}),h.jsx("span",{children:"LIVE"})]})})]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(be,{asChild:!0,variant:"outline",size:"sm",className:"flex-1",disabled:!l.isActive||!l.streamUrl,children:h.jsxs("a",{href:l.streamUrl,target:"_blank",rel:"noreferrer",children:[h.jsx(CN,{className:"h-3 w-3 mr-1"}),"Ton mn hnh"]})}),h.jsx(be,{asChild:!0,variant:"outline",size:"sm",className:"flex-1",disabled:!l.isActive||!l.streamUrl,children:h.jsxs("a",{href:l.streamUrl,download:!0,children:[h.jsx(wN,{className:"h-3 w-3 mr-1"}),"Ti xung"]})})]})]})]},l.id)),o.length===0&&h.jsx("div",{className:"col-span-full text-center text-muted-foreground py-12",children:"Cha c camera no c cu hnh."})]})]})]})}function eK(){return h.jsx(J8,{})}function tK(){const[n,e]=E.useState(""),{data:t=[],isLoading:r}=Je({queryKey:["/api/inventory",{search:n}]});return h.jsxs("div",{className:"space-y-4",children:[h.jsx("div",{className:"flex items-center gap-3",children:h.jsx(Xe,{placeholder:"Tm sn phm, thuc, ph kin...",value:n,onChange:s=>e(s.target.value),className:"max-w-md"})}),r?h.jsx("p",{className:"text-muted-foreground",children:"ang ti..."}):h.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(s=>h.jsxs(tt,{className:"flex flex-col",children:[h.jsxs(Vt,{children:[h.jsx(Zt,{className:"text-base",children:s.name}),h.jsx("p",{className:"text-xs text-muted-foreground",children:s.category})]}),h.jsxs(nt,{className:"mt-auto flex items-center justify-between",children:[h.jsxs("div",{className:"font-semibold",children:[Number(s.price).toLocaleString()," "]}),h.jsx(be,{asChild:!0,size:"sm",variant:"secondary",children:h.jsx(p0,{href:`/product/${s.id}`,children:"Xem"})})]})]},s.id))})]})}function nK(){const[,n]=BD("/product/:id"),e=n==null?void 0:n.id,{addItem:t}=Z0(),{data:r,isLoading:s}=Je({queryKey:["/api/inventory",e],queryFn:async()=>{const a=await fetch(`/api/inventory/${e}`);if(!a.ok)throw new Error("Failed to load");return await a.json()}});if(s)return h.jsx("p",{className:"text-muted-foreground",children:"ang ti..."});if(!r)return h.jsx("p",{children:"Khng tm thy sn phm"});const i=Number(r.price)||0;return h.jsxs(tt,{children:[h.jsxs(Vt,{children:[h.jsx(Zt,{children:r.name}),h.jsx("p",{className:"text-sm text-muted-foreground",children:r.category})]}),h.jsxs(nt,{className:"space-y-4",children:[h.jsxs("div",{className:"text-2xl font-semibold",children:[i.toLocaleString()," "]}),h.jsxs("div",{className:"text-sm text-muted-foreground",children:["n v: ",r.unit]}),h.jsx("div",{className:"flex gap-3",children:h.jsx(be,{onClick:()=>t({id:r.id,name:r.name,price:i},1),"data-testid":"button-add-to-cart",children:"Thm vo gi"})})]})]})}function rK(){const{items:n,updateQuantity:e,removeItem:t,clear:r,total:s}=Z0();return n.length===0?h.jsx("p",{children:"Gi hng trng"}):h.jsxs(tt,{children:[h.jsx(Vt,{children:h.jsx(Zt,{children:"Gi hng"})}),h.jsxs(nt,{className:"space-y-4",children:[n.map(i=>h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsxs("div",{className:"flex-1",children:[h.jsx("div",{className:"font-medium",children:i.name}),h.jsxs("div",{className:"text-sm text-muted-foreground",children:[i.price.toLocaleString()," "]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Xe,{type:"number",min:1,value:i.quantity,onChange:a=>e(i.id,parseInt(a.target.value||"1",10)),className:"w-20"}),h.jsx(be,{variant:"ghost",onClick:()=>t(i.id),children:"Xa"})]})]},i.id)),h.jsxs("div",{className:"flex items-center justify-between border-t pt-4 mt-2",children:[h.jsxs("div",{className:"text-lg font-semibold",children:["Tng: ",s.toLocaleString()," "]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx(be,{variant:"outline",onClick:r,children:"Xa gi"}),h.jsx(be,{"data-testid":"button-checkout",disabled:!0,children:"Thanh ton (sp c)"})]})]})]})]})}function sK(){return h.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:h.jsx(tt,{className:"w-full max-w-md mx-4",children:h.jsxs(nt,{className:"pt-6",children:[h.jsxs("div",{className:"flex mb-4 gap-2",children:[h.jsx(rA,{className:"h-8 w-8 text-red-500"}),h.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),h.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}function iK(){return h.jsxs(KD,{children:[h.jsx(ir,{path:"/",component:$2}),h.jsx(ir,{path:"/customers",component:DB}),h.jsx(ir,{path:"/appointments",component:$B}),h.jsx(ir,{path:"/medical-records",component:GB}),h.jsx(ir,{path:"/inventory",component:zB}),h.jsx(ir,{path:"/invoices",component:WB}),h.jsx(ir,{path:"/cameras",component:eK}),h.jsx(ir,{path:"/shop",component:tK}),h.jsx(ir,{path:"/product/:id",component:nK}),h.jsx(ir,{path:"/cart",component:rK}),h.jsx(ir,{component:sK})]})}function aK(){const n={"--sidebar-width":"16rem"},{items:e}=Z0(),t=e.reduce((r,s)=>r+s.quantity,0);return h.jsx(uP,{client:bP,children:h.jsxs(KA,{children:[h.jsx(d2,{style:n,children:h.jsxs("div",{className:"flex h-screen w-full",children:[h.jsx(k2,{}),h.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[h.jsxs("header",{className:"flex items-center justify-between gap-4 p-4 border-b",children:[h.jsx(h2,{"data-testid":"button-sidebar-toggle"}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(p0,{href:"/cart",children:h.jsxs(be,{variant:"ghost",size:"icon",className:"h-9 w-9 relative","aria-label":"Gi hng",children:[h.jsx(PN,{className:"h-4 w-4"}),t>0&&h.jsx("span",{className:"absolute -top-1 -right-1 h-4 min-w-4 px-1 rounded-full bg-primary text-primary-foreground text-[10px] flex items-center justify-center",children:t})]})}),h.jsx(D2,{})]})]}),h.jsx("main",{className:"flex-1 overflow-auto p-6",children:h.jsx(iK,{})})]})]})}),h.jsx(vO,{})]})})}tw(document.getElementById("root")).render(h.jsx(P2,{children:h.jsx(aK,{})}));
