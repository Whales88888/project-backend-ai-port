<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω Th√≥i quen H√†ng ng√†y</title>
    <style>
        :root {
            --primary-color: #B39DDB;
            --secondary-color: #7E57C2;
            --accent-color: #A5D6A7;
            --light-color: #f8f9fa;
            --dark-color: #37474F;
            --success-color: #81C784;
            --warning-color: #FFB74D;
            --danger-color: #E57373;
            --gray-color: #90A4AE;
            --border-radius: 16px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --gradient-1: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            --gradient-2: linear-gradient(135deg, var(--accent-color) 0%, var(--primary-color) 100%);
            --gradient-3: linear-gradient(135deg, var(--danger-color) 0%, var(--warning-color) 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        /* Light mode colors */
        body.light-mode {
            --primary-color: #6A5ACD;
            --secondary-color: #8A2BE2;
            --accent-color: #32CD32;
            --dark-color: #FFFFFF;
            --success-color: #228B22;
            --warning-color: #FF8C00;
            --danger-color: #DC143C;
            --gray-color: #696969;
            --glass-bg: rgba(0, 0, 0, 0.1);
            --glass-border: rgba(0, 0, 0, 0.2);
            color: #333;
        }

        body.light-mode::before {
            background: 
                radial-gradient(circle at 20% 20%, rgba(106, 90, 205, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(50, 205, 50, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 140, 0, 0.05) 0%, transparent 70%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: var(--dark-color);
            color: white;
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
            transition: all 0.3s ease;
        }

        body.light-mode {
            color: #333;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(179, 157, 219, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(165, 214, 167, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 183, 77, 0.05) 0%, transparent 70%);
            animation: backgroundFloat 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes backgroundFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(-20px, -20px) rotate(90deg); }
            50% { transform: translate(20px, -10px) rotate(180deg); }
            75% { transform: translate(-10px, 20px) rotate(270deg); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 0;
            margin-bottom: 40px;
            background: var(--gradient-1);
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 255, 255, 0.02) 10px,
                rgba(255, 255, 255, 0.02) 20px
            );
            animation: patternMove 10s linear infinite;
        }

        @keyframes patternMove {
            0% { transform: translateX(-20px); }
            100% { transform: translateX(20px); }
        }

        .app-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 10px;
            animation: titleGlow 3s ease-in-out infinite;
            position: relative;
            z-index: 1;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 20px rgba(255, 255, 255, 0.3); }
            50% { text-shadow: 0 0 30px rgba(255, 255, 255, 0.5), 0 0 40px rgba(165, 214, 167, 0.3); }
        }

        .app-subtitle {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }

        .daily-quote {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid var(--glass-border);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .daily-quote::before {
            content: '"';
            position: absolute;
            top: -10px;
            left: 20px;
            font-size: 4rem;
            color: var(--accent-color);
            opacity: 0.3;
            font-family: serif;
        }

        .daily-quote::after {
            content: '"';
            position: absolute;
            bottom: -30px;
            right: 20px;
            font-size: 4rem;
            color: var(--accent-color);
            opacity: 0.3;
            font-family: serif;
        }

        .quote-text {
            font-size: 1.1rem;
            font-style: italic;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            transition: opacity 0.3s ease;
        }

        .quote-author {
            font-size: 0.9rem;
            color: var(--accent-color);
            font-weight: 500;
            transition: opacity 0.3s ease;
        }

        body.light-mode .quote-text {
            color: rgba(0, 0, 0, 0.8);
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 8px;
            margin-bottom: 30px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--box-shadow);
            position: relative;
        }

        .nav-tab {
            flex: 1;
            padding: 12px 20px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            position: relative;
            z-index: 2;
        }

        body.light-mode .nav-tab {
            color: rgba(0, 0, 0, 0.7);
        }

        .nav-tab.active {
            background: var(--gradient-2);
            color: white;
            box-shadow: 0 8px 25px rgba(165, 214, 167, 0.3);
            transform: translateY(-2px);
        }

        .nav-tab:hover:not(.active) {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        body.light-mode .nav-tab:hover:not(.active) {
            color: #333;
            background: rgba(0, 0, 0, 0.1);
        }

        .nav-tab .tab-icon {
            margin-right: 8px;
            font-size: 1.1rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeInUp 0.5s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Today Summary */
        .today-summary {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 30px;
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .today-summary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-2);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            align-items: center;
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 4px;
        }

        .summary-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        body.light-mode .summary-label {
            color: rgba(0, 0, 0, 0.7);
        }

        .circular-progress {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
        }

        .circular-progress svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .circular-progress .bg-circle {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 8;
        }

        body.light-mode .circular-progress .bg-circle {
            stroke: rgba(0, 0, 0, 0.1);
        }

        .circular-progress .progress-circle {
            fill: none;
            stroke: url(#gradient);
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 220;
            stroke-dashoffset: 220;
            transition: stroke-dashoffset 1s ease;
        }

        .circular-progress .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }

        body.light-mode .circular-progress .progress-text {
            color: #333;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .quick-action {
            padding: 12px 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            border: none;
        }

        body.light-mode .quick-action {
            color: #333;
        }

        .quick-action:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        body.light-mode .quick-action:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .quick-action.complete-all {
            background: var(--gradient-2);
            color: white;
        }

        .quick-action.skip-all {
            background: var(--gradient-3);
            color: white;
        }

        /* Time-based Categories */
        .time-categories {
            margin-bottom: 30px;
        }

        .category-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 8px 16px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            border: none;
        }

        body.light-mode .category-tab {
            color: rgba(0, 0, 0, 0.7);
        }

        .category-tab.active {
            background: var(--gradient-2);
            color: white;
            border-color: transparent;
        }

        .category-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        body.light-mode .category-tab:hover:not(.active) {
            background: rgba(0, 0, 0, 0.1);
            color: #333;
        }

        /* Habit Cards */
        .habits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .habit-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 24px;
            border: 1px solid var(--glass-border);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .habit-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-2);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .habit-card:hover::before {
            transform: scaleX(1);
        }

        .habit-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border-color: rgba(165, 214, 167, 0.3);
        }

        .habit-card.completed {
            background: linear-gradient(135deg, rgba(129, 199, 132, 0.2) 0%, rgba(165, 214, 167, 0.1) 100%);
            border-color: var(--success-color);
        }

        .habit-card.completed::before {
            background: var(--success-color);
            transform: scaleX(1);
        }

        .habit-card.morning {
            border-left: 4px solid #FFB74D;
        }

        .habit-card.afternoon {
            border-left: 4px solid #64B5F6;
        }

        .habit-card.evening {
            border-left: 4px solid #9575CD;
        }

        .habit-card.anytime {
            border-left: 4px solid #81C784;
        }

        .habit-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .habit-info {
            flex: 1;
        }

        .habit-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: white;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.light-mode .habit-title {
            color: #333;
        }

        .habit-emoji {
            font-size: 1.4rem;
        }

        .habit-category {
            font-size: 0.9rem;
            color: var(--accent-color);
            font-weight: 500;
            margin-bottom: 2px;
        }

        .habit-time {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
        }

        body.light-mode .habit-time {
            color: rgba(0, 0, 0, 0.5);
        }

        .habit-difficulty {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 500;
            margin-top: 4px;
        }

        .habit-difficulty.easy {
            background: rgba(129, 199, 132, 0.2);
            color: var(--success-color);
        }

        .habit-difficulty.medium {
            background: rgba(255, 183, 77, 0.2);
            color: var(--warning-color);
        }

        .habit-difficulty.hard {
            background: rgba(229, 115, 115, 0.2);
            color: var(--danger-color);
        }

        .habit-actions {
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }

        .habit-check {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--gray-color);
            background: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: transparent;
            font-size: 16px;
        }

        .habit-check.completed {
            background: var(--success-color);
            border-color: var(--success-color);
            color: white;
            transform: scale(1.1);
        }

        .habit-check:hover {
            border-color: var(--accent-color);
            transform: scale(1.05);
        }

        .habit-menu {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        body.light-mode .habit-menu {
            background: rgba(0, 0, 0, 0.1);
            color: rgba(0, 0, 0, 0.6);
        }

        .habit-menu:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        body.light-mode .habit-menu:hover {
            background: rgba(0, 0, 0, 0.2);
            color: #333;
        }

        .habit-progress {
            margin-top: 16px;
        }

        .habit-streak {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .streak-info {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        body.light-mode .streak-info {
            color: rgba(0, 0, 0, 0.7);
        }

        .streak-number {
            color: var(--warning-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        body.light-mode .progress-bar {
            background: rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-2);
            border-radius: 3px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: right;
        }

        body.light-mode .progress-text {
            color: rgba(0, 0, 0, 0.7);
        }

        .habit-notes {
            margin-top: 12px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
        }

        body.light-mode .habit-notes {
            background: rgba(0, 0, 0, 0.05);
            color: rgba(0, 0, 0, 0.7);
        }

        /* Add Habit Button */
        .add-habit-btn {
            width: 100%;
            padding: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px dashed var(--glass-border);
            border-radius: var(--border-radius);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        body.light-mode .add-habit-btn {
            color: rgba(0, 0, 0, 0.7);
        }

        .add-habit-btn:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
            background: rgba(165, 214, 167, 0.1);
            transform: translateY(-2px);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: var(--dark-color);
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 600px;
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            border: 1px solid var(--glass-border);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        body.light-mode .modal-content {
            background: #FFFFFF;
            color: #333;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: white;
        }

        body.light-mode .modal-title {
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        body.light-mode .modal-close {
            color: #333;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }

        body.light-mode .modal-close:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: white;
            font-weight: 500;
        }

        body.light-mode .form-label {
            color: #333;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        body.light-mode .form-input, 
        body.light-mode .form-select, 
        body.light-mode .form-textarea {
            background: rgba(0, 0, 0, 0.05);
            color: #333;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(165, 214, 167, 0.2);
        }

        .form-input::placeholder, .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        body.light-mode .form-input::placeholder, 
        body.light-mode .form-textarea::placeholder {
            color: rgba(0, 0, 0, 0.5);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-select option {
            background: var(--dark-color);
            color: white;
        }

        body.light-mode .form-select option {
            background: #FFFFFF;
            color: #333;
        }

        .emoji-picker {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-top: 8px;
            max-height: 120px;
            overflow-y: auto;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        body.light-mode .emoji-picker {
            background: rgba(0, 0, 0, 0.05);
        }

        .emoji-option {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.2rem;
        }

        .emoji-option:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        body.light-mode .emoji-option:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .emoji-option.selected {
            background: var(--accent-color);
            transform: scale(1.2);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .btn-primary {
            background: var(--gradient-2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(165, 214, 167, 0.3);
        }

        .btn-secondary {
            background: var(--glass-bg);
            color: white;
            border: 1px solid var(--glass-border);
        }

        body.light-mode .btn-secondary {
            color: #333;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        body.light-mode .btn-secondary:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        /* Context Menu */
        .habit-context-menu {
            position: fixed;
            background: var(--dark-color);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 8px 0;
            z-index: 1001;
            min-width: 150px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
        }

        body.light-mode .habit-context-menu {
            background: #FFFFFF;
        }

        .menu-item {
            padding: 8px 16px;
            cursor: pointer;
            transition: background 0.2s;
            color: white;
            font-size: 14px;
        }

        body.light-mode .menu-item {
            color: #333;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        body.light-mode .menu-item:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .menu-item.danger {
            color: var(--danger-color);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 16px 20px;
            color: white;
            font-weight: 500;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        body.light-mode .notification {
            color: #333;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--success-color);
        }

        .notification.error {
            border-left: 4px solid var(--danger-color);
        }

        .notification.warning {
            border-left: 4px solid var(--warning-color);
        }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 24px;
            border: 1px solid var(--glass-border);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-2);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        body.light-mode .stat-label {
            color: rgba(0, 0, 0, 0.8);
        }

        /* Calendar */
        .calendar {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 24px;
            border: 1px solid var(--glass-border);
            margin-bottom: 30px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: white;
        }

        body.light-mode .calendar-title {
            color: #333;
        }

        .calendar-nav {
            display: flex;
            gap: 8px;
        }

        .calendar-nav-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            padding: 8px 12px;
            transition: all 0.3s ease;
        }

        body.light-mode .calendar-nav-btn {
            color: #333;
        }

        .calendar-nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        body.light-mode .calendar-nav-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }

        .calendar-weekday {
            text-align: center;
            padding: 8px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 600;
            text-transform: uppercase;
        }

        body.light-mode .calendar-weekday {
            color: rgba(0, 0, 0, 0.6);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            color: white;
        }

        body.light-mode .calendar-day {
            color: #333;
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        body.light-mode .calendar-day:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .calendar-day.other-month {
            color: rgba(255, 255, 255, 0.3);
        }

        body.light-mode .calendar-day.other-month {
            color: rgba(0, 0, 0, 0.3);
        }

        .calendar-day.today {
            background: var(--gradient-2);
            color: white;
        }

        .calendar-day.has-habits::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--accent-color);
            border-radius: 50%;
        }

        .calendar-day.completed::after {
            background: var(--success-color);
        }

        .calendar-day.partial::after {
            background: var(--warning-color);
        }

        /* Settings */
        .settings-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 30px;
            border: 1px solid var(--glass-border);
        }

        .settings-group {
            margin-bottom: 24px;
        }

        .settings-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: white;
            margin-bottom: 16px;
        }

        body.light-mode .settings-title {
            color: #333;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-mode .setting-item {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        body.light-mode .setting-label {
            color: rgba(0, 0, 0, 0.9);
        }

        .setting-description {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 2px;
        }

        body.light-mode .setting-description {
            color: rgba(0, 0, 0, 0.6);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        body.light-mode .toggle-switch {
            background: rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active {
            background: var(--accent-color);
        }

        .toggle-handle {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active .toggle-handle {
            transform: translateX(26px);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .habits-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 20px;
                width: 95%;
            }

            .app-title {
                font-size: 2rem;
            }

            .nav-tab {
                padding: 10px 16px;
                font-size: 14px;
            }

            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .quick-actions {
                justify-content: center;
            }

            .category-tabs {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .calendar-day {
                font-size: 0.8rem;
            }

            .habit-card {
                padding: 16px;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Time Suggestion Panel */
        .time-suggestion-panel {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 20px;
            z-index: 1500;
            max-width: 300px;
            transition: all 0.3s ease;
        }

        .suggestion-title {
            color: white;
            font-size: 1.1rem;
            margin-bottom: 16px;
            text-align: center;
        }

        body.light-mode .suggestion-title {
            color: #333;
        }

        .suggestion-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        body.light-mode .suggestion-item {
            background: rgba(0, 0, 0, 0.05);
        }

        .suggestion-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-color);
        }

        body.light-mode .suggestion-item:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .suggestion-time {
            font-weight: 600;
            color: var(--accent-color);
        }

        .suggestion-reason {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 4px;
        }

        body.light-mode .suggestion-reason {
            color: rgba(0, 0, 0, 0.7);
        }

        /* Pull-to-refresh styles */
        .pull-to-refresh {
            position: fixed;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 50px;
            padding: 15px 25px;
            color: white;
            font-size: 0.9rem;
            z-index: 2000;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        body.light-mode .pull-to-refresh {
            color: #333;
        }

        .pull-to-refresh.active {
            top: 20px;
        }

        .refresh-icon {
            width: 20px;
            height: 20px;
            border: 2px solid currentColor;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Auto refresh indicator */
        .auto-refresh-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 8px 12px;
            font-size: 0.8rem;
            color: white;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }

        body.light-mode .auto-refresh-indicator {
            color: #333;
        }

        .auto-refresh-indicator.show {
            opacity: 1;
        }

        /* Page refresh transition */
        .page-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-1);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .page-transition.active {
            opacity: 1;
            pointer-events: all;
        }

        .transition-content {
            text-align: center;
            color: white;
        }

        .transition-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        /* Animation classes */
        .animate-slide-up {
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="app-title">üåü Qu·∫£n l√Ω Th√≥i quen H√†ng ng√†y</h1>
            <p class="app-subtitle">X√¢y d·ª±ng th√≥i quen t·ªët, thay ƒë·ªïi cu·ªôc s·ªëng t·ª´ng ng√†y</p>
        </header>

        <!-- Daily Quote -->
        <div class="daily-quote">
            <p class="quote-text">Th√†nh c√¥ng l√† t·ªïng c·ªßa nh·ªØng n·ªó l·ª±c nh·ªè ƒë∆∞·ª£c l·∫∑p l·∫°i ng√†y n√†y qua ng√†y kh√°c.</p>
            <p class="quote-author">- Robert Collier</p>
        </div>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="today">
                <span class="tab-icon">üè†</span>H√¥m nay
            </button>
            <button class="nav-tab" data-tab="stats">
                <span class="tab-icon">üìä</span>Th·ªëng k√™
            </button>
            <button class="nav-tab" data-tab="calendar">
                <span class="tab-icon">üìÖ</span>L·ªãch
            </button>
            <button class="nav-tab" data-tab="settings">
                <span class="tab-icon">‚öôÔ∏è</span>C√†i ƒë·∫∑t
            </button>
        </nav>

        <!-- Today Tab -->
        <div class="tab-content active" id="today-tab">
            <!-- Today Summary -->
            <div class="today-summary">
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="circular-progress">
                            <svg>
                                <defs>
                                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#A5D6A7"/>
                                        <stop offset="100%" style="stop-color:#B39DDB"/>
                                    </linearGradient>
                                </defs>
                                <circle class="bg-circle" cx="40" cy="40" r="35"/>
                                <circle class="progress-circle" cx="40" cy="40" r="35" style="stroke-dashoffset: 66;"/>
                            </svg>
                            <div class="progress-text">70%</div>
                        </div>
                        <div class="summary-label">Ho√†n th√†nh h√¥m nay</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">4/6</div>
                        <div class="summary-label">Th√≥i quen ho√†n th√†nh</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">üî• 15</div>
                        <div class="summary-label">Streak d√†i nh·∫•t</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">‚≠ê 42</div>
                        <div class="summary-label">Ng√†y ho·∫°t ƒë·ªông</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <button class="quick-action complete-all">
                    <span>‚úÖ</span>Ho√†n th√†nh t·∫•t c·∫£
                </button>
                <button class="quick-action skip-all">
                    <span>‚è≠Ô∏è</span>B·ªè qua h√¥m nay
                </button>
                <button class="quick-action refresh-data" onclick="manualRefresh()">
                    <span>üîÑ</span>L√†m m·ªõi
                </button>
            </div>

            <!-- Time Categories -->
            <div class="time-categories">
                <div class="category-tabs">
                    <button class="category-tab active" data-category="all">T·∫•t c·∫£</button>
                    <button class="category-tab" data-category="morning">üåÖ Bu·ªïi s√°ng</button>
                    <button class="category-tab" data-category="afternoon">‚òÄÔ∏è Bu·ªïi chi·ªÅu</button>
                    <button class="category-tab" data-category="evening">üåô Bu·ªïi t·ªëi</button>
                    <button class="category-tab" data-category="anytime">‚è∞ B·∫•t k·ª≥ l√∫c n√†o</button>
                </div>

                <!-- Habit Cards -->
                <div class="habits-grid">
                    <!-- Morning Habits -->
                    <div class="habit-card morning">
                        <div class="habit-header">
                            <div class="habit-info">
                                <h3 class="habit-title">
                                    <span class="habit-emoji">üèÉ‚Äç‚ôÇÔ∏è</span>
                                    Ch·∫°y b·ªô bu·ªïi s√°ng
                                </h3>
                                <p class="habit-category">S·ª©c kh·ªèe</p>
                                <p class="habit-time">6:00 - 7:00</p>
                                <span class="habit-difficulty medium">Trung b√¨nh</span>
                            </div>
                            <div class="habit-actions">
                                <button class="habit-check">‚úì</button>
                                <button class="habit-menu">‚ãØ</button>
                            </div>
                        </div>
                        <div class="habit-progress">
                            <div class="habit-streak">
                                <span class="streak-info">Streak hi·ªán t·∫°i</span>
                                <span class="streak-number">üî• 7 ng√†y</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 70%;"></div>
                            </div>
                            <div class="progress-text">70% tu·∫ßn n√†y</div>
                        </div>
                        <div class="habit-notes">
                            Ch·∫°y ·ªü c√¥ng vi√™n g·∫ßn nh√†, tƒÉng c∆∞·ªùng s·ª©c kh·ªèe tim m·∫°ch v√† tinh th·∫ßn.
                        </div>
                    </div>

                    <div class="habit-card morning completed">
                        <div class="habit-header">
                            <div class="habit-info">
                                <h3 class="habit-title">
                                    <span class="habit-emoji">üßò‚Äç‚ôÄÔ∏è</span>
                                    Thi·ªÅn 15 ph√∫t
                                </h3>
                                <p class="habit-category">Tinh th·∫ßn</p>
                                <p class="habit-time">6:30 - 6:45</p>
                                <span class="habit-difficulty easy">D·ªÖ</span>
                            </div>
                            <div class="habit-actions">
                                <button class="habit-check completed">‚úì</button>
                                <button class="habit-menu">‚ãØ</button>
                            </div>
                        </div>
                        <div class="habit-progress">
                            <div class="habit-streak">
                                <span class="streak-info">Streak hi·ªán t·∫°i</span>
                                <span class="streak-number">üî• 3 ng√†y</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 43%;"></div>
                            </div>
                            <div class="progress-text">43% tu·∫ßn n√†y</div>
                        </div>
                        <div class="habit-notes">
                            Thi·ªÅn mindfulness ƒë·ªÉ b·∫Øt ƒë·∫ßu ng√†y m·ªõi v·ªõi t√¢m tr·∫°ng b√¨nh an.
                        </div>
                    </div>

                    <!-- Afternoon Habits -->
                    <div class="habit-card afternoon completed">
                        <div class="habit-header">
                            <div class="habit-info">
                                <h3 class="habit-title">
                                    <span class="habit-emoji">ü•ó</span>
                                    ƒÇn tr√°i c√¢y
                                </h3>
                                <p class="habit-category">Dinh d∆∞·ª°ng</p>
                                <p class="habit-time">14:00 - 14:15</p>
                                <span class="habit-difficulty easy">D·ªÖ</span>
                            </div>
                            <div class="habit-actions">
                                <button class="habit-check completed">‚úì</button>
                                <button class="habit-menu">‚ãØ</button>
                            </div>
                        </div>
                        <div class="habit-progress">
                            <div class="habit-streak">
                                <span class="streak-info">Streak hi·ªán t·∫°i</span>
                                <span class="streak-number">üî• 9 ng√†y</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 71%;"></div>
                            </div>
                            <div class="progress-text">71% tu·∫ßn n√†y</div>
                        </div>
                        <div class="habit-notes">
                            B·ªï sung vitamin v√† ch·∫•t x∆° cho c∆° th·ªÉ v√†o bu·ªïi chi·ªÅu.
                        </div>
                    </div>

                    <!-- Evening Habits -->
                    <div class="habit-card evening completed">
                        <div class="habit-header">
                            <div class="habit-info">
                                <h3 class="habit-title">
                                    <span class="habit-emoji">üìö</span>
                                    ƒê·ªçc s√°ch 30 ph√∫t
                                </h3>
                                <p class="habit-category">H·ªçc t·∫≠p</p>
                                <p class="habit-time">20:00 - 20:30</p>
                                <span class="habit-difficulty easy">D·ªÖ</span>
                            </div>
                            <div class="habit-actions">
                                <button class="habit-check completed">‚úì</button>
                                <button class="habit-menu">‚ãØ</button>
                            </div>
                        </div>
                        <div class="habit-progress">
                            <div class="habit-streak">
                                <span class="streak-info">Streak hi·ªán t·∫°i</span>
                                <span class="streak-number">üî• 15 ng√†y</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 100%;"></div>
                            </div>
                            <div class="progress-text">100% tu·∫ßn n√†y</div>
                        </div>
                        <div class="habit-notes">
                            ƒê·ªçc s√°ch self-help v√† ti·ªÉu thuy·∫øt ƒë·ªÉ m·ªü r·ªông ki·∫øn th·ª©c.
                        </div>
                    </div>

                    <div class="habit-card evening">
                        <div class="habit-header">
                            <div class="habit-info">
                                <h3 class="habit-title">
                                    <span class="habit-emoji">üìù</span>
                                    Vi·∫øt nh·∫≠t k√Ω
                                </h3>
                                <p class="habit-category">C√° nh√¢n</p>
                                <p class="habit-time">21:00 - 21:15</p>
                                <span class="habit-difficulty easy">D·ªÖ</span>
                            </div>
                            <div class="habit-actions">
                                <button class="habit-check">‚úì</button>
                                <button class="habit-menu">‚ãØ</button>
                            </div>
                        </div>
                        <div class="habit-progress">
                            <div class="habit-streak">
                                <span class="streak-info">Streak hi·ªán t·∫°i</span>
                                <span class="streak-number">üî• 5 ng√†y</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 57%;"></div>
                            </div>
                            <div class="progress-text">57% tu·∫ßn n√†y</div>
                        </div>
                        <div class="habit-notes">
                            Ghi l·∫°i nh·ªØng suy nghƒ© v√† c·∫£m x√∫c trong ng√†y.
                        </div>
                    </div>

                    <!-- Anytime Habits -->
                    <div class="habit-card anytime completed">
                        <div class="habit-header">
                            <div class="habit-info">
                                <h3 class="habit-title">
                                    <span class="habit-emoji">üíß</span>
                                    U·ªëng 2L n∆∞·ªõc
                                </h3>
                                <p class="habit-category">S·ª©c kh·ªèe</p>
                                <p class="habit-time">C·∫£ ng√†y</p>
                                <span class="habit-difficulty medium">Trung b√¨nh</span>
                            </div>
                            <div class="habit-actions">
                                <button class="habit-check completed">‚úì</button>
                                <button class="habit-menu">‚ãØ</button>
                            </div>
                        </div>
                        <div class="habit-progress">
                            <div class="habit-streak">
                                <span class="streak-info">Streak hi·ªán t·∫°i</span>
                                <span class="streak-number">üî• 12 ng√†y</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 86%;"></div>
                            </div>
                            <div class="progress-text">86% tu·∫ßn n√†y</div>
                        </div>
                        <div class="habit-notes">
                            Theo d√µi l∆∞·ª£ng n∆∞·ªõc u·ªëng ƒë·ªÉ duy tr√¨ ƒë·ªô ·∫©m cho c∆° th·ªÉ.
                        </div>
                    </div>

                    <!-- Add Habit Button -->
                    <button class="add-habit-btn" onclick="openModal('add-habit-modal')">
                        <span>+</span>
                        Th√™m th√≥i quen m·ªõi
                    </button>
                </div>
            </div>
        </div>

        <!-- Statistics Tab -->
        <div class="tab-content" id="stats-tab">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-value" id="total-habits">6</div>
                    <div class="stat-label">Th√≥i quen ƒëang theo d√µi</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-value">15</div>
                    <div class="stat-label">Streak d√†i nh·∫•t</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-value" id="completion-rate">71%</div>
                    <div class="stat-label">T·ª∑ l·ªá ho√†n th√†nh</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-value">42</div>
                    <div class="stat-label">Ng√†y ho·∫°t ƒë·ªông</div>
                </div>
            </div>
        </div>

        <!-- Calendar Tab -->
        <div class="tab-content" id="calendar-tab">
            <div class="calendar">
                <div class="calendar-header">
                    <h3 class="calendar-title" id="calendar-title">Th√°ng 5, 2025</h3>
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" id="prev-month">‚Äπ</button>
                        <button class="calendar-nav-btn" id="next-month">‚Ä∫</button>
                    </div>
                </div>
                <div class="calendar-weekdays">
                    <div class="calendar-weekday">T2</div>
                    <div class="calendar-weekday">T3</div>
                    <div class="calendar-weekday">T4</div>
                    <div class="calendar-weekday">T5</div>
                    <div class="calendar-weekday">T6</div>
                    <div class="calendar-weekday">T7</div>
                    <div class="calendar-weekday">CN</div>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    <!-- Calendar days will be generated by JavaScript -->
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-value" id="days-in-month">31</div>
                    <div class="stat-label">Ng√†y trong th√°ng</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value">28</div>
                    <div class="stat-label">Ng√†y ho√†n th√†nh</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-value">90%</div>
                    <div class="stat-label">T·ª∑ l·ªá th√†nh c√¥ng</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-value" id="monthly-habits">168</div>
                    <div class="stat-label">Th√≥i quen ho√†n th√†nh</div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings-tab">
            <div class="settings-panel">
                <div class="settings-group">
                    <h3 class="settings-title">‚öôÔ∏è C√†i ƒë·∫∑t chung</h3>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Ch·∫ø ƒë·ªô t·ªëi</div>
                            <div class="setting-description">Giao di·ªán t·ªëi ƒë·ªÉ b·∫£o v·ªá m·∫Øt</div>
                        </div>
                        <div class="toggle-switch active" id="dark-mode-toggle">
                            <div class="toggle-handle"></div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">√Çm thanh ho√†n th√†nh</div>
                            <div class="setting-description">Ph√°t √¢m thanh khi ho√†n th√†nh th√≥i quen</div>
                        </div>
                        <div class="toggle-switch" id="sound-toggle">
                            <div class="toggle-handle"></div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Th√¥ng b√°o push</div>
                            <div class="setting-description">Nh·∫≠n th√¥ng b√°o nh·∫Øc nh·ªü th√≥i quen</div>
                        </div>
                        <div class="toggle-switch active" id="notification-toggle">
                            <div class="toggle-handle"></div>
                        </div>
                    </div>
                </div>

                <div class="settings-group">
                    <h3 class="settings-title">üéØ M·ª•c ti√™u</h3>
                    
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">M·ª•c ti√™u h√†ng ng√†y</div>
                            <div class="setting-description">S·ªë th√≥i quen t·ªëi thi·ªÉu m·ªói ng√†y</div>
                        </div>
                        <select class="form-select" style="width: auto;" id="daily-goal">
                            <option value="3">3 th√≥i quen</option>
                            <option value="4">4 th√≥i quen</option>
                            <option value="5" selected>5 th√≥i quen</option>
                            <option value="6">6 th√≥i quen</option>
                        </select>
                    </div>
                </div>

                <div class="settings-group">
                    <h3 class="settings-title">üì± D·ªØ li·ªáu</h3>
                    
                    <div class="setting-item">
                        <button class="btn btn-secondary" onclick="exportData()">üì§ Xu·∫•t d·ªØ li·ªáu</button>
                        <button class="btn btn-secondary" onclick="clearAllData()">üóëÔ∏è X√≥a t·∫•t c·∫£ d·ªØ li·ªáu</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Habit Modal -->
    <div class="modal" id="add-habit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚ûï Th√™m th√≥i quen m·ªõi</h3>
                <button class="modal-close" onclick="closeModal('add-habit-modal')">&times;</button>
            </div>
            
            <form id="habit-form">
                <div class="form-group">
                    <label class="form-label">Emoji & T√™n th√≥i quen</label>
                    <div style="display: flex; gap: 12px;">
                        <input type="text" id="selected-emoji" value="üéØ" style="width: 60px; text-align: center; font-size: 1.4rem;" readonly>
                        <input type="text" id="habit-name" class="form-input" style="flex: 1;" placeholder="VD: Ch·∫°y b·ªô bu·ªïi s√°ng" required>
                    </div>
                    <div class="emoji-picker">
                        <div class="emoji-option selected" data-emoji="üéØ">üéØ</div>
                        <div class="emoji-option" data-emoji="üèÉ‚Äç‚ôÇÔ∏è">üèÉ‚Äç‚ôÇÔ∏è</div>
                        <div class="emoji-option" data-emoji="üßò‚Äç‚ôÄÔ∏è">üßò‚Äç‚ôÄÔ∏è</div>
                        <div class="emoji-option" data-emoji="üìö">üìö</div>
                        <div class="emoji-option" data-emoji="üíß">üíß</div>
                        <div class="emoji-option" data-emoji="üìù">üìù</div>
                        <div class="emoji-option" data-emoji="ü•ó">ü•ó</div>
                        <div class="emoji-option" data-emoji="üí™">üí™</div>
                        <div class="emoji-option" data-emoji="üé®">üé®</div>
                        <div class="emoji-option" data-emoji="üéµ">üéµ</div>
                        <div class="emoji-option" data-emoji="üå±">üå±</div>
                        <div class="emoji-option" data-emoji="‚òï">‚òï</div>
                        <div class="emoji-option" data-emoji="üßº">üßº</div>
                        <div class="emoji-option" data-emoji="üõèÔ∏è">üõèÔ∏è</div>
                        <div class="emoji-option" data-emoji="üì±">üì±</div>
                        <div class="emoji-option" data-emoji="üöó">üöó</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">M√¥ t·∫£ chi ti·∫øt</label>
                    <textarea id="habit-description" class="form-textarea" placeholder="M√¥ t·∫£ v·ªÅ th√≥i quen n√†y v√† l√Ω do b·∫°n mu·ªën th·ª±c hi·ªán..."></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Danh m·ª•c</label>
                        <select id="habit-category" class="form-select" required>
                            <option value="">Ch·ªçn danh m·ª•c</option>
                            <option value="health">üèÉ‚Äç‚ôÇÔ∏è S·ª©c kh·ªèe</option>
                            <option value="learning">üìö H·ªçc t·∫≠p</option>
                            <option value="mindfulness">üßò‚Äç‚ôÄÔ∏è Tinh th·∫ßn</option>
                            <option value="nutrition">ü•ó Dinh d∆∞·ª°ng</option>
                            <option value="personal">üìù C√° nh√¢n</option>
                            <option value="work">üíº C√¥ng vi·ªác</option>
                            <option value="social">üë• X√£ h·ªôi</option>
                            <option value="creative">üé® S√°ng t·∫°o</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ƒê·ªô kh√≥</label>
                        <select id="habit-difficulty" class="form-select" required>
                            <option value="easy">D·ªÖ</option>
                            <option value="medium" selected>Trung b√¨nh</option>
                            <option value="hard">Kh√≥</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Th·ªùi gian b·∫Øt ƒë·∫ßu</label>
                        <input type="time" id="habit-start-time" class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Th·ªùi gian k·∫øt th√∫c</label>
                        <input type="time" id="habit-end-time" class="form-input">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Khung th·ªùi gian</label>
                    <select id="habit-timeframe" class="form-select" required>
                        <option value="morning">üåÖ Bu·ªïi s√°ng (5:00 - 12:00)</option>
                        <option value="afternoon">‚òÄÔ∏è Bu·ªïi chi·ªÅu (12:00 - 18:00)</option>
                        <option value="evening">üåô Bu·ªïi t·ªëi (18:00 - 23:00)</option>
                        <option value="anytime">‚è∞ B·∫•t k·ª≥ l√∫c n√†o</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">T·∫ßn su·∫•t</label>
                    <select id="habit-frequency" class="form-select" required>
                        <option value="daily" selected>H√†ng ng√†y</option>
                        <option value="weekly">H√†ng tu·∫ßn</option>
                        <option value="custom">T√πy ch·ªânh</option>
                    </select>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('add-habit-modal')">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">Th√™m th√≥i quen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Habit Modal -->
    <div class="modal" id="edit-habit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è Ch·ªânh s·ª≠a th√≥i quen</h3>
                <button class="modal-close" onclick="closeModal('edit-habit-modal')">&times;</button>
            </div>
            
            <form id="edit-habit-form">
                <div class="form-group">
                    <label class="form-label">Emoji & T√™n th√≥i quen</label>
                    <div style="display: flex; gap: 12px;">
                        <input type="text" id="edit-selected-emoji" value="üéØ" style="width: 60px; text-align: center; font-size: 1.4rem;" readonly>
                        <input type="text" id="edit-habit-name" class="form-input" style="flex: 1;" placeholder="VD: Ch·∫°y b·ªô bu·ªïi s√°ng" required>
                    </div>
                    <div class="emoji-picker" id="edit-emoji-picker">
                        <div class="emoji-option selected" data-emoji="üéØ">üéØ</div>
                        <div class="emoji-option" data-emoji="üèÉ‚Äç‚ôÇÔ∏è">üèÉ‚Äç‚ôÇÔ∏è</div>
                        <div class="emoji-option" data-emoji="üßò‚Äç‚ôÄÔ∏è">üßò‚Äç‚ôÄÔ∏è</div>
                        <div class="emoji-option" data-emoji="üìö">üìö</div>
                        <div class="emoji-option" data-emoji="üíß">üíß</div>
                        <div class="emoji-option" data-emoji="üìù">üìù</div>
                        <div class="emoji-option" data-emoji="ü•ó">ü•ó</div>
                        <div class="emoji-option" data-emoji="üí™">üí™</div>
                        <div class="emoji-option" data-emoji="üé®">üé®</div>
                        <div class="emoji-option" data-emoji="üéµ">üéµ</div>
                        <div class="emoji-option" data-emoji="üå±">üå±</div>
                        <div class="emoji-option" data-emoji="‚òï">‚òï</div>
                        <div class="emoji-option" data-emoji="üßº">üßº</div>
                        <div class="emoji-option" data-emoji="üõèÔ∏è">üõèÔ∏è</div>
                        <div class="emoji-option" data-emoji="üì±">üì±</div>
                        <div class="emoji-option" data-emoji="üöó">üöó</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">M√¥ t·∫£ chi ti·∫øt</label>
                    <textarea id="edit-habit-description" class="form-textarea" placeholder="M√¥ t·∫£ v·ªÅ th√≥i quen n√†y v√† l√Ω do b·∫°n mu·ªën th·ª±c hi·ªán..."></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Danh m·ª•c</label>
                        <select id="edit-habit-category" class="form-select" required>
                            <option value="">Ch·ªçn danh m·ª•c</option>
                            <option value="health">üèÉ‚Äç‚ôÇÔ∏è S·ª©c kh·ªèe</option>
                            <option value="learning">üìö H·ªçc t·∫≠p</option>
                            <option value="mindfulness">üßò‚Äç‚ôÄÔ∏è Tinh th·∫ßn</option>
                            <option value="nutrition">ü•ó Dinh d∆∞·ª°ng</option>
                            <option value="personal">üìù C√° nh√¢n</option>
                            <option value="work">üíº C√¥ng vi·ªác</option>
                            <option value="social">üë• X√£ h·ªôi</option>
                            <option value="creative">üé® S√°ng t·∫°o</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ƒê·ªô kh√≥</label>
                        <select id="edit-habit-difficulty" class="form-select" required>
                            <option value="easy">D·ªÖ</option>
                            <option value="medium">Trung b√¨nh</option>
                            <option value="hard">Kh√≥</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Th·ªùi gian b·∫Øt ƒë·∫ßu</label>
                        <input type="time" id="edit-habit-start-time" class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Th·ªùi gian k·∫øt th√∫c</label>
                        <input type="time" id="edit-habit-end-time" class="form-input">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Khung th·ªùi gian</label>
                    <select id="edit-habit-timeframe" class="form-select" required>
                        <option value="morning">üåÖ Bu·ªïi s√°ng (5:00 - 12:00)</option>
                        <option value="afternoon">‚òÄÔ∏è Bu·ªïi chi·ªÅu (12:00 - 18:00)</option>
                        <option value="evening">üåô Bu·ªïi t·ªëi (18:00 - 23:00)</option>
                        <option value="anytime">‚è∞ B·∫•t k·ª≥ l√∫c n√†o</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">T·∫ßn su·∫•t</label>
                    <select id="edit-habit-frequency" class="form-select" required>
                        <option value="daily">H√†ng ng√†y</option>
                        <option value="weekly">H√†ng tu·∫ßn</option>
                        <option value="custom">T√πy ch·ªânh</option>
                    </select>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('edit-habit-modal')">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">C·∫≠p nh·∫≠t th√≥i quen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Time Suggestion Panel -->
    <div class="time-suggestion-panel" id="time-suggestion-panel" style="display: none;">
        <div class="suggestion-content">
            <h4 class="suggestion-title">üí° ƒê·ªÅ xu·∫•t th·ªùi gian t·ªëi ∆∞u</h4>
            <div class="suggestion-list" id="suggestion-list">
                <!-- Time suggestions will be populated here -->
            </div>
            <button class="btn btn-secondary" onclick="closeSuggestionPanel()">ƒê√≥ng</button>
        </div>
    </div>

    <!-- Pull to Refresh Indicator -->
    <div class="pull-to-refresh" id="pull-to-refresh">
        <div class="refresh-icon"></div>
        <span>K√©o ƒë·ªÉ l√†m m·ªõi...</span>
    </div>

    <!-- Auto Refresh Indicator -->
    <div class="auto-refresh-indicator" id="auto-refresh-indicator">
        ƒê√£ c·∫≠p nh·∫≠t d·ªØ li·ªáu
    </div>

    <!-- Page Transition -->
    <div class="page-transition" id="page-transition">
        <div class="transition-content">
            <div class="transition-spinner"></div>
            <div>ƒêang l√†m m·ªõi d·ªØ li·ªáu...</div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Audio for completion sound -->
    <audio id="completion-sound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmAaBTeM0vLOeSgF" type="audio/wav">
    </audio>

    <script>
        // Global variables
        let currentTab = 'today';
        let currentCategory = 'all';
        let habitIdCounter = 1000;
        let currentDate = new Date();
        let darkMode = true;
        let soundEnabled = false;
        let notificationsEnabled = true;

        // Load settings from localStorage
        function loadSettings() {
            const savedDarkMode = localStorage.getItem('darkMode');
            const savedSound = localStorage.getItem('soundEnabled');
            const savedNotifications = localStorage.getItem('notificationsEnabled');

            if (savedDarkMode !== null) {
                darkMode = savedDarkMode === 'true';
            }
            if (savedSound !== null) {
                soundEnabled = savedSound === 'true';
            }
            if (savedNotifications !== null) {
                notificationsEnabled = savedNotifications === 'true';
            }

            applySettings();
        }

        // Apply settings to UI
        function applySettings() {
            if (!darkMode) {
                document.body.classList.add('light-mode');
            } else {
                document.body.classList.remove('light-mode');
            }

            document.getElementById('dark-mode-toggle').classList.toggle('active', darkMode);
            document.getElementById('sound-toggle').classList.toggle('active', soundEnabled);
            document.getElementById('notification-toggle').classList.toggle('active', notificationsEnabled);
        }

        // Save settings to localStorage
        function saveSettings() {
            localStorage.setItem('darkMode', darkMode);
            localStorage.setItem('soundEnabled', soundEnabled);
            localStorage.setItem('notificationsEnabled', notificationsEnabled);
        }

        // Play completion sound
        function playCompletionSound() {
            if (soundEnabled) {
                const audio = document.getElementById('completion-sound');
                audio.currentTime = 0;
                audio.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        // Tab Navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                tab.classList.add('active');
                currentTab = tab.dataset.tab;
                
                const tabId = currentTab + '-tab';
                document.getElementById(tabId).classList.add('active');

                if (currentTab === 'calendar') {
                    generateCalendar();
                }
            });
        });

        // Category Filter
        document.querySelectorAll('.category-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentCategory = tab.dataset.category;
                filterHabits();
            });
        });

        function filterHabits() {
            const habitCards = document.querySelectorAll('.habit-card:not(.add-habit-btn)');
            habitCards.forEach(card => {
                if (currentCategory === 'all' || card.classList.contains(currentCategory)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Habit Check Toggle
        function initializeHabitChecks() {
            document.querySelectorAll('.habit-check').forEach(check => {
                check.removeEventListener('click', handleHabitCheck);
                check.addEventListener('click', handleHabitCheck);
            });
        }
        
        function handleHabitCheck(e) {
            e.stopPropagation();
            const check = e.target;
            const card = check.closest('.habit-card');
            
            check.classList.toggle('completed');
            card.classList.toggle('completed');
            
            updateTodaySummary();
            updateStats();
            
            const isCompleted = check.classList.contains('completed');
            
            if (isCompleted) {
                playCompletionSound();
            }
            
            showNotification(
                isCompleted ? 'Th√≥i quen ƒë√£ ho√†n th√†nh! üéâ' : 'ƒê√£ b·ªè ƒë√°nh d·∫•u ho√†n th√†nh',
                isCompleted ? 'success' : 'warning'
            );
            
            // Animation effect
            if (isCompleted) {
                check.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    check.style.transform = 'scale(1.1)';
                }, 150);
            }
        }

        // Quick Actions
        document.querySelector('.quick-action.complete-all').addEventListener('click', () => {
            const checks = document.querySelectorAll('.habit-check:not(.completed)');
            if (checks.length > 0) {
                checks.forEach(check => {
                    check.classList.add('completed');
                    check.closest('.habit-card').classList.add('completed');
                });
                updateTodaySummary();
                updateStats();
                playCompletionSound();
                showNotification('ƒê√£ ho√†n th√†nh t·∫•t c·∫£ th√≥i quen! üèÜ', 'success');
            }
        });

        document.querySelector('.quick-action.skip-all').addEventListener('click', () => {
            const checks = document.querySelectorAll('.habit-check.completed');
            if (checks.length > 0) {
                checks.forEach(check => {
                    check.classList.remove('completed');
                    check.closest('.habit-card').classList.remove('completed');
                });
                updateTodaySummary();
                updateStats();
                showNotification('ƒê√£ b·ªè ƒë√°nh d·∫•u t·∫•t c·∫£ th√≥i quen', 'warning');
            }
        });

        // Update Today Summary
        function updateTodaySummary() {
            const totalHabits = document.querySelectorAll('.habit-card:not(.add-habit-btn) .habit-check').length;
            const completedHabits = document.querySelectorAll('.habit-card:not(.add-habit-btn) .habit-check.completed').length;
            const percentage = totalHabits > 0 ? Math.round((completedHabits / totalHabits) * 100) : 0;
            
            // Update circular progress
            const progressCircle = document.querySelector('.progress-circle');
            const progressText = document.querySelector('.progress-text');
            const circumference = 220;
            const offset = circumference - (percentage / 100) * circumference;
            
            if (progressCircle && progressText) {
                progressCircle.style.strokeDashoffset = offset;
                progressText.textContent = percentage + '%';
            }
            
            // Update summary values
            const summaryValue = document.querySelector('.summary-item:nth-child(2) .summary-value');
            if (summaryValue) {
                summaryValue.textContent = `${completedHabits}/${totalHabits}`;
            }
        }

        // Update Statistics
        function updateStats() {
            const totalHabits = document.querySelectorAll('.habit-card:not(.add-habit-btn)').length;
            const totalHabitsElement = document.getElementById('total-habits');
            if (totalHabitsElement) {
                totalHabitsElement.textContent = totalHabits;
            }

            const completedHabits = document.querySelectorAll('.habit-card:not(.add-habit-btn) .habit-check.completed').length;
            const completionRate = totalHabits > 0 ? Math.round((completedHabits / totalHabits) * 100) : 0;
            const completionRateElement = document.getElementById('completion-rate');
            if (completionRateElement) {
                completionRateElement.textContent = completionRate + '%';
            }
        }

        // Emoji Picker
        document.querySelectorAll('.emoji-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.emoji-option').forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                document.getElementById('selected-emoji').value = option.dataset.emoji;
            });
        });

        // Modal Functions
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Habit Form Submission
        document.getElementById('habit-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const emoji = document.getElementById('selected-emoji').value;
            const name = document.getElementById('habit-name').value.trim();
            const description = document.getElementById('habit-description').value.trim();
            const category = document.getElementById('habit-category').value;
            const difficulty = document.getElementById('habit-difficulty').value;
            const startTime = document.getElementById('habit-start-time').value;
            const endTime = document.getElementById('habit-end-time').value;
            const timeFrame = document.getElementById('habit-timeframe').value;
            const frequency = document.getElementById('habit-frequency').value;
            
            // Validation
            if (!name || !category || !difficulty || !timeFrame || !frequency) {
                showNotification('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!', 'error');
                return;
            }
            
            // Create new habit
            createNewHabitCard({
                emoji,
                name,
                description,
                category,
                difficulty,
                startTime,
                endTime,
                timeFrame,
                frequency
            });
            
            showNotification('Th√≥i quen m·ªõi ƒë√£ ƒë∆∞·ª£c th√™m th√†nh c√¥ng! üéâ', 'success');
            closeModal('add-habit-modal');
            
            // Reset form
            resetForm();
            updateTodaySummary();
            updateStats();
        });

        function resetForm() {
            document.getElementById('habit-form').reset();
            document.querySelectorAll('.emoji-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector('.emoji-option').classList.add('selected');
            document.getElementById('selected-emoji').value = 'üéØ';
        }

        // Create New Habit Card
        function createNewHabitCard(habitData) {
            const habitsGrid = document.querySelector('.habits-grid');
            const addButton = document.querySelector('.add-habit-btn');
            
            const habitCard = document.createElement('div');
            habitCard.className = `habit-card ${habitData.timeFrame}`;
            habitCard.dataset.habitId = habitIdCounter++;
            
            const timeText = habitData.startTime && habitData.endTime 
                ? `${habitData.startTime} - ${habitData.endTime}`
                : getCategoryTimeText(habitData.timeFrame);
            
            const categoryName = getCategoryName(habitData.category);
            
            habitCard.innerHTML = `
                <div class="habit-header">
                    <div class="habit-info">
                        <h3 class="habit-title">
                            <span class="habit-emoji">${habitData.emoji}</span>
                            ${habitData.name}
                        </h3>
                        <p class="habit-category">${categoryName}</p>
                        <p class="habit-time">${timeText}</p>
                        <span class="habit-difficulty ${habitData.difficulty}">${getDifficultyText(habitData.difficulty)}</span>
                    </div>
                    <div class="habit-actions">
                        <button class="habit-check">‚úì</button>
                        <button class="habit-menu">‚ãØ</button>
                    </div>
                </div>
                <div class="habit-progress">
                    <div class="habit-streak">
                        <span class="streak-info">Streak hi·ªán t·∫°i</span>
                        <span class="streak-number">üî• 0 ng√†y</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%;"></div>
                    </div>
                    <div class="progress-text">0% tu·∫ßn n√†y</div>
                </div>
                ${habitData.description ? `<div class="habit-notes">${habitData.description}</div>` : ''}
            `;
            
            // Insert before add button
            habitsGrid.insertBefore(habitCard, addButton);
            
            // Initialize event listeners for new habit
            initializeHabitChecks();
            initializeHabitMenus();
            
            // Add animation
            habitCard.style.opacity = '0';
            habitCard.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                habitCard.style.transition = 'all 0.5s ease';
                habitCard.style.opacity = '1';
                habitCard.style.transform = 'translateY(0)';
            }, 100);
            
            // Apply current filter
            filterHabits();
        }

        // Helper functions
        function getCategoryTimeText(timeFrame) {
            const timeTexts = {
                morning: '5:00 - 12:00',
                afternoon: '12:00 - 18:00',
                evening: '18:00 - 23:00',
                anytime: 'B·∫•t k·ª≥ l√∫c n√†o'
            };
            return timeTexts[timeFrame] || 'Ch∆∞a x√°c ƒë·ªãnh';
        }
        
        function getCategoryName(category) {
            const names = {
                health: 'S·ª©c kh·ªèe',
                learning: 'H·ªçc t·∫≠p',
                mindfulness: 'Tinh th·∫ßn',
                nutrition: 'Dinh d∆∞·ª°ng',
                personal: 'C√° nh√¢n',
                work: 'C√¥ng vi·ªác',
                social: 'X√£ h·ªôi',
                creative: 'S√°ng t·∫°o'
            };
            return names[category] || 'Kh√°c';
        }
        
        function getDifficultyText(difficulty) {
            const texts = {
                easy: 'D·ªÖ',
                medium: 'Trung b√¨nh',
                hard: 'Kh√≥'
            };
            return texts[difficulty] || 'Trung b√¨nh';
        }

        // Initialize Habit Menus
        function initializeHabitMenus() {
            document.querySelectorAll('.habit-menu').forEach(menu => {
                menu.removeEventListener('click', handleHabitMenu);
                menu.addEventListener('click', handleHabitMenu);
            });
        }

        function handleHabitMenu(e) {
            e.stopPropagation();
            const habitCard = e.target.closest('.habit-card');
            showHabitMenu(habitCard, e.target);
        }

        function showHabitMenu(habitCard, menuButton) {
            // Remove existing menu
            const existingMenu = document.querySelector('.habit-context-menu');
            if (existingMenu) {
                existingMenu.remove();
            }
            
            const menu = document.createElement('div');
            menu.className = 'habit-context-menu';
            
            menu.innerHTML = `
                <div class="menu-item" data-action="edit">üìù Ch·ªânh s·ª≠a</div>
                <div class="menu-item" data-action="reset">üîÑ ƒê·∫∑t l·∫°i streak</div>
                <div class="menu-item danger" data-action="delete">üóëÔ∏è X√≥a</div>
            `;
            
            // Position menu
            const rect = menuButton.getBoundingClientRect();
            menu.style.left = (rect.left - 100) + 'px';
            menu.style.top = (rect.bottom + 5) + 'px';
            
            // Add event listeners
            menu.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', () => {
                    const action = item.dataset.action;
                    handleMenuAction(action, habitCard);
                    menu.remove();
                });
            });
            
            document.body.appendChild(menu);
            
            // Close menu when clicking outside
            setTimeout(() => {
                document.addEventListener('click', function closeMenu(e) {
                    if (!menu.contains(e.target)) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                });
            }, 0);
        }

        function handleMenuAction(action, habitCard) {
            switch(action) {
                case 'edit':
                    editHabit(habitCard);
                    break;
                case 'reset':
                    const streakElement = habitCard.querySelector('.streak-number');
                    const progressFill = habitCard.querySelector('.progress-fill');
                    const progressText = habitCard.querySelector('.progress-text');
                    
                    if (streakElement) streakElement.textContent = 'üî• 0 ng√†y';
                    if (progressFill) progressFill.style.width = '0%';
                    if (progressText) progressText.textContent = '0% tu·∫ßn n√†y';
                    
                    showNotification('ƒê√£ ƒë·∫∑t l·∫°i streak th√†nh c√¥ng!', 'success');
                    break;
                case 'delete':
                    if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a th√≥i quen n√†y?')) {
                        habitCard.style.transition = 'all 0.3s ease';
                        habitCard.style.opacity = '0';
                        habitCard.style.transform = 'translateY(-20px)';
                        setTimeout(() => {
                            habitCard.remove();
                            updateTodaySummary();
                            updateStats();
                            showNotification('ƒê√£ x√≥a th√≥i quen!', 'success');
                        }, 300);
                    }
                    break;
            }
        }

        // Calendar Functions
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            const calendarTitle = document.getElementById('calendar-title');
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const monthNames = [
                'Th√°ng 1', 'Th√°ng 2', 'Th√°ng 3', 'Th√°ng 4', 'Th√°ng 5', 'Th√°ng 6',
                'Th√°ng 7', 'Th√°ng 8', 'Th√°ng 9', 'Th√°ng 10', 'Th√°ng 11', 'Th√°ng 12'
            ];
            
            calendarTitle.textContent = `${monthNames[month]}, ${year}`;
            
            // Clear calendar
            calendarGrid.innerHTML = '';
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = (firstDay.getDay() + 6) % 7; // Convert Sunday=0 to Monday=0
            
            // Add previous month days
            const prevMonth = new Date(year, month - 1, 0);
            const daysInPrevMonth = prevMonth.getDate();
            
            for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.textContent = daysInPrevMonth - i;
                calendarGrid.appendChild(dayElement);
            }
            
            // Add current month days
            const today = new Date();
            const isCurrentMonth = year === today.getFullYear() && month === today.getMonth();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day has-habits';
                dayElement.textContent = day;
                
                if (isCurrentMonth && day === today.getDate()) {
                    dayElement.classList.add('today');
                }
                
                // Add random completion status for demo
                if (Math.random() > 0.3) {
                    dayElement.classList.add('completed');
                } else if (Math.random() > 0.5) {
                    dayElement.classList.add('partial');
                }
                
                dayElement.addEventListener('click', () => {
                    showNotification(`ƒê√£ ch·ªçn ng√†y ${day}/${month + 1}/${year}`, 'success');
                });
                
                calendarGrid.appendChild(dayElement);
            }
            
            // Add next month days
            const remainingDays = 42 - (startingDayOfWeek + daysInMonth);
            for (let day = 1; day <= remainingDays; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            }
            
            // Update days in month stat
            const daysInMonthElement = document.getElementById('days-in-month');
            if (daysInMonthElement) {
                daysInMonthElement.textContent = daysInMonth;
            }
        }

        // Calendar Navigation
        document.getElementById('prev-month').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
        });

        document.getElementById('next-month').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
        });

        // Settings Toggle Functions
        document.getElementById('dark-mode-toggle').addEventListener('click', () => {
            darkMode = !darkMode;
            applySettings();
            saveSettings();
            showNotification(`Ch·∫ø ƒë·ªô ${darkMode ? 't·ªëi' : 's√°ng'} ƒë√£ ƒë∆∞·ª£c b·∫≠t`, 'success');
        });

        document.getElementById('sound-toggle').addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            document.getElementById('sound-toggle').classList.toggle('active', soundEnabled);
            saveSettings();
            showNotification(`√Çm thanh ${soundEnabled ? 'b·∫≠t' : 't·∫Øt'}`, 'success');
        });

        document.getElementById('notification-toggle').addEventListener('click', () => {
            notificationsEnabled = !notificationsEnabled;
            document.getElementById('notification-toggle').classList.toggle('active', notificationsEnabled);
            saveSettings();
            showNotification(`Th√¥ng b√°o ${notificationsEnabled ? 'b·∫≠t' : 't·∫Øt'}`, 'success');
        });

        // Export and Clear Data Functions
        function exportData() {
            const data = {
                habits: Array.from(document.querySelectorAll('.habit-card:not(.add-habit-btn)')).map(card => ({
                    title: card.querySelector('.habit-title').textContent,
                    category: card.querySelector('.habit-category').textContent,
                    completed: card.classList.contains('completed')
                })),
                settings: {
                    darkMode,
                    soundEnabled,
                    notificationsEnabled
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'habit-tracker-data.json';
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c xu·∫•t th√†nh c√¥ng!', 'success');
        }

        function clearAllData() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·∫•t c·∫£ d·ªØ li·ªáu? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Notification Function
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Daily Quote Rotation
        const quotes = [
            {
                text: "Th√†nh c√¥ng l√† t·ªïng c·ªßa nh·ªØng n·ªó l·ª±c nh·ªè ƒë∆∞·ª£c l·∫∑p l·∫°i ng√†y n√†y qua ng√†y kh√°c.",
                author: "Robert Collier"
            },
            {
                text: "B·∫°n kh√¥ng th·ªÉ quay l·∫°i v√† thay ƒë·ªïi kh·ªüi ƒë·∫ßu, nh∆∞ng b·∫°n c√≥ th·ªÉ b·∫Øt ƒë·∫ßu t·ª´ n∆°i b·∫°n ƒëang ƒë·ª©ng v√† thay ƒë·ªïi k·∫øt th√∫c.",
                author: "C.S. Lewis"
            },
            {
                text: "ƒê·ªông l·ª±c gi√∫p b·∫°n b·∫Øt ƒë·∫ßu. Th√≥i quen gi√∫p b·∫°n ti·∫øp t·ª•c.",
                author: "Jim Ryun"
            },
            {
                text: "Ch√∫ng ta l√† nh·ªØng g√¨ ch√∫ng ta l·∫∑p ƒëi l·∫∑p l·∫°i. Do ƒë√≥, s·ª± xu·∫•t s·∫Øc kh√¥ng ph·∫£i l√† m·ªôt h√†nh ƒë·ªông, m√† l√† m·ªôt th√≥i quen.",
                author: "Aristotle"
            }
        ];

        function rotateQuote() {
            const quoteText = document.querySelector('.quote-text');
            const quoteAuthor = document.querySelector('.quote-author');
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            
            quoteText.style.opacity = '0';
            quoteAuthor.style.opacity = '0';
            
            setTimeout(() => {
                quoteText.textContent = randomQuote.text;
                quoteAuthor.textContent = `- ${randomQuote.author}`;
                quoteText.style.opacity = '1';
                quoteAuthor.style.opacity = '1';
            }, 300);
        }

        // Close modal when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal(modal.id);
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.active').forEach(modal => {
                    closeModal(modal.id);
                });
            }
        });

        // Edit Habit Function
        let currentEditingHabit = null;

        function editHabit(habitCard) {
            currentEditingHabit = habitCard;
            
            // Extract current habit data
            const title = habitCard.querySelector('.habit-title').textContent.trim();
            const emoji = habitCard.querySelector('.habit-emoji').textContent;
            const name = title.replace(emoji, '').trim();
            const category = habitCard.querySelector('.habit-category').textContent;
            const timeText = habitCard.querySelector('.habit-time').textContent;
            const difficulty = habitCard.querySelector('.habit-difficulty').className.split(' ').pop();
            const notes = habitCard.querySelector('.habit-notes')?.textContent || '';
            
            // Fill edit form
            document.getElementById('edit-selected-emoji').value = emoji;
            document.getElementById('edit-habit-name').value = name;
            document.getElementById('edit-habit-description').value = notes;
            document.getElementById('edit-habit-difficulty').value = difficulty;
            
            // Set category
            const categorySelect = document.getElementById('edit-habit-category');
            for (let option of categorySelect.options) {
                if (option.text.includes(category)) {
                    categorySelect.value = option.value;
                    break;
                }
            }
            
            // Extract and set times
            if (timeText.includes(' - ') && !timeText.includes('B·∫•t k·ª≥')) {
                const times = timeText.split(' - ');
                document.getElementById('edit-habit-start-time').value = times[0];
                document.getElementById('edit-habit-end-time').value = times[1];
            }
            
            // Set timeframe based on card class
            let timeframe = 'anytime';
            if (habitCard.classList.contains('morning')) timeframe = 'morning';
            else if (habitCard.classList.contains('afternoon')) timeframe = 'afternoon';
            else if (habitCard.classList.contains('evening')) timeframe = 'evening';
            document.getElementById('edit-habit-timeframe').value = timeframe;
            
            // Initialize emoji picker for edit modal
            document.querySelectorAll('#edit-emoji-picker .emoji-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.emoji === emoji) {
                    option.classList.add('selected');
                }
                option.addEventListener('click', () => {
                    document.querySelectorAll('#edit-emoji-picker .emoji-option').forEach(o => o.classList.remove('selected'));
                    option.classList.add('selected');
                    document.getElementById('edit-selected-emoji').value = option.dataset.emoji;
                });
            });
            
            openModal('edit-habit-modal');
        }

        // Edit Habit Form Submission
        document.getElementById('edit-habit-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            if (!currentEditingHabit) return;
            
            const emoji = document.getElementById('edit-selected-emoji').value;
            const name = document.getElementById('edit-habit-name').value.trim();
            const description = document.getElementById('edit-habit-description').value.trim();
            const category = document.getElementById('edit-habit-category').value;
            const difficulty = document.getElementById('edit-habit-difficulty').value;
            const startTime = document.getElementById('edit-habit-start-time').value;
            const endTime = document.getElementById('edit-habit-end-time').value;
            const timeFrame = document.getElementById('edit-habit-timeframe').value;
            
            if (!name || !category || !difficulty || !timeFrame) {
                showNotification('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!', 'error');
                return;
            }
            
            // Update habit card
            updateHabitCard(currentEditingHabit, {
                emoji, name, description, category, difficulty, startTime, endTime, timeFrame
            });
            
            showNotification('Th√≥i quen ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng! ‚ú®', 'success');
            closeModal('edit-habit-modal');
            currentEditingHabit = null;
        });

        function updateHabitCard(habitCard, habitData) {
            const timeText = habitData.startTime && habitData.endTime 
                ? `${habitData.startTime} - ${habitData.endTime}`
                : getCategoryTimeText(habitData.timeFrame);
            
            const categoryName = getCategoryName(habitData.category);
            
            // Update card classes
            habitCard.className = `habit-card ${habitData.timeFrame}`;
            if (habitCard.classList.contains('completed')) {
                habitCard.classList.add('completed');
            }
            
            // Update content
            habitCard.querySelector('.habit-emoji').textContent = habitData.emoji;
            habitCard.querySelector('.habit-title').innerHTML = `
                <span class="habit-emoji">${habitData.emoji}</span>
                ${habitData.name}
            `;
            habitCard.querySelector('.habit-category').textContent = categoryName;
            habitCard.querySelector('.habit-time').textContent = timeText;
            habitCard.querySelector('.habit-difficulty').textContent = getDifficultyText(habitData.difficulty);
            habitCard.querySelector('.habit-difficulty').className = `habit-difficulty ${habitData.difficulty}`;
            
            // Update or add notes
            let notesElement = habitCard.querySelector('.habit-notes');
            if (habitData.description) {
                if (!notesElement) {
                    notesElement = document.createElement('div');
                    notesElement.className = 'habit-notes';
                    habitCard.appendChild(notesElement);
                }
                notesElement.textContent = habitData.description;
            } else if (notesElement) {
                notesElement.remove();
            }
        }

        // Time Suggestion System
        function showTimeSuggestions(category) {
            const suggestions = getTimeSuggestions(category);
            const suggestionList = document.getElementById('suggestion-list');
            const panel = document.getElementById('time-suggestion-panel');
            
            suggestionList.innerHTML = '';
            
            suggestions.forEach(suggestion => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.innerHTML = `
                    <div class="suggestion-time">${suggestion.time}</div>
                    <div class="suggestion-reason">${suggestion.reason}</div>
                `;
                item.addEventListener('click', () => {
                    applySuggestion(suggestion);
                    closeSuggestionPanel();
                });
                suggestionList.appendChild(item);
            });
            
            panel.style.display = 'block';
            setTimeout(() => {
                panel.style.opacity = '1';
                panel.style.transform = 'translateY(-50%) scale(1)';
            }, 10);
        }

        function getTimeSuggestions(category) {
            const suggestions = {
                health: [
                    { time: '06:00 - 07:00', reason: 'Bu·ªïi s√°ng l√† th·ªùi gian t·ªët nh·∫•t cho ho·∫°t ƒë·ªông th·ªÉ ch·∫•t' },
                    { time: '17:00 - 18:00', reason: 'Bu·ªïi chi·ªÅu mu·ªôn gi√∫p gi·∫£i t·ªèa cƒÉng th·∫≥ng' },
                    { time: '07:00 - 08:00', reason: 'Sau khi th·ª©c d·∫≠y, c∆° th·ªÉ ƒë√£ s·∫µn s√†ng v·∫≠n ƒë·ªông' }
                ],
                learning: [
                    { time: '08:00 - 09:00', reason: 'ƒê·∫ßu √≥c minh m·∫´n nh·∫•t v√†o bu·ªïi s√°ng' },
                    { time: '14:00 - 15:00', reason: 'Sau b·ªØa tr∆∞a, n√£o b·ªô ho·∫°t ƒë·ªông t·ªët' },
                    { time: '20:00 - 21:00', reason: 'Bu·ªïi t·ªëi y√™n tƒ©nh, d·ªÖ t·∫≠p trung' }
                ],
                mindfulness: [
                    { time: '06:30 - 06:45', reason: 'B·∫Øt ƒë·∫ßu ng√†y v·ªõi t√¢m tr·∫°ng b√¨nh an' },
                    { time: '12:00 - 12:15', reason: 'Gi·ªØa tr∆∞a gi√∫p t√°i t·∫°o nƒÉng l∆∞·ª£ng' },
                    { time: '21:30 - 21:45', reason: 'Cu·ªëi ng√†y ƒë·ªÉ th∆∞ gi√£n v√† ngh·ªâ ng∆°i' }
                ],
                nutrition: [
                    { time: '07:00 - 08:00', reason: 'B·ªØa s√°ng l√† b·ªØa quan tr·ªçng nh·∫•t' },
                    { time: '10:00 - 10:15', reason: 'B·ªØa ph·ª• bu·ªïi s√°ng b·ªï sung nƒÉng l∆∞·ª£ng' },
                    { time: '15:00 - 15:15', reason: 'B·ªØa ph·ª• chi·ªÅu gi√∫p duy tr√¨ ƒë∆∞·ªùng huy·∫øt' }
                ],
                personal: [
                    { time: '21:00 - 21:30', reason: 'Cu·ªëi ng√†y ƒë·ªÉ suy ng·∫´m v√† ghi ch√©p' },
                    { time: '19:00 - 19:30', reason: 'Sau b·ªØa t·ªëi, t√¢m tr·∫°ng tho·∫£i m√°i' },
                    { time: '22:00 - 22:15', reason: 'Tr∆∞·ªõc khi ng·ªß ƒë·ªÉ t·ªïng k·∫øt ng√†y' }
                ]
            };
            
            return suggestions[category] || [
                { time: '09:00 - 10:00', reason: 'Th·ªùi gian linh ho·∫°t ph√π h·ª£p m·ªçi ho·∫°t ƒë·ªông' },
                { time: '14:00 - 15:00', reason: 'Bu·ªïi chi·ªÅu nƒÉng su·∫•t cao' },
                { time: '19:00 - 20:00', reason: 'Bu·ªïi t·ªëi th∆∞ gi√£n' }
            ];
        }

        function applySuggestion(suggestion) {
            const times = suggestion.time.split(' - ');
            document.getElementById('habit-start-time').value = times[0];
            document.getElementById('habit-end-time').value = times[1];
            
            // Also apply to edit form if open
            if (document.getElementById('edit-habit-modal').classList.contains('active')) {
                document.getElementById('edit-habit-start-time').value = times[0];
                document.getElementById('edit-habit-end-time').value = times[1];
            }
            
            showNotification(`ƒê√£ √°p d·ª•ng th·ªùi gian ƒë·ªÅ xu·∫•t: ${suggestion.time}`, 'success');
        }

        function closeSuggestionPanel() {
            const panel = document.getElementById('time-suggestion-panel');
            panel.style.opacity = '0';
            panel.style.transform = 'translateY(-50%) scale(0.9)';
            setTimeout(() => {
                panel.style.display = 'none';
            }, 300);
        }

        // Add suggestion trigger when category changes
        document.getElementById('habit-category').addEventListener('change', function() {
            if (this.value) {
                setTimeout(() => {
                    showTimeSuggestions(this.value);
                }, 500);
            }
        });

        document.getElementById('edit-habit-category').addEventListener('change', function() {
            if (this.value) {
                setTimeout(() => {
                    showTimeSuggestions(this.value);
                }, 500);
            }
        });

        // Smart time validation
        function validateTimeInput() {
            const startTime = document.getElementById('habit-start-time').value;
            const endTime = document.getElementById('habit-end-time').value;
            
            if (startTime && endTime) {
                const start = new Date(`2000-01-01T${startTime}`);
                const end = new Date(`2000-01-01T${endTime}`);
                
                if (start >= end) {
                    showNotification('Th·ªùi gian k·∫øt th√∫c ph·∫£i sau th·ªùi gian b·∫Øt ƒë·∫ßu!', 'warning');
                    return false;
                }
                
                const duration = (end - start) / (1000 * 60); // minutes
                if (duration < 5) {
                    showNotification('Th√≥i quen n√™n k√©o d√†i √≠t nh·∫•t 5 ph√∫t!', 'warning');
                    return false;
                } else if (duration > 480) { // 8 hours
                    showNotification('Th√≥i quen kh√¥ng n√™n qu√° 8 ti·∫øng!', 'warning');
                    return false;
                }
            }
            
            return true;
        }

        // Add time validation to inputs
        document.getElementById('habit-end-time').addEventListener('change', validateTimeInput);
        document.getElementById('edit-habit-end-time').addEventListener('change', validateTimeInput);

        // Enhanced Refresh System
        let pullDistance = 0;
        let isPulling = false;
        let startY = 0;
        let autoRefreshInterval = null;

        function initializeRefreshSystem() {
            // Pull-to-refresh functionality
            document.addEventListener('touchstart', handleTouchStart, { passive: true });
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd, { passive: true });

            // Auto-refresh every 5 minutes
            startAutoRefresh();
        }

        function handleTouchStart(e) {
            if (window.scrollY === 0) {
                startY = e.touches[0].clientY;
                isPulling = true;
            }
        }

        function handleTouchMove(e) {
            if (!isPulling) return;
            
            const currentY = e.touches[0].clientY;
            pullDistance = Math.max(0, currentY - startY);
            
            if (pullDistance > 0) {
                e.preventDefault();
                updatePullIndicator();
            }
        }

        function handleTouchEnd() {
            if (!isPulling) return;
            
            isPulling = false;
            
            if (pullDistance > 80) {
                triggerRefresh();
            } else {
                resetPullIndicator();
            }
            
            pullDistance = 0;
        }

        function updatePullIndicator() {
            const indicator = document.getElementById('pull-to-refresh');
            const progress = Math.min(pullDistance / 80, 1);
            
            if (progress > 0) {
                indicator.classList.add('active');
                indicator.style.transform = `translateX(-50%) translateY(${Math.min(pullDistance - 60, 20)}px) scale(${0.8 + (progress * 0.2)})`;
                indicator.style.opacity = progress;
                
                if (progress >= 1) {
                    indicator.querySelector('span').textContent = 'Th·∫£ ƒë·ªÉ l√†m m·ªõi...';
                } else {
                    indicator.querySelector('span').textContent = 'K√©o ƒë·ªÉ l√†m m·ªõi...';
                }
            }
        }

        function resetPullIndicator() {
            const indicator = document.getElementById('pull-to-refresh');
            indicator.classList.remove('active');
            indicator.style.transform = 'translateX(-50%)';
            indicator.style.opacity = '0';
            indicator.querySelector('span').textContent = 'K√©o ƒë·ªÉ l√†m m·ªõi...';
        }

        function triggerRefresh() {
            showPageTransition();
            
            // Simulate refresh delay
            setTimeout(() => {
                performRefresh();
                hidePageTransition();
                showAutoRefreshIndicator('D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l√†m m·ªõi!');
            }, 1500);
            
            resetPullIndicator();
        }

        function manualRefresh() {
            showPageTransition();
            
            setTimeout(() => {
                performRefresh();
                hidePageTransition();
                showAutoRefreshIndicator('ƒê√£ l√†m m·ªõi th√†nh c√¥ng!');
            }, 1000);
        }

        function performRefresh() {
            // Refresh all data and UI
            updateTodaySummary();
            updateStats();
            generateCalendar();
            filterHabits();
            
            // Refresh habit checks for today
            const today = new Date().toDateString();
            const todayHabits = document.querySelectorAll('.habit-card');
            
            todayHabits.forEach(card => {
                const checkbox = card.querySelector('.habit-checkbox');
                if (checkbox) {
                    // Re-initialize checkbox state
                    initializeHabitCheck(checkbox);
                }
            });
            
            // Update progress animations
            document.querySelectorAll('.progress-fill').forEach(fill => {
                const width = fill.style.width;
                fill.style.width = '0%';
                setTimeout(() => {
                    fill.style.width = width;
                }, 100);
            });
        }

        function showPageTransition() {
            document.getElementById('page-transition').classList.add('active');
        }

        function hidePageTransition() {
            document.getElementById('page-transition').classList.remove('active');
        }

        function showAutoRefreshIndicator(message) {
            const indicator = document.getElementById('auto-refresh-indicator');
            indicator.textContent = message;
            indicator.classList.add('show');
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 3000);
        }

        function startAutoRefresh() {
            // Auto refresh every 5 minutes
            autoRefreshInterval = setInterval(() => {
                if (document.visibilityState === 'visible') {
                    performRefresh();
                    showAutoRefreshIndicator('T·ª± ƒë·ªông c·∫≠p nh·∫≠t d·ªØ li·ªáu');
                }
            }, 300000); // 5 minutes
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        // Enhanced page visibility handling
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                // Page became visible, refresh data
                setTimeout(() => {
                    performRefresh();
                    showAutoRefreshIndicator('Ch√†o m·ª´ng quay l·∫°i!');
                }, 500);
            }
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            initializeHabitChecks();
            initializeHabitMenus();
            updateTodaySummary();
            updateStats();
            generateCalendar();
            initializeRefreshSystem();
            
            // Rotate quote every 30 seconds
            setInterval(rotateQuote, 30000);
            
            // Show welcome notification
            setTimeout(() => {
                showNotification('Ch√†o m·ª´ng b·∫°n quay l·∫°i! H√£y b·∫Øt ƒë·∫ßu ng√†y m·ªõi v·ªõi nh·ªØng th√≥i quen t√≠ch c·ª±c!', 'success');
            }, 1000);
            
            filterHabits();
        });
    </script>
</body>
</html>